<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.84.0"><meta name=description content="SpaceONE Helm Chart를 개발했던 경험
"><meta name=author content="umi0410"><link rel=icon href=https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/120/google/241/whale_1f40b.png type=image/png><title>SpaceONE Helm Chart 개발 :: Jinsu Playground</title><link href=/css/nucleus.css?1624555354 rel=stylesheet><link href=/css/fontawesome-all.min.css?1624555354 rel=stylesheet><link href=/css/hybrid.css?1624555354 rel=stylesheet><link href=/css/featherlight.min.css?1624555354 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1624555354 rel=stylesheet><link href=/css/auto-complete.css?1624555354 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1624555354 rel=stylesheet><link href=/css/theme.css?1624555354 rel=stylesheet><link href=/css/hugo-theme.css?1624555354 rel=stylesheet><link href=/css/theme-umi0410-blue.css?1624555354 rel=stylesheet><link href=/css/custom-umi0410.css?1624555354 rel=stylesheet><script src=/js/jquery-3.3.1.min.js?1624555354></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}:not(pre)>code+span.copy-to-clipboard{display:none}</style></head><body data-url=/experiences/megazone-cloud/spaceone-helm/><nav id=sidebar><div id=header-wrapper><div id=header><a id=logo href=https://umi0410.github.io><span>Jinsu Playground</span></a></div><div id=profile-wrapper><style>#sidebar-profile-message{text-align:left;word-break:keep-all}#sidebar-profile-message>p{margin-top:0;margin-bottom:0;margin-left:10px;font-size:16px}</style><a href=/><img src=/media/profile.png style=width:170px;margin-top:15px></a><div id=sidebar-profile-message><b>박진수 (umi0410)</b></br><p>Golang, Cloud services, MSA, 컨테이너와 자동화, 깔끔한 아키텍쳐에 관심이 많습니다.</p></div></div></div><div class=highlightable><ul class=topics><li data-nav-id=/portfolio/ title="About Jinsu Park (umi0410)" class=dd-item><a href=/portfolio/>About me</a></li><li data-nav-id=/experiences/ title=Experiences class="dd-item
parent"><a href=/experiences/>Experiences</a><ul><li data-nav-id=/experiences/megazone-cloud/ title="메가존 클라우드 데브옵스 인턴 후기" class="dd-item
parent"><a href=/experiences/megazone-cloud/><b></b>Megazone Cloud DevOps</a><ul><li data-nav-id=/experiences/megazone-cloud/stargate-infra/ title="Stargate라는 인프라 구축기" class=dd-item><a href=/experiences/megazone-cloud/stargate-infra/><b></b>인프라 구축기</a></li><li data-nav-id=/experiences/megazone-cloud/ci-cd-pipeline/ title="Github Action, Spinnaker을 이용한 CI/CD 파이프라인 구축기" class=dd-item><a href=/experiences/megazone-cloud/ci-cd-pipeline/><b></b>CI/CD 파이프라인</a></li><li data-nav-id=/experiences/megazone-cloud/argo-poc/ title="Argo Project들에 대한 PoC(개념 증명) 진행" class=dd-item><a href=/experiences/megazone-cloud/argo-poc/><b></b>Argo Project PoC</a></li><li data-nav-id=/experiences/megazone-cloud/spaceone-helm/ title="SpaceONE Helm Chart 개발" class="dd-item active"><a href=/experiences/megazone-cloud/spaceone-helm/><b></b>Helm Chart 개발</a></li><li data-nav-id=/experiences/megazone-cloud/spacectl/ title="SpaceONE CLI Client인 spacectl 설계 및 개발" class=dd-item><a href=/experiences/megazone-cloud/spacectl/><b></b>CLI Client 설계.개발</a></li></ul></li></ul></li><li data-nav-id=/blog/ title=Blog class=dd-item><a href=/blog/>Blog</a><ul><li data-nav-id=/blog/golang/ title="Go 언어" class=dd-item><a href=/blog/golang/>Go 언어</a><ul><li data-nav-id=/blog/golang/go-vs-java-oop/ title="Go vs Java - Go에서의 객체 지향" class=dd-item><a href=/blog/golang/go-vs-java-oop/><b></b>Go vs Java - Go에서의 객체 지향</a></li><li data-nav-id=/blog/golang/go-concurrency-pattern-use-case-view-count/ title="Go concurrency pattern - channel을 통해 간단히 세마포어처럼 동시 작업 속도 조절하기 (feat. 조회수 증가 기능)" class=dd-item><a href=/blog/golang/go-concurrency-pattern-use-case-view-count/><b></b>channel을 통해 동시성을 제어하며 게시물 조회수 증가시키기</a></li><li data-nav-id=/blog/golang/go-mutex-semaphore/ title="Go 언어로 적용해보는 Computer Science - Mutex와 Semaphore" class=dd-item><a href=/blog/golang/go-mutex-semaphore/><b></b>Mutex와 Semaphore</a></li><li data-nav-id=/blog/golang/go-deadlock/ title="Go 언어로 적용해보는 Computer Science - Deadlock" class=dd-item><a href=/blog/golang/go-deadlock/><b></b>Deadlock</a></li><li data-nav-id=/blog/golang/go-cpu-cache/ title="Go 언어로 적용해보는 Computer Science - Cache" class=dd-item><a href=/blog/golang/go-cpu-cache/><b></b>Cache</a></li><li data-nav-id=/blog/golang/go-concurrency-vs-parallelism/ title="Go 언어로 적용해보는 Computer Science - Concurrency vs Parallelism" class=dd-item><a href=/blog/golang/go-concurrency-vs-parallelism/><b></b>Concurrency vs Parallelism</a></li><li data-nav-id=/blog/golang/go-socket/ title="Go 언어로 적용해보는 Computer Science - Socket (Unix Domain Socket, Network/TCP/UDP Socket)" class=dd-item><a href=/blog/golang/go-socket/><b></b>Socket</a></li><li data-nav-id=/blog/golang/go-memory-leak-issue/ title="개발 썰 - Go Memory Leak(메모리 누수) 관련 이슈" class=dd-item><a href=/blog/golang/go-memory-leak-issue/><b></b>개발 썰 - Go Memory Leak(메모리 누수) 관련 이슈</a></li><li data-nav-id=/blog/golang/go-concurrent-pattern-pipeline/ title="Go의 Pipeline pattern. 언제 사용해야할까? - Golang concurrent patterns" class=dd-item><a href=/blog/golang/go-concurrent-pattern-pipeline/><b></b>Go의 Pipeline pattern. 언제 사용해야할까?</a></li></ul></li><li data-nav-id=/blog/conferences/ title=Conferences class=dd-item><a href=/blog/conferences/>Conferences</a><ul><li data-nav-id=/blog/conferences/naver-deview-2020-cpp-to-golang/ title="Naver Deview 2020 C++ to Golang 리뷰" class=dd-item><a href=/blog/conferences/naver-deview-2020-cpp-to-golang/><b></b>Naver Deview 2020 C++ to Golang 리뷰</a></li></ul></li><li data-nav-id=/blog/aws/ title=AWS class=dd-item><a href=/blog/aws/>AWS</a><ul><li data-nav-id=/blog/aws/aws_eks_elb/ title="EKS K8s에서 ELB(ALB, NLB) 제대로 설정하며 사용하기" class=dd-item><a href=/blog/aws/aws_eks_elb/>EKS K8s에서 ELB(ALB, NLB) 제대로 설정하며 사용하기</a></li></ul></li></ul></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://github.com/umi0410><i class="fab fa-github"></i> Github</a></li></ul></section><section id=footer><p>Built with <a href=https://github.com/matcornic/hugo-theme-learn><i class="fas fa-heart"></i></a> from <a href=https://getgrav.org>Grav</a> and <a href=https://gohugo.io/>Hugo</a></p></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=top-github-link><a class=github-link title="Edit this page" href=https://github.com/umi0410/umi0410.github.io/edit/master/content/experiences/megazone-cloud/spaceone-helm.md target=blank><i class="fas fa-code-branch"></i>
<span id=top-github-link-text>Edit this page</span></a></div><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=/>About Jinsu Park (umi0410)</a> > <a href=/experiences/>Experiences</a> > <a href=/experiences/megazone-cloud/>메가존 클라우드 데브옵스 인턴 후기</a> > SpaceONE Helm Chart 개발</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#spaceone-helm-chart란>SpaceONE Helm Chart란?</a></li><li><a href=#spaceone-helm-설계>spaceone-helm 설계</a></li><li><a href=#spaceone-helm-chart-구조>spaceone-helm chart 구조</a></li><li><a href=#마이크로서비스들의-버전-관리를-시작>마이크로서비스들의 버전 관리를 시작</a></li><li><a href=#helm-chart를-통해-패키지화하며-느낀-점>Helm Chart를 통해 패키지화하며 느낀 점</a></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>SpaceONE Helm Chart 개발</h1><div class=wrapper><hr style=margin-top:20px;margin-bottom:20px></hr><b>Table of Contents</b><nav id=TableOfContents><ul><li><a href=#spaceone-helm-chart란>SpaceONE Helm Chart란?</a></li><li><a href=#spaceone-helm-설계>spaceone-helm 설계</a></li><li><a href=#spaceone-helm-chart-구조>spaceone-helm chart 구조</a></li><li><a href=#마이크로서비스들의-버전-관리를-시작>마이크로서비스들의 버전 관리를 시작</a></li><li><a href=#helm-chart를-통해-패키지화하며-느낀-점>Helm Chart를 통해 패키지화하며 느낀 점</a></li></ul></nav><hr style=margin-top:0;margin-bottom:0></hr></div><p><img src=../spaceone-helm-preview.png alt=spaceone-helm-preivew.png></p><h2 id=spaceone-helm-chart란>SpaceONE Helm Chart란?</h2><p><a href=https://github.com/spaceone-dev/spaceone-helm>spaceone-helm</a> 은 저희
<code>CloudOne</code> 팀이 개발하는 서비스인 <a href=https://spaceone-dev.github.io/>SpaceONE</a>을
<code>helm chart</code>를 이용해 패키지화하는 프로젝트입니다. 원래의 저희 환경은 MicroService들을
개별 배포하고있었지만 오픈소스로 개발되는 저희 서비스를 저희 팀원들 뿐만아니라 다른
개발자들이 쉽게 개발할 수 있고, SpaceONE을 모르던 사용자들도 쉽게 SpaceONE을 구축해볼
수 있도록 하기 위해 패키지화도 진행하게되었습니다.</p><p>일반적으로 만들어진 Helm Chart를 이용해보기만했지 직접 Chart를 만드는 것은 처음 해본 일이기도 했고,
Chart를 개발하면서 새로운 환경에 저희 서비스를 배포해보다보니 삽질하며 고생도 꽤 했고,
무엇보다 프로젝트의 시작부터 퇴사 전까지의 작업들을 거의 제가 도맡아한 프로젝트였기에 개인적으로
애정이 많이 갔습니다 ^_^! 그리고 저도 이제는 저희 Chart를 이용해 SpaceONE을 구축형으로
손쉽게 이용할 수 있었습니다.</p><h2 id=spaceone-helm-설계>spaceone-helm 설계</h2><p>일단은 심플하게 사이드카 없이 저희의 마이크로서비스들만을 배포하고, 그 외에 필요한 서비스들도 최대한
Cloud Service에 의존하지 않고 그때 그때 손쉽게 서비스를 내렸다 올렸다 할 수 있도록 K8s 클러스터 위에
함께 배포하는 형식으로 Chart를 설계했습니다.</p><p>무엇보다 chart 개발의 목적은 아래 두 가지 사항이 컸기 때문에, <code>minikube</code> 혹은 <code>EKS</code> 띄운
마이크로서비스들과 로컬에서 통신이 가능하도록 해야했고, 사용하기 편리한 구조를 만들기 위해
고심했습니다.</p><ul><li>팀원이 아닌 개발자들도 자신의 부가적인 마이크로서비스를 로컬에 띄워 개발할 수 있도록 지원.<ul><li>로컬에서도 쿠버네티스 클러스터 내의 서비스에 접속이 가능해야하고, 경우에 따라 클러스터에서도
본인의 로컬 서비스로 접속을 할 수 있어야함.</li></ul></li><li>오픈소스로서 임의의 사용자가 서비스를 구축해보고자 시도할 때 손 쉽게 구축할 수 있도록 지원.<ul><li>마치 유저들의 사용자 경험을 중요시해서 디자인, 기획을 하듯 Chart의 사용자들이 직관적이고
편리하게 구축할 수 있도록 Configuration values(<code>values.yaml</code> in Helm Chart)를 설계함.</li></ul></li></ul><h2 id=spaceone-helm-chart-구조>spaceone-helm chart 구조</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>templates/
├── backend
│   ├── config
│   │   ├── config-conf.yml
│   │   ├── config-deployment.yml
│   │   └── config-svc.yml
│   ├── identity
│   │   ├── identity-conf.yml
│   │   ├── identity-deployment.yml
│   │   └── identity-svc.yml
│   ├── inventory
│   │   ├── inventory-conf.yml
│   │   ├── inventory-deployment.yml
│   │   └── inventory-svc.yml
│   ├── inventory-scheduler
│   │   ├── inventory-scheduler-conf.yml
│   │   ├── inventory-scheduler-deployment.yml
│   │   └── inventory-scheduler-svc.yml
│   ├── inventory-worker
│   │   ├── inventory-worker-conf.yml
│   │   ├── inventory-worker-deployment.yml
│   │   └── inventory-worker-svc.yml
<span style=color:#75715e>#... Backend 생략</span>
├── consul, mongo, redis <span style=color:#75715e># 디테일한 파일구조는 생략</span>
├── frontend
│   ├── console <span style=color:#75715e># 디테일한 파일구조는 생략</span>
│   └── console-api <span style=color:#75715e># 디테일한 파일구조는 생략</span>
├── ingress
│   └── ingress.yaml
├── initializer
│   ├── initialize-spaceone-conf.yml
│   ├── initialize-spaceone-job.yml
│   ├── spacectl-apply-conf.yml
│   └── spacectl-conf.yml
└── supervisor
    └── supervisor
        ├── supervisor-conf.yml
        ├── supervisor-deployment.yml
        └── supervisor-roles.yml
</code></pre></div><p>저희 <code>spaceone-helm</code> chart는 꽤나 구조가 간단한 편은 아니라고 생각됩니다. 웹페이지 환경상 너무
부수적인 부분은 tree에서 생략하기도 했습니다. 꽤나 복잡한 구조를 가졌기에 패키지화하는 부분이 쉽지 않았지만,
그런 과정 속에서 많이 트러블 슈팅을 경험하고 성장할 수 있었던 것 같습니다.</p><p>그리고 반대로 생각하면, 서비스가 패키지화하기도 쉽지 않을만큼 복잡한 구조를 가졌다면,
당연히 손수 배포하는 것은 그것보다 몇 배는 어려울 것이므로 누군가가 저희 서비스를 구축형으로 이용해주기 위해서는
패키지화가 필수라는 생각이 들었습니다.</p><h2 id=마이크로서비스들의-버전-관리를-시작>마이크로서비스들의 버전 관리를 시작</h2><p>Helm Chart를 개발하고, CI가 고도화되기 전까지는 단순히 팀 내에서 개발을 진행하면서
개발환경에 대한 배포는 <code>latest</code> tag만을 이용해 자동으로 진행하고,
QA를 진행하면서 커밋을 멈추고, 그 시점에 빌드된 Docker image의 Tag를 바탕으로 상용 환경에도
배포를 하곤했습니다. 하지만, Chart에서도 tag를 <code>latest</code>로 유지하거나 가독성이 좋지 않은 임의의
tag를 이용해 이미지를 제공하기는 힘들었고, 맞는 방향이 아니라고 생각했습니다.</p><p>따라서 저희는 꼭 Helm을 통한 패키지 뿐만 아니라 롤백에 대한 안정성, 버전 간의 Update 내역 관리
등을 위해 <code>{{MAJOR}}.{{MINOR}}.{{SPRINT_NUMBER}}-{{EXTRA_TAGS}}</code> 형태를 통해
버전을 관리하고자했습니다.</p><h2 id=helm-chart를-통해-패키지화하며-느낀-점>Helm Chart를 통해 패키지화하며 느낀 점</h2><p>Helm Chart를 통해 저희 서비스를 패키지화하기 전까지는 마이크로서비스 형태로 관리되는 서비스를
새로운 환경에 완전하게 구축한다는 것은 쉽지 않았습니다.
<code>Container</code>라는 것이 ReadOnly 레이어로 이미 구성이 완료된 이미지를 바탕으로 생성되기 때문에
언제 어디서든 구동이 가능하다는 것이 장점이겠지만, 현실적으로는 환경에 따라 이것 저것 설정해줘야하는
것이 있었기때문입니다.</p><p>이러한 난관들은 어떠한 변수처리와 자동화를 통해 해결할 수 있을텐데, 그러한 작업을 해준 녀석이 바로
<code>Helm</code>이었고, 그때 그때 설정을 바꿈으로써 커스터마이징할 수 있다는 점이 알고는 있었습니다만 막상
저희 서비스에 도입해보니 꽤나 만족스러웠습니다.</p><p>일화로 사내 네트워크가 막힌 상황에서도 받아놓은 이미지들만 있으면 네트워크 접속을 할 필요 없이
<code>minikube</code>와 <code>로컬 서버</code>를 이용해 minikube의 클러스터와 통신하면서 개발을 진행할 수도 있었습니다.</p><p>누군가 제가 만든 서비스를 사용해준다는 것은 참 뿌듯한 일이었고, 앞으로도 저희 helm chart가 잘
발전되어 더욱 더 편리하게 구축할 수 있는 형태로 제공될 수 있기를 기대해봅니다!</p><footer class=footline></footer></div><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//umi0410.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><div id=navigation><a class="nav nav-prev" href=/experiences/megazone-cloud/argo-poc/ title="Argo Project들에 대한 PoC(개념 증명) 진행"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=/experiences/megazone-cloud/spacectl/ title="SpaceONE CLI Client인 spacectl 설계 및 개발" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1624555354></script><script src=/js/perfect-scrollbar.min.js?1624555354></script><script src=/js/perfect-scrollbar.jquery.min.js?1624555354></script><script src=/js/jquery.sticky.js?1624555354></script><script src=/js/featherlight.min.js?1624555354></script><script src=/js/highlight.pack.js?1624555354></script><script>hljs.initHighlightingOnLoad()</script><script src=/js/modernizr.custom-3.6.0.js?1624555354></script><script src=/js/learn.js?1624555354></script><script src=/js/hugo-learn.js?1624555354></script><script src=/mermaid/mermaid.js?1624555354></script><script>mermaid.initialize({startOnLoad:!0})</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-177403492-1','auto'),ga('send','pageview'))</script></body></html>