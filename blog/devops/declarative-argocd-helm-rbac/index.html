<!doctype html><html lang=ko-kr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="시작하며 저번 글(&amp;ldquo;ArgoCD 선언적으로 이용해나가기 - Helm, App of App&amp;rdquo;)에서는 Helm과 App of App 패턴을 이용해 ArgoCD를 선언적으로 이용해나가는 방법을 다뤘습니다.
바~로 ArgoCD를 좀 더 선언적으로 이용해나가는 것과 관련된 팁부터 글을 적어나가기는 좀 무리가 있을 것 같아 해당 글에서는
배경지식들에 대한 간략한 정리와 핸즈온 같은 느낌의 내용들도 많이 포함하게 됐던 것 같아요.
이번 글에서는 ArgoCD를 실제로 이용하기 위해 필요할만한 이런 저런 설정들을 어떻게 선언적으로 정의해볼 수 있을지를 소개해보려해요!
그리고 그 예시로 RBAC 설정을 해보겠습니다."><title>ArgoCD 선언적으로 이용해나가기 - Github을 통한 SSO 및 RBAC</title><link rel=canonical href=https://umi0410.github.io/blog/devops/declarative-argocd-helm-rbac/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="ArgoCD 선언적으로 이용해나가기 - Github을 통한 SSO 및 RBAC"><meta property="og:description" content="시작하며 저번 글(&amp;ldquo;ArgoCD 선언적으로 이용해나가기 - Helm, App of App&amp;rdquo;)에서는 Helm과 App of App 패턴을 이용해 ArgoCD를 선언적으로 이용해나가는 방법을 다뤘습니다.
바~로 ArgoCD를 좀 더 선언적으로 이용해나가는 것과 관련된 팁부터 글을 적어나가기는 좀 무리가 있을 것 같아 해당 글에서는
배경지식들에 대한 간략한 정리와 핸즈온 같은 느낌의 내용들도 많이 포함하게 됐던 것 같아요.
이번 글에서는 ArgoCD를 실제로 이용하기 위해 필요할만한 이런 저런 설정들을 어떻게 선언적으로 정의해볼 수 있을지를 소개해보려해요!
그리고 그 예시로 RBAC 설정을 해보겠습니다."><meta property="og:url" content="https://umi0410.github.io/blog/devops/declarative-argocd-helm-rbac/"><meta property="og:site_name" content="Jinsu Playground"><meta property="og:type" content="article"><meta property="article:section" content="Blog"><meta property="article:published_time" content="2022-05-07T22:00:00+09:00"><meta property="article:modified_time" content="2022-05-07T22:00:00+09:00"><meta property="og:image" content="https://umi0410.github.io/blog/devops/declarative-argocd-helm-rbac/logo.png"><meta name=twitter:title content="ArgoCD 선언적으로 이용해나가기 - Github을 통한 SSO 및 RBAC"><meta name=twitter:description content="시작하며 저번 글(&amp;ldquo;ArgoCD 선언적으로 이용해나가기 - Helm, App of App&amp;rdquo;)에서는 Helm과 App of App 패턴을 이용해 ArgoCD를 선언적으로 이용해나가는 방법을 다뤘습니다.
바~로 ArgoCD를 좀 더 선언적으로 이용해나가는 것과 관련된 팁부터 글을 적어나가기는 좀 무리가 있을 것 같아 해당 글에서는
배경지식들에 대한 간략한 정리와 핸즈온 같은 느낌의 내용들도 많이 포함하게 됐던 것 같아요.
이번 글에서는 ArgoCD를 실제로 이용하기 위해 필요할만한 이런 저런 설정들을 어떻게 선언적으로 정의해볼 수 있을지를 소개해보려해요!
그리고 그 예시로 RBAC 설정을 해보겠습니다."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://umi0410.github.io/blog/devops/declarative-argocd-helm-rbac/logo.png"><link rel="shortcut icon" href=https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/120/google/241/whale_1f40b.png><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-177403492-1","auto"),ga("send","pageview"))</script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=East+Sea+Dokdo&family=Noto+Sans+KR:wght@400&display=swap" rel=stylesheet><style>@import 'https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css';:root{--body-background:#fafeff;--base-font-family:Pretendard, 'Noto Sans KR', sans-serif}.site-name{--site-name-font-family:'East Sea Dokdo', cursive;font-family:var(--site-name-font-family);font-size:3.2rem!important}.left-sidebar{--sidebar-avatar-size:200px}figure.site-avatar{margin-left:auto!important;margin-right:auto!important}</style></head><body class="article-page has-toc"><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex
extended"><div id=article-toolbar><a href=https://umi0410.github.io class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>Back</span></a></div><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/blog/devops/declarative-argocd-helm-rbac/><img src=/blog/devops/declarative-argocd-helm-rbac/logo_huc6aa4a846d689b08bb4f93a6ab036ab8_63751_800x0_resize_box_3.png srcset="/blog/devops/declarative-argocd-helm-rbac/logo_huc6aa4a846d689b08bb4f93a6ab036ab8_63751_800x0_resize_box_3.png 800w, /blog/devops/declarative-argocd-helm-rbac/logo_huc6aa4a846d689b08bb4f93a6ab036ab8_63751_1600x0_resize_box_3.png 1600w" width=800 height=371 loading=lazy alt="Featured image of post ArgoCD 선언적으로 이용해나가기 - Github을 통한 SSO 및 RBAC"></a></div><div class=article-details><header class=article-category><a href=/categories/devops/>devops</a></header><h2 class=article-title><a href=/blog/devops/declarative-argocd-helm-rbac/>ArgoCD 선언적으로 이용해나가기 - Github을 통한 SSO 및 RBAC</a></h2><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>May 07, 2022</time></footer></div></header><section class=article-content><h2 id=시작하며>시작하며</h2><p>저번 글(<a class=link href=https://umi0410.github.io/blog/devops/declarative-argocd-helm-app-of-app/ target=_blank rel=noopener>&ldquo;ArgoCD 선언적으로 이용해나가기 - Helm, App of App&rdquo;</a>)에서는
<code>Helm</code>과 <code>App of App</code> 패턴을 이용해 ArgoCD를 선언적으로 이용해나가는 방법을 다뤘습니다.</p><p>바~로 ArgoCD를 좀 더 선언적으로 이용해나가는 것과 관련된 팁부터 글을 적어나가기는 좀 무리가 있을 것 같아 해당 글에서는</p><p>배경지식들에 대한 간략한 정리와 핸즈온 같은 느낌의 내용들도 많이 포함하게 됐던 것 같아요.</p><p>이번 글에서는 <strong>ArgoCD를 실제로 이용하기 위해 필요할만한 이런 저런 설정들을 어떻게 선언적으로 정의해볼 수 있을지</strong>를 소개해보려해요!</p><p>그리고 그 예시로 <code>RBAC 설정</code>을 해보겠습니다. 이번 글에서 수행해볼 작업은 <strong>Github 계정을 ArgoCD와 연동시켜 역할(Role) 기반으로 ArgoCD의 권한을 제어</strong>하는 것이에요.</p><p>&lsquo;<em>왜 RBAC을 ArgoCD 커스터마이징의 예시로 했는가?</em>&lsquo;는 제가 사이드 프로젝트에서 ArgoCD를 이용하면서 Local user(ArgoCD의 자체 계정)을 이용하는 데에 불편이 있었기 때문이에요.
저는 <strong>ArgoCD와 Github 계정을 연동해 RBAC을 이용함으로써 해결</strong>했습니다. 이제는 Admin 계정의 패스워드를 암기할 필요도 새로운 팀원에게 새 계정을 생성해 전달할 일도 필요가 없어졌습니다! 또한 Github 계정 별로 권한을 갖도록 (e.g. readonly) 설정할 수도 있어졌습니다.</p><p>그리고 글의 내용은 &lsquo;<em>제 글만 무조건 따라하면 됩니다</em>&lsquo;보다는 &lsquo;<em>저는 이런 식으로 자료를 찾았고 이렇게 적용해봤어요.</em>&lsquo;식의 내용들을 다뤄보겠습니다.</p><h3 id=본-글에서-사용하는-환경>본 글에서 사용하는 환경</h3><ul><li>핸즈온 과정 참고 레포지토리 - <a class=link href=https://github.com/umi0410/declarative-argocd/tree/master/configuring-rbac target=_blank rel=noopener>https://github.com/umi0410/declarative-argocd/tree/master/configuring-rbac</a></li><li>Minikube를 이용한 K8s Cluster</li><li><a class=link href=https://github.com/argoproj/argo-helm/tree/main/charts/argo-cd target=_blank rel=noopener>ArgoCD Helm Chart</a>를 이용해 argocd namespace에 배포한 ArgoCD</li></ul><h2 id=rbac이란>RBAC이란?</h2><p><code>RBAC</code>은 <code>Role-Based Access Contol</code>의 약자로 쉽게 말하자면 그냥 역할 기반 권한 제어입니다.</p><p>속성 기반으로 나름 복잡한 로직에 의해 어떤 유저가 어떤 리소스에 어떤 작업을 수행할 수 있는지를 정의하는 <code>ABAC(Attribute-Base Access Control)</code>에 비해 그저 간단히 역할에 권한들을 부여하고 유저들은 그 역할을 부여받음으로써 권한을 체크하게 됩니다.</p><p>개인적으로는 많은 경우에 간단히 RBAC만으로도 권한 제어가 충분한 경우가 많은 것 같습니다. 그리고 많은 솔루션들이 RBAC 기능을 지원하는 것 같았어요. ArgoCD 또한 마찬가지로 RBAC을 지원하고 있습니다.</p><h2 id=github-organization--team으로-argocd-rbac-이용하기>Github organization + team으로 ArgoCD RBAC 이용하기</h2><p>자, 그럼 Github의 Organization, Team을 통해 ArgoCD에서 RBAC을 이용해보는 과정을 진행해봅시다!</p><h3 id=1-argocd에-rbac-설정하기>1. ArgoCD에 RBAC 설정하기</h3><p>요즘 인기있는 솔루션들은 <code>RBAC</code> 및 기타 권한 제어 기능이 대부분 존재합니다. 보안과 권한 관리는 아주 중요하기 때문입니다. 그리고 그런 권한 제어의 방법 중 가장 대중적인 방법은 바로 <code>RBAC</code> 입니다.</p><p><figure style=flex-grow:136;flex-basis:327px><a href=/blog/devops/declarative-argocd-helm-rbac/rbac.png data-size=1204x883><img src=/blog/devops/declarative-argocd-helm-rbac/rbac.png srcset="/blog/devops/declarative-argocd-helm-rbac/rbac_hu8a1d47df067db6e35deb191bf75329be_273516_480x0_resize_box_3.png 480w, /blog/devops/declarative-argocd-helm-rbac/rbac_hu8a1d47df067db6e35deb191bf75329be_273516_1024x0_resize_box_3.png 1024w" width=1204 height=883 loading=lazy alt="공식 문서 속 RBAC 설명"></a><figcaption>공식 문서 속 RBAC 설명</figcaption></figure></p><p>공식 문서는 언제나 가장 좋은 교과서입니다. 자세한 방법은 <a class=link href=https://argo-cd.readthedocs.io/en/stable/operator-manual/rbac/ target=_blank rel=noopener>공식 문서</a>에서 찾아보실 수 있습니다.</p><p><figure style=flex-grow:1705;flex-basis:4092px><a href=/blog/devops/declarative-argocd-helm-rbac/helm-chart-rbac.png data-size=1262x74><img src=/blog/devops/declarative-argocd-helm-rbac/helm-chart-rbac.png srcset="/blog/devops/declarative-argocd-helm-rbac/helm-chart-rbac_hu21132895ae0aab5f81e1c0650669ee11_33874_480x0_resize_box_3.png 480w, /blog/devops/declarative-argocd-helm-rbac/helm-chart-rbac_hu21132895ae0aab5f81e1c0650669ee11_33874_1024x0_resize_box_3.png 1024w" width=1262 height=74 loading=lazy alt="ArgoCD Helm Chart 속 Configuration"></a><figcaption>ArgoCD Helm Chart 속 Configuration</figcaption></figure></p><p><figure style=flex-grow:193;flex-basis:464px><a href=/blog/devops/declarative-argocd-helm-rbac/default-values.png data-size=1109x573><img src=/blog/devops/declarative-argocd-helm-rbac/default-values.png srcset="/blog/devops/declarative-argocd-helm-rbac/default-values_hu2c68e4165a00fec2142fab308f6a57c0_319110_480x0_resize_box_3.png 480w, /blog/devops/declarative-argocd-helm-rbac/default-values_hu2c68e4165a00fec2142fab308f6a57c0_319110_1024x0_resize_box_3.png 1024w" width=1109 height=573 loading=lazy alt="default values.yaml"></a><figcaption>default values.yaml</figcaption></figure></p><p>또한 제가 사용한 <a class=link href=https://github.com/argoproj/argo-helm/tree/main/charts/argo-cd target=_blank rel=noopener>ArgoCD Helm Chart에서 제공하는 README.md</a> 속 Configuration 부분과 <a class=link href=https://github.com/argoproj/argo-helm/blob/main/charts/argo-cd/values.yaml target=_blank rel=noopener>default values.yaml</a> 보면</p><p>Helm Chart를 통해 배포한 ArgoCD의 경우 어떻게 values.yaml을 통해 rbac을 설정할 수 있는지 나와있습니다.</p><p>기본 원리는 다음과 같습니다.</p><ul><li><code>p, &lt;role/user/group>, &lt;resource>, &lt;action>, &lt;appproject>/&lt;object></code> - AppProject에 속한 Object(e.g. Application)에 대한 권한을 정의한다.</li><li><code>p, &lt;role/user/group>, &lt;resource>, &lt;action>, &lt;object></code> - AppProject에 속하지 않는 Object(e.g. Clusters, AppProject, Repositories, &mldr;)에 대한 권한을 정의한다.</li></ul><p>그리고 위에서 말하는 Resource나 Action은 다음과 같습니다.</p><ul><li><strong>Resources</strong>: <code>clusters</code>, <code>projects</code>, <code>applications</code>, <code>repositories</code>, <code>certificates</code>, <code>accounts</code>, <code>gpgkeys</code></li><li><strong>Actions</strong>: <code>get</code>, <code>create</code>, <code>update</code>, <code>delete</code>, <code>sync</code>, <code>override</code>, <code>action</code></li></ul><p>공식 문서의 설명이 좀 부족하긴하지만 Github SSO를 이용해 인증하는 경우 RBAC은 다음과 같이 설정할 수 있다고 합니다.</p><pre tabindex=0><code class=language-csv data-lang=csv>p, role:org-admin, applications, *, */*, allow
p, role:org-admin, clusters, get, *, allow
p, role:org-admin, repositories, get, *, allow
p, role:org-admin, repositories, create, *, allow
p, role:org-admin, repositories, update, *, allow
p, role:org-admin, repositories, delete, *, allow

g, your-github-org:your-team, role:org-admin
</code></pre><ul><li>의미: org-admin이라는 Role이 갖는 권한들을 정의하고 해당 :에 속하는 Github user로 로그인한 경우 org-admin Role에 허용된 권한들을 갖는다.</li></ul><p>그리고 저는 다음과 같은 요구사항을 가정하려합니다.</p><p><strong>RBAC 요구사항</strong></p><ul><li>나의 Github Organization <code>khu-dev</code>의 <code>khumu-devops</code> 팀의 유저들은 admin 권한을 갖는다.</li><li>나의 Github Organization <code>khu-dev</code>의 <code>khumu-devops</code> 팀의 유저들은 readonly 권한을 갖는다.</li></ul><p>그 경우 저는 다음과 같이 values.yaml을 작성한 뒤 helm release를 update 해주면 됩니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># values.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>server</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rbacConfig</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>policy.csv</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>      g, khu-dev:khumu-developer, role:readonly
</span></span></span><span class=line><span class=cl><span class=sd>      g, khu-dev:khumu-devops, role:admin</span><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>...</span><span class=w>
</span></span></span></code></pre></div><p><code>readonly</code>와 <code>admin</code>이라는 Role은 공식문서에도 나와있듯 <code>builtin-policy</code>로서 <a class=link href=https://github.com/argoproj/argo-cd/blob/master/assets/builtin-policy.csv target=_blank rel=noopener>이곳</a>에 작성되어 있습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> helm upgrade -n argocd argocd <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=go>  argo/argo-cd -f values.yaml
</span></span></span></code></pre></div><p>그럼 위의 커맨드를 통해 RBAC 설정을 적용시켜주겠습니다.</p><h3 id=2-argocd에-github을-통한-sso-설정하기>2. ArgoCD에 Github을 통한 SSO 설정하기</h3><p>ArgoCD는 <a class=link href=https://github.com/dexidp/dex target=_blank rel=noopener>Dex</a>라는 인증 관련 각종 기능을 담당하는 컴포넌트를 함께 제공하고 있습니다. <code>Github</code>의 <code>OAuth2</code>를 이용해 <code>SSO(Single Sign On)</code>을 이용하는 과정은 <a class=link href=https://argo-cd.readthedocs.io/en/stable/operator-manual/user-management/#dex target=_blank rel=noopener>공식문서 Dex 부분</a>에도
소개되어있고, 사실 이대로 따라만하면 됩니다. ㅎㅎ</p><p><figure style=flex-grow:84;flex-basis:203px><a href=/blog/devops/declarative-argocd-helm-rbac/github-oauth-app.png data-size=660x777><img src=/blog/devops/declarative-argocd-helm-rbac/github-oauth-app.png srcset="/blog/devops/declarative-argocd-helm-rbac/github-oauth-app_hu395b1c716fc41f43b835749ac9fe7844_64355_480x0_resize_box_3.png 480w, /blog/devops/declarative-argocd-helm-rbac/github-oauth-app_hu395b1c716fc41f43b835749ac9fe7844_64355_1024x0_resize_box_3.png 1024w" width=660 height=777 loading=lazy alt="Github OAuth app 생성하기"></a><figcaption>Github OAuth app 생성하기</figcaption></figure></p><p><code>Organization</code> - <code>Settings</code> - <code>Developer Settings</code> - <code>OAuth Apps</code> 에서 위와 같이 OAuth App을 만들어주고 이후 생성되는 <code>Client ID</code>와 <code>Client Secret</code>을 다음과 같이 <code>dex.config</code>에 전달하면 됩니다.
(사실 Organization이 아니라 개인 계정에서 App을 생성해도 동작합니다.)</p><p>단, <code>dex.config</code>는 <code>argocd-cm</code>이라는 Configmap의 <code>.data</code>의 필드로 존재하기 때문에 우리는 Helm chart의 values.yaml에 <code>dex.config</code>를 올바르게 전달해야합니다.
이를 위해선 <code>server.config.dex.config</code>를 다음과 같이 작성해주면 됩니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>server</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>dex.config</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>      connectors:
</span></span></span><span class=line><span class=cl><span class=sd>      # Github OAuth를 통해 SSO하려는 경우
</span></span></span><span class=line><span class=cl><span class=sd>      - type: github
</span></span></span><span class=line><span class=cl><span class=sd>        id: github # 상관 없을 듯 뭘로 하든
</span></span></span><span class=line><span class=cl><span class=sd>        name: GitHub # 상관 없을 듯 뭘로 하든
</span></span></span><span class=line><span class=cl><span class=sd>        config:
</span></span></span><span class=line><span class=cl><span class=sd>          clientID: &lt;your github oauth app client id&gt;
</span></span></span><span class=line><span class=cl><span class=sd>          clientSecret: &lt;your github oauth app client secret&gt;
</span></span></span><span class=line><span class=cl><span class=sd>          orgs:
</span></span></span><span class=line><span class=cl><span class=sd>          - name: &lt;your github organization name&gt; # e.g. khu-dev</span><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>...</span><span class=w>
</span></span></span></code></pre></div><p><strong>server.config.dex.config에 작성해야한다는 것은 어떻게 알 수 있는가?</strong></p><ul><li><a class=link href=https://argo-cd.readthedocs.io/en/stable/operator-manual/declarative-setup/#quick-reference target=_blank rel=noopener>ArgoCD의 공식 문서</a>에서는 <code>argocd-cm.yaml</code>을 &lsquo;General Argo CD configuration&rsquo;로 소개하고 있습니다.</li><li><a class=link href=https://github.com/argoproj/argo-helm/tree/main/charts/argo-cd target=_blank rel=noopener>ArgoCD Helm Chart Github</a>에서는 <code>values.yaml</code> 속 <code>server.config</code>를 동일하게 &lsquo;General Argo CD configuration&rsquo;로 소개하고 있습니다.</li><li>따라서 <code>values.yaml</code> 속 <code>server.config</code>에 정의하는 내용이 곧 <code>argocd-cm.yaml</code>의 <code>.data</code>가 됨을 유추할 수 있습니다.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> helm upgrade -n argocd argocd <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=go>  argo/argo-cd -f values.yaml
</span></span></span></code></pre></div><p>한 번 더 위의 커맨드를 통해 RBAC 설정을 적용시켜주겠습니다.</p><p><figure style=flex-grow:167;flex-basis:401px><a href=/blog/devops/declarative-argocd-helm-rbac/login-via-github.png data-size=1534x916><img src=/blog/devops/declarative-argocd-helm-rbac/login-via-github.png srcset="/blog/devops/declarative-argocd-helm-rbac/login-via-github_hu9c113ddcd41c506471c69869b28b5ba9_827681_480x0_resize_box_3.png 480w, /blog/devops/declarative-argocd-helm-rbac/login-via-github_hu9c113ddcd41c506471c69869b28b5ba9_827681_1024x0_resize_box_3.png 1024w" width=1534 height=916 loading=lazy alt="LOG IN VIA GITHUB 버튼이 추가된 모습"></a><figcaption>LOG IN VIA GITHUB 버튼이 추가된 모습</figcaption></figure></p><p>성공적으로 Github을 통한 SSO가 활성화되면 ArgoCD에 접속할 때 위와 같이 <code>LOG IN VIA GITHUB</code> 버튼이 추가된 것을 확인할 수 있습니다.</p><p>그럼 요구사항대로 <code>khu-dev</code>라는 Github Organization의 <code>khumu-developer</code> Team에 속한 계정으로 ArgoCD에 로그인해보겠습니다.</p><p><figure style=flex-grow:175;flex-basis:421px><a href=/blog/devops/declarative-argocd-helm-rbac/user-info.png data-size=823x469><img src=/blog/devops/declarative-argocd-helm-rbac/user-info.png srcset="/blog/devops/declarative-argocd-helm-rbac/user-info_hucef4272cca453302126c4eebb9e78a82_85359_480x0_resize_box_3.png 480w, /blog/devops/declarative-argocd-helm-rbac/user-info_hucef4272cca453302126c4eebb9e78a82_85359_1024x0_resize_box_3.png 1024w" width=823 height=469 loading=lazy alt="User info"></a><figcaption>User info</figcaption></figure></p><p>성공적으로 로그인한 뒤 <code>&lt;your argocd url>/user-info</code>로 이동하면 위와 같이 : 이라는 이름의 그룹에 속한 모습을 볼 수 있습니다.</p><p><figure style=flex-grow:78;flex-basis:189px><a href=/blog/devops/declarative-argocd-helm-rbac/permission-denied.png data-size=730x925><img src=/blog/devops/declarative-argocd-helm-rbac/permission-denied.png srcset="/blog/devops/declarative-argocd-helm-rbac/permission-denied_hua5411c757f7472ef3825c63a839272be_139750_480x0_resize_box_3.png 480w, /blog/devops/declarative-argocd-helm-rbac/permission-denied_hua5411c757f7472ef3825c63a839272be_139750_1024x0_resize_box_3.png 1024w" width=730 height=925 loading=lazy alt="Permission denied"></a><figcaption>Permission denied</figcaption></figure></p><p>이후 만약 어떤 Application을 Sync하려해도 현재 속한 그룹인 <code>khu-dev:khumu-developer</code>는 <code>readonly</code> Role을 부여받았기에 어떠한 App도 Sync할 권한이 없어 위와 같이 Permission Denied 라는 에러를
맞이하게 됩니다.</p><p><figure style=flex-grow:175;flex-basis:420px><a href=/blog/devops/declarative-argocd-helm-rbac/user-info-2.png data-size=826x471><img src=/blog/devops/declarative-argocd-helm-rbac/user-info-2.png srcset="/blog/devops/declarative-argocd-helm-rbac/user-info-2_hu2b0412c75c988732975fb3f78c2d2f2f_85455_480x0_resize_box_3.png 480w, /blog/devops/declarative-argocd-helm-rbac/user-info-2_hu2b0412c75c988732975fb3f78c2d2f2f_85455_1024x0_resize_box_3.png 1024w" width=826 height=471 loading=lazy alt="User info"></a><figcaption>User info</figcaption></figure></p><p>🎉🎉🎉 하지만 위와 같이 <code>khu-dev:khumu-devops</code>에 속한 계정으로 로그인한 뒤 동일하게 어떤 App을 Sync해보면 이번에는 성공적으로 App이 Sync되는 모습을 볼 수 있습니다. <code>khu-dev:khumu-devops</code> 그룹은 admin Role을 부여받았기 때문입니다!</p><p>자, 그럼 이제는 admin 계정을 비롯한 username, password 기반의 계정을 이용할 필요 없이 Github을 이용해 ArgoCD의 인증/인가를 수행할 수 있습니다 ㅎㅎ</p><h2 id=마치며>마치며</h2><p>새로운 회사에 입사하고 행복하게 적응해나가면서 운동, 취미, 업무까지 챙기다보니 글을 작성해놓고 마무리를 오랜 시간 동안 짓지 못하다가 급히 지방선거일을 기회 삼아 글을 마무리 지어봤습니다.
우선은 ArgoCD를 Helm chart와 함께 선언적으로 이용해나가는 내용은 이 글을 끝으로 2편으로 마무리 지어보려합니다. 사이드 프로젝트에서 ArgoCD를 이용하면서 ArgoCD는 선언적으로 관리가 가능하다는 장점을 많이
써먹지 못하고 좀 더러운 형태로 억지로 사용하다보니 번거롭게 느껴졌던 경우가 많았는데 저 스스로도 이를 선언적인 형태로 개선하면서 많이 편해졌고, 그 과정들을 이렇게 글로 기록하고나니 나름 뿌듯합니다.</p><p>ArgoCD 관련한 또 다른 내용으로는 <a class=link href=https://argocd-applicationset.readthedocs.io/en/stable/ target=_blank rel=noopener>Applpicaitonset</a>에 관해 추후에 기회가 되면 다뤄볼까 생각 중입니다.</p><p>몇 년 전에 처음 데브옵스 엔지니어 인턴으로서 이쪽 일을 시작했을 때 제가 알던 ArgoCD는 &lsquo;ArgoCD라고 요즘 쿠버네티스 환경에서 쓸만한 CD 툴이 있다더라&rsquo; 정도의 도구였던 것 같은데 이제는 자체 CD툴만을 사용하는 기업을 제외하면
쿠버네티스를 사용하는 경우는 대부분이 ArgoCD를 이용할 정도로 대중적인 기술이 된 것 같고, 그 시절보다 많은 기능들을 편리하게 제공하는 기술이 된 것 같아 새삼 기특하단 생각이 들었습니다 ㅎㅎ.</p><p>데브옵스로 입사하면서 거대한 규모의 클라우드 인프라를 다루다보니 네트워크 관련된 내용을 자주 접하게 되고, 이론적으로는 제가 약한 부분이라고 생각이 들어서 앞으로는 DevOps 서비스들보다는 네트워크 공부를 우선적으로 해볼까합니다!
곧 자취를 시작할텐데 라즈베리 파이로 자취방에서 재밌는 무언가를 해볼 수 있을까 싶은 생각도 있구요 ㅎㅎ.
시간이 되면 관련 내용을 틈틈이 기록해보겠습니다! 감사합니다.</p><h2 id=참고자료>참고자료</h2><ul><li><a class=link href=https://www.okta.com/kr/identity-101/role-based-access-control-vs-attribute-based-access-control/ target=_blank rel=noopener>RBAC vs ABAC - Okta</a></li><li><a class=link href=https://argo-cd.readthedocs.io/en/stable/ target=_blank rel=noopener>ArgoCD 공식 문서</a></li><li><a class=link href=https://github.com/argoproj/argo-helm/tree/main/charts/argo-cd target=_blank rel=noopener>ArgoCD Helm Chart</a></li></ul></section><footer class=article-footer><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>관련 글</h2><div class=related-contents><div class="flex article-list--tile"><article class=has-image><a href=/blog/devops/istio-1-10-network-interface/><div class=article-image><img src=/blog/devops/istio-1-10-network-interface/preview.4e9f54549cac5e0bacff136c35e1e401_hu29fb6a1fc6668bac997912987ebc8bfc_15975_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy data-key data-hash="md5-Tp9UVJysXgus/xNsNeHkAQ=="></div><div class=article-details><h2 class=article-title>istio의 envoy proxy를 통해 경험해보는 네트워크 인터페이스 (istio 1.10)</h2></div></a></article><article class=has-image><a href=/blog/devops/declarative-argocd-helm-app-of-app/><div class=article-image><img src=/blog/devops/declarative-argocd-helm-app-of-app/logo.2f2745030cbf1c98f0f25182b22d48aa_huc6aa4a846d689b08bb4f93a6ab036ab8_63751_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy data-key data-hash="md5-LydFAwy/HJjw8lGCsi1Iqg=="></div><div class=article-details><h2 class=article-title>ArgoCD 선언적으로 이용해나가기 - Helm, App of App</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//umi0410.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{DISQUS&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2022 Jinsu Playground</section><section class=powerby><a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a>로 만듦<br><a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a>의 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.4.0>Stack</a></b> 테마 사용 중</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#시작하며>시작하며</a><ol><li><a href=#본-글에서-사용하는-환경>본 글에서 사용하는 환경</a></li></ol></li><li><a href=#rbac이란>RBAC이란?</a></li><li><a href=#github-organization--team으로-argocd-rbac-이용하기>Github organization + team으로 ArgoCD RBAC 이용하기</a><ol><li><a href=#1-argocd에-rbac-설정하기>1. ArgoCD에 RBAC 설정하기</a></li><li><a href=#2-argocd에-github을-통한-sso-설정하기>2. ArgoCD에 Github을 통한 SSO 설정하기</a></li></ol></li><li><a href=#마치며>마치며</a></li><li><a href=#참고자료>참고자료</a></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>