<!doctype html><html lang=ko-kr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="시작하며 직접 구축하는 홈서버에 VM도 추가하고 싶어졌고 이전 글[1]과 마찬가지로 CLI로 VM을 띄워보고 싶었다. 이전 글에서는 VirtualBox를 이용했지만 이번에는 qemu라는 도구를 이용해 VM을 만들어보고자한다.
qemu는 VM을 띄우는 도구들 중에서도 꽤나 로우한 레벨에 있으면서 손쉽게 다양한 아키텍쳐를 가상화해서 사용할 수 있게 해준다. 또한 CLI로 실행하는 프로그램이기에 VM을 손쉽게 띄워보고 싶은 나 같은 경우에 적합하다.
실습 환경 호스트 환경은 아래와 같다.
항목 정보 CPU amd64, 8 Core RAM 16GB Disk 256GB OS Ubuntu server 22."><title>QEMU로 Ubuntu Server VM 생성하기</title><link rel=canonical href=https://umi0410.github.io/blog/companion-server/create-vm-by-qemu/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="QEMU로 Ubuntu Server VM 생성하기"><meta property="og:description" content="시작하며 직접 구축하는 홈서버에 VM도 추가하고 싶어졌고 이전 글[1]과 마찬가지로 CLI로 VM을 띄워보고 싶었다. 이전 글에서는 VirtualBox를 이용했지만 이번에는 qemu라는 도구를 이용해 VM을 만들어보고자한다.
qemu는 VM을 띄우는 도구들 중에서도 꽤나 로우한 레벨에 있으면서 손쉽게 다양한 아키텍쳐를 가상화해서 사용할 수 있게 해준다. 또한 CLI로 실행하는 프로그램이기에 VM을 손쉽게 띄워보고 싶은 나 같은 경우에 적합하다.
실습 환경 호스트 환경은 아래와 같다.
항목 정보 CPU amd64, 8 Core RAM 16GB Disk 256GB OS Ubuntu server 22."><meta property="og:url" content="https://umi0410.github.io/blog/companion-server/create-vm-by-qemu/"><meta property="og:site_name" content="Jinsu Playground"><meta property="og:type" content="article"><meta property="article:section" content="Blog"><meta property="article:published_time" content="2022-12-08T01:31:00+09:00"><meta property="article:modified_time" content="2022-12-08T01:31:00+09:00"><meta property="og:image" content="https://umi0410.github.io/blog/companion-server/create-vm-by-qemu/preview.png"><meta name=twitter:title content="QEMU로 Ubuntu Server VM 생성하기"><meta name=twitter:description content="시작하며 직접 구축하는 홈서버에 VM도 추가하고 싶어졌고 이전 글[1]과 마찬가지로 CLI로 VM을 띄워보고 싶었다. 이전 글에서는 VirtualBox를 이용했지만 이번에는 qemu라는 도구를 이용해 VM을 만들어보고자한다.
qemu는 VM을 띄우는 도구들 중에서도 꽤나 로우한 레벨에 있으면서 손쉽게 다양한 아키텍쳐를 가상화해서 사용할 수 있게 해준다. 또한 CLI로 실행하는 프로그램이기에 VM을 손쉽게 띄워보고 싶은 나 같은 경우에 적합하다.
실습 환경 호스트 환경은 아래와 같다.
항목 정보 CPU amd64, 8 Core RAM 16GB Disk 256GB OS Ubuntu server 22."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://umi0410.github.io/blog/companion-server/create-vm-by-qemu/preview.png"><link rel="shortcut icon" href=https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/120/google/241/whale_1f40b.png><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-177403492-1","auto"),ga("send","pageview"))</script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=East+Sea+Dokdo&family=Noto+Sans+KR:wght@400&display=swap" rel=stylesheet><style>@import 'https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css';:root{--body-background:#fafeff;--base-font-family:Pretendard, 'Noto Sans KR', sans-serif}.site-name{--site-name-font-family:'East Sea Dokdo', cursive;font-family:var(--site-name-font-family);font-size:3.2rem!important}.left-sidebar{--sidebar-avatar-size:200px}figure.site-avatar{margin-left:auto!important;margin-right:auto!important}</style></head><body class="article-page has-toc"><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex
extended"><div id=article-toolbar><a href=https://umi0410.github.io class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>Back</span></a></div><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/blog/companion-server/create-vm-by-qemu/><img src=/blog/companion-server/create-vm-by-qemu/preview_hu13430b402fc78d1a17ca63e4738b897a_1461489_800x0_resize_box_3.png srcset="/blog/companion-server/create-vm-by-qemu/preview_hu13430b402fc78d1a17ca63e4738b897a_1461489_800x0_resize_box_3.png 800w, /blog/companion-server/create-vm-by-qemu/preview_hu13430b402fc78d1a17ca63e4738b897a_1461489_1600x0_resize_box_3.png 1600w" width=800 height=579 loading=lazy alt="Featured image of post QEMU로 Ubuntu Server VM 생성하기"></a></div><div class=article-details><header class=article-category><a href=/categories/companion-server/>반려 서버 키우기</a></header><h2 class=article-title><a href=/blog/companion-server/create-vm-by-qemu/>QEMU로 Ubuntu Server VM 생성하기</a></h2><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>Dec 08, 2022</time></footer></div></header><section class=article-content><h2 id=시작하며>시작하며</h2><p>직접 구축하는 홈서버에 VM도 추가하고 싶어졌고 이전 글<a class=link href=../create-vm-by-vboxmanage/>[1]</a>과 마찬가지로 CLI로 VM을 띄워보고 싶었다.
이전 글에서는 VirtualBox를 이용했지만 이번에는 qemu라는 도구를 이용해 VM을 만들어보고자한다.</p><p>qemu는 VM을 띄우는 도구들 중에서도 꽤나 로우한 레벨에 있으면서 손쉽게 다양한 아키텍쳐를 가상화해서 사용할 수 있게 해준다.
또한 CLI로 실행하는 프로그램이기에 VM을 손쉽게 띄워보고 싶은 나 같은 경우에 적합하다.</p><h2 id=실습-환경>실습 환경</h2><p>호스트 환경은 아래와 같다.</p><table><thead><tr><th>항목</th><th>정보</th></tr></thead><tbody><tr><td>CPU</td><td>amd64, 8 Core</td></tr><tr><td>RAM</td><td>16GB</td></tr><tr><td>Disk</td><td>256GB</td></tr><tr><td>OS</td><td>Ubuntu server 22.04</td></tr></tbody></table><p>구성하고자하는 VM은 다음과 같다.</p><table><thead><tr><th>항목</th><th>정보</th></tr></thead><tbody><tr><td>CPU</td><td>amd64, 2 Core</td></tr><tr><td>RAM</td><td>4GB</td></tr><tr><td>Disk</td><td>16GB</td></tr><tr><td>OS</td><td>Ubuntu server 22.04</td></tr></tbody></table><p>VM을 생성하는 작업은 root 권한을 많이 필요로 할 수 있어 이번 글에서 수행하는 커맨드는 대부분 root 권한으로 수행해야 올바르게 동작할 것이다.
커맨드를 표기할 때에는 root 권한으로 실행한다하더라도 편의상 <code>#</code>이 아닌 <code>$</code> 문자를 커맨드의 맨 앞에 적어뒀다.</p><h2 id=설치하기>설치하기</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># on linux</span>
</span></span><span class=line><span class=cl>$ sudo apt update
</span></span><span class=line><span class=cl>$ sudo apt-get install qemu-kvm qemu
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># on OSX</span>
</span></span><span class=line><span class=cl>$ brew install qemu
</span></span></code></pre></div><p>위와 같이 간단히 qemu를 설치해볼 수 있다. 설치가 잘 됐으면 다음 명령어로 설치된 버전을 확인해볼 수 있을 것이다.
x86_64 아키텍쳐의 VM을 이용할 것이기에 이번 글에서는 <code>qemu-system-x86_64</code>라는 명령어를 사용할 것이다.
편의상 <code>qemu-system-x86_64</code> 명령어에 대해 <code>qs</code>라는 alias를 설정하고 진행하도록 하겠다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ <span class=nb>alias</span> <span class=nv>qs</span><span class=o>=</span><span class=s1>&#39;qemu-system-x86_64&#39;</span>
</span></span><span class=line><span class=cl>$ qs --version
</span></span><span class=line><span class=cl>QEMU emulator version 6.2.0 <span class=o>(</span>Debian 1:6.2+dfsg-2ubuntu6.5<span class=o>)</span>
</span></span><span class=line><span class=cl>Copyright <span class=o>(</span>c<span class=o>)</span> 2003-2021 Fabrice Bellard and the QEMU Project developers
</span></span></code></pre></div><h2 id=이미지-생성하기>이미지 생성하기</h2><p>이미지는 VM의 저장장치로서 사용될 수 있다. 운영체제 설치파일이나 루트로 사용할 저장장치 등이 이미지로 정의된다.</p><p>qemu와 사용할 수 있는 이미지 타입은 <code>raw</code>와 <code>qcow2</code> 이렇게 두 개가 있다. 처음에는 raw를 사용할까싶긴 했지만
스냅샷이나 암호화, 자동화, 압축, 저장공간 효율 등의 측면에서 <code>qcow2</code>를 사용하는 게 더 적합할 것 같았다.
아무래도 <code>raw</code> 타입의 장점은 실제 물리 장비에 근접한 성능인 듯한데 요즘은 <code>qcow2</code>도 성능이 좋다는 것 같았다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ mkdir -p vm1 <span class=o>&amp;&amp;</span> <span class=nb>cd</span> vm1
</span></span><span class=line><span class=cl>$ curl -LO https://cloud-images.ubuntu.com/releases/jammy/release-20221201/ubuntu-22.04-server-cloudimg-amd64.img
</span></span></code></pre></div><p>이번 글에서는 Ubuntu Server 22.04 클라우드 이미지를 통해 운영체제를 자동으로 설치할 것이다.
vm의 이름은 vm1이라고 하고 vm1이라는 디렉토리에서 작업해나갈 것이다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ qemu-img info ubuntu-22.04-server-cloudimg-amd64.img
</span></span><span class=line><span class=cl>image: ubuntu-22.04-server-cloudimg-amd64.img
</span></span><span class=line><span class=cl>file format: qcow2
</span></span><span class=line><span class=cl>virtual size: 2.2 GiB <span class=o>(</span><span class=m>2361393152</span> bytes<span class=o>)</span>
</span></span><span class=line><span class=cl>disk size: <span class=m>636</span> MiB
</span></span><span class=line><span class=cl>cluster_size: <span class=m>65536</span>
</span></span><span class=line><span class=cl>Format specific information:
</span></span><span class=line><span class=cl>    compat: 0.10
</span></span><span class=line><span class=cl>    compression type: zlib
</span></span><span class=line><span class=cl>    refcount bits: <span class=m>16</span>
</span></span></code></pre></div><p>qemu-img라는 프로그램을 통해 다운로드 받은 이미지를 살펴봤다. qemu-img는 qemu의 디스크 이미지와 관련된 편의 도구이다.
이미지를 살펴보니 가상 사이즈가 2.2G로 잡혀있다. VM에서는 자신의 디스크의 크기를 2.2G로 인식할 듯하다.
이를 넉넉하게 16G로 늘려주자.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ qemu-img resize ubuntu-22.04-server-cloudimg-amd64.img 16G
</span></span><span class=line><span class=cl>Image resized.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ qemu-img info ubuntu-22.04-server-cloudimg-amd64.img
</span></span><span class=line><span class=cl>image: ubuntu-22.04-server-cloudimg-amd64.img
</span></span><span class=line><span class=cl>file format: qcow2
</span></span><span class=line><span class=cl>virtual size: <span class=m>16</span> GiB <span class=o>(</span><span class=m>17179869184</span> bytes<span class=o>)</span>
</span></span><span class=line><span class=cl>disk size: <span class=m>636</span> MiB
</span></span><span class=line><span class=cl>cluster_size: <span class=m>65536</span>
</span></span><span class=line><span class=cl>Format specific information:
</span></span><span class=line><span class=cl>    compat: 0.10
</span></span><span class=line><span class=cl>    compression type: zlib
</span></span><span class=line><span class=cl>    refcount bits: <span class=m>16</span>
</span></span></code></pre></div><p>이미지를 16G로 resize 해준 뒤 다시 info를 통해 정보를 조회해보면 virtual size가 16G로 늘어난 것을 확인할 수 있다.</p><p>이제 Auto install 시에 사용할 설정 정보를 정의하는 디스크 이미지를 만들 차례이다. 이와 관련해서는 cloud-init이나 user-data 같은 키워드들이가 존재하니
자세한 사항이 필요하면 별도로 찾아보는 게 나을 듯하다. 대충 <a class=link href=https://cloudinit.readthedocs.io/en/latest/topics/examples.html target=_blank rel=noopener>이곳의 예시</a>처럼 생겼다.</p><p>간략히 설명하면 ubuntu를 자동 설치할 때 <code>user-data</code>나 <code>metadata</code>라는 파일을 통해 초기 설정을 정의할 수 있다.
이를 통해 나는 나의 ssh 공개키나 vm의 hostname등을 정의해보려한다. ssh 공개키를 정의하는 PC에서 VM에 SSH 접속 시 사용하기 위해서이다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c>#cloud-config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>ssh_authorized_keys</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- {{<span class=w> </span><span class=l>본인이 SSH 접속 시 사용하는 비밀키에 대한 공개키 }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu</span><span class=w>
</span></span></span></code></pre></div><p><code>user-data</code> 파일을 위와 같이 작성해줬다. SSH 공개키는 나의 경우 <code>ssh-ed25519 FooBar(생략) Jinsu</code> 뭐 이런 식으로 생겼다.
주의할 점은 첫 문장은 주석일지라도 <code>#cloud-config</code>로 적어줘야 인식이 된다는 점이다! 그냥 user-data, cloud-init 스펙이 그렇다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>local-hostname</span><span class=p>:</span><span class=w> </span><span class=l>vm1</span><span class=w>
</span></span></span></code></pre></div><p>앞서 언급한 대로 VM의 이름은 vm1을 사용할 것이므로 hostname을 vm1으로 변경해봤다.</p><p>그럼 이제 <code>user-data</code>와 <code>metadata</code>라는 두 파일을 볼륨으로서 사용할 수 있게 해주는 이미지를 만들어줘야한다.
이때에는 cloud-localds라는 도구를 이용하는 것이 편리했다. Cloud Init 설정용 볼륨이라는 것을 인식하기 위해서는 해당 볼륨에 CI 등의 라벨이 달려있어야하며 몇몇의 특정 파일 시스템을 이용해야한다고 한다.
cloud-localds는 그런 조건을 만족시키는 볼륨의 이미지를 알아서 잘 만들어준다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ apt install -y cloud-image-utils
</span></span><span class=line><span class=cl>$ cloud-localds seed.img user-data metadata
</span></span></code></pre></div><p>해당 이미지의 이름은 <code>seed.img</code>라고 지어줬다. 이 이미지는 <code>user-data</code>와 <code>metadata</code> 두 파일만을 포함하는 볼륨을 나타낼 것이다.
좀 더 확인해보고 싶다면 다음 명령어로 확인해볼 수 있었다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ mkdir -p /mnt/vm1-seed
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ mount seed.img /mnt/vm1-seed
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ ls -al /mnt/vm1-seed
</span></span><span class=line><span class=cl>total <span class=m>7</span>
</span></span><span class=line><span class=cl>dr-xr-xr-x <span class=m>2</span> root root <span class=m>2048</span> Dec  <span class=m>7</span> 14:43 .
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>7</span> root root <span class=m>4096</span> Dec  <span class=m>7</span> 14:44 ..
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root root   <span class=m>20</span> Dec  <span class=m>7</span> 14:43 meta-data
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root root  <span class=m>144</span> Dec  <span class=m>7</span> 14:43 user-data
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 다시 umount하고 /mnt/vm1-seed 디렉토리 삭제</span>
</span></span><span class=line><span class=cl>$ umount seed.img
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ rm -r /mnt/vm1-seed
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ umount /mnt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ lsblk -f
</span></span><span class=line><span class=cl>root@whale-home:~/vm1# lsblk -f
</span></span><span class=line><span class=cl>NAME                    FSTYPE      FSVER            LABEL  UUID                                   FSAVAIL FSUSE% MOUNTPOINTS
</span></span><span class=line><span class=cl>loop0                   iso9660     Joliet Extension cidata 2022-12-07-14-43-10-00                       <span class=m>0</span>   100% /mnt/seed
</span></span><span class=line><span class=cl><span class=o>(</span>...생략<span class=o>)</span>
</span></span><span class=line><span class=cl>sda
</span></span><span class=line><span class=cl>├─sda1                  vfat        FAT32                   B125-AD84                                   1G     0% /boot/efi
</span></span><span class=line><span class=cl>├─sda2                  ext4        1.0                     a472b2ba-5b46-4495-8dc6-abe59a2e5153      1.5G    13% /boot
</span></span><span class=line><span class=cl>└─sda3                  LVM2_member LVM2 <span class=m>001</span>                D94K0G-n2UY-sxNu-nw23-962h-ZVSa-njxMOk
</span></span><span class=line><span class=cl>  └─ubuntu--vg-ubuntu--lv ext4        1.0                     6f3fa5e0-59bb-4cea-97e0-aa86b7cb68c7     53.9G    40% /
</span></span></code></pre></div><h2 id=1차로-vm-띄워보기>1차로 VM 띄워보기</h2><p>이제 네트워크 설정만 남긴했는데 일단 우선 한 번 정도는 VM을 뜨기는 하는지를 확인해보려한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># qs는 alias qs=qemu-system-x86_64 로 설정된 alias이다.</span>
</span></span><span class=line><span class=cl>$ qs -machine <span class=nv>accel</span><span class=o>=</span>kvm,type<span class=o>=</span>q35 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -cpu host <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -smp <span class=m>2</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -m 4G <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --nographic <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -drive <span class=k>if</span><span class=o>=</span>virtio,format<span class=o>=</span>qcow2,file<span class=o>=</span>ubuntu-22.04-server-cloudimg-amd64.img <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -drive <span class=k>if</span><span class=o>=</span>virtio,format<span class=o>=</span>raw,file<span class=o>=</span>seed.img
</span></span><span class=line><span class=cl><span class=o>(</span>...생략<span class=o>)</span>
</span></span><span class=line><span class=cl>Ubuntu 22.04.1 LTS vm1 ttyS0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>vm1 login: ubuntu
</span></span><span class=line><span class=cl>password: 
</span></span></code></pre></div><p>인자가 의미하는 바는 대충 이곳 링크<a class=link href=https://www.arthurkoziel.com/qemu-ubuntu-20-04/ target=_blank rel=noopener>[2]</a>에 잘 정리되어있었다.
혹은 그냥 qemu-system-x86_64 &ndash;help 에 나오는 인자 설명을 봐도 대충은 이해는 된다. 몇몇 인자에 대한 설명은 좀 이해가 안 돼서 따로 찾아봐야하긴 하지만..</p><p>대충 로그인하고 패스워드를 초기화하고 나면 쉘에 접속하게 된다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>df -h /dev/vda1
</span></span><span class=line><span class=cl>Filesystem      Size  Used Avail Use% Mounted on
</span></span><span class=line><span class=cl>/dev/vda1        16G  1.5G   14G  10% /
</span></span></code></pre></div><p>로그인해서 루트 파일시스템의 크기를 조회해보니 우리가 <code>.img</code> 파일을 resize한 대로 16G로 잘 늘어나서 설정되어있는 모습이다!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ubuntu@vm1:~$ ping google.com -c <span class=m>1</span>
</span></span><span class=line><span class=cl>PING google.com <span class=o>(</span>142.250.66.78<span class=o>)</span> 56<span class=o>(</span>84<span class=o>)</span> bytes of data.
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from hkg12s27-in-f14.1e100.net <span class=o>(</span>142.250.66.78<span class=o>)</span>: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>1</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>255</span> <span class=nv>time</span><span class=o>=</span>44.9 ms
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--- google.com ping statistics ---
</span></span><span class=line><span class=cl><span class=m>1</span> packets transmitted, <span class=m>1</span> received, 0% packet loss, <span class=nb>time</span> 0ms
</span></span><span class=line><span class=cl>rtt min/avg/max/mdev <span class=o>=</span> 44.868/44.868/44.868/0.000 ms
</span></span></code></pre></div><p>Google에 ping을 때려보니 인터넷 통신은 가능한 듯하긴하지만 호스트가 사용 중인 공유기를 통해
같은 네트워크를 이용하고 있는 상태는 아니다. 즉, 호스트 -> VM 혹은 공유기 네트워크 -> VM으로의 접근은 불가능한 상태이다.
따라서 추가적인 네트워크 설정이 필요하다.</p><p>host로 돌아가려면 VM을 종료시키면 된다. 프로세스를 kill해도 되긴 하지만 <code>sudo shutdown -h now</code> 명령어를 통해 VM 내부에서 안전히 종료할 수도 있다.</p><p>참고) 참고로 VM에서 네트워크 통신이 원활하지 않은 경우 <code>sudo sysctl net.ipv4.ip_forward=1</code>로 packet forward를 활성화시켜줘야할 수 있다고한다.
나의 경우에는 이 값과 무관하게 잘 동작하긴했다.</p><h2 id=브릿지-네트워크-설정하기>브릿지 네트워크 설정하기</h2><p>이제 네트워크 설정만 해주면 된다. 나 같은 경우에는 VM이 호스트와 동일한 공유기 네트워크를 이용하도록 하여 VM의 인터넷 통신, VM &lt;-> 호스트 머신 간의 통신, 그리고 VM &lt;-> 공유기 내의 디바이스들 간의 통신이 가능하도록 하고 싶다.
따라서 퍼블릭 브릿지 방식을 이용할 것이다.</p><p>하지만 이 부분이 VirtualBox를 썼을 때와는 달리 처음 경험해보는 사람에게는 약간 지옥일 수 있다. 마음을 열고 Tap network, Bridge 같은 내용을 공부해봐야 이해하고 작업이 가능하다.
VirtualBox를 이용하든 qemu를 이용하는 원리는 같긴하다. bridge용 interface를 생성하고 호스트가 공유기랑 사용하던 인터페이스를
브릿지용 인터페이스에 묶어주고 VM은 Tap 네트워크의 장치를 이용해 자신의 네트워크 인터페이스 카드를 가상화하는 듯하다. 완전 정확히 공부해보진 않았지만 대충 흐름은 그렇다.
VirtualBox는 이런 과정을 알아서 수행해주는 듯하지만 qemu는 그렇지 않으므로 직접 구성해야한다.</p><p>브릿지 네트워크를 구성하는 방법은 호스트의 환경마다 상이할 것이다. 나같은 경우에는 호스트 머신 또한 Ubuntu Server 22.04이므로
이를 바탕으로 적어보겠다. 잘못된 작업은 호스트 머신의 네트워크에 장애를 낳을 수 있으니 백업을 떠놓거나 네트워크 없이도 얼마든지 접속이 가능한
상황에서 작업을 하는 것을 추천한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># /etc/netplan/00-installer-config-wifi.yaml</span>
</span></span><span class=line><span class=cl><span class=c1># 기존 설정</span>
</span></span><span class=line><span class=cl>network:
</span></span><span class=line><span class=cl>  version: <span class=m>2</span>
</span></span><span class=line><span class=cl>  ethernets:
</span></span><span class=line><span class=cl>    eth0:
</span></span><span class=line><span class=cl>      dhcp4: <span class=nb>true</span>
</span></span><span class=line><span class=cl>      dhcp6: <span class=nb>false</span>
</span></span><span class=line><span class=cl>      match:
</span></span><span class=line><span class=cl>        macaddress: 00:e0:4c:36:3f:c6
</span></span><span class=line><span class=cl>      set-name: eth0
</span></span><span class=line><span class=cl>  wifis:
</span></span><span class=line><span class=cl>    wlp2s0:
</span></span><span class=line><span class=cl>      access-points:
</span></span><span class=line><span class=cl>        <span class=o>{{</span> YOUR AP NAME <span class=o>}}</span>:
</span></span><span class=line><span class=cl>          password: <span class=o>{{</span> YOUR AP PASSWORD <span class=o>}}</span>
</span></span><span class=line><span class=cl>      dhcp4: <span class=nb>true</span>
</span></span><span class=line><span class=cl>      dhcp6: <span class=nb>false</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ ifconfig eth0
</span></span><span class=line><span class=cl>eth0: <span class=nv>flags</span><span class=o>=</span>4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span class=m>1500</span>
</span></span><span class=line><span class=cl>        inet 192.168.219.183  netmask 255.255.255.0  broadcast 192.168.219.255
</span></span><span class=line><span class=cl>        <span class=o>(</span>...생략<span class=o>)</span>
</span></span></code></pre></div><p>기존에는 위와 같이 공유기와 이더넷으로 연결된 인터페이스가 IP를 갖고 있는 모습이다.
이제 이 인터페이스에 대한 DHCP를 비활성화 시키고 bridge 인터페이스로 브릿지될 인터페이스 목록에 이 인터페이스(<code>eth0</code>)를 추가해주면
eth0의 IP는 사라지고 브릿지 인터페이스가 IP를 발급받게 될 것이다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># /etc/netplan/00-installer-config-wifi.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 변경한 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>network</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ethernets</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>eth0</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>dhcp4</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>dhcp6</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>match</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>macaddress</span><span class=p>:</span><span class=w> </span><span class=m>00</span><span class=p>:</span><span class=l>e0:4c:36:3f:c6</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>set-name</span><span class=p>:</span><span class=w> </span><span class=l>eth0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>wifis</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>wlp2s0</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>access-points</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>{{<span class=w> </span><span class=nt>YOUR AP NAME }}</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>password</span><span class=p>:</span><span class=w> </span>{{<span class=w> </span><span class=l>YOUR AP PASSWORD }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>dhcp4</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>dhcp6</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>bridges</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>br0</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>dhcp4</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>dhcp6</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>interfaces</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>eth0]</span><span class=w>
</span></span></span></code></pre></div><p>그를 위해 위와 같이 netplan 설정을 변경해줬다. eth0의 DHCP를 끄고 브릿지 인터페이스를 추가해줬다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ sudo netplan apply
</span></span><span class=line><span class=cl>$ sudo systemctl restart systemd-networkd
</span></span></code></pre></div><p>설정을 적용해줬다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ ifconfig eth0
</span></span><span class=line><span class=cl>eth0: <span class=nv>flags</span><span class=o>=</span>4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span class=m>1500</span>
</span></span><span class=line><span class=cl>        ether 00:e0:4c:36:3f:c6  txqueuelen <span class=m>1000</span>  <span class=o>(</span>Ethernet<span class=o>)</span>
</span></span><span class=line><span class=cl>        RX packets <span class=m>431</span>  bytes <span class=m>48373</span> <span class=o>(</span>48.3 KB<span class=o>)</span>
</span></span><span class=line><span class=cl>        RX errors <span class=m>0</span>  dropped <span class=m>4</span>  overruns <span class=m>0</span>  frame <span class=m>0</span>
</span></span><span class=line><span class=cl>        TX packets <span class=m>438</span>  bytes <span class=m>68498</span> <span class=o>(</span>68.4 KB<span class=o>)</span>
</span></span><span class=line><span class=cl>        TX errors <span class=m>0</span>  dropped <span class=m>0</span> overruns <span class=m>0</span>  carrier <span class=m>0</span>  collisions <span class=m>0</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>$ ifconfig br0
</span></span><span class=line><span class=cl>br0: <span class=nv>flags</span><span class=o>=</span>4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span class=m>1500</span>
</span></span><span class=line><span class=cl>        inet 192.168.219.121  netmask 255.255.255.0  broadcast 192.168.219.255
</span></span><span class=line><span class=cl>        inet6 fe80::a0e8:49ff:fe15:547c  prefixlen <span class=m>64</span>  scopeid 0x20&lt;link&gt;
</span></span><span class=line><span class=cl>        ether a2:e8:49:15:54:7c  txqueuelen <span class=m>1000</span>  <span class=o>(</span>Ethernet<span class=o>)</span>
</span></span><span class=line><span class=cl>        RX packets <span class=m>150</span>  bytes <span class=m>14431</span> <span class=o>(</span>14.4 KB<span class=o>)</span>
</span></span><span class=line><span class=cl>        RX errors <span class=m>0</span>  dropped <span class=m>0</span>  overruns <span class=m>0</span>  frame <span class=m>0</span>
</span></span><span class=line><span class=cl>        TX packets <span class=m>94</span>  bytes <span class=m>14486</span> <span class=o>(</span>14.4 KB<span class=o>)</span>
</span></span><span class=line><span class=cl>        TX errors <span class=m>0</span>  dropped <span class=m>0</span> overruns <span class=m>0</span>  carrier <span class=m>0</span>  collisions <span class=m>0</span>
</span></span></code></pre></div><p>브릿지가 잘 적용된 모습이다. <code>brctl</code>이라는 브릿지 관리 도구로도 정보를 확인해볼 수 있다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ sudo apt install -y bridge-utils
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ brctl show
</span></span><span class=line><span class=cl>bridge name	bridge id		STP enabled	interfaces
</span></span><span class=line><span class=cl>br0		8000.a2e84915547c	no		eth0
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ qs -machine <span class=nv>accel</span><span class=o>=</span>kvm,type<span class=o>=</span>q35 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -cpu host <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -smp <span class=m>2</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -m 4G <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --nographic <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -drive <span class=k>if</span><span class=o>=</span>virtio,format<span class=o>=</span>qcow2,file<span class=o>=</span>ubuntu-22.04-server-cloudimg-amd64.img <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -drive <span class=k>if</span><span class=o>=</span>virtio,format<span class=o>=</span>raw,file<span class=o>=</span>seed.img <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -nic bridge,br<span class=o>=</span>br0,model<span class=o>=</span>virtio-net-pci
</span></span></code></pre></div><p>VM을 띄우되 bridge network 설정을 위해 앞서 VM을 띄웠던 명령어에서 <code>-nic bridge,br=br0,model=virtio-net-pci</code> 인자만 추가해줬다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ubuntu@vm1:~$ ip addr show enp0s2
</span></span><span class=line><span class=cl>2: enp0s2: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class=m>1500</span> qdisc fq_codel state UP group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/ether 52:54:00:12:34:56 brd ff:ff:ff:ff:ff:ff
</span></span><span class=line><span class=cl>    inet 192.168.219.185/24 metric <span class=m>100</span> brd 192.168.219.255 scope global dynamic enp0s2
</span></span><span class=line><span class=cl>       valid_lft 21557sec preferred_lft 21557sec
</span></span><span class=line><span class=cl>    inet6 fe80::5054:ff:fe12:3456/64 scope link
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span><span class=line><span class=cl>       
</span></span><span class=line><span class=cl>ubuntu@vm1:~$ ping 192.168.219.180 -c <span class=m>1</span>
</span></span><span class=line><span class=cl>PING 192.168.219.180 <span class=o>(</span>192.168.219.180<span class=o>)</span> 56<span class=o>(</span>84<span class=o>)</span> bytes of data.
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 192.168.219.180: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>1</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>64</span> <span class=nv>time</span><span class=o>=</span>2.89 ms
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--- 192.168.219.180 ping statistics ---
</span></span><span class=line><span class=cl><span class=m>1</span> packets transmitted, <span class=m>1</span> received, 0% packet loss, <span class=nb>time</span> 0ms
</span></span><span class=line><span class=cl>rtt min/avg/max/mdev <span class=o>=</span> 2.887/2.887/2.887/0.000 ms
</span></span></code></pre></div><p>호스트가 이용 중인 <code>192.168.219.0/24</code> 네트워크의 IP를 이용하고 있으며 현재 내 호스트 머신의 IP인 192.168.219.180로 Ping도 가능하다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ brctl show
</span></span><span class=line><span class=cl>bridge name	bridge id		STP enabled	interfaces
</span></span><span class=line><span class=cl>br0		8000.a2e84915547c	no		eth0
</span></span><span class=line><span class=cl>							tap0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ ifconfig tap0
</span></span><span class=line><span class=cl>tap0: <span class=nv>flags</span><span class=o>=</span>4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span class=m>1500</span>
</span></span><span class=line><span class=cl>        inet6 fe80::fc35:9dff:fe3f:86b0  prefixlen <span class=m>64</span>  scopeid 0x20&lt;link&gt;
</span></span><span class=line><span class=cl>        ether fe:35:9d:3f:86:b0  txqueuelen <span class=m>1000</span>  <span class=o>(</span>Ethernet<span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>(</span>...생략<span class=o>)</span>
</span></span></code></pre></div><p>참고용) 참고로 vm이 실행될 때는 이렇게 아까 생성한 bridge interface에 tap network interface가 묶인다.</p><h2 id=최종적으로-vm을-백그라운드에서-띄우기>최종적으로 VM을 백그라운드에서 띄우기</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ qs -machine <span class=nv>accel</span><span class=o>=</span>kvm,type<span class=o>=</span>q35 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -name vm1 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -cpu host <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -smp <span class=m>2</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -m 4G <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -daemonize <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -display none <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -drive <span class=k>if</span><span class=o>=</span>virtio,format<span class=o>=</span>qcow2,file<span class=o>=</span>ubuntu-22.04-server-cloudimg-amd64.img <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -drive <span class=k>if</span><span class=o>=</span>virtio,format<span class=o>=</span>raw,file<span class=o>=</span>seed.img <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -nic bridge,br<span class=o>=</span>br0,model<span class=o>=</span>virtio-net-pci
</span></span></code></pre></div><p><code>-nograhic</code> -> <code>-display none</code> 으로 변경하고 <code>-daemonize</code> 인자를 통해 백그라운드에서 돌 수 있게 해줬다.</p><p>🎉 이렇게 QEMU로 VM 띄워보기 완료~!</p><h2 id=배운-것-얻은-것>배운 것, 얻은 것</h2><ul><li>QEMU가 뭔지, KVM이 뭔지, 어떻게 쓰는 건지</li><li>브릿지 네트워크 설정 방법</li><li>TAP 네트워크 개념</li><li>가상 이미지 타입(RAW, QCOW2)</li></ul><h2 id=글에서-다룬-내용-외에-더-해볼-만한-것>글에서 다룬 내용 외에 더 해볼 만한 것</h2><ul><li><code>-daemonize</code>를 통해 백그라운드에서 VM을 돌리도록 하긴했지만 호스트가 재부팅되거나
해당 qemu-system-x86_64 프로세스가 죽으면 VM이 재시작되지 못하는 형태인데 이를 개선해볼 수 있을 것이다.</li><li>QEMU를 직접 사용하는 것은 한 번 해봤으니 이를 좀 더 편리하게 쓸 수 있는 proxmox나 virtsh 같은 도구들이 있는 것 같은데 실제로
VM을 통해 홈랩을 구축하려면 굳이 수작업으로 하거나 직접 만들지 않고 이런 도구들을 도입해보는 게 좋을 듯.</li></ul><h2 id=마치며>마치며</h2><p>VirtualBox를 CLI로 이용했을 때에는 VirtualBox가 CLI 친화적인 느낌은 아니었던 것도 있고, 클라우드 이미지가 아닌 단순 live 이미지로 이용하다보니
VM 띄우는 것 자체는 그리 간단하게 느껴지지 않았던 반면 네트워크 설정은 VirtualBox가 알아서 잡아주는 게 많으니 되게 간단하다고 느껴졌다.</p><p>반면 QEMU는 CLI 친화적인 데다가 이번에는 클라우드 이미지를 써봤더니 VM을 띄우는 것 자체는 엄청나게 간단했다. 반면
브릿지 네트워크를 설정하는 게 처음이다보니 쉽지는 않았던 것 같다.</p><h2 id=참고-자료>참고 자료</h2><p><em><a class=link href=../create-vm-by-vboxmanage/>[1] - VBoxManage(VirtualBox CLI)로 VM 생성하기</a></em></p><p><em><a class=link href=https://www.arthurkoziel.com/qemu-ubuntu-20-04/ target=_blank rel=noopener>[2] - Using QEMU to create a Ubuntu 20.04 Desktop VM on macOS</a></em></p><ul><li><a class=link href=https://levelup.gitconnected.com/how-to-setup-bridge-networking-with-kvm-on-ubuntu-20-04-9c560b3e3991 target=_blank rel=noopener>https://levelup.gitconnected.com/how-to-setup-bridge-networking-with-kvm-on-ubuntu-20-04-9c560b3e3991</a> - 브릿지 설정법을 참고함</li><li><a class=link href=https://superuser.com/questions/1490188/what-is-the-difference-and-relationship-between-kvm-virt-manager-qemu-and-libv/1490196#1490196 target=_blank rel=noopener>https://superuser.com/questions/1490188/what-is-the-difference-and-relationship-between-kvm-virt-manager-qemu-and-libv/1490196#1490196</a> - KVM과 QEMU의 차이를 간단히 알려줌.</li><li><a class=link href=https://www.vinchin.com/en/blog/raw-vs-qcow2.html target=_blank rel=noopener>https://www.vinchin.com/en/blog/raw-vs-qcow2.html</a> - RAW 이미지 타입과 QCOW2 이미지 타입에 대한 내용이 잘 정리됨</li><li><a class=link href=https://www.joinc.co.kr/w/Site/cloud/Qemu/Network target=_blank rel=noopener>https://www.joinc.co.kr/w/Site/cloud/Qemu/Network</a> - qemu 에서 다양한 네트워크 설정을 이용하는 예시를 보여줌</li><li><a class=link href=https://www.qemu.org/2018/05/31/nic-parameter/ target=_blank rel=noopener>https://www.qemu.org/2018/05/31/nic-parameter/</a> - net, netdev, device, nic 등 헷갈리는 qemu 실행 인자를 정리해줌</li><li><a class=link href=https://skylit.tistory.com/215 target=_blank rel=noopener>https://skylit.tistory.com/215</a> - 구버전 우분투에 대한 bridge 설정인듯함</li><li><a class=link href=https://ubuntu.com/server/docs/virtualization-libvirt target=_blank rel=noopener>https://ubuntu.com/server/docs/virtualization-libvirt</a> - libvirt, virsh 등의 내용을 훑어봄</li><li><a class=link href=https://www.snel.com/support/nstall-qemu-guest-agent-for-debian-ubuntu/ target=_blank rel=noopener>https://www.snel.com/support/nstall-qemu-guest-agent-for-debian-ubuntu/</a> - qemu-guest-agent에 대한 내용을 잠깐 살펴봄</li></ul></section><footer class=article-footer><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>관련 글</h2><div class=related-contents><div class="flex article-list--tile"><article class=has-image><a href=/blog/companion-server/create-vm-by-vboxmanage/><div class=article-image><img src=/blog/companion-server/create-vm-by-vboxmanage/preview.86e294bc97b79467eb3b810ae5007907_hu13430b402fc78d1a17ca63e4738b897a_1461489_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy data-key data-hash="md5-huKUvJe3lGfrO4EK5QB5Bw=="></div><div class=article-details><h2 class=article-title>VBoxManage(VirtualBox CLI)로 VM 생성하기</h2></div></a></article><article class=has-image><a href=/blog/companion-server/core-dns/><div class=article-image><img src=/blog/companion-server/core-dns/preview.06fa0a861baa356bcf9c11ca75ad3713_hudf745d9e6218ded522d0b9ff98b2db64_1519649_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy data-key data-hash="md5-BvoKhhuqNWvPnBHKda03Ew=="></div><div class=article-details><h2 class=article-title>[반려 서버 키우기 사전 작업] Core DNS를 홈랩의 커스텀 DNS 서버로 이용하기</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//umi0410.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{DISQUS&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2022 Jinsu Playground</section><section class=powerby><a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a>로 만듦<br><a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a>의 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.4.0>Stack</a></b> 테마 사용 중</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#시작하며>시작하며</a></li><li><a href=#실습-환경>실습 환경</a></li><li><a href=#설치하기>설치하기</a></li><li><a href=#이미지-생성하기>이미지 생성하기</a></li><li><a href=#1차로-vm-띄워보기>1차로 VM 띄워보기</a></li><li><a href=#브릿지-네트워크-설정하기>브릿지 네트워크 설정하기</a></li><li><a href=#최종적으로-vm을-백그라운드에서-띄우기>최종적으로 VM을 백그라운드에서 띄우기</a></li><li><a href=#배운-것-얻은-것>배운 것, 얻은 것</a></li><li><a href=#글에서-다룬-내용-외에-더-해볼-만한-것>글에서 다룬 내용 외에 더 해볼 만한 것</a></li><li><a href=#마치며>마치며</a></li><li><a href=#참고-자료>참고 자료</a></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>