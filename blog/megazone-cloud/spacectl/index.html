<!doctype html><html lang=ko-kr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="spacectl이라는 CLI 프로그램 개발기
"><title>5. SpaceONE CLI Client인 spacectl 설계 및 개발</title><link rel=canonical href=https://umi0410.github.io/blog/megazone-cloud/spacectl/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="5. SpaceONE CLI Client인 spacectl 설계 및 개발"><meta property="og:description" content="spacectl이라는 CLI 프로그램 개발기
"><meta property="og:url" content="https://umi0410.github.io/blog/megazone-cloud/spacectl/"><meta property="og:site_name" content="Jinsu Playground"><meta property="og:type" content="article"><meta property="article:section" content="Blog"><meta property="article:published_time" content="2020-09-04T12:46:54+09:00"><meta property="article:modified_time" content="2020-09-04T12:46:54+09:00"><meta name=twitter:title content="5. SpaceONE CLI Client인 spacectl 설계 및 개발"><meta name=twitter:description content="spacectl이라는 CLI 프로그램 개발기
"><link rel="shortcut icon" href=https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/120/google/241/whale_1f40b.png><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-177403492-1","auto"),ga("send","pageview"))</script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=East+Sea+Dokdo&family=Noto+Sans+KR:wght@400&display=swap" rel=stylesheet><style>@import 'https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css';:root{--body-background:#fafeff;--base-font-family:Pretendard, 'Noto Sans KR', sans-serif}.site-name{--site-name-font-family:'East Sea Dokdo', cursive;font-family:var(--site-name-font-family);font-size:3.2rem!important}.left-sidebar{--sidebar-avatar-size:200px}figure.site-avatar{margin-left:auto!important;margin-right:auto!important}</style></head><body class="article-page has-toc"><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex
extended"><div id=article-toolbar><a href=https://umi0410.github.io class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>Back</span></a></div><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/experiences/>Experiences (활동 경험)</a>
<a href=/categories/megazone-cloud-internship/>메가존 클라우드 인턴 후기</a></header><h2 class=article-title><a href=/blog/megazone-cloud/spacectl/>5. SpaceONE CLI Client인 spacectl 설계 및 개발</a></h2><h3 class=article-subtitle>spacectl이라는 CLI 프로그램 개발기</h3><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>Sep 04, 2020</time></footer></div></header><section class=article-content><h2 id=spacectl이란>spacectl이란?</h2><h3 id=소개>소개</h3><p><a class=link href=https://github.com/spaceone-dev/spacectl target=_blank rel=noopener>spacectl</a> 은 저희팀이 개발하는 서비스인 SpaceONE의 <code>gRPC</code> API request를 CLI로
손쉽게 수행할 수 있도록 해주는 도구입니다. 파이썬을 통해 개발했고 <code>Click</code> 이라는 모듈로 CLI 환경을
손쉽게 사용할 수 있었고, <code>Jinja2</code>를 통해 상세한 Manifest 들에서 변수 치환, 분기 등을 수행할 수 있었습니다.</p><h3 id=사용-예시>사용 예시</h3><h4 id=a-simple-example>A simple example</h4><p>간단하게 <code>spacectl</code>이 어떤 식으로 이용되는 도구인지 예시를 보여드리겠습니다.
아래의 커맨드를 이용해 손쉽게 <code>SpaceONE</code>의 다양한 마이크로서비스들의 API를 이용할
수 있습니다.</p><pre tabindex=0><code>$ spacectl list domain
 domain_id           | name   | state   | plugin_id  ...
 domain-abc123abc    | umi0410| ENABLED |            ...
$ spacectl list server -p domain_id=domain-abc123abc
 server_id         | name    | provider ...
 server-abc123abc  | foo     | aws ...
</code></pre><h4 id=apply-command>apply command</h4><p><code>spacectl apply</code> command는 kubectl의 apply와 유사하게 없으면 만들고,
있으면 업데이트하고 혹은 단순히 어떤 API를 Execute하는 Task들의 플로우를 관리해주는
커맨드 입니다.</p><blockquote><p>아쉽게도 퇴사 전에 마무리를 짓지는 못했습니다. ㅜ.ㅜ
퇴사 전까지 진행한 작업은 일부 리소스에 대한 CRU(create, read, update),
대부분의 리소스에 대한 Excute(execute할 API를 설정)까지입니다.</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># main.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>import</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>mongo.yaml</span><span class=w> </span><span class=c># 개별 yaml file에서는 terraform/ansible과 같이 수행할 Task들을 정의</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>root_domain.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>repository.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>var</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>domain_name</span><span class=p>:</span><span class=w> </span><span class=l>root</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>domain_owner</span><span class=p>:</span><span class=w> </span><span class=l>admin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>admin_username</span><span class=p>:</span><span class=w> </span><span class=l>admin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>admin_password</span><span class=p>:</span><span class=w> </span><span class=l>admin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>$ spacectl apply main.yaml</span><span class=w>
</span></span></span></code></pre></div><h2 id=설계를-하며-느낀-점>설계를 하며 느낀 점</h2><p>이 프로젝트에 대한 실제 개발 업무 이전에는 꽤나 설계 업무가 많았습니다.
저는 그 동안은 혼자 주로 개발을 해왔고, 실행력 좋게 시작은 하지만 설계는 충분하지 않은 채
성급하게 실행에 옮겼던 경험이 많습니다. 또한 학생이었고, 개발 경력이 길지 않았기에
사실상 &ldquo;개발 = 그때 그때 새로운 내용 공부"와 같은 느낌이었기에 애초에 설계를 하려해도 <em>&lsquo;뭐가
필요하고 뭐가 가능할 것이고 뭐가 힘들 것인가&rsquo;</em> 를 판단하기 어려웠습니다.</p><p>하지만 팀원들과 함께 개발하면서 밥 먹을 때, 회의 할 때 틈틈히 설계 방식과 요령에 대해
상의했고, 처음으로 설계를 어느 정도 굳힌 뒤 개발에 들어들어갔던 경험이었습니다.</p><p>인턴 기간 막바지에 이 설계에 참여하게 된 것은 정말 값진 경험이었다고 생각했습니다.
사실 단순히 데브옵스로서 일할 때는 남들과 의사소통할 일이 그리 많진 않았는데, 이 설계를
맡게 되면서 많은 회의와 대화를 하게되었습니다.
선배 개발자분들과 설계에 대해 잦은 회의를 하면서 제가 <strong>어떤 개발자가 되고싶은지</strong> 직접 느낄 수 있었던 것 같습니다.
그 배경에는 두 가지 충격이 있었습니다.</p><ol><li><em>&lsquo;내가 남의 생각을 잘 읽는 편은 아니었나보군&mldr;?&rsquo;</em></li><li><em>&lsquo;선배 개발자분은 내가 개판으로 설명해도 어떻게 귀신같이 나보다 내 생각을 잘 읽으시지?&rsquo;</em>
=> 마치 축구할 때 노련한 축구선수와 함께 뛰면서 저 행동을 귀신같이 예측하고서는 너무나도 잘 밀어주는 느낌을 받았습니다&mldr;</li></ol><p>제가 평소에 말을 잘하는 편이라고 생각했는데, 남의 생각을 이해하고 읽어내는 능력은 그리 뛰어나지많은
않구나라는 생각을 하게됐습니다. 설계 내용이 꽤나 추상적으로 구두로 진행되었기에 그랬을 수도 있겠지만,
큰 충격은 선배 개발자분의 <strong>노련함</strong>이었습니다.</p><p>후에 누군가 어떤 개발자가 되고싶냐, 협업할 때 어떤 노하우가 있느냐 이런 내용을 물어보면
자신있게 <strong>남의 생각을 잘 이해하고, 알아주는 사람</strong>과 관련해 대답할 수 있는 사람이 될 수 있었으면
좋겠습니다.</p><p>또한 설계 깊게 진행하기 전에 침착하게 자료 조사를
잘 해야한다는 것을 느꼈습니다.</p><p>하나 일화로 원래는 설정 파일에서 <code>${{ tasks.umi0410.output }}</code> 이런 식의 변수를 이용한
설정을 치환한 뒤 API를 수행해야할 때, 아마 template 언어들을 제가 원하는 대로 사용하기
힘들 것이라 생각하고, 하나하나 함수와 클래스를 만들어가곤했는데, 개발이 거의 완료되어갈쯤
<code>Jinja2</code>의 사용법을 다시 읽다보니 <code>spacectl</code>에 <code>Jinja2</code>를 적절히 사용할 수 있을 것 같았고,
정신이 번뜩 들어 몇 시간만에 수작업으로 짠 코드들을 덜어내고 Jinja2를 이용해 좀 더 깔끔하게
변수 치환 및 추가로 <code>Jinja2</code>의 built-in filter들을 이용할 수 있었습니다!</p><h2 id=개발하면서-느낀-점>개발하면서 느낀 점</h2><p>역시 개발은 남이 만든 패키지를 잘 사용해야한다는 것을 느꼈고, 그냥 복사 붙여넣기만 잘하면 된다는 의미가 아니라,
그런 것들을 빠르게 가져와서 적용시키고 부분 부분 커스터마이징하기 위해서는
기본기가 탄탄해야한다고 느꼈습니다. 물론 수작업으로 만드는 것도 좋을 수 있겠지만, 다양한 엣지케이스가 존재할 수 있고,
그 모든 작업들을 문서로 상세히 설명하는 것이 아니라면, 제작자인 제가 아닌 누군가가 그 기능을 이용하기는
힘들 것입니다. Jinja2를 이용한 템플릿 기능 제공이 이와 관련된 경험이 될 수 있겠습니다.</p><p>또한 남의 코드를 자세히 읽어보는 게 처음이었는데, 덕분에 파이썬 프로젝트를 수행할 때 어떤 식으로
디렉토리 스트럭쳐를 짜면 좋을 지 생각해볼 수 있었던 계기였던 것 같습니다.
제가 설계하고, 개발한 내용을 짧게나마 발표한 뒤 리뷰를 받고 수정을 하면 한층 더 코드의
구조와 사용이 간결하고 직관적으로 보인다는 느낌을 받을 수 있었습니다. 이렇게 다양한
가르침을 주신 <strong>저희 팀의 선배 개발자분들께 항상 감사드립니다.</strong></p><p>Megazone CloudOne 팀의 DevOps 인턴으로서 근무했던 내용에 대한 후기가 거의 끝났습니다.
끝으로 인턴 활동에 대한 종합적인 느낀점을 이어서 보시거나 다시 목차를 보고싶으신 분은 <a class=link href=../index><strong>여기</strong></a>를
클릭해주세요.</p></section><footer class=article-footer><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>관련 글</h2><div class=related-contents><div class="flex article-list--tile"><article class=has-image><a href=/blog/megazone-cloud/argo-poc/><div class=article-image><img src=/blog/megazone-cloud/argo-poc/argo-events-top-level.7624c36013c776690d9423e1f1d2b2b0_hu911ca173f7b6efecb06ab37a91a70151_401443_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy data-key data-hash="md5-diTDYBPHdmkNlCPh8dKysA=="></div><div class=article-details><h2 class=article-title>3. Argo Project들에 대한 PoC(개념 증명) 진행</h2></div></a></article><article class=has-image><a href=/blog/megazone-cloud/index/><div class=article-image><img src=/blog/megazone-cloud/index/mzcloud-logo.8315e3e3cd17d375741d32a3ecd5642a_huaed2850ad2750bd21c0ea378f4b3d958_6575_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy data-key data-hash="md5-gxXj480X03V0HTKj7NVkKg=="></div><div class=article-details><h2 class=article-title>메가존 클라우드 데브옵스 인턴 후기</h2></div></a></article><article><a href=/blog/megazone-cloud/spaceone-helm/><div class=article-details><h2 class=article-title>4. SpaceONE Helm Chart 개발</h2></div></a></article><article class=has-image><a href=/blog/megazone-cloud/stargate-infra/><div class=article-image><img src=/blog/megazone-cloud/stargate-infra/dev-architecture.svg loading=lazy data-key data-hash=/blog/megazone-cloud/stargate-infra/dev-architecture.svg></div><div class=article-details><h2 class=article-title>1. Stargate라는 인프라 구축기</h2></div></a></article><article class=has-image><a href=/blog/megazone-cloud/ci-cd-pipeline/><div class=article-image><img src=/blog/megazone-cloud/ci-cd-pipeline/ci-cd-pipeline.392d064fb306cc812649e434f3c3fa9e_hu2d78a6f76281dd93e8329c8b5a44cef9_282268_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy data-key data-hash="md5-OS0GT7MGzIEmSeQ088P6ng=="></div><div class=article-details><h2 class=article-title>2. Github Action, Spinnaker을 이용한 CI/CD 파이프라인 구축기</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//umi0410.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{DISQUS&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2022 Jinsu Playground</section><section class=powerby><a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a>로 만듦<br><a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a>의 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.4.0>Stack</a></b> 테마 사용 중</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#spacectl이란>spacectl이란?</a><ol><li><a href=#소개>소개</a></li><li><a href=#사용-예시>사용 예시</a><ol><li><a href=#a-simple-example>A simple example</a></li><li><a href=#apply-command>apply command</a></li></ol></li></ol></li><li><a href=#설계를-하며-느낀-점>설계를 하며 느낀 점</a></li><li><a href=#개발하면서-느낀-점>개발하면서 느낀 점</a></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>