<!doctype html><html lang=ko-kr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="SpaceONE Helm Chart를 개발했던 경험
"><title>4. SpaceONE Helm Chart 개발</title><link rel=canonical href=https://umi0410.github.io/blog/megazone-cloud/spaceone-helm/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="4. SpaceONE Helm Chart 개발"><meta property="og:description" content="SpaceONE Helm Chart를 개발했던 경험
"><meta property="og:url" content="https://umi0410.github.io/blog/megazone-cloud/spaceone-helm/"><meta property="og:site_name" content="Jinsu Playground"><meta property="og:type" content="article"><meta property="article:section" content="Blog"><meta property="article:published_time" content="2020-09-04T12:46:54+09:00"><meta property="article:modified_time" content="2020-09-04T12:46:54+09:00"><meta name=twitter:title content="4. SpaceONE Helm Chart 개발"><meta name=twitter:description content="SpaceONE Helm Chart를 개발했던 경험
"><link rel="shortcut icon" href=https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/120/google/241/whale_1f40b.png><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-177403492-1","auto"),ga("send","pageview"))</script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=East+Sea+Dokdo&family=Noto+Sans+KR:wght@400&display=swap" rel=stylesheet><style>@import 'https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css';:root{--body-background:#fafeff;--base-font-family:Pretendard, 'Noto Sans KR', sans-serif}.site-name{--site-name-font-family:'East Sea Dokdo', cursive;font-family:var(--site-name-font-family);font-size:3.2rem!important}.left-sidebar{--sidebar-avatar-size:200px}figure.site-avatar{margin-left:auto!important;margin-right:auto!important}</style></head><body class="article-page has-toc"><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex
extended"><div id=article-toolbar><a href=https://umi0410.github.io class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>Back</span></a></div><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/experiences/>Experiences (활동 경험)</a>
<a href=/categories/megazone-cloud-internship/>메가존 클라우드 인턴 후기</a></header><h2 class=article-title><a href=/blog/megazone-cloud/spaceone-helm/>4. SpaceONE Helm Chart 개발</a></h2><h3 class=article-subtitle>SpaceONE Helm Chart를 개발했던 경험</h3><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>Sep 04, 2020</time></footer></div></header><section class=article-content><p><figure style=flex-grow:124;flex-basis:299px><a href=/blog/megazone-cloud/spaceone-helm/spaceone-helm-preview.png data-size=1000x802><img src=/blog/megazone-cloud/spaceone-helm/spaceone-helm-preview.png srcset="/blog/megazone-cloud/spaceone-helm/spaceone-helm-preview_hua20648dff267d17bdc5ba51e055b8d26_129267_480x0_resize_box_3.png 480w, /blog/megazone-cloud/spaceone-helm/spaceone-helm-preview_hua20648dff267d17bdc5ba51e055b8d26_129267_1024x0_resize_box_3.png 1024w" width=1000 height=802 loading=lazy alt=spaceone-helm-preivew.png></a><figcaption>spaceone-helm-preivew.png</figcaption></figure></p><h2 id=spaceone-helm-chart란>SpaceONE Helm Chart란?</h2><p><a class=link href=https://github.com/spaceone-dev/spaceone-helm target=_blank rel=noopener>spaceone-helm</a> 은 저희
<code>CloudOne</code> 팀이 개발하는 서비스인 <a class=link href=https://spaceone-dev.github.io/ target=_blank rel=noopener>SpaceONE</a>을
<code>helm chart</code>를 이용해 패키지화하는 프로젝트입니다. 원래의 저희 환경은 MicroService들을
개별 배포하고있었지만 오픈소스로 개발되는 저희 서비스를 저희 팀원들 뿐만아니라 다른
개발자들이 쉽게 개발할 수 있고, SpaceONE을 모르던 사용자들도 쉽게 SpaceONE을 구축해볼
수 있도록 하기 위해 패키지화도 진행하게되었습니다.</p><p>일반적으로 만들어진 Helm Chart를 이용해보기만했지 직접 Chart를 만드는 것은 처음 해본 일이기도 했고,
Chart를 개발하면서 새로운 환경에 저희 서비스를 배포해보다보니 삽질하며 고생도 꽤 했고,
무엇보다 프로젝트의 시작부터 퇴사 전까지의 작업들을 거의 제가 도맡아한 프로젝트였기에 개인적으로
애정이 많이 갔습니다 ^_^! 그리고 저도 이제는 저희 Chart를 이용해 SpaceONE을 구축형으로
손쉽게 이용할 수 있었습니다.</p><h2 id=spaceone-helm-설계>spaceone-helm 설계</h2><p>일단은 심플하게 사이드카 없이 저희의 마이크로서비스들만을 배포하고, 그 외에 필요한 서비스들도 최대한
Cloud Service에 의존하지 않고 그때 그때 손쉽게 서비스를 내렸다 올렸다 할 수 있도록 K8s 클러스터 위에
함께 배포하는 형식으로 Chart를 설계했습니다.</p><p>무엇보다 chart 개발의 목적은 아래 두 가지 사항이 컸기 때문에, <code>minikube</code> 혹은 <code>EKS</code> 띄운
마이크로서비스들과 로컬에서 통신이 가능하도록 해야했고, 사용하기 편리한 구조를 만들기 위해
고심했습니다.</p><ul><li>팀원이 아닌 개발자들도 자신의 부가적인 마이크로서비스를 로컬에 띄워 개발할 수 있도록 지원.<ul><li>로컬에서도 쿠버네티스 클러스터 내의 서비스에 접속이 가능해야하고, 경우에 따라 클러스터에서도
본인의 로컬 서비스로 접속을 할 수 있어야함.</li></ul></li><li>오픈소스로서 임의의 사용자가 서비스를 구축해보고자 시도할 때 손 쉽게 구축할 수 있도록 지원.<ul><li>마치 유저들의 사용자 경험을 중요시해서 디자인, 기획을 하듯 Chart의 사용자들이 직관적이고
편리하게 구축할 수 있도록 Configuration values(<code>values.yaml</code> in Helm Chart)를 설계함.</li></ul></li></ul><h2 id=spaceone-helm-chart-구조>spaceone-helm chart 구조</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>templates/
</span></span><span class=line><span class=cl>├── backend
</span></span><span class=line><span class=cl>│   ├── config
</span></span><span class=line><span class=cl>│   │   ├── config-conf.yml
</span></span><span class=line><span class=cl>│   │   ├── config-deployment.yml
</span></span><span class=line><span class=cl>│   │   └── config-svc.yml
</span></span><span class=line><span class=cl>│   ├── identity
</span></span><span class=line><span class=cl>│   │   ├── identity-conf.yml
</span></span><span class=line><span class=cl>│   │   ├── identity-deployment.yml
</span></span><span class=line><span class=cl>│   │   └── identity-svc.yml
</span></span><span class=line><span class=cl>│   ├── inventory
</span></span><span class=line><span class=cl>│   │   ├── inventory-conf.yml
</span></span><span class=line><span class=cl>│   │   ├── inventory-deployment.yml
</span></span><span class=line><span class=cl>│   │   └── inventory-svc.yml
</span></span><span class=line><span class=cl>│   ├── inventory-scheduler
</span></span><span class=line><span class=cl>│   │   ├── inventory-scheduler-conf.yml
</span></span><span class=line><span class=cl>│   │   ├── inventory-scheduler-deployment.yml
</span></span><span class=line><span class=cl>│   │   └── inventory-scheduler-svc.yml
</span></span><span class=line><span class=cl>│   ├── inventory-worker
</span></span><span class=line><span class=cl>│   │   ├── inventory-worker-conf.yml
</span></span><span class=line><span class=cl>│   │   ├── inventory-worker-deployment.yml
</span></span><span class=line><span class=cl>│   │   └── inventory-worker-svc.yml
</span></span><span class=line><span class=cl><span class=c1>#... Backend 생략</span>
</span></span><span class=line><span class=cl>├── consul, mongo, redis <span class=c1># 디테일한 파일구조는 생략</span>
</span></span><span class=line><span class=cl>├── frontend
</span></span><span class=line><span class=cl>│   ├── console <span class=c1># 디테일한 파일구조는 생략</span>
</span></span><span class=line><span class=cl>│   └── console-api <span class=c1># 디테일한 파일구조는 생략</span>
</span></span><span class=line><span class=cl>├── ingress
</span></span><span class=line><span class=cl>│   └── ingress.yaml
</span></span><span class=line><span class=cl>├── initializer
</span></span><span class=line><span class=cl>│   ├── initialize-spaceone-conf.yml
</span></span><span class=line><span class=cl>│   ├── initialize-spaceone-job.yml
</span></span><span class=line><span class=cl>│   ├── spacectl-apply-conf.yml
</span></span><span class=line><span class=cl>│   └── spacectl-conf.yml
</span></span><span class=line><span class=cl>└── supervisor
</span></span><span class=line><span class=cl>    └── supervisor
</span></span><span class=line><span class=cl>        ├── supervisor-conf.yml
</span></span><span class=line><span class=cl>        ├── supervisor-deployment.yml
</span></span><span class=line><span class=cl>        └── supervisor-roles.yml
</span></span></code></pre></div><p>저희 <code>spaceone-helm</code> chart는 꽤나 구조가 간단한 편은 아니라고 생각됩니다. 웹페이지 환경상 너무
부수적인 부분은 tree에서 생략하기도 했습니다. 꽤나 복잡한 구조를 가졌기에 패키지화하는 부분이 쉽지 않았지만,
그런 과정 속에서 많이 트러블 슈팅을 경험하고 성장할 수 있었던 것 같습니다.</p><p>그리고 반대로 생각하면, 서비스가 패키지화하기도 쉽지 않을만큼 복잡한 구조를 가졌다면,
당연히 손수 배포하는 것은 그것보다 몇 배는 어려울 것이므로 누군가가 저희 서비스를 구축형으로 이용해주기 위해서는
패키지화가 필수라는 생각이 들었습니다.</p><h2 id=마이크로서비스들의-버전-관리를-시작>마이크로서비스들의 버전 관리를 시작</h2><p>Helm Chart를 개발하고, CI가 고도화되기 전까지는 단순히 팀 내에서 개발을 진행하면서
개발환경에 대한 배포는 <code>latest</code> tag만을 이용해 자동으로 진행하고,
QA를 진행하면서 커밋을 멈추고, 그 시점에 빌드된 Docker image의 Tag를 바탕으로 상용 환경에도
배포를 하곤했습니다. 하지만, Chart에서도 tag를 <code>latest</code>로 유지하거나 가독성이 좋지 않은 임의의
tag를 이용해 이미지를 제공하기는 힘들었고, 맞는 방향이 아니라고 생각했습니다.</p><p>따라서 저희는 꼭 Helm을 통한 패키지 뿐만 아니라 롤백에 대한 안정성, 버전 간의 Update 내역 관리
등을 위해 <code>{{MAJOR}}.{{MINOR}}.{{SPRINT_NUMBER}}-{{EXTRA_TAGS}}</code> 형태를 통해
버전을 관리하고자했습니다.</p><h2 id=helm-chart를-통해-패키지화하며-느낀-점>Helm Chart를 통해 패키지화하며 느낀 점</h2><p>Helm Chart를 통해 저희 서비스를 패키지화하기 전까지는 마이크로서비스 형태로 관리되는 서비스를
새로운 환경에 완전하게 구축한다는 것은 쉽지 않았습니다.
<code>Container</code>라는 것이 ReadOnly 레이어로 이미 구성이 완료된 이미지를 바탕으로 생성되기 때문에
언제 어디서든 구동이 가능하다는 것이 장점이겠지만, 현실적으로는 환경에 따라 이것 저것 설정해줘야하는
것이 있었기때문입니다.</p><p>이러한 난관들은 어떠한 변수처리와 자동화를 통해 해결할 수 있을텐데, 그러한 작업을 해준 녀석이 바로
<code>Helm</code>이었고, 그때 그때 설정을 바꿈으로써 커스터마이징할 수 있다는 점이 알고는 있었습니다만 막상
저희 서비스에 도입해보니 꽤나 만족스러웠습니다.</p><p>일화로 사내 네트워크가 막힌 상황에서도 받아놓은 이미지들만 있으면 네트워크 접속을 할 필요 없이
<code>minikube</code>와 <code>로컬 서버</code>를 이용해 minikube의 클러스터와 통신하면서 개발을 진행할 수도 있었습니다.</p><p>누군가 제가 만든 서비스를 사용해준다는 것은 참 뿌듯한 일이었고, 앞으로도 저희 helm chart가 잘
발전되어 더욱 더 편리하게 구축할 수 있는 형태로 제공될 수 있기를 기대해봅니다!</p></section><footer class=article-footer><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>관련 글</h2><div class=related-contents><div class="flex article-list--tile"><article class=has-image><a href=/blog/megazone-cloud/ci-cd-pipeline/><div class=article-image><img src=/blog/megazone-cloud/ci-cd-pipeline/ci-cd-pipeline.392d064fb306cc812649e434f3c3fa9e_hu2d78a6f76281dd93e8329c8b5a44cef9_282268_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy data-key data-hash="md5-OS0GT7MGzIEmSeQ088P6ng=="></div><div class=article-details><h2 class=article-title>2. Github Action, Spinnaker을 이용한 CI/CD 파이프라인 구축기</h2></div></a></article><article class=has-image><a href=/blog/megazone-cloud/argo-poc/><div class=article-image><img src=/blog/megazone-cloud/argo-poc/argo-events-top-level.7624c36013c776690d9423e1f1d2b2b0_hu911ca173f7b6efecb06ab37a91a70151_401443_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy data-key data-hash="md5-diTDYBPHdmkNlCPh8dKysA=="></div><div class=article-details><h2 class=article-title>3. Argo Project들에 대한 PoC(개념 증명) 진행</h2></div></a></article><article class=has-image><a href=/blog/megazone-cloud/index/><div class=article-image><img src=/blog/megazone-cloud/index/mzcloud-logo.8315e3e3cd17d375741d32a3ecd5642a_huaed2850ad2750bd21c0ea378f4b3d958_6575_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy data-key data-hash="md5-gxXj480X03V0HTKj7NVkKg=="></div><div class=article-details><h2 class=article-title>메가존 클라우드 데브옵스 인턴 후기</h2></div></a></article><article><a href=/blog/megazone-cloud/spacectl/><div class=article-details><h2 class=article-title>5. SpaceONE CLI Client인 spacectl 설계 및 개발</h2></div></a></article><article class=has-image><a href=/blog/megazone-cloud/stargate-infra/><div class=article-image><img src=/blog/megazone-cloud/stargate-infra/dev-architecture.svg loading=lazy data-key data-hash=/blog/megazone-cloud/stargate-infra/dev-architecture.svg></div><div class=article-details><h2 class=article-title>1. Stargate라는 인프라 구축기</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//umi0410.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{DISQUS&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2022 Jinsu Playground</section><section class=powerby><a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a>로 만듦<br><a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a>의 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.4.0>Stack</a></b> 테마 사용 중</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#spaceone-helm-chart란>SpaceONE Helm Chart란?</a></li><li><a href=#spaceone-helm-설계>spaceone-helm 설계</a></li><li><a href=#spaceone-helm-chart-구조>spaceone-helm chart 구조</a></li><li><a href=#마이크로서비스들의-버전-관리를-시작>마이크로서비스들의 버전 관리를 시작</a></li><li><a href=#helm-chart를-통해-패키지화하며-느낀-점>Helm Chart를 통해 패키지화하며 느낀 점</a></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>