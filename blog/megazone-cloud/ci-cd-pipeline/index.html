<!doctype html><html lang=ko-kr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Github Action과 Spinnaker을 이용한 CI/CD 파이프라인 구축기
"><title>2. Github Action, Spinnaker을 이용한 CI/CD 파이프라인 구축기</title><link rel=canonical href=https://umi0410.github.io/blog/megazone-cloud/ci-cd-pipeline/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="2. Github Action, Spinnaker을 이용한 CI/CD 파이프라인 구축기"><meta property="og:description" content="Github Action과 Spinnaker을 이용한 CI/CD 파이프라인 구축기
"><meta property="og:url" content="https://umi0410.github.io/blog/megazone-cloud/ci-cd-pipeline/"><meta property="og:site_name" content="Jinsu Playground"><meta property="og:type" content="article"><meta property="article:section" content="Blog"><meta property="article:published_time" content="2020-09-04T12:46:54+09:00"><meta property="article:modified_time" content="2020-09-04T12:46:54+09:00"><meta property="og:image" content="https://umi0410.github.io/blog/megazone-cloud/ci-cd-pipeline/ci-cd-pipeline.png"><meta name=twitter:title content="2. Github Action, Spinnaker을 이용한 CI/CD 파이프라인 구축기"><meta name=twitter:description content="Github Action과 Spinnaker을 이용한 CI/CD 파이프라인 구축기
"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://umi0410.github.io/blog/megazone-cloud/ci-cd-pipeline/ci-cd-pipeline.png"><link rel="shortcut icon" href=https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/120/google/241/whale_1f40b.png><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=East+Sea+Dokdo&family=Noto+Sans+KR:wght@400&display=swap" rel=stylesheet><style>:root{--body-background:#fafeff;--base-font-family:'Noto Sans KR', sans-serif}.site-name{--site-name-font-family:'East Sea Dokdo', cursive;font-family:var(--site-name-font-family);font-size:3.2rem!important}.left-sidebar{--sidebar-avatar-size:200px}figure.site-avatar{margin-left:auto!important;margin-right:auto!important}</style></head><body class="article-page has-toc"><script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script><div class="container main-container flex
extended"><div id=article-toolbar><a href=https://umi0410.github.io class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>Back</span></a></div><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/blog/megazone-cloud/ci-cd-pipeline/><img src=/blog/megazone-cloud/ci-cd-pipeline/ci-cd-pipeline_hu2d78a6f76281dd93e8329c8b5a44cef9_282268_800x0_resize_box_2.png srcset="/blog/megazone-cloud/ci-cd-pipeline/ci-cd-pipeline_hu2d78a6f76281dd93e8329c8b5a44cef9_282268_800x0_resize_box_2.png 800w, /blog/megazone-cloud/ci-cd-pipeline/ci-cd-pipeline_hu2d78a6f76281dd93e8329c8b5a44cef9_282268_1600x0_resize_box_2.png 1600w" width=800 height=1427 loading=lazy alt="Featured image of post 2. Github Action, Spinnaker을 이용한 CI/CD 파이프라인 구축기"></a></div><div class=article-details><header class=article-category><a href=/categories/experiences/>Experiences (활동 경험)</a>
<a href=/categories/megazone-cloud-internship/>메가존 클라우드 인턴 후기</a></header><h2 class=article-title><a href=/blog/megazone-cloud/ci-cd-pipeline/>2. Github Action, Spinnaker을 이용한 CI/CD 파이프라인 구축기</a></h2><h3 class=article-subtitle>Github Action과 Spinnaker을 이용한 CI/CD 파이프라인 구축기</h3><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>Sep 04, 2020</time></footer></div></header><section class=article-content><h2 id=github-action을-사용하게-된-배경>Github Action을 사용하게 된 배경</h2><p>저희 팀은 원래 CI용으로 <code>Jenkins</code>를 사용했습니다만 팀이 개발 중이던 서비스가
오픈소스가 목표인 프로젝트였고, Github Action이 빠르게 발전해나가면서
비용도 무료가 되었고, 좋은 Action들이 많이 생겨나고 있었기에
어느 정도 프로젝트 구조가 잡힌 뒤에는 Github의 Public Repository로 프로젝트를 관리하고
Github Action을 CI 도구로 채택하게되었습니다. Integration Test를
제외한 모든 빌드 및 일부 배포를 Github Action을 이용하게되었고, 대부분의 배포에는 사용하던대로
Spinnaker을 이용했습니다.</p><h2 id=github-action-vs-jenkins>Github Action vs Jenkins</h2><p>이 부분 역시 느낀 점 위주로 요약해보겠습니다.</p><table><thead><tr><th>Github Action</th><th>Jenkins</th></tr></thead><tbody><tr><td>내가 서버를 관리할 필요가 없다.</td><td>내가 직접 master을 띄우고, slave를 띄워우고, 관리해줘야한다.</td></tr><tr><td>VM이 배치되어 제공되는 데에 좀 시간이 든다. 내 커스텀 이미지를 사용할 수가 없다보니 반복되는 패키지 설치나 환경 설정을 매번 해야해서 좀 느리다.</td><td>내가 필요한 Plugin을 설치해놓거나 설정을 입력해 놓으면 매번 빌드할 때 따로 제공할 필요 없다.</td></tr><tr><td>Code로 관리가 가능하다! 처음엔 조금 어려울 수 있지만, 알고 나면 쓰기 너무 쉽다.</td><td>처음 접한 사람이 사용하기에는 Github Action보다 편리할 수 있지만, 그렇다고 훌륭한 UI/UX는 아닌 듯 하다.</td></tr><tr><td>요즘 핫하고, 빠르게 발전 중이다.</td><td>구식이다.</td></tr></tbody></table><p>비용이 저렴하게 풀리고 있고(퍼블릭의 경우 아마 무조건 무제한 공짜),
원래 지원하지 않던 매뉴얼 트리거가 2020.07부터 제공되기 시작했다는 점,
누구든 오픈소스로 Github Action에서 남들이 사용할 수 있는 action 을 만들 수 있다는 점등을
보고 Github Action이 빠르게 발전 중이라는 생각이 들었습니다.</p><h2 id=그래서-어떤-cicd를-자동화하였나요>그래서 어떤 CI/CD를 자동화하였나요?</h2><p><figure style=flex-grow:56;flex-basis:134px><a href=/blog/megazone-cloud/ci-cd-pipeline/ci-cd-pipeline.png data-size=913x1628><img src=/blog/megazone-cloud/ci-cd-pipeline/ci-cd-pipeline.png srcset="/blog/megazone-cloud/ci-cd-pipeline/ci-cd-pipeline_hu2d78a6f76281dd93e8329c8b5a44cef9_282268_480x0_resize_box_2.png 480w, /blog/megazone-cloud/ci-cd-pipeline/ci-cd-pipeline_hu2d78a6f76281dd93e8329c8b5a44cef9_282268_1024x0_resize_box_2.png 1024w" width=913 height=1628 loading=lazy alt=ci-cd-pipeline.png></a><figcaption>ci-cd-pipeline.png</figcaption></figure></p><p>세로로 길어서 좀 보기 불편하실 수도 있는데, 위의 차트가 저희의 깃헙액션에 대한 차트입니다.
레포지토리마다 조금씩 다른 부분이 있고, 프론트엔드의 경우 파이프라인이 다양했는데, 우선 백엔드의
깃헙액션 및 CI/CD 진행 방식에 대해 요약해보겠습니다. (Chart를 작성한 지가 좀 돼서 설명과 조금
다른 부분이 있을 수도 있습니다.)</p><p>개발 스프린트 진행 시에는 아래와 같이 진행되었습니다. (&lt;상황 설명> => &lt;Github Action 수행 내용> 형식으로 나했습니다.)</p><ol><li>개별 Fork 후 Master Branch에 Pull Request => lint, basic unit test 진행. 통과된 PR만 Merge열</li><li>Master에 Merge 혹은 Commit이 Push됨 => CI Action이 실행됩니다.</li><li>개발용 docker registry 에 업로드</li><li>해당 registry에 업로드 된 것을 감지하고 <code>Spinnaker</code>가 Experiment 환경에 배포</li><li>Experimental 환경을 이용해 <code>Jenkins</code>가 Integration Test를 진행</li><li>Integration Test 성공 시에 Dev 환경에 배포.</li></ol><p>이후 스프린트 막바지 QA 기간에는 Experiment, Dev 환경이 주로 QA 환경으로 사용되었고,
파이프라인은 다음과 같았습니다.</p><ol><li>검증이 어느 정도 끝난 커밋에 대해 Git Tag를 <code>{{VERSION}}-rc{{RC_NUMBER}}</code> 형태로 달아 푸시 - Github Release가 생김
=> 도커 이미지 빌드 후 Production Docker Registry에 이미지 업로드
=> tag가 달린 커밋을 기점으로 자동으로 버전 명의 브랜치를 만듦.</li><li>Production Docker Registry의 업로드를 감지하고 Dev에서 손수 QA 진행</li><li>문제가 있을 경우 rc number를 올려서 다시 태그를 달고 업로드 후 재차 QA</li><li>문제가 없을 경우 해당 태그를 바탕으로 rc를 지우고 실제 버전으로서 태그를 달아 푸시 => 다시 업로드</li><li>Production은 매뉴얼 배포.</li></ol><h2 id=github-action을-다뤄보면서-느낀-점>Github Action을 다뤄보면서 느낀 점</h2><p>처음에는 Github Action에 그렇게 만족을 하지 못했습니다. 초기에는 Manual Trigger가 지원되지
않았던 데다가, 가뜩이나 Github Action을 잘 몰랐기에 한 번 Github Action을 수정하여
테스트 하고싶을 때 마다 커밋을 하나씩 날려야했던 게 불편했고, 브랜치를 따로 만들거나 fork를 떠서 Github Action 테스트 후
해당 <code>workflow</code>만 마스터에 머지하는 방식 등등 다양한 방식을 사용했었는데, 어느 정도 익숙해지고 Github Action에
Manual Trigger도 등장하게 되면서 꽤나 만족도가 높아졌습니다.</p><p><code>Jenkins</code>와 달리 제가 서버를 이용하지 않아도 된다는 점도 맘에 들긴했는데, 종종 Github 서버가 죽는 일이
발생해서 난감했던 적이 있긴합니다.</p><p>하나 재미있었던 점은 Github Action을 이용하면서 저희의 <code>CI/CD</code> 전략이 꽤나 고도화되었는데,
그 과정에서 팀원들과 자유롭게 의사소통하는 과정이 재미있었고, 저 또한 자유롭게 의견을 나눌 수 있었던 경험을 할 수 있었다는 것입니다.</p><p>후에 저희 <code>SpaceONE</code>의 CLI API 클라이언트인 <code>spacectl</code>의 설계에도 <code>Github Action</code>의 구조를 모티브삼았는데
이때에도 Github Action에 대한 지식이 많은 도움이 되었고, 퇴사 후에도
개인적인 Github 활동을 하면서 자유롭게 Github Action을 사용할 수 있었기에
든든한 개발 도구를 얻은 느낌입니다. 코드로 제가 하고싶은 것을 뭐든 정의할 수 있고,
만들어져 있는 작업은 편하게 가져다 쓰면 되기 때문에
빌드나 배포에 관해 재미있는 번뜩이는 아이디어가 있을 때 바로 바로 적용할 수 있고, 실제로 현재의 <code>Github Page</code>도
<code>Github Action</code>을 통해 다양한 트릭을 이용할 수도 있었고,
빌드 후 배포 또한 자동화 되어있습니다!</p></section><footer class=article-footer><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>관련 글</h2><div class=related-contents><div class="flex article-list--tile"><article class=has-image><a href=/blog/megazone-cloud/index/><div class=article-image><img src=/blog/megazone-cloud/index/mzcloud-logo.8315e3e3cd17d375741d32a3ecd5642a_huaed2850ad2750bd21c0ea378f4b3d958_6575_250x150_fill_box_smart1_2.png width=250 height=150 loading=lazy data-key data-hash="md5-gxXj480X03V0HTKj7NVkKg=="></div><div class=article-details><h2 class=article-title>메가존 클라우드 데브옵스 인턴 후기</h2></div></a></article><article class=has-image><a href=/blog/megazone-cloud/argo-poc/><div class=article-image><img src=/blog/megazone-cloud/argo-poc/argo-events-top-level.7624c36013c776690d9423e1f1d2b2b0_hu911ca173f7b6efecb06ab37a91a70151_401443_250x150_fill_box_smart1_2.png width=250 height=150 loading=lazy data-key data-hash="md5-diTDYBPHdmkNlCPh8dKysA=="></div><div class=article-details><h2 class=article-title>3. Argo Project들에 대한 PoC(개념 증명) 진행</h2></div></a></article><article><a href=/blog/megazone-cloud/spacectl/><div class=article-details><h2 class=article-title>5. SpaceONE CLI Client인 spacectl 설계 및 개발</h2></div></a></article><article><a href=/blog/megazone-cloud/spaceone-helm/><div class=article-details><h2 class=article-title>4. SpaceONE Helm Chart 개발</h2></div></a></article><article class=has-image><a href=/blog/megazone-cloud/stargate-infra/><div class=article-image><img src=/blog/megazone-cloud/stargate-infra/dev-architecture.svg loading=lazy data-key data-hash=/blog/megazone-cloud/stargate-infra/dev-architecture.svg></div><div class=article-details><h2 class=article-title>1. Stargate라는 인프라 구축기</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//umi0410.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener('onColorSchemeChange',a=>{DISQUS&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2021 Jinsu Playground</section><section class=powerby><a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a>로 만듦<br><a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a>의 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.4.0>Stack</a></b> 테마 사용 중</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#github-action을-사용하게-된-배경>Github Action을 사용하게 된 배경</a></li><li><a href=#github-action-vs-jenkins>Github Action vs Jenkins</a></li><li><a href=#그래서-어떤-cicd를-자동화하였나요>그래서 어떤 CI/CD를 자동화하였나요?</a></li><li><a href=#github-action을-다뤄보면서-느낀-점>Github Action을 다뤄보면서 느낀 점</a></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script></body></html>