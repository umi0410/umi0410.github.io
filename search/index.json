[{"content":"ì‹œì‘í•˜ë©° ë°ë¸Œì˜µìŠ¤ ì—”ì§€ë‹ˆì–´ë¡œ ì…ì‚¬í•œ ë’¤ ì£¼ë¡œ ë§¡ê³  ìˆëŠ” ì‘ì—…ì€ Istio ê´€ë ¨ ì‘ì—…ì´ë‹¤. í‰ì†Œ ì°¸ ê´€ì‹¬ ìˆì—ˆë˜ ë¶„ì•¼ì´ê¸°ë„ í•˜ê³  istio ë¿ë§Œ ì•„ë‹ˆë¼ ë„¤íŠ¸ì›Œí¬ì— ëŒ€í•´ ê°œì¸ì ìœ¼ë¡œ ì •ë§ ê³µë¶€í•´ë³´ê³ ì‹¶ì—ˆëŠ”ë° ë•ë¶„ì— ì¬ë¯¸ìˆê²Œ ê³µë¶€í•˜ê³  ì„±ì¥í•˜ë©° ê·¼ë¬´í•˜ê³  ìˆëŠ” ê²ƒ ê°™ë‹¤. ğŸ˜Š\nê·¼ë° ìš”ì¦˜ ë“¤ì–´ ì ì  ë‹¨ìˆœíˆ â€˜ì–´ë–»ê²Œ ì €ë–»ê²Œ í•˜ë‹ˆê¹Œ ëŒì•„ëŠ”ê°€ë„¤~ ì˜¤.. ë‚˜ istio ì¢€ íŒŒì•…í•œë“¯?ã…‹ã…‹â€™ ìˆ˜ì¤€ì˜ ìì„¸ë¡œëŠ” íŠ¸ëŸ¬ë¸”ìŠˆíŒ…ì„ í•˜ê±°ë‚˜ ì˜¬ë°”ë¥´ê²Œ ì„¤ê³„í•˜ê¸°ê°€ ì‰½ì§€ ì•Šì€ ê²½ìš°ë“¤ì´ ì¦ì•„ì¡Œë‹¤.\në”°ë¼ì„œ í‰ì†Œ ê¶ê¸ˆí–ˆë˜ ë‚´ìš© ì¤‘ í•˜ë‚˜ë¥¼ ì‚´ì§ íŒŒí—¤ì³ë³¼ê¹Œí•œë‹¤.\në‚˜ëŠ” ì£¼ë¡œ istio ingress gatewayì™€ ê´€ë ¨ëœ ì‘ì—…ì„ ë§ì´ í–ˆì—ˆê³  ì´ ê²½ìš° Virtual ServiceëŠ” í•­ìƒ ingress gatewayë¥¼ ì°¸ì¡°í•˜ë„ë¡ ì„¤ì •í•´ì™”ë‹¤. ê·¼ë° istioë¥¼ ì²˜ìŒ ë°°ìš¸ ë•ŒëŠ” ë¶„ëª… â€˜client ì¸¡ì—ì„œ outbound handlerë¡œì„œì˜ Envody ì‚¬ì´ë“œì¹´ì„ í†µí•´ ì•Œì•„ì„œ ìš°ë¦¬ê°€ ì˜ë„í•˜ëŠ” ëª©ì ì§€ë¥¼ ì°¾ì•„ì„œ ìš”ì²­ì„ ë³´ë‚¸ë‹¤.â€™ ì´ëŸ° ì‹ìœ¼ë¡œ ë°°ì› ë˜ ê²ƒ ê°™ì€ë° â€˜ì™œ ë‚˜ëŠ” Virtual Serviceë¥¼ ì´ìš©í•  ë•Œ í•­ìƒ Gatewayë¥¼ ì„¤ì •í•´ì¤˜ì•¼í•˜ëŠ” ê²ƒì´ì—ˆì„ê¹Œ?â€™í•˜ëŠ” ê¶ê¸ˆì¦ì´ ìƒê²¼ë‹¤.\nVirtual ServiceëŠ” Gatewayì— ingress gatewayë¥¼ ì„¤ì •í•´ì£¼ì§€ ì•Šì•„ë„ ë˜ëŠ” ê²ƒì¼ê¹Œ? Virtual Serviceì— ì„¤ì •í•œ ë‚´ìš©ì€ ingress gatewayë¡œ ë“¤ì–´ì˜¨ ìš”ì²­ë¿ë§Œ ì•„ë‹ˆë¼ mesh ë‚´ë¶€ì—ì„œì˜ ìš”ì²­ì—ë„ ì ìš©ë  ìˆ˜ ìˆëŠ” ê²ƒì¸ê°€? Destination Ruleì€ ë­í•˜ëŠ” ë…€ì„ì¼ê¹Œ? ì£¼ë¡œ ì–˜ëŠ” Virtual Serviceì™€ í•¨ê»˜ ì“°ëŠ” ì˜ˆì‹œê°€ ë§ì´ ë³´ì´ë˜ë° ê¼­ Virtual Serviceì™€ í•¨ê»˜ ì¨ì•¼í•˜ëŠ” ê±¸ê¹Œ? ë”°ë¼ì„œ ì´ë²ˆ ê¸€ì—ì„œëŠ” ìœ„ì™€ ê°™ì€ ê¶ê¸ˆì¦ë“¤ì— ëŒ€í•´ ì‚½ì§ˆí•´ë³¸ ë‚´ìš©ì„ ì •ë¦¬í•´ë³´ë ¤í•œë‹¤. ì‘ì—…í•´ë³¸ ë‚´ìš©ì€ ì•„ë˜ì™€ ê°™ë‹¤.\ningress gatewayë¥¼ í†µí•´ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì´ ì•„ë‹ˆë¼ mesh ë‚´ë¶€ì—ì„œ ë³´ë‚´ëŠ” ìš”ì²­ì— ëŒ€í•´ ì ìš©ë  ìˆ˜ ìˆë„ë¡ Virtual Serviceë¥¼ ì •ì˜í•œ ë’¤ mesh ë‚´ë¶€ì—ì„œ ìš”ì²­ì„ ë³´ë‚´ë³´ê¸° Virtual Service ì—†ì´ Destination ì´ìš©í•´ë³´ê¸° Virtual Serviceì™€ Destination Ruleì— ëŒ€í•´ ì§šê³  ë„˜ì–´ê°€ë³´ì. virtual services as how you route your trafficÂ toÂ a given destination, and then you use destination rules to configure what happens to trafficÂ forÂ that destination. Destination rules are applied after virtual service routing rules are evaluated, so they apply to the trafficâ€™s â€œrealâ€ destination.\nhttps://istio.io/latest/docs/concepts/traffic-management/#destination-rules\nistioë¥¼ ì²˜ìŒ ë°°ìš¸ ë•Œì—ëŠ” (ë¬¼ë¡  ì´ ê¸€ì„ ì“°ê¸° ì „ê¹Œì§€ë„.. ã…ã…;;) Virtual Serviceì™€ Destination Ruleì´ ì°¸ í—·ê°ˆë ¸ë‹¤.\nVirtual ServiceëŠ” Gatewayë¥¼ í†µí•´ hosts ì„¤ì •í•œ í˜¸ìŠ¤íŠ¸ë¥¼ ì´ìš©í•´ ë“¤ì–´ì˜¨ ìš”ì²­ì„ ì–´ë–¤ ê¸°ì¤€ìœ¼ë¡œ ì–´ë–¤ (ì•½ê°„ì€ ê°€ìƒì¸) ëª©ì ì§€ë¡œ ë³´ë‚´ì¤„ ê²ƒì¸ê°€ë¥¼ ì˜ë¯¸í•œë‹¤. ì´ ë§ë„ ì¢€ í—·ê°ˆë¦´ ìˆ˜ ìˆëŠ”ë° ì˜ˆë¥¼ ë“¤ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.\ningress gateway ë¥¼ í†µí•´ Virtual Serviceì˜ hostsì¸ [â€foo.jinsu.meâ€] ì¤‘ í•˜ë‚˜ì¸ foo.jinsu.meë¥¼ ì´ìš©í•´ ë“¤ì–´ì˜¨ ìš”ì²­ì„ subsetì´ë‚˜ weightì— ë”°ë¼ foo v1 ì´ë‚˜ foo v2 ë¡œ ë³´ë‚¸ë‹¤. ìœ„ì™€ ê°™ì€ ì„¤ì •ì„ í•´ì£¼ëŠ” ê²ƒì´ Virtual Serviceì´ë‹¤.\nê·¸ëŸ¼ foo v1ê³¼ foo v2ëŠ” ëˆ„ê°€ ì •ì˜í•´ì¤„ê¹Œ? ê·€ì‹  ê°™ì´ ì•Œì•„ì„œ v1ì— ëŒ€í•œ endpointì™€ v2ì— ëŒ€í•œ endpointë¥¼ ë¶„ë¥˜í•  ìˆ˜ëŠ” ì—†ì„í…ë° ë§ì´ë‹¤. ë°”ë¡œ ì´ë•Œ Destination Ruleì´ ë“±ì¥í•œë‹¤.\nDestination Ruleì€ ì–´ë–¤ ê¸°ì¤€ìœ¼ë¡œ íŠ¹ì • Service(ì¿ ë²„ì˜ ê¸°ë³¸ ë¦¬ì†ŒìŠ¤ íƒ€ì…)ì— ëŒ€í•œ subsetì„ ë‚˜ëˆŒì§€ ì •ì˜í•  ìˆ˜ ìˆë‹¤. í˜¹ì€ ê·¸ ì™¸ì—ë„ ê¸°ë³¸ì ìœ¼ë¡œ Serviceê°€ ì œê³µí•˜ì§€ ì•ŠëŠ” ìœ ìš©í•œ ë°©ì‹ë“¤ì„ í†µí•´ Endpointê°€ ê´€ë¦¬ë  ìˆ˜ ìˆë„ë¡ í•´ì¤€ë‹¤. ì´ë•Œ ë§í•˜ëŠ” EndpointëŠ” ì¿ ë²„ì˜ ê¸°ë³¸ ë¦¬ì†ŒìŠ¤ íƒ€ì… ì¤‘ í•˜ë‚˜ì¸ Endpointê°€ ì•„ë‹ˆë¼ Destination Ruleì„ í†µí•´ ì‹¤ì œë¡œ íŠ¸ë˜í”½ì´ í˜ë ¤ë³´ë‚´ì§„ë‹¤ëŠ” ì˜ë¯¸ì˜ Endpointë¥¼ ì˜ë¯¸í•œë‹¤.\nê·¼ë° ë­,,, ë‚˜ë¦„ëŒ€ë¡œ ë‘ ê°œë…ì„ ì •ë¦¬í•´ë³´ë ¤í–ˆëŠ”ë° ì‹œì›í•œ ì •ë¦¬ëŠ” ì•„ë‹Œ ê²ƒ ê°™ë‹¤â€¦ ì“°ë‹¤ë³´ë©´ ê°ì´ì˜¤ëŠ”ë° ì•„ì§ ë”± ê¹”ë”í•˜ê²Œ ì •ë¦¬í•  ìˆ˜ ìˆëŠ” ìˆ˜ì¤€ì˜ ì´í•´ëŠ” ì•„ë‹Œê°€ë³´ë‹¤.\nmesh ë‚´ë¶€ì˜ í†µì‹ ì—ì„œë„ virtual serviceë‚˜ destination ruleì´ ë™ì‘í•˜ëŠ”ê°€? ì•ì„œ Virtual Serviceì— ëŒ€í•´ ì„¤ëª…í•  ë•Œ â€œGatewayë¥¼ í†µí•´ ë“¤ì–´ì˜¨ ìš”ì²­ì´ â€¦(ìƒëµ)â€ ì´ë¼ë©° ì„¤ëª…ì„ í–ˆëŠ”ë° ê·¸ë ‡ë‹¤ë©´ Virtual ServiceëŠ” ingress gatewayë¥¼ í†µí•´ ë“¤ì–´ì˜¨ ìš”ì²­ì— ëŒ€í•œ ì„¤ì •ë§Œ ì •ì˜ê°€ ê°€ëŠ¥í•˜ëƒë¼ê³ í•˜ë©´ ê·¸ê±´ ë‹¹ì—°íˆ ì•„ë‹ˆë‹¤. ì• ì´ˆì— istioë¥¼ í†µí•´ ìš°ë¦¬ê°€ ì–»ê³  ì‹¶ì€ ê²ƒì€ ingressì— ëŒ€í•œ ê¸°ëŠ¥ë¿ë§Œ ì•„ë‹ˆë¼ mesh ë‚´ë¶€ í†µì‹ ì— ëŒ€í•œ ê¸°ëŠ¥ë„ í° ë¶€ë¶„ì¼ ê²ƒì´ë‹ˆ ë§ì´ë‹¤.\nThe reserved word mesh is used to imply all the sidecars in the mesh. When this field is omitted, the default gateway (mesh) will be used, which would apply the rule to all sidecars in the mesh.\nhttps://istio.io/latest/docs/reference/config/networking/virtual-service/#VirtualService\nVirtual Serviceê°€ mesh ë¼ëŠ” ì˜ˆì•½ëœ gateway ì´ë¦„ì„ ì´ìš©í•˜ë©´ ê·¸ê²ƒì€ mesh ë‚´ì˜ sidecarë“¤ì—ê²Œ ëª¨ë‘ ì ìš©ë˜ëŠ” ruleì´ ëœë‹¤. Virtual Serviceì˜ gatewaymesh ë‚´ë¶€ í†µì‹ ì— ìˆì–´ Virtual Serviceì˜ ì—­í• ì´ í¼ì—ë„ ë¶ˆêµ¬í•˜ê³  ì•„ì´ëŸ¬ë‹ˆí•˜ê²Œë„ ìœ„ì™€ ê°™ì€ ë‚´ìš©ì„ ì°¾ì•„ë³¼ ìˆ˜ ìˆëŠ” ë¬¸ì„œê°€ ë§ì§€ëŠ” ì•Šì•˜ë‹¤.\nì •ë¦¬í•˜ìë©´ â€œmesh ë‚´ë¶€ì˜ í†µì‹ ì—ì„œë„ virtual serviceë‚˜ destination ruleì´ ë™ì‘í•˜ëŠ”ê°€?â€ì— ëŒ€í•œ ëŒ€ë‹µì€ ì•„ë˜ì™€ ê°™ë‹¤.\nVirtual Serviceì˜ gatewaysì— mesh ê°€ í¬í•¨ë˜ì–´ìˆê±°ë‚˜ gateways ê°€ ìƒëµë˜ì—ˆê³ , client ì¸¡ envoy sidecarê°€ outbound handler ì—­í• ì„ ìˆ˜í–‰í•œë‹¤ë©´ â†’ YES Virtual Serviceì˜ gatewaysë¥¼ ì •ì˜í–ˆëŠ”ë° mesh ê°€ í¬í•¨ë˜ì–´ìˆì§€ ì•Šë‹¤ë©´ â†’ NO client ì¸¡ envoy sidecarê°€ ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜ outbound handler ì—­í• ì„ ì œëŒ€ë¡œ ìˆ˜í–‰í•˜ì§€ ëª»í•œë‹¤ë©´ â†’ NO ê·¸ëŸ¼ í•œ ë²ˆ ì‹¤ìŠµì„ í†µí•´ í™•ì¸í•´ë³´ì.\nmesh ë‚´ë¶€ í†µì‹ ì—ì„œ Virtual Service + Destination Ruleì„ í†µí•´ Service subsetê³¼ weight ì´ìš©í•´ë³´ê¸° httpping-without-sidecarë¼ëŠ” ì´ë¦„ì˜ ì„œë¹„ìŠ¤ë¥¼ ë°°í¬í•´ë‘ì—ˆê³ , ì´ëŠ” golangìœ¼ë¡œ ë§Œë“¤ì–´ì§„ ìš”ì²­ì´ ë“¤ì–´ì˜¬ ë•Œ â€œpongâ€ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” ë‹¨ìˆœí•œ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë‹¤. ì´ ì„œë¹„ìŠ¤ì˜ Podë“¤ì€ Envoy ì‚¬ì´ë“œì¹´ë¥¼ ì£¼ì…ë°›ì§€ ì•ŠëŠ”ë‹¤.\n$ kubectl get pod -l app=httpping-without-sidecar NAME READY STATUS RESTARTS AGE httpping-without-sidecar-v1-7fd6bfdb57-bcpdh 1/1 Running 0 2m54s httpping-without-sidecar-v1-7fd6bfdb57-s4smn 1/1 Running 0 2m54s httpping-without-sidecar-v1-7fd6bfdb57-zg8td 1/1 Running 0 2m54s httpping-without-sidecar-v2-5df8b7f656-n4cvh 1/1 Running 0 2m53s httpping-without-sidecar-v2-5df8b7f656-nfm6q 1/1 Running 0 2m53s httpping-without-sidecar-v2-5df8b7f656-vbgpr 1/1 Running 0 2m53s v1 ê³¼ v2ì— ëŒ€í•œ Deployment ê°ê° ë°°í¬í•´ë‘ì—ˆë‹¤.\nê° ë²„ì „ë³„ë¡œ 3ê°œì˜ Podê°€ ë°°í¬ë˜ì–´ìˆë‹¤.\në²„ì „ ë³„ë¡œ Podë“¤ì€ ë‹¤ìŒê³¼ ê°™ì´ ë¼ë²¨ì´ ë¶™ì–´ìˆë‹¤.\n# v1 Podì˜ ê²½ìš° app: httpping-without-sidecar version: v1 # v2 Podì˜ ê²½ìš° app: httpping-without-sidecar version: v2 Service, Destination Rule, Virtual ServiceëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.\napiVersion: v1 kind: Service metadata: namespace: infra-jinsu-lab name: httpping-without-sidecar spec: selector: app: httpping-without-sidecar ports: - protocol: TCP port: 8080 targetPort: 80 ServiceëŠ” versionì„ ëª…ì‹œí•˜ì§€ ì•Šì€ ì±„ appë§Œì„ ëª…ì‹œí•˜ëŠ” ìˆ˜í¼ì…‹ìœ¼ë¡œì„œ ì •ì˜í–ˆë‹¤.\napiVersion: networking.istio.io/v1alpha3 kind: DestinationRule metadata: namespace: infra-jinsu-lab name: httpping-without-sidecar-destination spec: host: httpping-without-sidecar subsets: - name: v1 labels: app: httpping-without-sidecar version: v1 - name: v2 labels: app: httpping-without-sidecar version: v2 Destination Ruleì€ Serviceì— í•´ë‹¹í•˜ëŠ” Endpointë“¤ì˜ Subsetì²˜ëŸ¼ ì •ì˜ëœë‹¤.\nversion ë¼ë²¨ì´ ì¶”ê°€ë˜ì—ˆë‹¤.\nhostëŠ” Serviceë¥¼ ê°€ë¦¬í‚¬ ìˆ˜ ìˆëŠ” ì´ë¦„ì´ì–´ì•¼í•œë‹¤. ê°™ì€ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì¼ ê²½ìš° Short nameìœ¼ë¡œ í‘œí˜„í•  ìˆ˜ë„ ìˆê³ , ì–¸ì œëŠ” FQDN(e.g. httpping-with-sidecar.infra-jinsu.lab.svc.cluster.local)ìœ¼ë¡œ í‘œí˜„í•  ìˆ˜ë„ ìˆë‹¤.\napiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: namespace: infra-jinsu-lab name: httpping-without-sidecar spec: hosts: - \u0026#34;httpping-without-sidecar\u0026#34; gateways: - mesh http: - match: - uri: prefix: / route: - destination: host: httpping-without-sidecar subset: v1 port: number: 8080 weight: 10 - destination: host: httpping-without-sidecar subset: v2 port: number: 8080 weight: 90 ì•ì„œ ë§í•œëŒ€ë¡œ í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ í†µì‹ ì— ëŒ€í•´ Virtual Serviceë¥¼ ì ìš©í•˜ë ¤ë©´ gateways ë¥¼ ìƒëµí•˜ê±°ë‚˜ mesh ë¼ëŠ” ì˜ˆì•½ëœ ì´ë¦„ì˜ ê²Œì´íŠ¸ì›¨ì´ë¥¼ í¬í•¨ì‹œì¼œì¤€ë‹¤. ë˜í•œ mesh ë‚´ë¶€ í†µì‹ ì— ëŒ€í•´ì„œëŠ” hostsì— Destination Ruleì²˜ëŸ¼ Serviceë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆëŠ” ì´ë¦„ì„ ì ì–´ì¤€ë‹¤.\nê·¸ë¦¬ê³ ì„œëŠ” Destination Ruleì—ì„œ ì •ì˜í•œ v1 subsetì€ weightë¥¼ 10ìœ¼ë¡œ, v2 subsetì€ weightë¥¼ 90ìœ¼ë¡œ ì„¤ì •í•´ì¤¬ë‹¤. ì´ë ‡ê²Œ ë˜ë©´ ëˆ„êµ°ê°€ê°€ ì„œë¹„ìŠ¤ë¥¼ í–¥í•´ ìš”ì²­ì„ ë³´ëƒˆì„ ë•Œ v1ê³¼ v2ê°€ 1ëŒ€9ì˜ ë¹„ìœ¨ë¡œ ë¡œë“œë°¸ëŸ°ìŠ¤ê°€ ë  ê²ƒì´ë‹¤ ğŸ™‚\ncurl -H \u0026#39;foo: bar\u0026#39; http://httpping-without-sidecar.infra-jinsu-lab:8080/ping ì¢Œì¸¡ì€ weightê°€ 10ì¸ v1 Pod 3ê°œ | ìš°ì¸¡ì€ weightê°€ 90ì¸ v2 Pod 3ê°œ Envoy ì‚¬ì´ë“œì¹´ê°€ ì‚½ì…ëœ ì–´ë–¤ Podì—ì„œ ìœ„ì˜ ì»¤ë§¨ë“œë¥¼ í†µí•´ httpping-without-sidecar ì„œë¹„ìŠ¤ë¡œ ìš”ì²­ì„ ë³´ë‚¸ ê²½ìš°ì˜ ëª¨ìŠµì´ë‹¤. ì¢Œì¸¡ ë¡œê·¸ëŠ” v1 Pod 3ê°œì˜ ë¡œê·¸ì´ê³ , ìš°ì¸¡ ë¡œê·¸ëŠ” v2 Pod 3ê°œì˜ ë¡œê·¸ì´ë‹¤.\nVirtual Serviceì—ì„œ ì •ì˜í•œëŒ€ë¡œ ëŒ€ë¶€ë¶„ì˜ íŠ¸ë˜í”½ì€ v2ë¡œ í˜ëŸ¬ê°”ê³  Destination Ruleì—ì„œ ì •ì˜í•œ ëŒ€ë¡œ v1, v2ì— ëŒ€í•œ subsetì´ ì˜ ë¶„ë¥˜ëœ ë“¯í•˜ë‹¤!\nì°¸ê³ ë¡œ ë‹¹ì—°íˆë„ í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ Enovyê°€ outbound handlingì„ í•´ì£¼ì§€ ëª»í•œë‹¤ë©´(í˜¹ì€ sidecarê°€ ì‚½ì…ë˜ì§€ ì•Šì•˜ë‹¤ë©´) weight ì¡°ì ˆë„ ë˜ì§€ ì•Šê³  ê·¸ëƒ¥ ë¼ìš´ë“œë¡œë¹ˆìœ¼ë¡œ ë¶€í•˜ê°€ ë¶„ì‚°ë  ê²ƒì´ë‹¤.\nVirtual Service ì—†ì´ Destination Ruleë§Œìœ¼ë¡œ ì›í•˜ëŠ” ë°©ì‹ì„ í†µí•´ ë¶€í•˜ ë¶„ì‚°ì‹œí‚¤ê¸° ì´ë²ˆì—ëŠ” Virtual Service ì—†ì´ Destination Ruleì˜ ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ì¸ consistentHashë¥¼ í†µí•œ ë¡œë“œë°¸ëŸ°ìŠ¤ë¥¼ í•´ë³¼ ê²ƒì´ë‹¤. ì´ë¥¼ ì´ìš©í•˜ë©´ íŠ¹ì • í‚¤ì— ëŒ€í•œ ê°’ì„ í•´ì‹±í•´ì„œ í•´ë‹¹ í•´ì‹œ ê°’ì„ ë‹´ë‹¹í•˜ëŠ” Podì—ê²Œ ìš”ì²­ì„ ë³´ë‚¼ ê²ƒì´ë‹¤!\n$ kubectl delete virtualservice httpping-without-sidecar virtualservice.networking.istio.io \u0026#34;httpping-without-sidecar\u0026#34; deleted Virtual Service ì—†ì´ ë™ì‘í•¨ì„ ë¶„ëª…íˆ í•˜ê¸° ìœ„í•´ ì‚­ì œí•´ì¤€ë‹¤.\napiVersion: networking.istio.io/v1alpha3 kind: DestinationRule metadata: namespace: infra-jinsu-lab name: httpping-without-sidecar-destination spec: host: httpping-without-sidecar trafficPolicy: loadBalancer: consistentHash: httpHeaderName: foo ì´ë²ˆì—ëŠ” Destinationì„ ìœ„ì™€ ê°™ì´ ì‘ì„±í•´ì¤Œìœ¼ë¡œì¨ í—¤ë” ì¤‘ fooë¼ëŠ” í‚¤ì— ëŒ€í•œ ê°’ì— ë”°ë¼ ë¶€í•˜ê°€ ë¶„ì‚°ë˜ë„ë¡ í•  ê²ƒì´ë‹¤. ê°™ì€ ê°’ìœ¼ë¡œ ìš”ì²­ì„ ë³´ë‚´ë©´ ë‹´ë‹¹í•˜ëŠ” í•´ì‹œ ê°’ì´ ë³€ê²½ë˜ì§€ ì•ŠëŠ” í•œ ê°™ì€ Podë¡œë§Œ ìš”ì²­ì´ ê°ˆ ê²ƒì´ë‹¤.\ncurl -H \u0026#39;foo: bar\u0026#39; http://httpping-with-sidecar.infra-jinsu-lab:8080/ping Envoy ì‚¬ì´ë“œì¹´ê°€ ì‚½ì…ë˜ì–´ outbound handlerê°€ ì˜ ë™ì‘ ì¤‘ì¸ ë‹¤ë¥¸ Podì—ì„œ ìœ„ì™€ ê°™ì´ ìš”ì²­ì„ ì—¬ëŸ¬ ì°¨ë¡€ ë³´ë‚´ë´¤ë‹¤.\nConsistent Hash ì„¤ì • í›„ foo: barë¼ëŠ” ë™ì¼í•œ í—¤ë”ë¡œ ìš”ì²­ì„ ë³´ë‚¸ ê²½ìš°ì˜ ë¡œê·¸ ìœ„ì™€ ê°™ì´ í•˜ë‚˜ì˜ Podë¡œë§Œ ìš”ì²­ì´ ê°„ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤!\në§ˆì¹˜ë©° ì´ë²ˆ ì£¼ì— ì—…ë¬´ê°€ ì •ë§ ë§ì•˜ëŠ”ë° ì´ë˜ ì €ë˜ ì˜¤ê°”ë˜ ëŒ€í™” ì¤‘ì— í—·ê°ˆë¦¬ëŠ” ë¶€ë¶„ì´ ìˆì–´ì„œ ê°‘ìê¸° ì•¼ë°¤ì— ì´ë ‡ê²Œ ë‚´ìš©ì„ ì •ë¦¬í•´ë´¤ë‹¤. ê³µì‹ ë¬¸ì„œë¥¼ ë‹¤ì‹œ í•œ ë²ˆ ì •ë…í•œ ë’¤ â€˜ì•„~ ì–˜ì˜ ì—­í• ì€ ì´ê±°ë‹ˆê¹Œ ì´ë ‡ê²Œ í•˜ë©´ ì´ë ‡ê²Œ ë˜ê² êµ°!â€™ì´ë¼ë©° ì‚´ì§ì¿µ ì´í•´ë¥¼ í•œ ë’¤ì— ì‹¤ìŠµì„ í•´ë´¤ê³  ê²°ê³¼ê°€ ì˜ ë‚˜ì™€ì„œ ë¿Œë“¯í•˜ë‹¤. ë§˜ í¸íˆ ì˜ ìˆ˜ ìˆì„ ë“¯.\në‹¤ë§Œ ë¬¸ì„œ ë‚´ìš©ê³¼ ì»¨ì…‰ë“¤ì˜ â€œì—­í• \u0026quot;ì´ë‚˜ â€œì˜ë¯¸\u0026quot;ì— ëŒ€í•œ ì´í•´ ë¿ë§Œ ì•„ë‹ˆë¼ ì‹¤ì œ ë™ì‘ í”Œë¡œìš°ê¹Œì§€ë„ ì•Œê³  ì‹¶ì€ ë§ˆìŒì€ ìˆëŠ”ë° ë„ˆë¬´ ì¡°ê¸‰í•´í•˜ëŠ” ê²ƒë³´ë‹¤ëŠ” ë¹ ë¥´ì§„ ì•Šë”ë¼ë„ ê¾¸ì¤€í•˜ê²Œ ì´ë ‡ê²Œ í•˜ë‚˜ í•˜ë‚˜ ê³µë¶€í•´ë‚˜ê°€ë©´ ë  ê²ƒì´ë¼ê³  ë¯¿ëŠ”ë‹¤!\nì°¸ê³  ê°ì¢… istio ë¬¸ì„œë“¤ Traffic Management ì»¨ì…‰ https://istio.io/latest/docs/concepts/traffic-management/ Traffic Management, Networking config ê´€ë ¨ ë¬¸ì„œ https://istio.io/latest/docs/reference/config/networking/ Using Istio VirtualService from inside of the cluster - https://stackoverflow.com/questions/65626962/using-istio-virtualservice-from-inside-of-the-cluster ","date":"2022-08-11T03:20:00+09:00","image":"https://umi0410.github.io/blog/devops/virtual-service-destination-rule-mesh-internal-traffic/preview_hu479968be15567657f18e71d11f31e69a_283588_120x120_fill_box_smart1_3.png","permalink":"https://umi0410.github.io/blog/devops/virtual-service-destination-rule-mesh-internal-traffic/","title":"Virtual Serviceì™€ Destination Ruleì„ ì´ìš©í•´ mesh ë‚´ë¶€ íŠ¸ë˜í”½ì„ ì›í•˜ëŠ” ëŒ€ë¡œ ë¼ìš°íŒ…í•´ë³´ê¸°"},{"content":"ì‹œì‘í•˜ë©° ìš”ì¦˜ istioë¥¼ ê³µë¶€í•˜ë˜ ì¤‘ istioê°€ ë³€í™”í•´ì˜¨ ê³¼ì •ì— ëŒ€í•´ì„œë„ í¥ë¯¸ê°€ ìƒê²¨ ì§€ë‚œ ë²„ì „ë“¤ì˜ ë¦´ë¦¬ì¦ˆ ë…¸íŠ¸ë“¤ë„ ì½ì–´ë³´ê³  ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë˜ ì¤‘ í˜„ ì‹œì (2022ë…„ 7ì›”)ì—ëŠ” ì´ë¯¸ ê³µì‹ì ì¸ End of Lifeê°€ ì§€ë‚œ 2021ë…„ 3ì›” ì²˜ìŒ ë¦´ë¦¬ì¦ˆëœ istio 1.10ì˜ ë¦´ë¦¬ì¦ˆ ë…¸íŠ¸ë¥¼ ë³´ë‹¤ê°€ ì¬ë¯¸ìˆëŠ” ì ì„ í•˜ë‚˜ ë°œê²¬í•  ìˆ˜ ìˆì—ˆëŠ”ë°ìš”.\në°”ë¡œ envoy proxyê°€ eth0ì— ëŒ€í•œ ìš”ì²­ì„ ë„˜ê²¨ì£¼ëŠ” containerì˜ network interfaceê°€ lo ì—ì„œ eth0 ë¡œ ë³€ê²½ë˜ì—ˆë‹¤ëŠ” ì ì…ë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ì— ëŒ€í•´, ê·¸ ì¤‘ì—ì„œë„ íŠ¹íˆ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ì— ëŒ€í•´ ì˜ ëª°ëë˜ ë•Œì—ëŠ” ì´ ë³€ê²½ì‚¬í•­ì— ê·¸ë‹¥ ê´€ì‹¬ì´ ì•ˆ ê°”ì„ ê²ƒ ê°™ì€ë° ìµœê·¼ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ì— ëŒ€í•´ ê³µë¶€ë¥¼ í•´ì„œì¸ì§€ ì´ ë³€ê²½ì‚¬í•­ì— ê´€ì‹¬ì´ ê°”ìŠµë‹ˆë‹¤.\nê·¸ë˜ì„œ ì´ë²ˆ ê¸€ì—ì„œëŠ” ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ì™€ ê´€ë ¨ëœ istio 1.9 â†’ 1.10ì˜ ë³€ê²½ì‚¬í•­ì„ ì‹¤ì œ ì‘ì—…ì„ í†µí•´ í™•ì¸í•´ë³´ë ¤í•©ë‹ˆë‹¤. ì‹¤ì œ ì‘ì—…ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.\nistio 1.9 - ì„œë²„ë¥¼ lo (ë£¨í”„ë°± ì¸í„°í˜ì´ìŠ¤)ì˜ IP(127.0.0.1)ë¡œ ë„ìš´ ê²½ìš° Serviceì— ìš”ì²­ì„ ë³´ë‚´ ì„±ê³µì ì¸ ì‘ë‹µì„ ë°›ì„ ìˆ˜ ìˆìŒì„ í™•ì¸ istio 1.9 - ì„œë²„ë¥¼ eth0 ì˜ IPë¡œ ë„ìš´ ê²½ìš° Serviceì— ìš”ì²­ì„ ë³´ë‚´ë„ ìš”ì²­ì´ ì œëŒ€ë¡œ ì „ë‹¬ë˜ì§€ ì•ŠìŒì„ í™•ì¸ istio 1.10 - ì„œë²„ë¥¼ lo (ë£¨í”„ë°± ì¸í„°í˜ì´ìŠ¤)ì˜ IP(127.0.0.1)ë¡œ ë„ìš´ ê²½ìš° Serviceì— ìš”ì²­ì„ ë³´ë‚´ë„ ìš”ì²­ì´ ì œëŒ€ë¡œ ì „ë‹¬ë˜ì§€ ì•ŠìŒì„ í™•ì¸ istio 1.10 - ì„œë²„ë¥¼ eth0 ì˜ IPë¡œ ë„ìš´ ê²½ìš° Serviceì— ìš”ì²­ì„ ë³´ë‚´ ì„±ê³µì ì¸ ì‘ë‹µì„ ë°›ì„ ìˆ˜ ìˆìŒì„ í™•ì¸ istio \u0026lt;-\u0026gt; k8s ë²„ì „ í˜¸í™˜ì„± k8s ë²„ì „ì€ istio 1.9ì™€ istio 1.10 ëª¨ë‘ì™€ í˜¸í™˜ë˜ëŠ” k8s 1.20 ì„ ì´ìš©í•  ê²ƒì´ê³  k8sëŠ” minikubeë¥¼ í†µí•´ ë¡œì»¬ì—ì„œ êµ¬ì„±í•  ê²ƒì…ë‹ˆë‹¤.\nâš ï¸ ì°¸ê³ ë¡œ M1 ë§¥ë¶ì˜ minikubeì—ì„  envoy proxyê°€ ë™ì‘í•˜ì§€ ì•Šì•„ì„œì¸ì§€ istioë¥¼ ì œëŒ€ë¡œ ì´ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì €ëŠ” ubuntuì—ì„œ minikubeë¥¼ í†µí•´ ì‘ì—…í–ˆìŠµë‹ˆë‹¤.\nistio 1.9 â†’ 1.10 ë³€ê²½ì‚¬í•­ ì¤‘ ì¬ë¯¸ìˆëŠ” ì  1.10 ë¦´ë¦¬ì¦ˆ ë…¸íŠ¸ (ì°¸ê³ : https://istio.io/latest/news/releases/1.10.x/announcing-1.10/)\n1.10 ë²„ì „ì˜ ë³€ê²½ì‚¬í•­ì— ëŒ€í•´ ì¢€ ë” ìì„¸íˆ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤. ì´ì „ ë²„ì „ì—ì„œëŠ” Sidecar Envoy Proxyê°€ eth0ìœ¼ë¡œ ë“¤ì–´ì˜¨ ìš”ì²­ì„ loë¡œ ë„˜ê²¨ì¤˜ì™”ëŠ”ë° ì´ë²ˆ ë²„ì „(1.10)ì—ì„œë¶€í„°ëŠ” eth0ë¡œ ë“¤ì–´ì˜¨ ìš”ì²­ì„ eth0ë¡œ ë„˜ê²¨ì¤€ë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.\nëŒ€ë¶€ë¶„ ì„œë²„ë¥¼ ë„ìš¸ ë•Œ 0.0.0.0ì„ í†µí•´ loopback interfaceì™€ ethernet interface ëª¨ë‘ì— ì„œë²„ë¥¼ ë„ìš°ëŠ” ê²½ìš°ê°€ ë§ì•„ í•´ë‹¹ ë‚´ìš©ì´ í° ë³€í™”ë¥¼ ê°€ì ¸ì˜¤ì§„ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\ní•˜ì§€ë§Œ ë§Œì•½ ê¸°ì¡´ì— íŠ¹ì • interfaceì˜ IPë§Œì„ ì§€ì •í•´ì„œ ì„œë²„ë¥¼ ë„ìš°ëŠ” ê²½ìš°ê°€ ìˆì—ˆë‹¤ë©´ ì´ ë³€ê²½ì‚¬í•­ìœ¼ë¡œ ì¸í•´ í†µì‹  ì¥ì• ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nloopback interfaceì˜ IPë¡œë§Œ ì„œë²„ë¥¼ ë„ìš´ ê²½ìš° â†’ eth0ë¡œ ë³´ë‚¸ ìš”ì²­ì„ sidecarë¥¼ ê±°ì³ loê°€ ë°›ì„ ìˆ˜ ìˆë˜ ì»¨í…Œì´ë„ˆê°€ ìš”ì²­ì„ ë°›ì„ ìˆ˜ ì—†ì–´ì§. eth0 interfaceì˜ IPë¡œë§Œ ì„œë²„ë¥¼ ë ìš´ ê²½ìš° â†’ eth0ë¡œ ë³´ë‚¸ ìš”ì²­ì„ sidecarë¥¼ ê±°ì³ ì—¬ì „íˆ eth0ê°€ ìš”ì²­ì„ ë°›ì„ ìˆ˜ ìˆì–´ì§. ì´ëŸ¬í•œ ë³€ê²½ ì‚¬í•­ì´ ì¶”ê°€ëœ ì´ìœ ëŠ”?\nOn-premiseë‚˜ non-k8s í™˜ê²½ì—ì„œëŠ” ë³´í†µ lo ì— ì„œë²„ë¥¼ ë„ìš°ëŠ” ê²½ìš°ëŠ” ì™¸ë¶€ì—ì„œì˜ ì ‘ì†ì„ ë§‰ìœ¼ë ¤ëŠ” ê²½ìš°ì¼ ê²ƒì…ë‹ˆë‹¤. ë°˜ë©´ eth0 ì— ì„œë²„ë¥¼ ë„ìš°ëŠ” ê²½ìš°ëŠ” ì™¸ë¶€ì—ì„œì˜ ì ‘ì†ì„ í—ˆìš©í•˜ë ¤ëŠ” ê²½ìš°ì¼ ê²ƒì…ë‹ˆë‹¤.\ní•˜ì§€ë§Œ ì´ì „ì—ëŠ” ì´ëŸ¬í•œ ê¸°ì¡´ í™˜ê²½ì—ì„œ istioë¥¼ ë„ì…í•˜ê²Œ ë˜ë©´ ê¸°ì¡´ì˜ ì˜ë„ì™€ ë°˜ëŒ€ë˜ê²Œ ì˜¤íˆë ¤ lo ì— ì„œë²„ë¥¼ ë„ìš´ ê²½ìš° ì˜¤íˆë ¤ envoy sidecarì—ê²Œ ìš”ì²­ì„ ì „ë‹¬ë°›ì„ ìˆ˜ ìˆì–´ì§€ê³ , eth0 ì— ì„œë²„ë¥¼ ë„ìš´ ê²½ìš°ëŠ” ì˜¤íˆë ¤ enovy sidecarì—ê²Œ ìš”ì²­ì„ ì „ë‹¬ë°›ì„ ìˆ˜ ì—†ì—ˆë˜ ëª¨ìˆœëœ ìƒí™©ì´ ë°œìƒí–ˆë‹¤ê³  í•©ë‹ˆë‹¤.\në”°ë¼ì„œ ì´ëŸ¬í•œ ëª¨ìˆœëœ ìƒí™©ë“¤ì„ ë°©ì§€í•˜ê³ ì ì´ëŸ¬í•œ ë³€ê²½ì‚¬í•­ì´ ì¶”ê°€ë˜ì—ˆë‹¤ê³  í•©ë‹ˆë‹¤.\nminikubeë¥¼ í†µí•´ k8s 1.20.15 í™˜ê²½ êµ¬ì¶•í•˜ê¸° $ minikube start --profile k8s-1-20 --kubernetes-version 1.20.15 ìœ„ì˜ ëª…ë ¹ì–´ë¥¼ í†µí•´ íŠ¹ì • k8s ë²„ì „(1.20.15)ì˜ í™˜ê²½ì„ ë¡œì»¬ì— êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nk8sì— istio 1.9ì™€ 1.10 ì„¤ì¹˜í•˜ê¸° istioctlì„ í†µí•´ ë‘ ë²„ì „ì˜ istioë¥¼ k8s clusterì— ë°°í¬í•´ì¤„ ê²ƒì…ë‹ˆë‹¤.\nistioctlì˜ ë²„ì „ì— ë§ê²Œ istioê°€ ì„¤ì¹˜ë˜ê¸° ë•Œë¬¸ì— ê·¸ë•Œ ê·¸ë•Œ í¸ë¦¬í•˜ê²Œ istioctlì˜ ë²„ì „ì„ ë³€ê²½í•´ì•¼í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì €ëŠ” asdfë¼ëŠ” ë„êµ¬ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. ìŠ¤íƒ€ ìˆ˜ëŠ” ì ì§€ë§Œ asdfì˜ istioctl pluginì„ ì´ìš©í•˜ê¸°ë„ í–ˆìŠµë‹ˆë‹¤.\në¯¸ë¦¬ ì •ì˜ë˜ì–´ ìˆëŠ” Profile ëª©ë¡ ì°¸ê³ : https://istio.io/latest/docs/setup/additional-setup/config-profiles/\nistioctlì„ í†µí•´ istioë¥¼ í´ëŸ¬ìŠ¤í„°ì— ë°°í¬í•  ë•Œì—ëŠ” ë¯¸ë¦¬ ì •ì˜ë˜ì–´ìˆëŠ” profileì´ë¼ëŠ” ê²ƒì„ ì´ìš©í•´ ì¢€ ë” í¸ë¦¬í•˜ê²Œ ì„¤ì •ì„ í•´ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë²ˆ ì‘ì—…ì—ì„œ gatewayë“¤ì€ í•„ìš” ì—†ê¸° ë•Œë¬¸ì— ì €ëŠ” minimal profileì„ í†µí•´ ì„¤ì¹˜í•´ì£¼ê² ìŠµë‹ˆë‹¤.\nasdf plugin-add istioctl https://github.com/virtualstaticvoid/asdf-istioctl.git \u0026amp;\u0026amp; \\ asdf install istioctl 1.9.9 \u0026amp;\u0026amp; \\ asdf install istioctl 1.10.6 ìœ„ì˜ ëª…ë ¹ì–´ë¥¼ í†µí•´ istioctl 1.9.9ì™€ 1.10.6 ë‘ ë²„ì „ì„ ëª¨ë‘ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n$ asdf global istioctl 1.9.9 \u0026amp;\u0026amp; istioctl version no running Istio pods in \u0026#34;istio-system\u0026#34; 1.9.9 istioctl 1.9.9ë¥¼ ì´ìš©í•˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.\nistioctl install --set profile=minimal --set revision=1-9 --set values.global.proxy.holdApplicationUntilProxyStarts=true ! values.global.proxy.holdApplicationUntilProxyStarts is deprecated; use meshConfig.defaultConfig.holdApplicationUntilProxyStarts instead ! Istio is being downgraded from 1.9.0 -\u0026gt; 1.9.9.This will install the Istio 1.9.9 minimal profile with [\u0026#34;Istio core\u0026#34; \u0026#34;Istiod\u0026#34;] components into the cluster. Proceed? (y/N) y âœ” Istio core installed âœ” Istiod installed âœ” Installation complete istio 1.9.9ë¥¼ 1-9ë¼ëŠ” revisionìœ¼ë¡œ ê¹”ì•„ì¤ë‹ˆë‹¤.\nvalues.global.proxy.holdApplicationUntilProxyStartsì™€ meshConfig.defaultConfig.holdApplicationUntilProxyStartsëŠ” envoy proxyê°€ ì¤€ë¹„ëœ ë’¤ì— ìš°ë¦¬ê°€ ì •ì˜í•œ ì‹¤ì œ ì»¨í…Œì´ë„ˆë¥¼ ì‹œì‘í•˜ëŠ” ì˜µì…˜ì…ë‹ˆë‹¤. ì „ìëŠ” Deprecated ë˜ì—ˆë‹¤ê³  ê²½ê³ ê°€ ëœ¨ì§€ë§Œ ì ìš©í•´ë³¸ ê²°ê³¼ 1.9 ë²„ì „ ëŒ€ì—ì„œëŠ” ì—¬ì „íˆ ì „ìë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒ ê°™ë”ë¼êµ¬ìš”. ë”°ë¼ì„œ ì €ëŠ” 1.9.9 ë²„ì „ì—ì„œëŠ” ì „ìì˜ ì¸ìë¥¼, 1.10.6 ë²„ì „ì—ì„œëŠ” í›„ìì˜ ì¸ìë¥¼ ì ìš©í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.\në§Œì•½ envoy proxyê°€ ì™„ì „íˆ ì¤€ë¹„ë˜ê¸° ì „ì— ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆì—ì„œ ë„¤íŠ¸ì›Œí¬ ì‘ì—…ì„ ìˆ˜í–‰í•˜ë©´ í•´ë‹¹ ì‘ì—…ì€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜í–‰ë˜ì§€ ì•Šì„ ê²ƒì…ë‹ˆë‹¤.\n$ asdf global istioctl 1.10.6 \u0026amp;\u0026amp; istioctl version client version: 1.10.6 control plane version: 1.9.9 data plane version: none istioctl 1.10.6ì„ ì´ìš©í•˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.\n$ istioctl install --set profile=minimal --set revision=1-10 --set meshConfig.defaultConfig.holdApplicationUntilProxyStarts=true WARNING: Istio is being upgraded from 1.9.9 -\u0026gt; 1.10.6. WARNING: Before upgrading, you may wish to use \u0026#39;istioctl analyze\u0026#39; to check forIST0002 and IST0135 deprecation warnings. This will install the Istio 1.10.6 minimal profile with [\u0026#34;Istio core\u0026#34; \u0026#34;Istiod\u0026#34;] components into the cluster. Proceed? (y/N) y âœ” Istio core installed âœ” Istiod installed âœ” Installation complete Thank you for installing Istio 1.10. Please take a few minutes to tell us about your install/upgrade experience! https://forms.gle/KjkrDnMPByq7akrYA istio 1.10.6ì„ 1-10ì´ë¼ëŠ” revisionìœ¼ë¡œ ê¹”ì•„ì¤ë‹ˆë‹¤.\nì›Œë‹ì´ ë– ìˆê¸´ í•˜ì§€ë§Œ ê·¸ë‹¥ ìƒê´€ì€ ì—†ìŠµë‹ˆë‹¤.\n$ kubectl get pod -n istio-system NAME READY STATUS RESTARTS AGE istiod-1-10-5cd4d5b44d-b98xm 1/1 Running 0 84s istiod-1-9-6b549b9d87-9f76b 1/1 Running 0 2m56s ì˜ ê¹”ë ¸ë‹¤ë©´ ìœ„ì™€ ê°™ì´ Podë“¤ì´ ì„±ê³µì ìœ¼ë¡œ ë–´ì„ ê²ƒì…ë‹ˆë‹¤.\nistio sidecarê°€ injectedëœ netcat server \u0026amp; client Pod ë°°í¬í•˜ê¸° ì´ì œ netcat serverì´ì clientê°€ ë  Pod ë“¤ì„ ë°°í¬í•´ì¤„ ê²ƒì…ë‹ˆë‹¤.\në°°í¬í•  ë¦¬ì†ŒìŠ¤ë“¤ì€ ëª¨ë‘ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.\nNamespace rev-1-9 - istio 1.9ì˜ sidecar injectë¥¼ ë°›ì„ Namespace Namespace rev-1-10 - istio 1.10ì˜ sidecar injectë¥¼ ë°›ì„ Namespace Pod netcat-client - default Namespaceì—ì„œ ê° Serviceë¥¼ í†µí•´ netcat ìš”ì²­ì„ ë‚ ë ¤ì¤„ client Pod netcat-lo - lo ì¸í„°í˜ì´ìŠ¤ì˜ IP ì— netcat ì„œë²„ë¥¼ ë„ìš°ëŠ” Pod. Pod netcat-eth0 - eth0 ì¸í„°í˜ì´ìŠ¤ì˜ IPì— netcat ì„œë²„ë¥¼ ë„ìš°ëŠ” Pod. Service lo - lo ì¸í„°í˜ì´ìŠ¤ì˜ IPì— netcat ì„œë²„ë¥¼ ë„ìš´ Podë¥¼ ë…¸ì¶œì‹œì¼œì¤„ Service Service eth0 - eth0 ì¸í„°í˜ì´ìŠ¤ì˜ IPì— netcat ì„œë²„ë¥¼ ë„ìš´ Podë¥¼ ë…¸ì¶œì‹œì¼œì¤„ Service (netcat ì„œë²„ PodëŠ” 8080 í¬íŠ¸ì— ìš”ì²­ì´ TCP ì»¤ë„¥ì…˜ì´ í˜•ì„±ë˜ë©´ â€œpongâ€ìœ¼ë¡œ ì‘ë‹µí•˜ëŠ” Podì…ë‹ˆë‹¤.)\napiVersion: v1 kind: Namespace metadata: labels: istio.io/rev: 1-9 name: rev-1-9 --- apiVersion: v1 kind: Namespace metadata: labels: istio.io/rev: 1-10 name: rev-1-10 --- apiVersion: v1 kind: Pod metadata: namespace: default name: netcat-client spec: containers: - image: ubuntu:22.04 command: - \u0026#34;/bin/bash\u0026#34; - \u0026#34;-c\u0026#34; args: - | apt update \u0026amp;\u0026amp; apt install -y ncat while true; do sleep 60; done; imagePullPolicy: IfNotPresent name: netcat-client restartPolicy: Always --- apiVersion: v1 kind: Pod metadata: namespace: rev-1-9 name: netcat-lo labels: app: rev-1-9-lo spec: containers: - image: ubuntu:22.04 command: - \u0026#34;/bin/bash\u0026#34; - \u0026#34;-c\u0026#34; args: - | apt update \u0026amp;\u0026amp; apt install -y net-tools ncat ifconfig eth0 | grep \u0026#39;inet \u0026#39; | awk \u0026#39;{print $2}\u0026#39; while true do echo \u0026#39;pong\u0026#39; | nc -l 127.0.0.1 8080 sleep 1 done imagePullPolicy: IfNotPresent name: ubuntu ports: - containerPort: 8080 restartPolicy: Always --- apiVersion: v1 kind: Pod metadata: namespace: rev-1-10 name: netcat-lo labels: istio.io/rev: 1-10 app: rev-1-10-lo spec: containers: - image: ubuntu:22.04 command: - \u0026#34;/bin/bash\u0026#34; - \u0026#34;-c\u0026#34; args: - | apt update \u0026amp;\u0026amp; apt install -y net-tools ncat while true do echo \u0026#39;pong\u0026#39; | nc -l 127.0.0.1 8080 sleep 1 done imagePullPolicy: IfNotPresent name: ubuntu ports: - containerPort: 8080 restartPolicy: Always --- apiVersion: v1 kind: Pod metadata: namespace: rev-1-9 name: netcat-eth0 labels: istio.io/rev: 1-9 app: rev-1-9-eth0 spec: containers: - image: ubuntu:22.04 command: - \u0026#34;/bin/bash\u0026#34; - \u0026#34;-c\u0026#34; args: - | apt update \u0026amp;\u0026amp; apt install -y net-tools ncat ifconfig eth0 | grep \u0026#39;inet \u0026#39; | awk \u0026#39;{print $2}\u0026#39; while true do echo \u0026#39;pong\u0026#39; | nc -l $(ifconfig eth0 | grep \u0026#39;inet \u0026#39; | awk \u0026#39;{print $2}\u0026#39;) 8080 sleep 1 done imagePullPolicy: IfNotPresent name: ubuntu ports: - containerPort: 8080 restartPolicy: Always --- apiVersion: v1 kind: Pod metadata: namespace: rev-1-10 name: netcat-eth0 labels: istio.io/rev: 1-10 app: rev-1-10-eth0 spec: containers: - image: ubuntu:22.04 command: - \u0026#34;/bin/bash\u0026#34; - \u0026#34;-c\u0026#34; args: - | apt update \u0026amp;\u0026amp; apt install -y net-tools ncat ifconfig eth0 | grep \u0026#39;inet \u0026#39; | awk \u0026#39;{print $2}\u0026#39; while true do echo \u0026#39;pong\u0026#39; | nc -l $(ifconfig eth0 | grep \u0026#39;inet \u0026#39; | awk \u0026#39;{print $2}\u0026#39;) 8080 done imagePullPolicy: IfNotPresent name: ubuntu ports: - containerPort: 8080 restartPolicy: Always --- apiVersion: v1 kind: Service metadata: namespace: rev-1-9 name: lo spec: ports: - port: 8080 protocol: TCP selector: app: rev-1-9-lo --- apiVersion: v1 kind: Service metadata: namespace: rev-1-9 name: eth0 spec: ports: - port: 8080 protocol: TCP selector: app: rev-1-9-eth0 --- apiVersion: v1 kind: Service metadata: namespace: rev-1-10 name: lo spec: ports: - port: 8080 protocol: TCP selector: app: rev-1-10-lo --- apiVersion: v1 kind: Service metadata: namespace: rev-1-10 name: eth0 spec: ports: - port: 8080 protocol: TCP selector: app: rev-1-10-eth0 $ kubectl apply -f tmp.yaml namespace/rev-1-9 created namespace/rev-1-10 created pod/netcat-client created pod/netcat-lo created pod/netcat-lo created pod/netcat-eth0 created pod/netcat-eth0 created service/lo created service/eth0 created service/lo created service/eth0 created ìœ„ì˜ ëª…ë ¹ì–´ë“¤ì„ ì´ìš©í•´ sidecarê°€ injectedë  netcat ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ Podë¥¼ ë°°í¬í•´ì¤ë‹ˆë‹¤.\n$ kubectl get pod -A NAMESPACE NAME READY STATUS RESTARTS AGE default netcat-client 1/1 Running 0 15m istio-system istiod-1-10-5cd4d5b44d-8lv2h 1/1 Running 0 145m istio-system istiod-1-9-5ccbd888d8-scdzz 1/1 Running 0 107m ... rev-1-10 netcat-eth0 2/2 Running 0 18m rev-1-10 netcat-lo 2/2 Running 0 18m rev-1-9 netcat-eth0 2/2 Running 1 17m rev-1-9 netcat-lo 2/2 Running 1 17m $ kubectl get svc -A NAMESPACE NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE default kubernetes ClusterIP 10.96.0.1 \u0026lt;none\u0026gt; 443/TCP 3h10m istio-system istiod-1-10 ClusterIP 10.110.227.112 \u0026lt;none\u0026gt; 15010/TCP,15012/TCP,443/TCP,15014/TCP 3h3m istio-system istiod-1-9 ClusterIP 10.107.205.100 \u0026lt;none\u0026gt; 15010/TCP,15012/TCP,443/TCP,15014/TCP 145m kube-system kube-dns ClusterIP 10.96.0.10 \u0026lt;none\u0026gt; 53/UDP,53/TCP,9153/TCP 3h10m rev-1-10 eth0 ClusterIP 10.111.38.103 \u0026lt;none\u0026gt; 8080/TCP 35m rev-1-10 lo ClusterIP 10.106.100.209 \u0026lt;none\u0026gt; 8080/TCP 35m rev-1-9 eth0 ClusterIP 10.105.29.177 \u0026lt;none\u0026gt; 8080/TCP 35m rev-1-9 lo ClusterIP 10.100.228.64 \u0026lt;none\u0026gt; 8080/TCP 35m ì„±ê³µì ìœ¼ë¡œ ë°°í¬í–ˆë‹¤ë©´ ìœ„ì™€ ê°™ì„ ê²ƒì…ë‹ˆë‹¤.\nnetcat ì„œë²„ë“¤ì—ê²Œ ìš”ì²­ ë³´ë‚´ë³´ê¸° kubectl execì™€ netcat ëª…ë ¹ì–´ë¥¼ í†µí•´ netcat-client ì˜ ì´ë¦„ìœ¼ë¡œ ë°°í¬í•œ Podë¡œ ê° Serviceë“¤ì„ ê±°ì³ ê° Podì—ê²Œ ìš”ì²­ì„ ë³´ë‚´ë³¼ ê²ƒì…ë‹ˆë‹¤.\n$ kubectl exec -n default netcat-client -- bash -c \u0026#34;echo \u0026#39;ping\u0026#39; | nc lo.rev-1-9 8080\u0026#34; pong $ kubectl exec -n default netcat-client -- bash -c \u0026#34;echo \u0026#39;ping\u0026#39; | nc eth0.rev-1-9 8080\u0026#34; Ncat: Connection reset by peer. command terminated with exit code 1 ê° Podì˜ netcat serverê°€ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ë˜ë©´ ìœ„ì™€ ê°™ì´ netcat-client Podë¥¼ ì´ìš©í•´ ëª…ë ¹ì„ ë‚ ë ¤ ì‘ë‹µì„ ë°›ì•„ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n(ì´ˆê¸° ì„œë²„ê°€ êµ¬ë™ë˜ê¸°ê¹Œì§€ ë‹¤ì†Œ ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš° ì„œë²„ì˜ ë¡œê·¸ë¥¼ í†µí•´ ì„œë²„ê°€ êµ¬ë™ëëŠ”ì§€ë¥¼ í™•ì¸í•´ë³´ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.)\neth0ì˜ IPì— ì„œë²„ë¥¼ ë„ìš´ Podë¥¼ ëª©ì ì§€ë¡œ í•˜ëŠ” Serviceì—ê²Œ ìš”ì²­ì„ ë³´ë‚¼ ê²½ìš° í•´ë‹¹ ëª©ì ì§€ Podê°€ istio 1.9ì— ì˜í•´ sidecar injection ë˜ì—ˆë‹¤ë©´ Pod ë‚´ì˜ ì„œë²„ëŠ” ì˜¬ë°”ë¥´ê²Œ ìš”ì²­ì„ ì „ë‹¬ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n$ kubectl exec -n default netcat-client -- bash -c \u0026#34;echo \u0026#39;ping\u0026#39; | nc lo.rev-1-10 8080\u0026#34; Ncat: Connection reset by peer. command terminated with exit code 1 $ kubectl exec -n default netcat-client -- bash -c \u0026#34;echo \u0026#39;ping\u0026#39; | nc eth0.rev-1-10 8080\u0026#34; pong istio 1.10ì„ ì´ìš©í•œ ê²½ìš° ê²°ê³¼ëŠ” ì˜ˆìƒëŒ€ë¡œ istio 1.9ì™€ ë°˜ëŒ€ì…ë‹ˆë‹¤.\nlo ì˜ IPì— ì„œë²„ë¥¼ ë„ìš´ Podë¥¼ ëª©ì ì§€ë¡œ í•˜ëŠ” Serviceì—ê²Œ ìš”ì²­ì„ ë³´ë‚¼ ê²½ìš° í•´ë‹¹ ëª©ì ì§€ Podê°€ istio 1.10ì— ì˜í•´ sidecar injection ë˜ì—ˆë‹¤ë©´ Pod ë‚´ì˜ ì„œë²„ëŠ” ì˜¬ë°”ë¥´ê²Œ ìš”ì²­ì„ ì „ë‹¬ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\në§ˆì¹˜ë©° ìš”ì¦˜ ë²„ì „ì´ ì°¸ ì¤‘ìš”í•˜ë‹¤ëŠ” ìƒê°ì´ ë“­ë‹ˆë‹¤. ì‹¤ì œë¡œ ì´ë ‡ê²Œ ë²„ì „ì— ë”°ë¼ í†µì‹ ì´ ë˜ê³  ì•ˆ ë˜ê³ ê°€ ê²°ì •ë  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ í™•ì¸í•´ë³´ë‹ˆ í•œì¸µ ë” ë²„ì „ì´ ì¤‘ìš”í•˜ê²Œ ëŠê»´ì§‘ë‹ˆë‹¤.\në”°ë¡œ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ì œì‘í•˜ê³  imagePullSecretì„ ê¸°ì…í•˜ê¸° ê·€ì°®ì•„ì„œ ê¸°ì¡´ì— ì¡´ì¬í•˜ëŠ” Ubuntu ì´ë¯¸ì§€ë¥¼ í™œìš©í•˜ë ¤ë‹¤ ë³´ë‹ˆ ê°„ë‹¨í•˜ê²Œ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì„ í•˜ê¸° ìœ„í•´ netcatì„ ì ê·¹ í™œìš©í•´ë´¤ìŠµë‹ˆë‹¤. ì˜¤íˆë ¤ ë„ˆë¬´ ì½”ë“œê°€ ê¸¸ì–´ì¡Œë‚˜ ì‹¶ê¸°ë„í•˜ë„¤ìš”.\nì´ ì‘ì—…ì„ í•˜ë©´ì„œ ì™„ì „íˆ ì´í•´í•˜ì§€ ëª»í•œ ë¶€ë¶„ì´ í•œ ê°€ì§€ ì¡´ì¬í•˜ê¸´ í•©ë‹ˆë‹¤. ì‘ì—…í•˜ë©° ê²½í—˜í•œ ë°”ë¡œëŠ” Podì˜ IPë¡œ ìš”ì²­ì„ ë³´ë‚´ëŠ” ê²½ìš°ì—ëŠ” istio ë²„ì „ì— ë¬´ê´€í•˜ê²Œ eth0ì˜ IPë¡œ ì„œë²„ë¥¼ ë„ì›Œì•¼ë§Œ ì™¸ë¶€(ë™ë£Œ Podë“¤)ì—ì„œëŠ” ì ‘ì†ì´ ê°€ëŠ¥í•˜ê³ , loì˜ IPë¡œ ì„œë²„ë¥¼ ë„ìš°ëŠ” ê²½ìš° Podì˜ IPë¡œ ì ‘ì†ì´ ë¶ˆê°€ëŠ¥í–ˆëŠ”ë°ìš”. ì‚¬ì‹¤ ì´ë¡œ ì¸í•´ ë§ì€ ì‚½ì§ˆì„ í–ˆìŠµë‹ˆë‹¤â€¦ ì™œ ì„œë¹„ìŠ¤ë¡œ ì ‘ì†í•  ë•Œì—ëŠ” ì˜ˆìƒëŒ€ë¡œ ë²„ì „ì— ë§ëŠ” ë™ì‘ì„ í•˜ëŠ”ë°, Podì˜ IPë¡œ ì§ì ‘ ì ‘ì†í•  ë•Œì—ëŠ” ë¬´ì¡°ê±´ eth0ì˜ IPë¡œ ì„œë²„ë¥¼ ë„ìš´ ê²½ìš°ì—ë§Œ ì™¸ë¶€ì—ì„œ ì ‘ê·¼ì´ ê°€ëŠ¥í•œì§€ëŠ” ì˜ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤.\ní•˜ì§€ë§Œ ê³¼ê±° ë²„ì „ì˜ istioë¥¼ í†µí•´ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ì˜ ë™ì‘ì„ í™•ì¸í•´ë³´ëŠ” ê²ƒì€ ì´ ì •ë„ë¡œ ì¶©ë¶„í•  ê²ƒ ê°™ë‹¤ê³  ìƒê°ì´ ë“¤ì–´ ì´ë²ˆ ê¸€ì€ ì—¬ê¸°ì„œ ë§ˆë¬´ë¦¬ ì§€ìœ¼ë ¤í•©ë‹ˆë‹¤. ğŸ™‚\n","date":"2022-07-17T22:00:00+09:00","image":"https://umi0410.github.io/blog/devops/istio-1-10-network-interface/preview_hu29fb6a1fc6668bac997912987ebc8bfc_15975_120x120_fill_box_smart1_3.png","permalink":"https://umi0410.github.io/blog/devops/istio-1-10-network-interface/","title":"istioì™€ envoy proxyë¥¼ í†µí•´ ê²½í—˜í•´ë³´ëŠ” ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ (istio 1.10)"},{"content":"ì‹œì‘í•˜ë©° Clova AI ìŠ¤í”¼ì»¤ ì˜¬í•´ì—ëŠ” ë§ì€ ë³€í™”ê°€ ìˆì—ˆë‹¤!\nğŸ’¼ ë°ë¸Œì˜µìŠ¤ ì—”ì§€ë‹ˆì–´ë¡œ íšŒì‚¬ë¥¼ ê°€ê²Œ ëê³  ì•„ì£¼ ë§Œì¡± ì¤‘ì´ë‹¤! ğŸ  íšŒì‚¬ì˜ ì¢‹ì€ ë³´ìƒ, ë³µì§€ì— í˜ì…ì–´ ìƒì•  ì²« ìì·¨ë¥¼ í•˜ê²Œ ëë‹¤. ğŸ’» ë„¤íŠ¸ì›Œí¬ë‚˜ ë¦¬ëˆ…ìŠ¤, ë³´ì•ˆ ë“± ë”¥í•œ ì˜ì—­ì— ì¢€ ë” ê´€ì‹¬ì„ ê°–ê²Œ ëë‹¤. ğŸ¸ ê¸°íƒ€ë¥¼ ê¾¸ì¤€íˆ ë‹¤ë‹ˆê³  ìˆë‹¤. ê·¸ëŸ° ë³€í™”ë“¤ ì†ì—ì„œ ìì·¨ë°©ì— ì¸í„°ë„· ì„¤ì¹˜ë¥¼ í•˜ê²Œ ëëŠ”ë° í´ë¡œë°” AI ìŠ¤í”¼ì»¤ë¥¼ ê³µì§œë¡œ ì£¼ë”ë¼.\në³¸ê°€ì— ìˆì„ ë•Œë„ ì“°ê¸´ í–ˆëŠ”ë° ë”±íˆ ê´€ì‹¬ ì—†ë‹¤ê°€ ì§ì ‘ í´ë¡œë°” ì•±ì„ ê¹”ì•„ì„œ ì´ê²ƒì €ê²ƒ ì¨ë³´ë‹ˆ \u0026lsquo;ì „ë³´ë‹¤ ì¬ë°Œë„¤..? ã…ã…\u0026rsquo; ì‹¶ì—ˆê³ , \u0026lsquo;ì•„ë‹ˆ ì´ê±° ì§ì ‘ ë§Œë“¤ì§€ëŠ” ëª»í•˜ë‚˜\u0026rsquo;í•˜ëŠ” ìƒê°ì´ ë“¤ë˜ ì°¸ì— \u0026ldquo;ìŠ¤í‚¬ ìŠ¤í† ì–´â€ë¼ëŠ” ê²Œ ëˆˆì— ë„ì—ˆë‹¤. ìŠ¤í‚¬ ìŠ¤í† ì–´ì—ëŠ” ê°œë³„ ê°œë°œì‚¬ë“¤ì´ ê°œë°œí•œ ìê¸°ë„¤ ê¸°ëŠ¥ë“¤ì´ ì†Œê°œë˜ì–´ìˆì—ˆë‹¤.\nìš”ì¦˜ ì¬ë¯¸ìˆê²Œ ë”¥í•œ ì˜ì—­ì„ ê³µë¶€í•´ë‚˜ê°€ê³  ìˆê¸´ í•˜ì§€ë§Œ ë„ˆë¬´ ë”¥í•œ ê²ƒë§Œ í•˜ë‹¤ë³´ë‹ˆ ì‹¬ì‹¬í’€ì´ ì‘ì—… ì¢€ ì¦ê¸°ê³  ì‹¶ì€ ë§ˆìŒì— ë‚˜ë„ í•˜ë‚˜ ìŠ¤í‚¬ì„ ë§Œë“¤ì–´ë³´ê³ ì í–ˆë‹¤. ë§ˆì¹¨ ìš”ì¦˜ istioì—ë„ ê´€ì‹¬ì´ ë§ì´ ê°”ê³  ì ìš©í•´ë³´ê³  ì‹¶ì—ˆëŠ”ë° ê°–ê³  ìˆë˜ k8s í´ëŸ¬ìŠ¤í„°ì— istioëŠ” ë°°í¬í•´ë†“ì€ ìƒíƒœì˜€ê³ , Gateway, VirtualService ë“±ì˜ CRDì™€ ì¸ì¦ì„œë§Œ ì˜ ë§Œì ¸ì£¼ë©´ ìŠ¤í‚¬ì„ ê³µê°œí•  ìˆ˜ ìˆì„ ê²ƒ ê°™ì•˜ë‹¤.\nê·¸ë¦¬í•˜ì—¬ \u0026ldquo;ìš°ë¯¸, ë¯¸ìŠ¤í„° ë””ë²„ê±°\u0026ldquo;ë¼ëŠ” ìŠ¤í‚¬ì„ ê°œë°œí•˜ê³ ì í–ˆê³  ì´ ë…€ì„ì˜ ê¸°ëŠ¥ì€ ì‚¬ìš©ìê°€ \u0026ldquo;ë””ë²„ê±°, ë””ë²„ê¹… íŒ ì¢€ ì•Œë ¤ì¤˜\u0026quot;ë¼ëŠ” ì‹ìœ¼ë¡œ ìš”ì²­í•˜ë©´ ë¯¸ë¦¬ ì •ì˜í•´ë†“ì€ ë””ë²„ê¹… íŒ(e.g. \u0026ldquo;í™˜ê²½ë³€ìˆ˜ê°€ ì˜ ì„¤ì •ë˜ì–´ìˆë‚˜ìš”?\u0026rdquo;) ì¤‘ì—ì„œ ëœë¤ìœ¼ë¡œ íŒì„ ì•Œë ¤ì£¼ëŠ” ê²ƒì´ë‹¤.\nì´ë²ˆ ê¸€ì€ ê·¸ëƒ¥ ì¼ê¸°ì¥ ê°™ì€ ëŠë‚Œìœ¼ë¡œ CS ì§€ì‹ì€ ì¼ë¶€ ì œì™¸í•˜ê³  ì ì–´ë³´ë ¤í•©ë‹ˆë‹¤.\nì´ë²ˆ ê¸€ì—ì„œ ì‚¬ìš©í•œ ì†ŒìŠ¤ì½”ë“œëŠ” Github umi0410/umi-mrdebuggerì—ì„œ ì°¾ì•„ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\ní™˜ê²½ ë° ë²„ì „ ì •ë³´ ì´ë¦„ ë²„ì „ k8s cluster 1.22 Istio 1.11.8 cert-manager 1.8.2 ì‹¤ì œë¡œ ì‹¤ë¬´ë¥¼ ë‹¤ë£¨ê³  ìµœì‹  ê¸°ìˆ ë“¤ì„ ì´ìš©í•˜ë‹¤ë³´ë‹ˆ ìµœê·¼ ë²„ì „ìœ¼ë¡œ ì¸í•œ ì‚½ì§ˆì´ ì¦ì•˜ë‹¤. ë”°ë¼ì„œ í˜¹ì‹œ ì°¸ê³ í•˜ì‹¤ ë¶„ì´ ê³„ì‹¤ê¹Œ ì‹¶ì–´ ë‚´ í´ëŸ¬ìŠ¤í„°ì˜ í™˜ê²½ ë° ë²„ì „ ì •ë³´ë¥¼ ì •ë¦¬í•´ë´¤ë‹¤. ë²„ì „ì€ ì°¸ ì¤‘ìš”í•˜ë‹¤. ê° ë„êµ¬ë“¤ì˜ í˜¸í™˜ì„±ì„ ì˜ í™•ì¸í•´ë´ì•¼í•œë‹¤.\në‚˜ëŠ” í´ëŸ¬ìŠ¤í„°ë¥¼ í•œë™ì•ˆ ì—…ê·¸ë ˆì´ë“œ í•´ì£¼ì§€ ì•Šì•„ 2022ë…„ 7ì›” ê¸°ì¤€ìœ¼ë¡œ ê·¸ëƒ¥ ì €ëƒ¥ ìµœì‹ ì€ ì•„ë‹Œ 1.22 ë²„ì „ì˜ k8s í´ëŸ¬ìŠ¤í„°ë¥¼ ê°–ê³  ìˆì—ˆê³  istioëŠ” k8s 1.22ì™€ í˜¸í™˜ë˜ëŠ” ë²„ì „ ì¤‘ ê°€ì¥ ì˜¤ë˜ëœ minor ë²„ì „ì˜ 1.11.8ì„ ì‚¬ìš©í–ˆë‹¤. istioë¥¼ ìµœëŒ€í•œ êµ¬ë²„ì „ìœ¼ë¡œ ì´ìš©í•´ë³¸ ì´ìœ ëŠ” istioë¥¼ ì—…ê·¸ë ˆì´ë“œí•´ë‚˜ê°€ë©´ì„œ istioì˜ ë³€ê²½ì‚¬í•­, ì—­ì‚¬ë“±ì„ ê³µë¶€í•˜ë©´ ì¢‹ì„ ê²ƒ ê°™ê¸° ë•Œë¬¸ì´ì—ˆë‹¤. ë•Œë¡œëŠ” ì—…ê·¸ë ˆì´ë“œ ì‘ì—…ì„ ì‹¤ì œë¡œ ì§„í–‰í•´ì•¼í•  ìˆ˜ë„ ìˆê³  ë§ì´ë‹¤.\ncert-managerëŠ” ê°€ë” CRD api versionì´ ë³€ê²½ë˜ëŠ” ê²½ìš°ê°€ ìˆì–´ì„œ ê·¸ëƒ¥ ê¸°ë¡í•´ë†¨ë‹¤.\nk8sëŠ” GKEë¥¼ ì´ìš© ì¤‘ì´ê³  istioëŠ” istioctlë¡œ, cert-managerëŠ” Helm3ë¡œ ê´€ë¦¬ ì¤‘ì´ë‹¤.\nì„œë²„ ê°œë°œí•˜ê¸° ì„œë²„ ê°œë°œì€ ë³„ê±° ì—†ë‹¤. ê·¸ëƒ¥ HTTP Post ìš”ì²­ ë¶„ì„ í›„ ì‘ë‹µì„ ì£¼ë©´ ëœë‹¤. ì‹¤ì œë¡œ ì •ë§ ê·¸ ì •ë„ ìˆ˜ì¤€ì´ë¼ í‡´ê·¼ í›„ ëª‡ ì‹œê°„ ë§Œì— ê°œë°œ â†’ ë°°í¬ê¹Œì§€ ì™„ë£Œí•  ìˆ˜ ìˆì—ˆë‹¤. ìƒê°ë³´ë‹¤ ê¸ˆë°©ì´ì—ˆë‹¤.\nì§ìƒëœ ì§€ ëª‡ ë…„ì€ ëœ ë“¯í•˜ë©´ì„œ ê·¸ë‹¥ ì¹œì ˆí•˜ì§„ ì•Šì€ ê³µì‹ ë¬¸ì„œì™€ ì˜ˆì‹œ í”„ë¡œì íŠ¸(ì½”ì¸í—¬í¼)ë¥¼ ì°¸ê³ í•˜ë©´ ì‰½ê²Œ ë§Œë“¤ì–´ë³¼ ìˆ˜ ìˆë‹¤. ë‚˜ëŠ” ì˜ˆì‹œ í”„ë¡œì íŠ¸ì¸ ì½”ì¸í—¬í¼ ë ˆí¬ì§€í† ë¦¬ë¥¼ í¬í¬ ë– ì„œ ê°œë°œí–ˆë‹¤.\n\u0026ldquo;ìš°ë¯¸, ë¯¸ìŠ¤í„° ë””ë²„ê±°\u0026rdquo; ë ˆí¬ì§€í† ë¦¬: https://github.com/umi0410/umi-mrdebugger\n(ì¼ê¸°ì¥ìŠ¤ëŸ¬ìš´ ê¸€ì´ë¯€ë¡œ ì½”ë“œë¥¼ í•´ì„í•˜ì§„ ì•Šê² ìŠµë‹ˆë‹¤.)\në§ì€ ì˜ˆì‹œ í”„ë¡œì íŠ¸ ì¤‘ ì½”ì¸í—¬í¼ë¥¼ ê³¨ë¼ ê°œë°œí•´ë‚˜ê°„ ì´ìœ ëŠ” ìœ ì¼í•˜ê²Œ Goì–¸ì–´ë¡œ ê°œë°œëœ ì˜ˆì‹œ í”„ë¡œì íŠ¸ì˜€ê¸° ë•Œë¬¸ì¼ ë¿ì´ì—ˆë‹¤. ì‹¤ì œë¡œëŠ” ê·¸ëƒ¥ íƒ€ì… ì„ ì–¸ì´ë‘ ìœ í‹¸ í•¨ìˆ˜ ì •ë„ë§Œ ê°€ì ¸ì˜¤ê³  ë‚˜ë¨¸ì§„ ë‹¤ ì¬êµ¬í˜„í•˜ê²Œ ë˜ê¸´ í–ˆë‹¤. ê¸°ì¡´ì—” ë‚´ì¥ http packageë¥¼ ì‚¬ìš©í–ˆëŠ”ë° fiberë¼ëŠ” ì›¹í”„ë ˆì„ì›Œí¬ ì´ìš©í•˜ë„ë¡ ë³€ê²½í•˜ëŠ” ë“±..\nì¿ ë²„ë„¤í‹°ìŠ¤ì— ë°°í¬í•˜ê¸° ì¿ ë²„ë„¤í‹°ìŠ¤ì— ë°°í¬ëœ istioë¥¼ í†µí•´ ì™¸ë¶€ì—ì„œ ì„œë²„ Podë¡œ ì ‘ì† ê°€ëŠ¥í•˜ê²Œë” í•´ì¤„ ê²ƒì´ê³ , cert-managerë¥¼ í†µí•´ ì¸ì¦ì„œ ë°œê¸‰ í›„ í•´ë‹¹ ì¸ì¦ì„œì™€ ê´€ë ¨ëœ ì‹œí¬ë¦¿ì„ istioê°€ ê°€ì ¸ê°€ì„œ tlsë¥¼ ì œê³µí•œë‹¤.\n(k8s manifest file ë˜í•œ ì•ì„œ ì–¸ê¸‰í–ˆë“¯ https://github.com/umi0410/umi-mrdebugger ì—ì„œ ì°¾ì•„ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.)\numi-mrdebugger/k8s $ tree 4s 00:38:42 . â”œâ”€â”€ certificate.yaml â”œâ”€â”€ cluster-issuer.yaml â”œâ”€â”€ deployment.yaml â”œâ”€â”€ gateway.yaml â”œâ”€â”€ svc.yaml â””â”€â”€ virtual-svc.yaml í•„ìš”í•œ í•­ëª©ë“¤ì€ k8s ë¦¬ì†ŒìŠ¤ë“¤ì€ ìœ„ì™€ ê°™ë‹¤\n# cluster-issuer.yaml apiVersion: cert-manager.io/v1 kind: ClusterIssuer metadata: name: clova-issuer namespace: cert-manager spec: acme: # The ACME server URL server: https://acme-v02.api.letsencrypt.org/directory email: dev.umijs@gmail.com # Name of a secret used to store the ACME account private key privateKeySecretRef: name: clova-issuer-secret solvers: - http01: ingress: class: istio cert-managerê°€ Let\u0026rsquo;s Encryptë¡œ ì¸ì¦ì„œë¥¼ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ClusterIssuerë¥¼ ì‘ì„±í•œë‹¤. ì•„ë§ˆ Certificateì™€ ë™ì¼ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ì´ìš©í•œë‹¤ë©´ ClusterIssuerê°€ ì•„ë‹Œ Issuerì—¬ë„ ê´œì°®ì„ ê²ƒì´ë‹¤.\nê·¸ë¦¬ê³  ê¸°ì¡´ì—ëŠ” Challenge ë°©ì‹ì„ DNS01ë¡œ í–ˆì—ˆëŠ”ë° DNS01 ë°©ì‹ì´ ì•½ê°„ ê°€ë¬¼ ê°€ë¬¼í•´ì ¸ì„œ ìš°ì„ ì€ HTTP01 ë°©ì‹ìœ¼ë¡œ ë„ë©”ì¸ì„ ì¸ì¦í•˜ê¸°ë¡œ í–ˆë‹¤.\nì°¸ê³ ë¡œ HTTP01 ë°©ì‹ì„ ì´ìš©í•˜ëŠ” ê²½ìš° ì¸ì¦ì„œë¥¼ ë°œê¸‰ë°›ê¸° ì „ë¶€í„° ë¯¸ë¦¬ HTTP â†’ HTTPS ë¥¼ ì„¤ì •í•´ë‘ë©´ Challengeê°€ ì„±ê³µì ìœ¼ë¡œ ì´ë£¨ì–´ì§€ì§€ ì•ŠëŠ” ë“¯í•˜ë‹¤. ì•„ë§ˆ HTTPSë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ë˜ëŠ”ë° ì¸ì¦ì„œê°€ ì—†ë‹¤ë³´ë‹ˆ HTTPS í†µì‹ ì´ ì›í™œí•˜ì§€ ì•Šì•„ì„œê² ë‹¤.\n# certificate.yaml apiVersion: cert-manager.io/v1 kind: Certificate metadata: name: mrdebugger-cert namespace: istio-system spec: secretName: mrdebugger-cert-secret commonName: mrdebugger.clova.jinsu.me issuerRef: name: clova-issuer kind: ClusterIssuer group: cert-manager.io dnsNames: - \u0026#34;mrdebugger.clova.jinsu.me\u0026#34; HTTP01 ë°©ì‹ìœ¼ë¡œ Challengeë¥¼ ì§„í–‰í•˜ê¸° ë•Œë¬¸ì— ì™€ì¼ë“œì¹´ë“œ(*, asterisk)ëŠ” ì‚¬ìš©í•˜ì§€ ëª»í•´ ê·¸ëƒ¥ ì‚¬ìš©í•  ë„ë©”ì¸ ë„¤ì„ì¸ mrdebugger.clova.jinsu.me ë¥¼ ì ì–´ì£¼ì—ˆë‹¤.\n# deployment.yaml apiVersion: apps/v1 kind: Deployment metadata: name: mrdebugger labels: app: mrdebugger spec: replicas: 1 revisionHistoryLimit: 3 selector: matchLabels: app: mrdebugger template: metadata: labels: app: mrdebugger spec: terminationGracePeriodSeconds: 1 containers: - name: mrdebugger image: umi0410/mrdebugger imagePullPolicy: Always ports: - name: http containerPort: 8080 readinessProbe: httpGet: port: 8080 path: /health initialDelaySeconds: 5 timeoutSeconds: 2 successThreshold: 1 failureThreshold: 3 periodSeconds: 10 # svc.yaml apiVersion: v1 kind: Service metadata: namespace: mrdebugger labels: app: mrdebugger name: mrdebugger spec: selector: app: mrdebugger ports: - name: mrdebugger port: 80 protocol: TCP targetPort: http type: ClusterIP ì´ë²ˆì—” ê·¸ì € ê·¸ëŸ° í‰ë²”í•œ ì„œë²„ Podë¥¼ ë°°í¬í•´ì¤„ Deploymentì™€ ê·¸ê²ƒì„ ë…¸ì¶œì‹œì¼œì£¼ëŠ” Serviceë¥¼ ì‘ì„±í•´ì¤¬ë‹¤. ì´ê±´ ë­ ì„¤ëª…í•  ê±´ ì—†ë‹¤.\n# gateway.yaml apiVersion: networking.istio.io/v1alpha3 kind: Gateway metadata: name: mrdebugger spec: selector: istio: ingressgateway servers: - port: number: 80 name: http protocol: HTTP hosts: - \u0026#34;mrdebugger.clova.jinsu.me\u0026#34; #tls: # httpsRedirect: true - port: number: 443 name: https protocol: HTTPS hosts: - \u0026#34;mrdebugger.clova.jinsu.me\u0026#34; tls: mode: SIMPLE credentialName: mrdebugger-cert-secret istioì˜ Gateway CRDë¥¼ ì •ì˜í•˜ì. ë°°í¬ë˜ì–´ìˆëŠ” istio ingress gatewayë¥¼ selectorë¡œ ì„ íƒí•´ì£¼ê³  ì•„ê¹Œ ì •ì˜í•œ ì¸ì¦ì„œê°€ ë‹´ê¸¸ secretì„ TLSì—ì„œ ì‚¬ìš©í•˜ë„ë¡ í•œë‹¤.\n# virtual-svc.yaml apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: mrdebugger namespace: mrdebugger spec: hosts: - \u0026#34;*\u0026#34; gateways: - mrdebugger http: - match: - uri: prefix: / route: - destination: host: mrdebugger port: number: 80 ë§ˆì§€ë§‰ìœ¼ë¡œ istioì˜ VirtualService CRDë¥¼ ì •ì˜í•´ì£¼ë©´ ëœë‹¤. ê·¸ëƒ¥ ëª¨ë“  ìš”ì²­ì„ mrdebugger ì„œë¹„ìŠ¤ë¡œ ë„˜ê²¨ì¤€ë‹¤ê³  ë³´ë©´ ëœë‹¤.\nğŸ’¡ ëª‡ ê°€ì§€ istio CRDì— ëŒ€í•´ í—·ê°ˆë¦¬ëŠ” ë¶€ë¶„ë“¤ì„ ì •ì˜í•´ë³´ìë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.\nGatewayëŠ” istio ingress gatewayì™€ ë‹¤ë¥´ë‹¤. GatewayëŠ” CRDì´ê³ , ingress gatewayëŠ” ìì‹ ì„ selectorë¡œ ì„¤ì •í•œ Gatewayë¥¼ ë³´ê³  í•´ë‹¹ ì„¤ì •ì„ ì ìš©í•œë‹¤. ë§ˆì¹˜ Ingressì™€ Nginx Ingress Controller ê°™ì€ ëŠë‚Œì´ë„ê¹Œ istio ingress gatewayëŠ” ë³´í†µ istio-system ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ì¡´ì¬í•œë‹¤. GatewayëŠ” ì•„ë¬´ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ë§Œë“¤ì–´ë„ ëœë‹¤. VirtualSevice ë˜í•œ ì•„ë¬´ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ë§Œë“¤ì–´ë„ ëœë‹¤. ë‹¨, VirtualServiceì˜ destinationì€ ì ‘ê·¼ ê°€ëŠ¥í•œ mesh ë‚´ì˜ í˜¸ìŠ¤íŠ¸ì—¬ì•¼í•˜ê³  ë„¤ì„ìŠ¤í˜ì´ìŠ¤ê°€ ë‹¤ë¥¸ ê²½ìš° ì ì ˆí•œ ë„ë©”ì¸ ë„¤ì„ì„ ì¨ì•¼í•  ìˆ˜ ìˆë‹¤. ê°™ì€ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ ê²½ìš° service nameë§Œìœ¼ë¡œ ì´ìš© ê°€ëŠ¥í•˜ë‹¤. Service, Deployment, Pod, â€¦ ë˜í•œ ì•„ë¬´ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ë§Œë“¤ì–´ë„ ëœë‹¤. umi-mrdebugger $ kubectl create ns mrdebugger namespace/mrdebugger created umi-mrdebugger $ kubectl label namespace mrdebugger istio-injection=enabled namespace/mrdebugger labeled umi-mrdebugger $ kubectl apply -n mrdebugger -f k8s/![clova-extension.png](clova-extension.png) certificate.cert-manager.io/mrdebugger-cert created clusterissuer.cert-manager.io/clova-issuer created deployment.apps/mrdebugger created gateway.networking.istio.io/mrdebugger created service/mrdebugger created virtualservice.networking.istio.io/mrdebugger created í•œ ë²ˆì— ë¦¬ì†ŒìŠ¤ê°€ ë¹µ ë– ì„œ ì˜ ì—°ê²°ë˜ë©´ ì¢‹ê² ì§€ë§Œ,,, ë‹¹ì—°íˆë„ í˜„ì‹¤ì‹¤ì€ ê·¸ë ‡ì§„ ì•Šë‹¤. ğŸ¥²\nìì˜í•œ ì´ìŠˆë“¤ì„ í•´ê²°í•´ì£¼ê³  ë‚˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì„œë²„ì—ê²Œ ì„±ê³µì ìœ¼ë¡œ ì‘ë‹µì„ ë°›ì„ ìˆ˜ ìˆë‹¤.\n# ì¸ì¦ì„œê°€ READY ë˜ì—ˆë‹¤! $ kubectl get cert -n istio-system mrdebugger-cert NAME READY SECRET AGE mrdebugger-cert True mrdebugger-cert-secret 28m $ curl https://mrdebugger.clova.jinsu.me/health OK ğŸ‰ êµ¿. ì¢‹ë‹¹!\nClova AI Consoleì—ì„œ Custom Extension ë“±ë¡í•˜ê¸° Clova AI Console Clova AI Consoleì— ê°€ì„œ ìì‹ ì˜ Extensionì„ ìƒì„±í•˜ë©´ ëœë‹¤. ë§Œë“œëŠ” ê³¼ì •ì€ ë³„ê±´ ì—†ë‹¤.\ní˜¸ì¶œ ì´ë¦„ ì„¤ì • ì´ê²ƒë§Œ ì˜ ì„¤ì •í•´ì£¼ë©´ ë˜ëŠ”ë° ë³´í†µ \u0026ldquo;{{í˜¸ì¶œ ì´ë¦„}} ì‹œì‘í•´ì¤˜\u0026quot;ë¡œ ìŠ¤í‚¬ì´ ì‹œì‘ë˜ëŠ” ê²ƒ ê°™ë‹¤. ê·¸ ì´í›„ëŠ” ì„¸ì…˜ì´ ëŠì–´ì§€ì§€ ì•Šìœ¼ë©´ ì„¸ì…˜ì˜ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì‚´ë ¤ ëŒ€í™”í•  ìˆ˜ëŠ” ìˆëŠ”ë“¯ í•˜ë‹¤.\nInteraction ëª¨ë¸ ë¹Œë“œ ê·¸ë¦¬ê³  ë‚˜ì„  Interaction ëª¨ë¸ ì„¤ì •ì— ë“¤ì–´ê°€ ë¹Œë“œë¥¼ í•´ì¤˜ì•¼í•œë‹¤. ìì‹ ì´ Custom Intentë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤í•´ë„ ë¬´ì¡°ê±´ í•œ ë²ˆì€ ë¹Œë“œë¥¼ í•´ì¤˜ì•¼í•œë‹¤. ë¬¸ì„œ ìƒìœ¼ë¡œëŠ” 3~5ë¶„ ì •ë„ ì†Œìš”ëœë‹¤ê³  í•˜ëŠ”ë° ì²´ê°ìƒ í•œ 10ë¶„ì€ ê±¸ë¦°ë“¯í•˜ë‹¤â€¦ ìµœì´ˆ 1ë²ˆì´ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ê²ƒ ê°™ê³  ê·¸ ì´í›„ë¡œëŠ” ê¸ˆë°© ë˜ëŠ” ë“¯? (ì‚¬ì´íŠ¸ UIê°€ ê·¸ë‹¥ ì¹œì ˆí•˜ì§„ ì•Šë‹¤. ì•½ê°„ì€ ë²„ë ¤ì§„ ëŠë‚Œâ€¦?)\nê·¸ëŸ¬ê³  ë‚˜ë©´ í…ŒìŠ¤í„° IDë¥¼ ë“±ë¡í•´ì¤˜ì•¼í•œë‹¤. ë³´í†µì€ ì‹¬ì‚¬, ì‹¤ì œ í¼ë¸”ë¦¬ì‹œê¹Œì§€ëŠ” ê·€ì°®ê¸° ë•Œë¬¸ì—â€¦ í˜¼ìë§Œ ì“¸ ê±°ë¼ë˜ê°€ ê·¸ëƒ¥ ì¬ë¯¸ì‚¼ì•„ ë§Œë“¤ì–´ë³¸ ê²½ìš°ì—ëŠ” ë­ í…ŒìŠ¤í„°ë§Œìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒë„ ì¶©ë¶„í•  ê²ƒ ê°™ë‹¤. ë„¤ì´ë²„ API ë“±ë“±ì€ ì£¼ë¡œ ì´ë ‡ê²Œ ì¶œì‹œ ì‹¬ì‚¬ ì „ê¹Œì§€ í…ŒìŠ¤íŠ¸ IDë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì£¼ë”ë¼.\ní…ŒìŠ¤í„° ì•„ì´ë””ë¥¼ ë“±ë¡í•œ ë’¤ ë„¤ì´ë²„ í´ë¡œë°” ì•±ì— ìì‹ ì˜ ë„¤ì´ë²„ ì•„ì´ë””ë¡œ ë¡œê·¸ì¸í•˜ë©´ ìŠ¤í‚¬ ìŠ¤í† ì–´ í˜ì´ì§€ì—ì„œ ìœ„ì™€ ê°™ì´ ìì‹ ì´ ë“±ë¡í•œ ìŠ¤í‚¬ì„ ë³¼ ìˆ˜ ìˆë‹¤. ë¬¸ì„œìƒìœ¼ë¡  ì‹œê°„ì´ ê½¤ ê±¸ë¦´ ìˆ˜ë„ ìˆë‹¤ê³  í–ˆëŠ”ë° ì•„ë§ˆ ë°”ë¡œ ë³´ì˜€ë˜ ê²ƒ ê°™ë‹¤.\nê·¸ëŸ¼ ì•„ë§ˆ ì•„ê¹Œ ì½˜ì†”ì—ì„œ ì„¤ì •í•œ \u0026ldquo;{{í˜¸ì¶œ ì´ë¦„}} ì‹œì‘í•´ì¤˜\u0026quot;ë¡œ ìŠ¤í‚¬ì„ ì‹œì‘í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤. ë‚˜ëŠ” ëì— \u0026ldquo;ì‹œì‘í•´ì¤˜\u0026quot;ë¥¼ ì•ˆ ë¶™ì—¬ë„ ë˜ëŠ” ì¤„ ì•Œê³  í˜¸ì¶œ ì´ë¦„ì„ \u0026ldquo;ë””ë²„ê¹… ë„ì™€ì¤˜\u0026quot;ë¡œ í–ˆëŠ”ë° ê³ ìƒì„ ì¢€ í–ˆë‹¤. í˜¸ì¶œ ì´ë¦„ì´ \u0026ldquo;ë””ë²„ê¹… ë„ì™€ì¤˜\u0026quot;ì¸ ê²½ìš° ì‹¤ì œë¡œëŠ” \u0026ldquo;ë””ë²„ê¹… ë„ì™€ì¤˜ ì‹œì‘í•´ì¤˜\u0026rdquo; ì´ëŸ° ì‹ìœ¼ë¡œ ë§í•´ì•¼ ì‹¤í–‰ì´ ë˜ê¸° ë•Œë¬¸ì´ë‹¤â€¦ ã…œã…œ\nê·¸ëŸ¼ ê²°ê³¼ë¥¼ í™•ì¸í•´ë³´ì.\nğŸ‰ ê·€ì—½ê²Œ ë””ë²„ê¹…ì„ ë„ì™€ì¤˜ëŠ” \u0026ldquo;ë¯¸ìŠ¤í„° ë””ë²„ê±° ìš°ë¯¸\u0026ldquo;ë¥¼ ë§Œë‚˜ë³¼ ìˆ˜ ìˆì—ˆë‹¤. ğŸ¥³\në§ˆì¹˜ë©° ì˜¤ëœë§Œì— ë”¥í•œ ê¸°ìˆ ì„ íƒêµ¬í•˜ëŠ” ê²ƒì—ì„œ ë²—ì–´ë‚˜ ìœ í¥ìŠ¤ëŸ¬ìš´ ê°œë°œì„ í•´ë³´ì•˜ë‹¤. ì‚¬ì´ë“œ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘ìœ¼ë¡œ ê°€ê¾¸ê²Œ ëë˜ GKE í´ëŸ¬ìŠ¤í„°ì— istioë¥¼ êµ¬ì¶•ë§Œ í•´ë†“ê³  ì œëŒ€ë¡œ ë„ì…ì€ ëª»í•´ë³¸ ìƒíƒœì˜€ëŠ”ë° ì´ë²ˆ ì„œë²„ ë°°í¬ë¥¼ ì§„í–‰í•˜ë©´ì„œ í•œ ë²ˆ ë°ëª¨ì²˜ëŸ¼ istioë¥¼ ì‚¬ìš©í•´ë³¼ ìˆ˜ ìˆì—ˆì–´ì„œ ì¢‹ì•˜ë‹¤. istioë¥¼ ë„ì…í•´ë³¸ ê±¸ ìƒê°í•˜ë©´ ê·¸ë‹¥ ìœ í¥ìŠ¤ëŸ½ë‹¤ê¸° ë³´ë‹¨ ê¸°ìˆ  íƒêµ¬ìŠ¤ëŸ¬ì› ì„ì§€ë„..? ã…ã…\nìƒˆë¡œ íšŒì‚¬ë¥¼ ë“¤ì–´ê°€ê³ ë‚˜ì„œëŠ” ê¶ê¸ˆí•œ ê²ƒ, ê³µë¶€í•˜ê³  ì‹¶ì€ ê²ƒì´ ë„˜ì³ë‚˜ê³  ì¬ë¯¸ìˆê²Œ ê³µë¶€í•´ë‚˜ê°€ê³  ìˆì§€ë§Œ ë‹¤ì†Œ ë¸”ë¡œê·¸ì— ì •ë¦¬í•˜ê¸´ ì–´ë ¤ìš´ ë‚´ìš©ë“¤ì´ ë§ì€ ê²ƒ ê°™ë‹¤. ì–´ë ¤ìš´ ë‚´ìš©ë“¤ì´ë‹¤ë³´ë‹ˆ ê³µë¶€ëŠ” í–ˆë”ë¼ë„ 1ë²ˆì˜ ê³µë¶€ë§Œìœ¼ë¡œ ì˜ë¯¸ìˆëŠ” ê¸€ì„ ë‹´ì•„ë‚´ê¸´ ì–´ë µê¸°ë„ í–ˆë‹¤.\ní•˜ì§€ë§Œ ë°”ì˜ê¸°ë„ í•œë°ë‹¤ê°€ ë­”ê°€ ê¹Šì´ ìˆëŠ” ê¸€ì„ ì“°ë ¤ë‹¤ë³´ë‹ˆ ìš”ì¦˜ ë¸”ë¡œê·¸ì— ê¸€ì„ ì˜¤íˆë ¤ ì•ˆ ì“°ê²Œ ë˜ê³  \u0026lsquo;ì•„ ì´ê²ƒë„ ì¨ë³´ê³  ì‹¶ì€ë° ì €ê²ƒë„ ì¨ë³´ê³  ì‹¶ì€ë°â€¦\u0026rsquo; ìƒê°ë§Œ í•˜ë‹¤ ë²Œì¨ ë§ˆì§€ë§‰ìœ¼ë¡œ ê¸€ì„ ì“´ì§€ë„ ì—„ì²­ ì˜¤ë˜ëœ ê²ƒ ê°™ë‹¤.\nê·¸ë˜ì„œ ì•ìœ¼ë¡œëŠ” CS ì§€ì‹ì´ë‚˜ ì •í™•í•œ ì •ë³´ëŠ” ì•„ë‹ˆë”ë¼ë„ ê°€ë” ì´ë ‡ê²Œ ê°œë°œ ì¼ê¸°ìŠ¤ëŸ¬ìš´ ê¸€ë„ ì ì–´ë³¼ê¹Œí•œë‹¤. ê·¸ëŸ° ê¸€ì€ ë‚¨ì—ê²Œ ì •ë³´ë¥¼ ì „ë‹¬í•˜ë ¤ëŠ” ëª©ì ë³´ë‹¨ ë‚˜ë¥¼ ê¸°ë¡í•˜ëŠ” ìš©ë„ê¸° ë•Œë¬¸ì— \u0026lsquo;â€¦ì…ë‹ˆë‹¤.\u0026rsquo; ì²´ë³´ë‹¤ëŠ” \u0026lsquo;â€¦ì´ë‹¤\u0026rsquo; ì²´ë¡œ ê·¸ëƒ¥ ê°€ë³ê²Œ ì ì–´ë‚˜ê°€ë ¤í•œë‹¤.\nê·¸ëŸ¼, ë‹¤ìŒì— ë˜ ë§Œë‚˜ìš©.\n","date":"2022-07-13T23:00:00+09:00","image":"https://umi0410.github.io/blog/clova-ai-on-k8s/preview_hu0de35698344aa28c3f5141b2d5dcaef6_812038_120x120_fill_box_smart1_3.png","permalink":"https://umi0410.github.io/blog/clova-ai-on-k8s/","title":"ì¿ ë²„ë„¤í‹°ìŠ¤ë¡œ Clova AI Custom Extension ë°°í¬í•˜ê¸° (feat. Istio, Cert Manager)"},{"content":"ì‹œì‘í•˜ë©° ì €ë²ˆ ê¸€(\u0026ldquo;ArgoCD ì„ ì–¸ì ìœ¼ë¡œ ì´ìš©í•´ë‚˜ê°€ê¸° - Helm, App of App\u0026rdquo;)ì—ì„œëŠ” Helmê³¼ App of App íŒ¨í„´ì„ ì´ìš©í•´ ArgoCDë¥¼ ì„ ì–¸ì ìœ¼ë¡œ ì´ìš©í•´ë‚˜ê°€ëŠ” ë°©ë²•ì„ ë‹¤ë¤˜ìŠµë‹ˆë‹¤.\në°”~ë¡œ ArgoCDë¥¼ ì¢€ ë” ì„ ì–¸ì ìœ¼ë¡œ ì´ìš©í•´ë‚˜ê°€ëŠ” ê²ƒê³¼ ê´€ë ¨ëœ íŒë¶€í„° ê¸€ì„ ì ì–´ë‚˜ê°€ê¸°ëŠ” ì¢€ ë¬´ë¦¬ê°€ ìˆì„ ê²ƒ ê°™ì•„ í•´ë‹¹ ê¸€ì—ì„œëŠ”\në°°ê²½ì§€ì‹ë“¤ì— ëŒ€í•œ ê°„ëµí•œ ì •ë¦¬ì™€ í•¸ì¦ˆì˜¨ ê°™ì€ ëŠë‚Œì˜ ë‚´ìš©ë“¤ë„ ë§ì´ í¬í•¨í•˜ê²Œ ëë˜ ê²ƒ ê°™ì•„ìš”.\nì´ë²ˆ ê¸€ì—ì„œëŠ” ArgoCDë¥¼ ì‹¤ì œë¡œ ì´ìš©í•˜ê¸° ìœ„í•´ í•„ìš”í• ë§Œí•œ ì´ëŸ° ì €ëŸ° ì„¤ì •ë“¤ì„ ì–´ë–»ê²Œ ì„ ì–¸ì ìœ¼ë¡œ ì •ì˜í•´ë³¼ ìˆ˜ ìˆì„ì§€ë¥¼ ì†Œê°œí•´ë³´ë ¤í•´ìš”!\nê·¸ë¦¬ê³  ê·¸ ì˜ˆì‹œë¡œ RBAC ì„¤ì •ì„ í•´ë³´ê² ìŠµë‹ˆë‹¤. ì´ë²ˆ ê¸€ì—ì„œ ìˆ˜í–‰í•´ë³¼ ì‘ì—…ì€ Github ê³„ì •ì„ ArgoCDì™€ ì—°ë™ì‹œì¼œ ì—­í• (Role) ê¸°ë°˜ìœ¼ë¡œ ArgoCDì˜ ê¶Œí•œì„ ì œì–´í•˜ëŠ” ê²ƒì´ì—ìš”.\n\u0026lsquo;ì™œ RBACì„ ArgoCD ì»¤ìŠ¤í„°ë§ˆì´ì§•ì˜ ì˜ˆì‹œë¡œ í–ˆëŠ”ê°€?\u0026lsquo;ëŠ” ì œê°€ ì‚¬ì´ë“œ í”„ë¡œì íŠ¸ì—ì„œ ArgoCDë¥¼ ì´ìš©í•˜ë©´ì„œ Local user(ArgoCDì˜ ìì²´ ê³„ì •)ì„ ì´ìš©í•˜ëŠ” ë°ì— ë¶ˆí¸ì´ ìˆì—ˆê¸° ë•Œë¬¸ì´ì—ìš”. ì €ëŠ” ArgoCDì™€ Github ê³„ì •ì„ ì—°ë™í•´ RBACì„ ì´ìš©í•¨ìœ¼ë¡œì¨ í•´ê²°í–ˆìŠµë‹ˆë‹¤. ì´ì œëŠ” Admin ê³„ì •ì˜ íŒ¨ìŠ¤ì›Œë“œë¥¼ ì•”ê¸°í•  í•„ìš”ë„ ìƒˆë¡œìš´ íŒ€ì›ì—ê²Œ ìƒˆ ê³„ì •ì„ ìƒì„±í•´ ì „ë‹¬í•  ì¼ë„ í•„ìš”ê°€ ì—†ì–´ì¡ŒìŠµë‹ˆë‹¤! ë˜í•œ Github ê³„ì • ë³„ë¡œ ê¶Œí•œì„ ê°–ë„ë¡ (e.g. readonly) ì„¤ì •í•  ìˆ˜ë„ ìˆì–´ì¡ŒìŠµë‹ˆë‹¤.\nê·¸ë¦¬ê³  ê¸€ì˜ ë‚´ìš©ì€ \u0026lsquo;ì œ ê¸€ë§Œ ë¬´ì¡°ê±´ ë”°ë¼í•˜ë©´ ë©ë‹ˆë‹¤\u0026lsquo;ë³´ë‹¤ëŠ” \u0026lsquo;ì €ëŠ” ì´ëŸ° ì‹ìœ¼ë¡œ ìë£Œë¥¼ ì°¾ì•˜ê³  ì´ë ‡ê²Œ ì ìš©í•´ë´¤ì–´ìš”.\u0026lsquo;ì‹ì˜ ë‚´ìš©ë“¤ì„ ë‹¤ë¤„ë³´ê² ìŠµë‹ˆë‹¤.\në³¸ ê¸€ì—ì„œ ì‚¬ìš©í•˜ëŠ” í™˜ê²½ í•¸ì¦ˆì˜¨ ê³¼ì • ì°¸ê³  ë ˆí¬ì§€í† ë¦¬ - https://github.com/umi0410/declarative-argocd/tree/master/configuring-rbac Minikubeë¥¼ ì´ìš©í•œ K8s Cluster ArgoCD Helm Chartë¥¼ ì´ìš©í•´ argocd namespaceì— ë°°í¬í•œ ArgoCD RBACì´ë€? RBACì€ Role-Based Access Contolì˜ ì•½ìë¡œ ì‰½ê²Œ ë§í•˜ìë©´ ê·¸ëƒ¥ ì—­í•  ê¸°ë°˜ ê¶Œí•œ ì œì–´ì…ë‹ˆë‹¤.\nì†ì„± ê¸°ë°˜ìœ¼ë¡œ ë‚˜ë¦„ ë³µì¡í•œ ë¡œì§ì— ì˜í•´ ì–´ë–¤ ìœ ì €ê°€ ì–´ë–¤ ë¦¬ì†ŒìŠ¤ì— ì–´ë–¤ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ”ì§€ë¥¼ ì •ì˜í•˜ëŠ” ABAC(Attribute-Base Access Control)ì— ë¹„í•´ ê·¸ì € ê°„ë‹¨íˆ ì—­í• ì— ê¶Œí•œë“¤ì„ ë¶€ì—¬í•˜ê³  ìœ ì €ë“¤ì€ ê·¸ ì—­í• ì„ ë¶€ì—¬ë°›ìŒìœ¼ë¡œì¨ ê¶Œí•œì„ ì²´í¬í•˜ê²Œ ë©ë‹ˆë‹¤.\nê°œì¸ì ìœ¼ë¡œëŠ” ë§ì€ ê²½ìš°ì— ê°„ë‹¨íˆ RBACë§Œìœ¼ë¡œë„ ê¶Œí•œ ì œì–´ê°€ ì¶©ë¶„í•œ ê²½ìš°ê°€ ë§ì€ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ë§ì€ ì†”ë£¨ì…˜ë“¤ì´ RBAC ê¸°ëŠ¥ì„ ì§€ì›í•˜ëŠ” ê²ƒ ê°™ì•˜ì–´ìš”. ArgoCD ë˜í•œ ë§ˆì°¬ê°€ì§€ë¡œ RBACì„ ì§€ì›í•˜ê³  ìˆìŠµë‹ˆë‹¤.\nGithub organization + teamìœ¼ë¡œ ArgoCD RBAC ì´ìš©í•˜ê¸° ì, ê·¸ëŸ¼ Githubì˜ Organization, Teamì„ í†µí•´ ArgoCDì—ì„œ RBACì„ ì´ìš©í•´ë³´ëŠ” ê³¼ì •ì„ ì§„í–‰í•´ë´…ì‹œë‹¤!\n1. ArgoCDì— RBAC ì„¤ì •í•˜ê¸° ìš”ì¦˜ ì¸ê¸°ìˆëŠ” ì†”ë£¨ì…˜ë“¤ì€ RBAC ë° ê¸°íƒ€ ê¶Œí•œ ì œì–´ ê¸°ëŠ¥ì´ ëŒ€ë¶€ë¶„ ì¡´ì¬í•©ë‹ˆë‹¤. ë³´ì•ˆê³¼ ê¶Œí•œ ê´€ë¦¬ëŠ” ì•„ì£¼ ì¤‘ìš”í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ê·¸ë¦¬ê³  ê·¸ëŸ° ê¶Œí•œ ì œì–´ì˜ ë°©ë²• ì¤‘ ê°€ì¥ ëŒ€ì¤‘ì ì¸ ë°©ë²•ì€ ë°”ë¡œ RBAC ì…ë‹ˆë‹¤.\nê³µì‹ ë¬¸ì„œ ì† RBAC ì„¤ëª… ê³µì‹ ë¬¸ì„œëŠ” ì–¸ì œë‚˜ ê°€ì¥ ì¢‹ì€ êµê³¼ì„œì…ë‹ˆë‹¤. ìì„¸í•œ ë°©ë²•ì€ ê³µì‹ ë¬¸ì„œì—ì„œ ì°¾ì•„ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nArgoCD Helm Chart ì† Configuration default values.yaml ë˜í•œ ì œê°€ ì‚¬ìš©í•œ ArgoCD Helm Chartì—ì„œ ì œê³µí•˜ëŠ” README.md ì† Configuration ë¶€ë¶„ê³¼ default values.yaml ë³´ë©´\nHelm Chartë¥¼ í†µí•´ ë°°í¬í•œ ArgoCDì˜ ê²½ìš° ì–´ë–»ê²Œ values.yamlì„ í†µí•´ rbacì„ ì„¤ì •í•  ìˆ˜ ìˆëŠ”ì§€ ë‚˜ì™€ìˆìŠµë‹ˆë‹¤.\nê¸°ë³¸ ì›ë¦¬ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.\np, \u0026lt;role/user/group\u0026gt;, \u0026lt;resource\u0026gt;, \u0026lt;action\u0026gt;, \u0026lt;appproject\u0026gt;/\u0026lt;object\u0026gt; - AppProjectì— ì†í•œ Object(e.g. Application)ì— ëŒ€í•œ ê¶Œí•œì„ ì •ì˜í•œë‹¤. p, \u0026lt;role/user/group\u0026gt;, \u0026lt;resource\u0026gt;, \u0026lt;action\u0026gt;, \u0026lt;object\u0026gt; - AppProjectì— ì†í•˜ì§€ ì•ŠëŠ” Object(e.g. Clusters, AppProject, Repositories, \u0026hellip;)ì— ëŒ€í•œ ê¶Œí•œì„ ì •ì˜í•œë‹¤. ê·¸ë¦¬ê³  ìœ„ì—ì„œ ë§í•˜ëŠ” Resourceë‚˜ Actionì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.\nResources: clusters, projects, applications, repositories, certificates, accounts, gpgkeys Actions: get, create, update, delete, sync, override, action ê³µì‹ ë¬¸ì„œì˜ ì„¤ëª…ì´ ì¢€ ë¶€ì¡±í•˜ê¸´í•˜ì§€ë§Œ Github SSOë¥¼ ì´ìš©í•´ ì¸ì¦í•˜ëŠ” ê²½ìš° RBACì€ ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•  ìˆ˜ ìˆë‹¤ê³  í•©ë‹ˆë‹¤.\np, role:org-admin, applications, *, */*, allow p, role:org-admin, clusters, get, *, allow p, role:org-admin, repositories, get, *, allow p, role:org-admin, repositories, create, *, allow p, role:org-admin, repositories, update, *, allow p, role:org-admin, repositories, delete, *, allow g, your-github-org:your-team, role:org-admin ì˜ë¯¸: org-adminì´ë¼ëŠ” Roleì´ ê°–ëŠ” ê¶Œí•œë“¤ì„ ì •ì˜í•˜ê³  í•´ë‹¹ :ì— ì†í•˜ëŠ” Github userë¡œ ë¡œê·¸ì¸í•œ ê²½ìš° org-admin Roleì— í—ˆìš©ëœ ê¶Œí•œë“¤ì„ ê°–ëŠ”ë‹¤. ê·¸ë¦¬ê³  ì €ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ìš”êµ¬ì‚¬í•­ì„ ê°€ì •í•˜ë ¤í•©ë‹ˆë‹¤.\nRBAC ìš”êµ¬ì‚¬í•­\në‚˜ì˜ Github Organization khu-devì˜ khumu-devops íŒ€ì˜ ìœ ì €ë“¤ì€ admin ê¶Œí•œì„ ê°–ëŠ”ë‹¤. ë‚˜ì˜ Github Organization khu-devì˜ khumu-devops íŒ€ì˜ ìœ ì €ë“¤ì€ readonly ê¶Œí•œì„ ê°–ëŠ”ë‹¤. ê·¸ ê²½ìš° ì €ëŠ” ë‹¤ìŒê³¼ ê°™ì´ values.yamlì„ ì‘ì„±í•œ ë’¤ helm releaseë¥¼ update í•´ì£¼ë©´ ë©ë‹ˆë‹¤.\n# values.yaml server: rbacConfig: policy.csv: | g, khu-dev:khumu-developer, role:readonly g, khu-dev:khumu-devops, role:admin ... readonlyì™€ adminì´ë¼ëŠ” Roleì€ ê³µì‹ë¬¸ì„œì—ë„ ë‚˜ì™€ìˆë“¯ builtin-policyë¡œì„œ ì´ê³³ì— ì‘ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.\n$ helm upgrade -n argocd argocd \\ argo/argo-cd -f values.yaml ê·¸ëŸ¼ ìœ„ì˜ ì»¤ë§¨ë“œë¥¼ í†µí•´ RBAC ì„¤ì •ì„ ì ìš©ì‹œì¼œì£¼ê² ìŠµë‹ˆë‹¤.\n2. ArgoCDì— Githubì„ í†µí•œ SSO ì„¤ì •í•˜ê¸° ArgoCDëŠ” Dexë¼ëŠ” ì¸ì¦ ê´€ë ¨ ê°ì¢… ê¸°ëŠ¥ì„ ë‹´ë‹¹í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ë¥¼ í•¨ê»˜ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤. Githubì˜ OAuth2ë¥¼ ì´ìš©í•´ SSO(Single Sign On)ì„ ì´ìš©í•˜ëŠ” ê³¼ì •ì€ ê³µì‹ë¬¸ì„œ Dex ë¶€ë¶„ì—ë„ ì†Œê°œë˜ì–´ìˆê³ , ì‚¬ì‹¤ ì´ëŒ€ë¡œ ë”°ë¼ë§Œí•˜ë©´ ë©ë‹ˆë‹¤. ã…ã…\nGithub OAuth app ìƒì„±í•˜ê¸° Organization - Settings - Developer Settings - OAuth Apps ì—ì„œ ìœ„ì™€ ê°™ì´ OAuth Appì„ ë§Œë“¤ì–´ì£¼ê³  ì´í›„ ìƒì„±ë˜ëŠ” Client IDì™€ Client Secretì„ ë‹¤ìŒê³¼ ê°™ì´ dex.configì— ì „ë‹¬í•˜ë©´ ë©ë‹ˆë‹¤. (ì‚¬ì‹¤ Organizationì´ ì•„ë‹ˆë¼ ê°œì¸ ê³„ì •ì—ì„œ Appì„ ìƒì„±í•´ë„ ë™ì‘í•©ë‹ˆë‹¤.)\në‹¨, dex.configëŠ” argocd-cmì´ë¼ëŠ” Configmapì˜ .dataì˜ í•„ë“œë¡œ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— ìš°ë¦¬ëŠ” Helm chartì˜ values.yamlì— dex.configë¥¼ ì˜¬ë°”ë¥´ê²Œ ì „ë‹¬í•´ì•¼í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ì„  server.config.dex.configë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•´ì£¼ë©´ ë©ë‹ˆë‹¤.\nserver: config: dex.config: | connectors: # Github OAuthë¥¼ í†µí•´ SSOí•˜ë ¤ëŠ” ê²½ìš° - type: github id: github # ìƒê´€ ì—†ì„ ë“¯ ë­˜ë¡œ í•˜ë“  name: GitHub # ìƒê´€ ì—†ì„ ë“¯ ë­˜ë¡œ í•˜ë“  config: clientID: \u0026lt;your github oauth app client id\u0026gt; clientSecret: \u0026lt;your github oauth app client secret\u0026gt; orgs: - name: \u0026lt;your github organization name\u0026gt; # e.g. khu-dev ... server.config.dex.configì— ì‘ì„±í•´ì•¼í•œë‹¤ëŠ” ê²ƒì€ ì–´ë–»ê²Œ ì•Œ ìˆ˜ ìˆëŠ”ê°€?\nArgoCDì˜ ê³µì‹ ë¬¸ì„œì—ì„œëŠ” argocd-cm.yamlì„ \u0026lsquo;General Argo CD configuration\u0026rsquo;ë¡œ ì†Œê°œí•˜ê³  ìˆìŠµë‹ˆë‹¤. ArgoCD Helm Chart Githubì—ì„œëŠ” values.yaml ì† server.configë¥¼ ë™ì¼í•˜ê²Œ \u0026lsquo;General Argo CD configuration\u0026rsquo;ë¡œ ì†Œê°œí•˜ê³  ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ values.yaml ì† server.configì— ì •ì˜í•˜ëŠ” ë‚´ìš©ì´ ê³§ argocd-cm.yamlì˜ .dataê°€ ë¨ì„ ìœ ì¶”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. $ helm upgrade -n argocd argocd \\ argo/argo-cd -f values.yaml í•œ ë²ˆ ë” ìœ„ì˜ ì»¤ë§¨ë“œë¥¼ í†µí•´ RBAC ì„¤ì •ì„ ì ìš©ì‹œì¼œì£¼ê² ìŠµë‹ˆë‹¤.\nLOG IN VIA GITHUB ë²„íŠ¼ì´ ì¶”ê°€ëœ ëª¨ìŠµ ì„±ê³µì ìœ¼ë¡œ Githubì„ í†µí•œ SSOê°€ í™œì„±í™”ë˜ë©´ ArgoCDì— ì ‘ì†í•  ë•Œ ìœ„ì™€ ê°™ì´ LOG IN VIA GITHUB ë²„íŠ¼ì´ ì¶”ê°€ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nê·¸ëŸ¼ ìš”êµ¬ì‚¬í•­ëŒ€ë¡œ khu-devë¼ëŠ” Github Organizationì˜ khumu-developer Teamì— ì†í•œ ê³„ì •ìœ¼ë¡œ ArgoCDì— ë¡œê·¸ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.\nUser info ì„±ê³µì ìœ¼ë¡œ ë¡œê·¸ì¸í•œ ë’¤ \u0026lt;your argocd url\u0026gt;/user-infoë¡œ ì´ë™í•˜ë©´ ìœ„ì™€ ê°™ì´ : ì´ë¼ëŠ” ì´ë¦„ì˜ ê·¸ë£¹ì— ì†í•œ ëª¨ìŠµì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nPermission denied ì´í›„ ë§Œì•½ ì–´ë–¤ Applicationì„ Syncí•˜ë ¤í•´ë„ í˜„ì¬ ì†í•œ ê·¸ë£¹ì¸ khu-dev:khumu-developerëŠ” readonly Roleì„ ë¶€ì—¬ë°›ì•˜ê¸°ì— ì–´ë– í•œ Appë„ Syncí•  ê¶Œí•œì´ ì—†ì–´ ìœ„ì™€ ê°™ì´ Permission Denied ë¼ëŠ” ì—ëŸ¬ë¥¼ ë§ì´í•˜ê²Œ ë©ë‹ˆë‹¤.\nUser info ğŸ‰ğŸ‰ğŸ‰ í•˜ì§€ë§Œ ìœ„ì™€ ê°™ì´ khu-dev:khumu-devopsì— ì†í•œ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•œ ë’¤ ë™ì¼í•˜ê²Œ ì–´ë–¤ Appì„ Syncí•´ë³´ë©´ ì´ë²ˆì—ëŠ” ì„±ê³µì ìœ¼ë¡œ Appì´ Syncë˜ëŠ” ëª¨ìŠµì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. khu-dev:khumu-devops ê·¸ë£¹ì€ admin Roleì„ ë¶€ì—¬ë°›ì•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤!\nì, ê·¸ëŸ¼ ì´ì œëŠ” admin ê³„ì •ì„ ë¹„ë¡¯í•œ username, password ê¸°ë°˜ì˜ ê³„ì •ì„ ì´ìš©í•  í•„ìš” ì—†ì´ Githubì„ ì´ìš©í•´ ArgoCDì˜ ì¸ì¦/ì¸ê°€ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ ã…ã…\në§ˆì¹˜ë©° ìƒˆë¡œìš´ íšŒì‚¬ì— ì…ì‚¬í•˜ê³  í–‰ë³µí•˜ê²Œ ì ì‘í•´ë‚˜ê°€ë©´ì„œ ìš´ë™, ì·¨ë¯¸, ì—…ë¬´ê¹Œì§€ ì±™ê¸°ë‹¤ë³´ë‹ˆ ê¸€ì„ ì‘ì„±í•´ë†“ê³  ë§ˆë¬´ë¦¬ë¥¼ ì˜¤ëœ ì‹œê°„ ë™ì•ˆ ì§“ì§€ ëª»í•˜ë‹¤ê°€ ê¸‰íˆ ì§€ë°©ì„ ê±°ì¼ì„ ê¸°íšŒ ì‚¼ì•„ ê¸€ì„ ë§ˆë¬´ë¦¬ ì§€ì–´ë´¤ìŠµë‹ˆë‹¤. ìš°ì„ ì€ ArgoCDë¥¼ Helm chartì™€ í•¨ê»˜ ì„ ì–¸ì ìœ¼ë¡œ ì´ìš©í•´ë‚˜ê°€ëŠ” ë‚´ìš©ì€ ì´ ê¸€ì„ ëìœ¼ë¡œ 2í¸ìœ¼ë¡œ ë§ˆë¬´ë¦¬ ì§€ì–´ë³´ë ¤í•©ë‹ˆë‹¤. ì‚¬ì´ë“œ í”„ë¡œì íŠ¸ì—ì„œ ArgoCDë¥¼ ì´ìš©í•˜ë©´ì„œ ArgoCDëŠ” ì„ ì–¸ì ìœ¼ë¡œ ê´€ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤ëŠ” ì¥ì ì„ ë§ì´ ì¨ë¨¹ì§€ ëª»í•˜ê³  ì¢€ ë”ëŸ¬ìš´ í˜•íƒœë¡œ ì–µì§€ë¡œ ì‚¬ìš©í•˜ë‹¤ë³´ë‹ˆ ë²ˆê±°ë¡­ê²Œ ëŠê»´ì¡Œë˜ ê²½ìš°ê°€ ë§ì•˜ëŠ”ë° ì € ìŠ¤ìŠ¤ë¡œë„ ì´ë¥¼ ì„ ì–¸ì ì¸ í˜•íƒœë¡œ ê°œì„ í•˜ë©´ì„œ ë§ì´ í¸í•´ì¡Œê³ , ê·¸ ê³¼ì •ë“¤ì„ ì´ë ‡ê²Œ ê¸€ë¡œ ê¸°ë¡í•˜ê³ ë‚˜ë‹ˆ ë‚˜ë¦„ ë¿Œë“¯í•©ë‹ˆë‹¤.\nArgoCD ê´€ë ¨í•œ ë˜ ë‹¤ë¥¸ ë‚´ìš©ìœ¼ë¡œëŠ” Applpicaitonsetì— ê´€í•´ ì¶”í›„ì— ê¸°íšŒê°€ ë˜ë©´ ë‹¤ë¤„ë³¼ê¹Œ ìƒê° ì¤‘ì…ë‹ˆë‹¤.\nëª‡ ë…„ ì „ì— ì²˜ìŒ ë°ë¸Œì˜µìŠ¤ ì—”ì§€ë‹ˆì–´ ì¸í„´ìœ¼ë¡œì„œ ì´ìª½ ì¼ì„ ì‹œì‘í–ˆì„ ë•Œ ì œê°€ ì•Œë˜ ArgoCDëŠ” \u0026lsquo;ArgoCDë¼ê³  ìš”ì¦˜ ì¿ ë²„ë„¤í‹°ìŠ¤ í™˜ê²½ì—ì„œ ì“¸ë§Œí•œ CD íˆ´ì´ ìˆë‹¤ë”ë¼\u0026rsquo; ì •ë„ì˜ ë„êµ¬ì˜€ë˜ ê²ƒ ê°™ì€ë° ì´ì œëŠ” ìì²´ CDíˆ´ë§Œì„ ì‚¬ìš©í•˜ëŠ” ê¸°ì—…ì„ ì œì™¸í•˜ë©´ ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ëŠ” ëŒ€ë¶€ë¶„ì´ ArgoCDë¥¼ ì´ìš©í•  ì •ë„ë¡œ ëŒ€ì¤‘ì ì¸ ê¸°ìˆ ì´ ëœ ê²ƒ ê°™ê³ , ê·¸ ì‹œì ˆë³´ë‹¤ ë§ì€ ê¸°ëŠ¥ë“¤ì„ í¸ë¦¬í•˜ê²Œ ì œê³µí•˜ëŠ” ê¸°ìˆ ì´ ëœ ê²ƒ ê°™ì•„ ìƒˆì‚¼ ê¸°íŠ¹í•˜ë‹¨ ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤ ã…ã….\në°ë¸Œì˜µìŠ¤ë¡œ ì…ì‚¬í•˜ë©´ì„œ ê±°ëŒ€í•œ ê·œëª¨ì˜ í´ë¼ìš°ë“œ ì¸í”„ë¼ë¥¼ ë‹¤ë£¨ë‹¤ë³´ë‹ˆ ë„¤íŠ¸ì›Œí¬ ê´€ë ¨ëœ ë‚´ìš©ì„ ìì£¼ ì ‘í•˜ê²Œ ë˜ê³ , ì´ë¡ ì ìœ¼ë¡œëŠ” ì œê°€ ì•½í•œ ë¶€ë¶„ì´ë¼ê³  ìƒê°ì´ ë“¤ì–´ì„œ ì•ìœ¼ë¡œëŠ” DevOps ì„œë¹„ìŠ¤ë“¤ë³´ë‹¤ëŠ” ë„¤íŠ¸ì›Œí¬ ê³µë¶€ë¥¼ ìš°ì„ ì ìœ¼ë¡œ í•´ë³¼ê¹Œí•©ë‹ˆë‹¤! ê³§ ìì·¨ë¥¼ ì‹œì‘í• í…ë° ë¼ì¦ˆë² ë¦¬ íŒŒì´ë¡œ ìì·¨ë°©ì—ì„œ ì¬ë°ŒëŠ” ë¬´ì–¸ê°€ë¥¼ í•´ë³¼ ìˆ˜ ìˆì„ê¹Œ ì‹¶ì€ ìƒê°ë„ ìˆêµ¬ìš” ã…ã…. ì‹œê°„ì´ ë˜ë©´ ê´€ë ¨ ë‚´ìš©ì„ í‹ˆí‹ˆì´ ê¸°ë¡í•´ë³´ê² ìŠµë‹ˆë‹¤! ê°ì‚¬í•©ë‹ˆë‹¤.\nì°¸ê³ ìë£Œ RBAC vs ABAC - Okta ArgoCD ê³µì‹ ë¬¸ì„œ ArgoCD Helm Chart ","date":"2022-05-07T22:00:00+09:00","image":"https://umi0410.github.io/blog/devops/declarative-argocd-helm-rbac/logo_huc6aa4a846d689b08bb4f93a6ab036ab8_63751_120x120_fill_box_smart1_3.png","permalink":"https://umi0410.github.io/blog/devops/declarative-argocd-helm-rbac/","title":"ArgoCD ì„ ì–¸ì ìœ¼ë¡œ ì´ìš©í•´ë‚˜ê°€ê¸° - Githubì„ í†µí•œ SSO ë° RBAC"},{"content":"ì‹œì‘í•˜ë©° ì·¨ì¤€ìƒ ê¸°ê°„ì„ ë§ˆë¬´ë¦¬í•˜ê³  ë°ë¸Œì˜µìŠ¤ ì—”ì§€ë‹ˆì–´ë¡œì„œ ì»¤ë¦¬ì–´ë¥¼ ì‹œì‘í•˜ê²Œ ëìŠµë‹ˆë‹¤! ğŸ‰\nê·¼ë¬´ë¥¼ ì‹œì‘í•˜ê¸° ì „ê¹Œì§€ ê¸°ê°„ì´ ì¢€ ë‚¨ì•„ìˆì–´ì„œ ê·¸ ì „ê¹Œì§€ ë­˜ í•´ë³´ë©´ ì¬ë°Œì„ê¹Œ ê³ ë¯¼í•˜ë˜ ì¤‘ì— ìƒˆë¡œ ìƒê¸´ í´ë¼ìš°ë“œ ë™ì•„ë¦¬ì¸ Cloud Clubì—ì„œ í´ë¼ìš°ë“œì™€ ì¸í”„ë¼ì— ê´€í•œ ì£¼ì œë¡œ ë°œí‘œí•  ê¸°íšŒê°€ ì£¼ì–´ì ¸ ArgoCDë¥¼ í† í”½ìœ¼ë¡œ ë°œí‘œë¥¼ í•´ë³´ë ¤í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ê´€ë ¨ëœ ë‚´ìš©ì„ í•œ ë²ˆ ë” ë¸”ë¡œê·¸ì— ì •ë¦¬í•´ë³´ë ¤í•´ìš”!\nì£¼ì œëŠ” \u0026ldquo;ArgoCD ì„ ì–¸ì ìœ¼ë¡œ ì´ìš©í•´ë‚˜ê°€ê¸°\u0026rdquo; ì´ê³  ì£¼ë¡œ ë‹¤ë£° ë‚´ìš©ì€ ì–´ë–»ê²Œ ArgoCDë¥¼ ì¢€ ë” ì„ ì–¸ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê³  ì´ìš©í•´ë‚˜ê°ˆ ìˆ˜ ìˆì„ì§€ì…ë‹ˆë‹¤.\nArgoCDê°€ ë­”ì§€, ì–´ë–»ê²Œ Getting Startedí• ì§€, GitOpsê°€ ë­”ì§€ ë“±ì„ ë‹¤ë£¨ì§€ ì•Šìœ¼ë ¤ëŠ” ì´ìœ ëŠ” ì´ë¯¸ ê·¸ ë‚´ìš©ìœ¼ë¡œëŠ” ì¶©ë¶„í•œ ì–‘ì§ˆì˜ ìë£Œê°€ ì¡´ì¬í•œë‹¤ê³  ìƒê°í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ArgoCDë‚˜ GitOpsì˜ ê°œë… ìì²´ ê°™ì€ ë‚´ìš©ë³´ë‹¤ëŠ” ìƒˆë¡œìš´ ê¸°ìˆ (ArgoCD)ì„ ì ‘í•  ë•Œ ì–´ë–»ê²Œ ì…ë§›ëŒ€ë¡œ ì»¤ìŠ¤í„°ë§ˆì´ì§•í•´ë‚˜ê°€ëŠ”ì§€ ê·¸ë¦¬ê³  ê·¸ ì‘ì—…ì„ ì–´ë–»ê²Œ ì¢€ ë” ìœ ì§€ë³´ìˆ˜í•˜ê¸° ì‰½ë„ë¡ ì¦‰ ì„ ì–¸ì ìœ¼ë¡œ í•´ë‚˜ê°ˆ ìˆ˜ ìˆì„ì§€ì— ëŒ€í•œ ì €ì˜ ì‘ì—… ê³¼ì •ì„ ì†Œê°œí•´ë³´ë ¤í•©ë‹ˆë‹¤ â˜ºï¸\nì´ë²ˆ ê¸€ì—ì„œëŠ” í¬ê²Œ ë‹¤ìŒê³¼ ê°™ì€ ì‘ì—…ì„ ë‹¤ë£¨ê²Œ ë  ê±°ì—ìš”.\nminikubeë¥¼ í†µí•´ ë¡œì»¬ì— kubernetes í™˜ê²½ì„ êµ¬ì¶•í•©ë‹ˆë‹¤. helmì„ í†µí•´ ArgoCDë¥¼ install í•©ë‹ˆë‹¤. ArgoCDë¥¼ ì´ìš©í•´ë³´ê¸° ìœ„í•´ CRDì¸ AppProjectì™€ Applicationì„ ìƒì„±í•©ë‹ˆë‹¤. ì‹¤ì œë¡œ GitOpsì˜ í˜•íƒœë¡œ CDê°€ ì˜ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸~ 1~4ë²ˆ ê³¼ì •ì„ helmì„ í†µí•´ ì¢€ ë” ì„ ì–¸ì ìœ¼ë¡œ ìˆ˜í–‰í•  ìˆ˜ ìˆë„ë¡ ê°œì„ í•©ë‹ˆë‹¤. í•´ë‹¹ ê³¼ì •ë“¤ì„ ì‹¤ìŠµí•´ë³´ê³  ì‹¶ìœ¼ì‹  ë¶„ë“¤ì€ ì œê°€ ì‘ì„±í•´ë‘” Repository(https://github.com/umi0410/declarative-argocd)ë¥¼ í¬í¬í•œ ë’¤ ì‘ì—…í•˜ì‹œë©´ í¸í•˜ì‹¤ ê²ƒ ê°™ìŠµë‹ˆë‹¤.\nGlossary (ìš©ì–´ ì‚¬ì „) ê°„ë‹¨í•˜ê²Œ ì´ë²ˆ ê¸€ì—ì„œ ë‹¤ë£¨ê²Œ ë  ìš©ì–´ë“¤ì„ ì •ë¦¬í•´ë³´ê² ìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì´ ê¶ê¸ˆí•˜ì‹œë‹¤ë©´ ë”°ë¡œ ì°¾ì•„ë³´ì‹œëŠ” ê²ƒì„ ì¶”ì²œë“œë¦¬ê² ìŠµë‹ˆë‹¤. ì´ë²ˆ ê¸€ì—ì„œ ì „ë¶€ë¥¼ ë‹¤ë£¨ê¸´ í˜ë“¤ê¸° ë•Œë¬¸ì´ì—ìš” ã…œã……ã…œ\nGlossary - ìš©ì–´ ì‚¬ì „ minikube - \u0026ldquo;minikube is local Kubernetes, focusing on making it easy to learn and develop for Kubernetes.\u0026rdquo; from Minikube Docs ArgoCD - \u0026ldquo;Argo CD is a declarative, GitOps continuous delivery tool for Kubernetes.\u0026rdquo; - from ArgoCD Documents CRD(Custom Resource Definition) - K8sì˜ í‘œì¤€ ResourceëŠ” ì•„ë‹ˆì§€ë§Œ ê°œë³„ì ìœ¼ë¡œ ì •ì˜í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë¦¬ì†ŒìŠ¤ kindë“¤ì„ ë§í•¨. Application - ArgoCDê°€ ì‚¬ìš©í•˜ëŠ” CRD ì¤‘ í•˜ë‚˜. ì–´ë–¤ K8s ë¦¬ì†ŒìŠ¤ë“¤ì„ ì–´ë–¤ Repositoryì—ì„œ ê°€ì ¸ì™€ì„œ ì–´ë–¤ ì‹ìœ¼ë¡œ ë°°í¬í•  ì§€ë¥¼ ì •ì˜í•¨. AppProject í˜¹ì€ Project - Applicationì´ ì†í•˜ëŠ” ê·¸ë£¹. GitOps - DevOpsì˜ ì‹¤í˜„ í˜•íƒœ ì¤‘ í•˜ë‚˜. ì¸í”„ë¼ë‚˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ìš´ì˜ ì •ë³´ì— ëŒ€í•œ Single Source of Truthë¡œì„œ Git Repositoryë¥¼ í™œìš©í•˜ëŠ” í˜•íƒœ Helm - K8s applicationì„ íŒ¨í‚¤ì§•í•˜ì—¬ í¸ë¦¬í•˜ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” ë„êµ¬ Chart - Helmì„ í†µí•´ ë°°í¬ë˜ëŠ” ê²ƒ. ChartëŠ” ë‹¤ì–‘í•œ k8s ë¦¬ì†ŒìŠ¤ë“¤ì„ íŒ¨í‚¤ì§•í•œ í˜•íƒœì´ë‹¤. ì„ ì–¸ì (Declarative) - ì ˆì°¨ì (Procedural) í˜¹ì€ ëª…ë ¹ì (Imperative) ë°©ì‹ê³¼ ë‹¬ë¦¬ ê³¼ì •ì„ ìƒëµí•˜ê³  ê°„ê²°í•˜ê²Œ Desired Stateë¥¼ ì„ ì–¸ì ìœ¼ë¡œ ì •ì˜í•˜ëŠ” ê²ƒ. Requirements minikube brew install minikube \u0026amp;\u0026amp; minikube start kubectl brew install kubectl \u0026amp;\u0026amp; kubectl version helm brew install helm \u0026amp;\u0026amp; helm version Github account ì˜ˆì‹œ ì½”ë“œ ë ˆí¬(https://github.com/umi0410/declarative-argocd)ë¥¼ í¬í¬ëœ¬ ë’¤ ìì‹ ì˜ ë ˆí¬ë¥¼ í†µí•´ Continuouse Deployí•˜ê¸° ìœ„í•¨ ArgoCDë¥¼ êµ¬ì¶•í•˜ê³  ê´€ë¦¬í•˜ëŠ” ë°©ë²• ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œëŠ” ì–´ë–¤ ì„œë¹„ìŠ¤ë¥¼ ë°°í¬í•˜ê³  ê´€ë¦¬í•´ë‚˜ê°€ëŠ” ë°ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë°©ë²•ë“¤ì´ ìˆìŠµë‹ˆë‹¤.\nPlain k8s manifest yaml Kustomize Helm Chart \u0026hellip; ì´ì™¸ì—ë„ ë‹¤ì–‘í•œ ë°©ë²•ë“¤ì´ ìˆì„ ìˆ˜ ìˆì§€ë§Œ ì¼ë‹¨ ì œê°€ ì‚¬ìš©í•´ë³¸ ë°©ë²•ë“¤ì€ ìœ„ì˜ 3ê°œì™€ ê°™ì•„ìš”.\nì €ëŠ” ë³µì¡í•œ í˜•íƒœë¥¼ ê°€ì§„ ì˜¤í”ˆì†ŒìŠ¤ë¥¼ ë°°í¬í•  ë•Œì—ëŠ” Helm Chartë¥¼, ìš°ë¦¬ íŒ€ì˜ ì„œë¹„ìŠ¤ë¥¼ ê°ê° ë°°í¬í•  ë•Œì—ëŠ” ê°€ë³ê²Œ ì¸ìë¥¼ ìˆ˜ì •í•˜ëŠ” ë“±ì˜ ìš©ë„ë¡œ Kustomizeë¥¼ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤. Plain k8s manifest yamlì€ ì‹¤ì œ ì—…ë¬´ë‚˜ í”„ë¡œì íŠ¸ì—ì„œëŠ” ê±°ì˜ ì‚¬ìš©í•˜ì§€ ì•Šê³ , ì¿ ë²„ë„¤í‹°ìŠ¤ ê´€ë ¨ tutorial ë“±ì—ì„œ ì£¼ë¡œ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.\në³µì¡í•œ í˜•íƒœì˜ ì˜¤í”ˆì†ŒìŠ¤ë¥¼ ë°°í¬í•  ë•Œì—ëŠ” Helm Chartë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ëŠ” Helm ChartëŠ” values.yamlê³¼ ê°™ì€ ì„¤ì • íŒŒì¼ì„ í†µí•´ í•„ìš”í•œ ëŒ€ë¶€ë¶„ì˜ ê²ƒì„ í¸ë¦¬í•˜ê²Œ ì„¤ì •í•˜ê²Œ í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì˜¤í”ˆì†ŒìŠ¤ í”„ë¡œì íŠ¸ë¥¼ ì§ì ‘ Plain k8s manifest íŒŒì¼ë“¤ë¡œ ê´€ë¦¬í•˜ê¸°ì—ëŠ” ë„ˆë¬´ë‚˜ë„ ë²…ì°¨ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. Deploymentë§Œ í•´ë„ í•œ ì†ê°€ë½ìœ¼ë¡œ ì„¸ê¸° í˜ë“  ê²½ìš°ë„ ìˆê³ , Configmapì— ì „ë‹¬í•´ì•¼í•˜ëŠ” ê°’ë„ ë³€ê²½ë  ìˆ˜ ìˆëŠ”ë°, ë˜ ìƒˆë¡œìš´ ë²„ì „ì´ ì¶œì‹œë˜ë©´ ê·¸ manifest íŒŒì¼ë“¤ì„ í•˜ë‚˜ í•˜ë‚˜ ë¹„êµí•˜ëŠ” ê²ƒë„ ë„ˆë¬´ í˜ë“¤ì£ . ê·¸ë˜ì„œ ì €ëŠ” ë³´í†µ Nginx Ingress Controller, Cert manager, ArgoCD ì™€ ê°™ì€ ì˜¤í”ˆì†ŒìŠ¤ë“¤ì€ Helmìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒì„ ì„ í˜¸í•©ë‹ˆë‹¤.\në°˜ë©´ ìš°ë¦¬ íŒ€ ì„œë¹„ìŠ¤ë¥¼ ë°°í¬í•˜ëŠ” ê²½ìš° ëŒ€ë¶€ë¶„ Image tagë§Œ ë³€ê²½í•˜ë©´ ë˜ëŠ”ë° ì´ëŸ° ì¼€ì´ìŠ¤ì—ëŠ” ê°€ë³ê²Œ Kustomizeë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì ì ˆí•˜ë‹¤ê³  ìƒê°ë©ë‹ˆë‹¤.\nê·¸ë˜ì„œ! ì´ë²ˆ ê¸€ì—ì„œëŠ” ArgoCDë¥¼ Helmìœ¼ë¡œ ë°°í¬í•´ë³´ë ¤ í•©ë‹ˆë‹¤.\nHelmìœ¼ë¡œ ê°„ë‹¨í•˜ê²Œ êµ¬ì¶•í•´ë³´ê¸° ArgoCD Helm Chart ì„¤ì¹˜ Helm ìœ¼ë¡œ ArgoCDë¥¼ ì„¤ì¹˜í•˜ëŠ” ë°©ë²•ì€ ArgoCD Helm Chart Githubì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì°¸ ê°„ë‹¨í•©ë‹ˆë‹¤.\nëŒ€ì‹  ì €ëŠ” namespaceë¥¼ argocdë¡œ ê³ ì •í•˜ì—¬ ì„¤ì¹˜í• ê²Œìš”! ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ default namespaceì— ì„¤ì¹˜ë”ë¼êµ¬ìš”. Release nameì€ argocd-demoë¡œ í•˜ê² ìŠµë‹ˆë‹¤.\n$ minikube start ğŸ˜„ minikube v1.25.2 on Darwin 12.2 (arm64) ... $ kubectl create ns argocd $ helm repo add argo https://argoproj.github.io/argo-helm \u0026#34;argo\u0026#34; has been added to your repositories $ helm install -n argocd argocd-demo argo/argo-cd NAME: argocd-demo LAST DEPLOYED: Sat Apr 23 05:37:32 2022 NAMESPACE: argocd STATUS: deployed REVISION: 1 TEST SUITE: None NOTES: In order to access the server UI you have the following options: 1. kubectl port-forward service/argocd-demo-server -n argocd 8080:443 and then open the browser on http://localhost:8080 and accept the certificate 2. enable ingress in the values file `server.ingress.enabled` and either - Add the annotation for ssl passthrough: https://github.com/argoproj/argo-cd/blob/master/docs/operator-manual/ingress.md#option-1-ssl-passthrough - Add the `--insecure` flag to `server.extraArgs` in the values file and terminate SSL at your ingress: https://github.com/argoproj/argo-cd/blob/master/docs/operator-manual/ingress.md#option-2-multiple-ingress-objects-and-hosts After reaching the UI the first time you can login with username: admin and the random password generated during the installation. You can find the password by running: kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath=\u0026#34;{.data.password}\u0026#34; | base64 -d (You should delete the initial secret afterwards as suggested by the Getting Started Guide: https://github.com/argoproj/argo-cd/blob/master/docs/getting_started.md#4-login-using-the-cli) ëŒ€ë¶€ë¶„ì˜ ê²½ìš° helm chartë¥¼ installí•œ ë’¤ í‘œì‹œë˜ëŠ” ì•ˆë‚´ë¬¸ì´ ë§ì€ ë„ì›€ì´ ë©ë‹ˆë‹¤.\n1ë²ˆ - ë¸Œë¼ìš°ì €ì—ì„œ ArgoCDë¥¼ ì—´ê¸° ìœ„í•œ Port forwarding ì„¤ëª…ì´ì—ìš”.\n2ë²ˆ - Ingressë‚˜ TLS Termination ê´€ë ¨ ì„¤ëª…ì´ì—ìš”.\në‚˜ë¨¸ì§€ - adminê³¼ ëœë¤ íŒ¨ìŠ¤ì›Œë“œì— ëŒ€í•œ ì„¤ëª…ì´ì—ìš”.\në¸Œë¼ìš°ì €ë¡œ ë¡œê·¸ì¸í•´ë³´ê¸° ìë™ìœ¼ë¡œ ìƒì„±ëœ admin ë¹„ë°€ë²ˆí˜¸ë¥¼ ì–»ì€ ë’¤ ì½˜ì†”ì— ì ‘ì†í•˜ê¸° ìœ„í•´ Port forwardí•œ ë’¤ ì ‘ì†í•´ë³¼ê²Œìš”.\n$ kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath=\u0026#34;{.data.password}\u0026#34; | base64 -d 5VYjI5YcfOo6XMHx $ kubectl port-forward service/argocd-demo-server -n argocd 8080:443 Forwarding from 127.0.0.1:8080 -\u0026gt; 8080 Forwarding from [::1]:8080 -\u0026gt; 8080 ë¡œê·¸ì¸ í™”ë©´ TLS ì„¤ì •ì„ ì˜¬ë°”ë¥´ê²Œ í•´ì£¼ì§€ ì•Šì•˜ê¸° ë–„ë¬¸ì— ë¸Œë¼ìš°ì €ì—ì„œ ì¸ì¦ì„œë‚˜ HTTPS ë¬¸ì œê°€ ê²½ê³ ë  ìˆ˜ ìˆì–´ìš”. ì¼ë‹¨ì€ \u0026lsquo;ë¬´ì‹œí•˜ê³  í˜ì´ì§€ ì§„í–‰í•˜ê¸°\u0026lsquo;ì™€ ê°™ì€ ë²„íŠ¼ë“¤ì„ í†µí•´ ì§„í–‰í•´ì¤ì‹œë‹¤. ë¡œì»¬ì—ì„œ ë°ëª¨í•´ë³´ëŠ” ê²ƒì´ë‹ˆê¹Œìš”. ê·¸ëŸ¼ ë²Œì¨ ì†ì‰½ê²Œ ë¡œê·¸ì¸ ì°½ì´ ëœ¬ ê²ƒì„ ë³¼ ìˆ˜ ìˆê³ , ì•„ê¹Œ ì¡°íšŒí•œ adminì— ëŒ€í•œ íŒ¨ìŠ¤ì›Œë“œë¥¼ í†µí•´ admin / {{YOUR_PASSWORD}}ë¡œ ë¡œê·¸ì¸í•´ì¤ë‹ˆë‹¤.\nì½˜ì†” í™”ë©´ ğŸ‰ ì§œì”~! ArgoCD ì½˜ì†” í™”ë©´ì´ ë“±ì¥í–ˆì–´ìš”!!!\nApplicationì„ í†µí•´ CD ë™ì‘ì„ í…ŒìŠ¤íŠ¸í•´ë³´ê¸° ArgoCDì—ëŠ” Repository, AppProject, Application ê³¼ ê°™ì€ ê°œë…ë“¤ì´ ì¡´ì¬í•©ë‹ˆë‹¤.\nRepository - Private Repository ë° ë‹¤ì–‘í•œ Repositoryì— ëŒ€í•œ ì„¤ì •ë“¤ì„ ë‹´ë‹¹í•´ìš”. AppProject - Applicationì´ ì†í•  ìˆ˜ ìˆëŠ” ê·¸ë£¹ìœ¼ë¡œ í•´ë‹¹ Projectë‚´ì˜ Applicationë“¤ì´ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ”, í˜¹ì€ Project Tokenì´ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ë™ì‘ì„ ì œí•œí•  ìˆ˜ ìˆì–´ìš”. Application - ì›í•˜ëŠ” k8s ë¦¬ì†ŒìŠ¤ë“¤ì„ ì–´ë–¤ ì‹ìœ¼ë¡œ CDí•  ì§€ì— ëŒ€í•œ ì„¤ì •ì´ì—ìš”. Applicationì´ ê°€ì¥ ì¤‘ìš”í•´ìš”~! Private repositoryë¥¼ ì´ìš©í•˜ê¸° ì „ê¹Œì§€ëŠ” ì•„ë§ˆ Repositoryê°€ í•„ìš”í•˜ì§„ ì•Šì„ ê±°ê³ , default project ì™¸ì˜ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•´ì„œ ì‚¬ìš©í•  ê²Œ ì•„ë‹ˆë©´ AppProjectë„ í•„ìš”í•˜ì§„ ì•Šì„ ê±°ì—ìš”.\në‹¤ë§Œ Applicationì€ í•„ìˆ˜ë¡œ ìƒˆë¡œ ìƒì„±í•´ì•¼ CD ë™ì‘ì„ í™•ì¸í•´ë³¼ ìˆ˜ ìˆì–´ìš”!\nArgoCDì—ì„œ ì“°ì´ëŠ” ëŒ€ë¶€ë¶„ì˜ ë¦¬ì†ŒìŠ¤ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ CRD(e.g. Repository, AppProject, Application)ë¡œ ê´€ë¦¬ë˜ê³  ê·¸ ì™¸ì˜ ê²ƒë“¤ë„ configmapì— ì„¤ì •ì„ ê¸°ì…í•¨ìœ¼ë¡œì¨ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!\në”°ë¼ì„œ ìš°ë¦¬ëŠ” ArgoCD CRD ì¤‘ í•˜ë‚˜ì¸ Applicationì„ ë§Œë“¤ì–´ë³¼ ê±°ì—ìš”. ê³µì‹ ë¬¸ì„œì˜ Getting Startedì—ì„œëŠ” ì§ì ‘ ArgoCD CLIë¡œ Applicationì„ ë§Œë“¤ì§€ë§Œ ArgoCD CLIë‚˜ ì½˜ì†” í™”ë©´ì„ í†µí•´ Applicationì„ ë§Œë“¤ê²Œ ë˜ë©´ ì¶”í›„ì— Applicationì„ yaml ì½”ë“œë¡œ ë‚˜íƒ€ë‚´ì–´ ì„ ì–¸ì ìœ¼ë¡œ ì´ìš©í•˜ë ¤ëŠ” ê²½ìš° ê¸°ì¡´ì˜ Applicationì„ ì½”ë“œë¡œ ë‚˜íƒ€ë‚´ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼í•˜ëŠ”ì§€ í˜¼ë€ìŠ¤ëŸ¬ìš°ì‹¤ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì €ëŠ” ì§ì ‘ Applicationì„ yamlë¡œ ì‘ì„±í•´ì„œ ì ìš©í•´ì£¼ê² ìŠµë‹ˆë‹¤.\ní•˜ì§€ë§Œ ë§Œì•½ ì•„ì§ ArgoCDê°€ ë‚¯ì„œì‹œë‹¤ë©´ ë‹¨ìˆœíˆ ì½˜ì†”ì—ì„œ ì§ì ‘ Applicationì„ ìƒì„±í•˜ëŠ” ë°©ë²•ë„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤. ì´í›„ ì–´ë–¤ ì„¤ì •ë“¤ì´ ìˆëŠ”ì§€ ê°ì„ ì¡ì•„ë³´ì‹œê³  ê·¸ëŸ° ì„¤ì •ë“¤ì„ ì–´ë–»ê²Œ CRD(yaml)ë¡œ ë‚˜íƒ€ë‚´ëŠ”ì§€ë¥¼ ì°¾ì•„ë‚˜ê°€ë©° IaCë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒë„ í•˜ë‚˜ì˜ ë°©ë²•ì´ë¼ê³  ìƒê°í•©ë‹ˆë‹¤.\nì œê°€ ë³¸ ê²Œì‹œê¸€ì„ ìœ„í•´ ë§Œë“¤ì–´ë†“ì€ Repository(https://github.com/umi0410/declarative-argocd)ë¥¼ Forkí•˜ì…”ì„œ ì‚¬ìš©í•˜ì‹œë©´ ë˜ê² ìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ì•„ë˜ í•­ëª©ë“¤ì„ ì˜ ìˆ˜í–‰í•´ì£¼ì„¸ìš”.\nâš ï¸ ì•„ë˜ì˜ kubectl apply ìˆ˜í–‰ ì‹œ URLì„ ë³¸ì¸ì˜ Github username í˜¹ì€ Organization nameìœ¼ë¡œ ë³€ê²½í•˜ê¸° âš ï¸ fork ëœ¬ Repositoryì˜ getting-started/argocd/application.yml íŒŒì¼ì—ì„œ spec.source.repoURL ê°’ì„ ìì‹ ì˜ fork ëœ¬ Repository URLë¡œ ì˜¬ë°”ë¥´ê²Œ ìˆ˜ì •í•˜ê¸° forkë¥¼ ëœ¨ëŠ” ì´ìœ ëŠ” ì´í›„ì— GitOps ë°©ì‹ìœ¼ë¡œ CDí•˜ê¸° ìœ„í•´ image tagë¥¼ ë³€ê²½í•´ì„œ í‘¸ì‹œí•œ ë’¤ ì—…ë°ì´íŠ¸ ë˜ëŠ” ëª¨ìŠµì„ ë³´ê¸° ìœ„í•¨ì´ì—ìš”!\nì €í¬ëŠ” ìƒ˜í”Œ í”„ë¡œì íŠ¸ë¡œ Guestbook(ë°©ëª…ë¡) í”„ë¡œì íŠ¸ë¥¼ ë°°í¬í•˜ê³  í™•ì¸í•´ë³¼ê±°ì—ìš”.\n$ kubectl apply -n argocd -f https://raw.githubusercontent.com/umi0410/declarative-argocd/master/getting-started/argocd/application.yml guestbook ì•±ì´ ì˜ ë“±ë¡ëœ ëª¨ìŠµ ê·¸ëŸ¼ ìœ„ì™€ ê°™ì´ guestbook ì•±ì´ ë“±ë¡ë˜ì–´ syncëœ ëª¨ìŠµì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n$ kubectl port-forward service/guestbook-ui -n default 8888:80 Forwarding from 127.0.0.1:8888 -\u0026gt; 80 Forwarding from [::1]:8888 -\u0026gt; 80 ë§ˆì°¬ê°€ì§€ë¡œ ë°©ê¸ˆ ë°°í¬í•œ guestbookì´ ì˜ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•´ë³´ê¸° ìœ„í•´ guestbook-ui ì„œë¹„ìŠ¤ë¥¼ port forwardí•´ì£¼ê² ìŠµë‹ˆë‹¤.\nks-guestbook-demo:0,1 0.1 ë²„ì „ìœ¼ë¡œ ì„¤ì¹˜í–ˆë‹¤ë©´ ìœ„ì™€ ê°™ì´ ê²€ì€ íƒ€ì´í‹€ì˜ Guestbook UIë¥¼ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤!\nê·¸ëŸ¼ ê³¼ì—° ë‹¤ë¥¸ ë²„ì „ì˜ ì´ë¯¸ì§€ë¡œ ì—…ë°ì´íŠ¸í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•´ë³¼ ìˆ˜ ìˆì„ê¹Œìš”?!\nì§€ì›ë˜ëŠ” ì´ë¯¸ì§€ íƒœê·¸ ëª©ë¡.png ì§€ì›ë˜ëŠ” ì´ë¯¸ì§€ íƒœê·¸ ëª©ë¡ì€ ì´ê³³ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nìš°ë¦¬ëŠ” GitOpsë¥¼ ìœ„í•œ ë„êµ¬ì¸ ArgoCDë¥¼ ì´ìš©í•˜ê³  ìˆê³  guestbook applicationì€ Auto Sync ì„¤ì •ì„ í•´ë†“ì•˜ê¸° ë•Œë¬¸ì— ë‹¨ìˆœíˆ image tagë¥¼ 0.2ë¡œ ë³€ê²½í•œ ë’¤ í‘¸ì‹œí•´ì£¼ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤!\nê·¸ëŸ¼ fork ëœ¨ì‹  ë ˆí¬ì§€í† ë¦¬ì—ì„œ getting-started/k8s/deployment.ymlì˜ spec.template.spec.containers[0].image tag ê°’ì„ 0.1 -\u0026gt; 0.2 ë¡œ ë³€ê²½í•´ì£¼ì‹œê³  í‘¸ì‹œí•´ì£¼ì„¸ìš”.\nks-guestbook-demo:0.2ë¡œ ë°°í¬ëœ Pod ìœ„ì™€ ê°™ì´ Podì˜ ì»¨í…Œì´ë„ˆì˜ ì´ë¯¸ì§€ íƒœê·¸ê°€ 0.2ë¡œ ë³€ê²½ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆê³ \nks-guestbook-demo:0.2 ê¸°ì¡´ì—ëŠ” ê²€ì •ìƒ‰ íƒ€ì´í‹€ì˜ \u0026ldquo;Guestbook\u0026rdquo; ì´ì—ˆì§€ë§Œ ì´ì œëŠ” ì•Œë¡ë‹¬ë¡í•œ \u0026ldquo;Fancy Guestbook\u0026rdquo; ì´ ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”~!\nì´ëŸ° ì‹ì˜ ì‘ì—… ë°©ì‹ì—ì„œ ë¶ˆí¸í•œ ì ë“¤ ì„±ê³µì ìœ¼ë¡œ CD ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì‹¤ì œë¡œ ArgoCDë¥¼ ë„ì…í•˜ê³  ê¾¸ì¤€íˆ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ë°©ê¸ˆê³¼ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ì‘ì—…í•˜ê²Œ ë˜ë©´ ëª‡ ê°€ì§€ ë¶ˆí¸ ì‚¬í•­ë“¤ì´ ì¡´ì¬í•  ìˆ˜ ìˆì–´ìš”.\nhelmìœ¼ë¡œ ArgoCDë¥¼ ì„¤ì¹˜í•œ ë’¤ ì¶”ê°€ì ìœ¼ë¡œ ìˆ˜ë™ìœ¼ë¡œ Applicationì„ ë“±ë¡í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ ë˜ë©´ ë˜ ë‹¤ë¥¸ í´ëŸ¬ìŠ¤í„°ì— ë™ì¼í•œ ì„¤ì •ìœ¼ë¡œ ArgoCDë¥¼ ì„¤ì¹˜í•˜ê±°ë‚˜ ì¬êµ¬ì¶•í•  ë•Œ ë§ì´ ë²ˆê±°ë¡œìš¸ ìˆ˜ ìˆì–´ìš”. ì´í›„ì—ë„ Applicationì„ ìƒˆë¡œ ìƒì„±í•  ë•Œë‚˜ ë³€ê²½í•  ë•Œë§ˆë‹¤ kubectlì„ ì§ì ‘ ìˆ˜í–‰í•´ì•¼í•©ë‹ˆë‹¤. ìš°ë¦¬ëŠ” GitOpsì˜ í˜•íƒœë¡œ ArgoCDë¥¼ í†µí•´ Deployment, Service, Configmap ë“±ì„ ê´€ë¦¬í•˜ê³  ìˆì§€ë§Œ Applicationì€ ì§ì ‘ kubectlë¡œ ê´€ë¦¬í•˜ê³  ìˆì–´ìš”. App of App íŒ¨í„´ì„ í†µí•´ ì¢€ ë” ì„ ì–¸ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê¸° ë”°ë¼ì„œ ìœ„ì™€ ê°™ì€ ë¶ˆí¸ ì‚¬í•­ë“¤ì„ í•´ì†Œí•˜ê¸° ìœ„í•´ì„œ ArgoCDì—ëŠ” App of Appì´ë¼ëŠ” íŒ¨í„´ì´ ì¡´ì¬í•©ë‹ˆë‹¤. App of App íŒ¨í„´ì´ë€ ArgoCDë¡œ ê´€ë¦¬í•  Applicationë“¤ì„ ê´€ë¦¬í•˜ëŠ” ìš°ë‘ë¨¸ë¦¬ Applicationì„ ë‘ëŠ” íŒ¨í„´ì„ ë§í•´ìš”.\nê³µì‹ë¬¸ì„œì—ì„œë„ ê´€ë ¨ ë‚´ìš©ì„ ì°¾ì•„ë³¼ ìˆ˜ ìˆì–´ìš”. ì˜ˆë¥¼ ë“¤ì–´ App of App íŒ¨í„´ì„ ì´ìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë‹¤ë¥¸ ì•±ë“¤ì„ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ ë¼ìš”. ê·¸ëŸ¼ ìœ„ì—ì„œ 2ë²ˆìœ¼ë¡œ ì–¸ê¸‰í•œ ë¬¸ì œëŠ” ì–´ëŠ ì •ë„ í•´ê²°í•  ìˆ˜ ìˆì§€ë§Œ, ê·¸ëŸ¼ ê·¸ ìš°ë‘ë¨¸ë¦¬ Appì€ ì–´ë–»ê²Œ ìƒì„±/ê´€ë¦¬í•  ê²ƒì¸ê°€(1ë²ˆ ë¬¸ì œ)ê°€ ì—¬ì „íˆ ë¬¸ì œì—ìš”.\nì €ëŠ” ì´ ë¬¸ì œë¥¼ ìš°ë¦¬ê°€ ì§ì ‘ Appì„ ìƒì„±/ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ArgoCD helm chartì˜ ì¶”ê°€ì ì¸ ì„¤ì •ì„ í†µí•´ ì„ ì–¸ì ìœ¼ë¡œ ê´€ë¦¬í•¨ìœ¼ë¡œì¨ í•´ê²°í•˜ë ¤í•©ë‹ˆë‹¤.\nArgoCD Helm Chart README.mdì— ì†Œê°œëœ ë¶€ë¶„ ì„¤ì •ê°’ ì˜ˆì‹œëŠ” ì´ê³³ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nì¦‰, ArgoCD Helm Chartë¥¼ í†µí•´ ê´€ë¦¬í•  Applicationì„ values.yamlì— ì‘ì„±í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.\nê·¸ëŸ¼ getting-started/values.yamlì˜ server.additionalApplications[0].source.repoURLì„ ë§ˆì°¬ê°€ì§€ë¡œ ë³¸ì¸ì´ fork ëœ¨ì‹  ë ˆí¬ì§€í† ë¦¬ì˜ URLë¡œ ë³€ê²½í•´ì£¼ì‹œê³  ì•„ë˜ì˜ ëª…ë ¹ì–´ë¡œ helm chartë¥¼ ì—…ê·¸ë ˆì´ë“œí•´ì£¼ì„¸ìš”.\n$ helm upgrade -n argocd argocd-demo argo/argo-cd -f getting-started/values.yaml ... ì´í›„ì—ëŠ” ì•„ë˜ì™€ ê°™ì´ app-of-appì´ë¼ëŠ” guestbook Applicaitonì„ ê´€ë¦¬í•˜ëŠ” Applicationì´ ìƒì„±ëœ ê²ƒì„ ë³´ì‹¤ ìˆ˜ ìˆì„ ê±°ì—ìš” :)\napp-of-app íŒ¨í„´ì´ ì ìš©ëœ ëª¨ìŠµ app-of-appì€ guestbook applicationì„ ê´€ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë§Œì•½ ì¶”ê°€ì ìœ¼ë¡œ Applicationì„ ìƒì„±í•˜ê±°ë‚˜ ì‚­ì œí•˜ê³  ì‹¶ë‹¤ë©´ ì§ì ‘ kubectlì„ í†µí•´ ê´€ë¦¬í•  ê²ƒì´ ì•„ë‹ˆë¼ ë³€ê²½í•˜ê³ ì‹¶ì€ ì‚¬í•­ì„ getting-started/argocdì— ì‘ì„±í•œ ë’¤ Git pushí•˜ë©´ ArgoCDê°€ ì•Œì•„ì„œ ì ìš©í•´ì£¼ê²Œ ë©ë‹ˆë‹¤! ëŒ€ë‹¨í•˜ì£ ?!\nê·¸ëŸ¼ ìœ„ì˜ ì‘ì—…ì„ í†µí•´ ìš°ë¦¬ê°€ ì•ì„œ ì–¸ê¸‰í–ˆë˜ ë¶ˆí¸ë“¤ì´ í•´ì†Œë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ë³¼ê²Œìš”. ì œê°€ ë°”ë¼ëŠ” ê±´ ë°±ì§€ ìƒíƒœì˜ í´ëŸ¬ìŠ¤í„°ì—ì„œë„ ì œê°€ ì„ ì–¸í•´ë†“ì€ ì„¤ì • íŒŒì¼ë“¤ë§Œì„ í†µí•´ helm install ëª…ë ¹ì–´ í•œ ì¤„ë§Œìœ¼ë¡œ í˜„ì¬ì™€ ë™ì¼í•œ ArgoCD ìƒíƒœ, guestbook ìƒíƒœë¥¼ ê°–ëŠ” ê²ƒì´ì—ìš”! ì•„ì£¼ ì„ ì–¸ì ì´ì£ ?!\n$ minikube delete Deleting \u0026#34;minikube\u0026#34; in docker ... ğŸ”¥ Deleting container \u0026#34;minikube\u0026#34; ... ... $ minikube start ğŸ˜„ minikube v1.25.2 on Darwin 12.2 (arm64) âœ¨ Automatically selected the docker driver ... # ArgoCDë‚˜ guestbook ê´€ë ¨ Podë‚˜ ë¦¬ì†ŒìŠ¤ê°€ ì—†ìŒì„ í™•ì¸í•´ë³¼ê²Œìš” $ kubectl get pod --all-namespaces NAMESPACE NAME READY STATUS RESTARTS AGE kube-system coredns-64897985d-pd57n 1/1 Running 0 36s ... $ kubectl create ns argocd namespace/argocd created $ helm install -n argocd argocd-demo argo/argo-cd -f getting-started/values.yaml NAME: argocd-demo LAST DEPLOYED: Sat Apr 23 07:27:22 2022 NAMESPACE: argocd ... ê·¸ëŸ¼ ì‹œì›í•˜ê²Œ minikubeë¥¼ í†µí•´ êµ¬ì¶•í•œ ì¿ ë²„ë„¤í‹°ìŠ¤ í™˜ê²½ì„ ë‚ ë ¤ë²„ë¦¬ê³  ë‹¤ì‹œ ìƒì„±í•œ ë’¤ ArgoCDë¥¼ helm chartë¡œ ê¹”ì•„ë³¼ê²Œìš”. ì´ë²ˆì—ëŠ” helm chart ì„¤ì¹˜ ì‹œ getting-started/values.yamlì„ ì„¤ì •íŒŒì¼ë¡œ ì´ìš©í•´ì•¼í•©ë‹ˆë‹¤.\nhelm installì´ ì™„ë£Œë˜ë©´ ë™ì¼í•œ ë°©ë²•ìœ¼ë¡œ ìƒˆë¡œìš´ Admin íŒ¨ìŠ¤ì›Œë“œë¥¼ ì¡°íšŒí•œ ë’¤ ë‹¤ì‹œ port forwardí•´ì£¼ì‹œê³  ì½˜ì†”ì— ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.\nì„ ì–¸ì ìœ¼ë¡œ ê´€ë¦¬ëœ ArgoCD. guestbookì€ Sync ì¤‘ì´ì—ìš” :) ì„ ì–¸ì ìœ¼ë¡œ ê´€ë¦¬ëœ guestbook ğŸ‰ ì™€ìš°.. ìƒˆë¡œìš´ í´ëŸ¬ìŠ¤í„°ì—ì„œë„ ìš°ë¦¬ê°€ ì„ ì–¸ì ìœ¼ë¡œ ì‘ì„±í•œ ì½”ë“œë“¤ë§Œ ìˆë‹¤ë©´ ìœ„ì™€ ê°™ì´ ê¸°ì¡´ê³¼ ë™ì¼í•œ ìƒíƒœë¡œ êµ¬ì¶•ì´ ê°€ëŠ¥í•˜ë„¤ìš”! ì¢‹ìŠµë‹ˆë‹¤ ì¢‹ì•„ìš”~\në§ˆì¹˜ë©° ArgoCDë¥¼ Helmìœ¼ë¡œ install í•´ë³´ê¸° Applicationì„ ìƒì„±í•˜ê³  guestbook í”„ë¡œì íŠ¸ë¥¼ í†µí•´ CD í…ŒìŠ¤íŠ¸í•´ë³´ê¸° ê·¸ ê³¼ì •ì—ì„œì˜ ë¶ˆí¸ì´ë‚˜ ë¬¸ì œì‚¬í•­ì„ ë°œê²¬í•´ë‚´ê³  ì„ ì–¸ì ìœ¼ë¡œ í•´ê²°í•´ë‚˜ê°€ê¸° App of App íŒ¨í„´ ì´ìš©í•˜ê¸° ArgoCD Helm Chartê°€ ì§€ì›í•˜ëŠ” additionalApplications ì„¤ì •ì„ ì´ìš©í•˜ê¸° ì´ë²ˆ ê¸€ì—ì„œ ìœ„ì˜ ê³¼ì •ë“¤ì„ í†µí•´ ArgoCDë¥¼ ì–´ë–»ê²Œ ì¢€ ë” ì„ ì–¸ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆì„ì§€ ë˜ ê·¸ëŸ° ì‘ì—…ì„ ìˆ˜í–‰í•  ë•Œ ìë£Œë“¤ì„ ì–´ë””ì„œ ì°¾ì•„ë³¼ ìˆ˜ ìˆëŠ”ì§€ì— ëŒ€í•´ ì•Œì•„ë´¤ìŠµë‹ˆë‹¤.\nì¢€ ë” ì œê°€ ì–´ë–»ê²Œ ìë£Œë¥¼ ì°¾ì•„ë‚˜ê°€ëŠ” ì§€ ê·¸ëŸ° ìš”ë ¹ì´ë‚˜ ê³¼ì •ë“¤ì„ ì ì–´ë³´ë ¤í–ˆëŠ”ë° ê¸€ì´ ê¸¸ì–´ì§€ë©´ì„œ ê¸°ëŠ¥ ìì²´ì˜ ë‚´ìš©ì— ì§‘ì¤‘í•˜ê²Œ ëœ ê°ì´ ìˆë„¤ìš” ğŸ¥²..\në‹¤ìŒ í¸ì—ì„œëŠ” ArgoCDì—ì„œ RBAC ì„¤ì •ì„ í•´ë³´ë©´ì„œ \u0026lsquo;ì–´ë–»ê²Œ ìƒˆë¡œìš´ ê¸°ëŠ¥ë“¤ì„ ì°¾ê³  ì ìš©í•´ë‚˜ê°€ëŠ”ì§€\u0026lsquo;ì— ì¢€ ë” í¬ì»¤ìŠ¤ë¥¼ ë§ì¶°ë³´ë ¤í•´ìš”. ë˜í•œ ì´ëŸ° ê³¼ì •ë“¤ì€ ArgoCD ë¿ë§Œ ì•„ë‹ˆë¼ Kafka, ELK, Jenkins ë“±ì˜ ì˜¤í”ˆì†ŒìŠ¤ë“¤ì„ ì‚¬ìš©í•  ë•Œì—ë„ ë„ì›€ì´ ë  ìˆ˜ ìˆì„ ê²ƒì´ë¼ ìƒê°í•©ë‹ˆë‹¤. \u0026lsquo;ì•„~ ì´ëŸ° ì‹ìœ¼ë¡œ ìë£Œë¥¼ ì°¾ì•„ë³¼ ìˆ˜ ìˆêµ¬ë‚˜\u0026rsquo; í•˜ê³  ë§ì´ì£  ã…ã…\nì´ë²ˆ ê¸€ì´ ArgoCDë¥¼ ì²˜ìŒ ì´ìš©í•´ë³´ì‹œëŠ” ë¶„ë“¤, ì´ìš©í•´ì˜¤ë©´ì„œ ì¡°ê¸ˆ ë¶ˆí¸í•˜ì…¨ë˜ ë¶„ë“¤, ìƒˆë¡œìš´ ì˜¤í”ˆì†ŒìŠ¤ë¥¼ ì–´ë–»ê²Œ í•™ìŠµí•˜ê³  ì ìš©í•´ë‚˜ê°ˆì§€ ì˜ ëª¨ë¥´ê² ëŠ” ë¶„ë“¤ê»˜ ë„ì›€ì´ ë  ìˆ˜ ìˆëŠ” ê¸€ì´ì—ˆê¸°ë¥¼ ë°”ëë‹ˆë‹¤! ê°ì‚¬í•©ë‹ˆë‹¤~ ğŸ˜†\n","date":"2022-04-22T14:11:07+09:00","image":"https://umi0410.github.io/blog/devops/declarative-argocd-helm-app-of-app/logo_huc6aa4a846d689b08bb4f93a6ab036ab8_63751_120x120_fill_box_smart1_3.png","permalink":"https://umi0410.github.io/blog/devops/declarative-argocd-helm-app-of-app/","title":"ArgoCD ì„ ì–¸ì ìœ¼ë¡œ ì´ìš©í•´ë‚˜ê°€ê¸° - Helm, App of App"},{"content":"ì‹œì‘í•˜ë©° ì €ë²ˆ í¸ì—ì„œëŠ” Key-Value DBì™€ Document DBë¥¼ ì •ë¦¬í•´ë´¤ê³  ì´ë²ˆ í¸ì—ì„œëŠ” Column Family DBì™€ GraphDBì— ëŒ€í•´ ì •ë¦¬í•´ë³´ë ¤í•œë‹¤.\nColumn Family DBë‚˜ GraphDBëŠ” ì‹¤ì œë¡œ ì‚¬ìš©í•´ë³¸ ì ì´ í•œ ë²ˆë„ ì—†ì–´ì„œ ì–´ë–¤ ë…€ì„ë“¤ì¸ì§€ ìì„¸íˆëŠ” ëª¨ë¥´ì§€ë§Œ ì±… ë‚´ìš© ìœ„ì£¼ë¡œ ì •ë¦¬í•´ë³´ë„ë¡ í•˜ê² ë‹¤.\nColumn-Family DB Column-Family DBëŠ” í•œ Rowì— ë¬´ìˆ˜íˆ ë§ì€ Columnì„ Schemaê°€ ê°•ì œë˜ì§€ ì•Šì€ í˜•íƒœë¡œ ì´ìš©í•  ìˆ˜ ìˆëŠ” NoSQLì˜ í•œ ì¢…ë¥˜ì´ë‹¤. Wide column DB, Wide column store, Columnar DB ë“±ì˜ ë‹¤ë¥¸ ë‹¤ì–‘í•œ ëª…ì¹­ë“¤ë„ ì¡´ì¬ëŠ” í•˜ì§€ë§Œ ì±…ì—ì„œëŠ” ì¢€ ë” ì—¬ëŸ¬ ì»¬ëŸ¼ì„ ë¬¶ì–´ì„œ ìƒê°í•  ìˆ˜ ìˆëŠ” ì ì´ ê°•ì¡°ë˜ëŠ” Colum-Family DBë¼ëŠ” ìš©ì–´ë¥¼ ì´ìš©í–ˆë‹¤ê³  í•œë‹¤.\nColumn-Family DBëŠ” ë‹¤ë¥¸ ì¼ë°˜ì ì¸ NoSQLê³¼ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì˜ ì‚¬ì´ì˜ ê·¸ ë¬´ì–¸ê°€ ê°™ì€ ëŠë‚Œì¸ë° ì´ëŠ” NoSQLì„ì—ë„ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì™€ ë¹„ìŠ·í•œ ëª‡ ê°€ì§€ íŠ¹ì§•ë“¤ì´ ìˆê¸° ë•Œë¬¸ì´ë‹¤.\nSQLê³¼ ìœ ì‚¬í•œ ì¿¼ë¦¬ ì–¸ì–´ë¥¼ ì œê³µí•˜ê¸°ë„ í•œë‹¤. Rowì™€ Column ë“±ì˜ ê°œë…ì´ ì¡´ì¬í•œë‹¤. ê·¸ ì™¸ì˜ íŠ¹ì§•ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.\nìì£¼ í•¨ê»˜ ì‚¬ìš©ë˜ëŠ” Columnë“¤ì„ ë¬¶ì–´ Column familyë¡œ ì´ìš©í•  ìˆ˜ ìˆë‹¤. Column familyëŠ” ì•½ê°„ RDBì—ì„œì˜ í•˜ë‚˜ì˜ Table ê°™ì€ ëŠë‚Œìœ¼ë¡œ ë³¼ ìˆ˜ë„ ìˆë‹¤. ê°œì¸ì ìœ¼ë¡œëŠ” Column family DBì—ì„œ í•˜ë‚˜ì˜ Rowì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ë“¤ì€ ì´ë¯¸ JOINì´ ìˆ˜í–‰ëœ ë°ì´í„°ë“¤ì˜ ëª¨ì„ ê°™ë‹¤. ì‚¬ì‹¤ 2ì°¨ì›ì ì¸ í…Œì´ë¸”ì´ ì•„ë‹Œ ì¤‘ì²©ëœ ë§µ êµ¬ì¡°ì´ë‹¤. SortedMap\u0026lt;Row Key, SortedMap\u0026lt;Column Key, Column Value\u0026gt;\u0026gt; ê°™ì€ ëŠë‚Œìœ¼ë¡œ ë³¼ ìˆ˜ ìˆë‹¤. ë‹¨ì¼ Rowì— ëŒ€í•œ ì „ì²´ ë°ì´í„°ë“¤ì€ ë””ìŠ¤í¬ì— ì €ì¥ë  ë•Œ ì„œë¡œ ì¸ì ‘í•˜ì§€ ì•Šì„ ìˆ˜ë„ ìˆë‹¤. í•˜ì§€ë§Œ í•˜ë‚˜ì˜ Column-Familyì— ëŒ€í•œ ë°ì´í„°ë“¤ì€ ì¸ì ‘í•´ì„œ ì €ì¥ëœë‹¤. Schemaê°€ ê°•ì œë˜ì§„ ì•ŠìŒ. JOINì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ê²ƒ ê°™ë‹¤. ì—„ì²­ë‚˜ê²Œ ë§ì€ ë°ì´í„°, ë†’ì€ í™•ì¥ì„±, ë†’ì€ ê°€ìš©ì„±ì— íŠ¹í™”ëœ ë“¯í•˜ë‹¤. ì»¬ëŸ¼ê°’ë“¤ì˜ ë²„ì „ ê´€ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤. í™•ì¥ê³¼ ê°€ìš©ì„±ì— íŠ¹í™”ëœ DBì´ë‹¤ë³´ë‹ˆ ë§ˆìŠ¤í„°ê°€ SPOF (ë‹¨ì¼ ì‹¤íŒ¨ ì§€ì )ì´ ë  ìˆ˜ ìˆëŠ” í˜•íƒœë¥¼ ì§€ì–‘í•œ ë“¯í•˜ê³ , Column-Family DBëŠ” P2P í˜•íƒœë¡œ ì–´ëŠ ëˆ„êµ¬ í•˜ë‚˜ê°€ ë§ˆìŠ¤í„°ì´ì§€ ì•Šê³  í‰ë“±í•˜ë‹¤.\në”°ë¼ì„œ í´ëŸ¬ìŠ¤í„° ë‚´ ì„œë²„ë“¤ì˜ ìƒíƒœ ê³µìœ , ë°ì´í„° ìµœì‹ í™” ë° ë³µì œ ë“± ê¸°ì¡´ì— ë§ˆìŠ¤í„°ê°€ ìˆ˜í–‰í•˜ë˜ ì‘ì—…ì„ ë™ë£Œ Nodeë“¤ë¼ë¦¬ ì•Œì•„ì„œ ìˆ˜í–‰í•´ì•¼í•˜ê³  ê·¸ë¥¼ ìœ„í•œ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ì´ í•„ìš”í•œë° ì´ë•Œ ë™ë£Œ Nodeë“¤ì´ ë§ì•„ì§ˆ ìˆ˜ë¡ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ì´ ê¸°í•˜ê¸‰ìˆ˜ì ìœ¼ë¡œ ëŠ˜ì–´ë‚  ìˆ˜ ìˆë‹¤. ì´ëŸ° ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ì„ íš¨ìœ¨ì ìœ¼ë¡œ í•˜ê¸° ìœ„í•œ í”„ë¡œí† ì½œë“¤ë„ ìƒê²¨ë‚˜ê²Œ ëë‹¤. ê°„ëµíˆë§Œ ì •ë¦¬í•´ë³´ìë©´ ê·¸ ì¤‘ í•˜ë‚˜ê°€ â€œê°€ì‹­ í”„ë¡œí† ì½œâ€ì´ë©°, â€œê° ë…¸ë“œê°€ ë‹¤ë¥¸ ëª¨ë“  ë…¸ë“œë“¤ì˜ ìƒíƒœë¥¼ ì§ì ‘ ì²´í¬í•˜ëŠ” ê²Œ ì•„ë‹ˆë¼ ê°ìê°€ ëª‡ ëª‡ ë…¸ë“œì˜ ìƒíƒœë¥¼ ì§ì ‘ ì²´í¬í•˜ê³  ë‚˜ë¨¸ì§€ ë…¸ë“œì˜ ìƒíƒœëŠ” ì„œë¡œ ì£¼ê³  ë°›ì€ ì •ë³´ë¥¼ ì°¸ê³ í•œë‹¤â€ ì •ë„ë¡œ ì •ë¦¬í•´ë³¼ ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.\nColumn-Family DBëŠ” ì£¼ë¡œ ë¹…ë°ì´í„° ë¶„ì•¼ì—ì„œ ë§ì´ ì“°ì´ëŠ” ê²ƒ ê°™ê³ , ë¹…ë°ì´í„°ë¥¼ ë‹¤ë£° ë•Œì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì‘ì—…ë“¤ì´ í•„ìš”í•˜ë‹¤.\nETL (Extract, Transfrom, Load) - ë°ì´í„°ì˜ ì¶”ì¶œ, ì ì ˆí•œ í˜•íƒœë¡œ ê°€ê³µ, ì ì¬ ë°ì´í„° ë¶„ì„ DB ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ Column-Family DBëŠ” ìœ„ì™€ ê°™ì€ ê¸°ëŠ¥ë“¤ì„ ì˜ ì œê³µí•˜ê³  ìˆë‹¤. ë°˜ë©´ ì£¼ë¡œ ì œí’ˆ(ë¹„ì¦ˆë‹ˆìŠ¤) ë¡œì§ì„ ìœ„í•œ ë°ì´í„° ì €ì¥ì€ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤, Key-Value DB, ë¬¸ì„œ DBë¥¼ ë§ì´ ì´ìš©í•˜ëŠ” ê²ƒ ê°™ê¸°ëŠ” í•˜ë‹¤.\ní•˜ì§€ë§Œ ê°„ë‹¨íˆ ì •ë¦¬í•˜ë ¤ë‹¤ê°€ ë‹¤ì‹œ ê¶ê¸ˆì¦ì´ ìƒê²¨ì„œ ìë£Œë¥¼ ì¢€ ì°¾ì•„ë³´ë˜ ì¤‘ ì»¬ëŸ¼ íŒ¨ë°€ë¦¬ë¥¼ ì œí’ˆ ë¡œì§ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì¼€ì´ìŠ¤ì— ê´€í•´ eBayì˜ ìƒí’ˆ ì¢‹ì•„ìš” ê¸°ëŠ¥ì„ Cassandraë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„° ëª¨ë¸ë§í•˜ëŠ” ê²ƒ ê´€ë ¨ ì¢‹ì€ ê¸€ì„ ë°œê²¬í•˜ê²Œ ë˜ì–´ ì´ ê¸€ì„ ì°¸ê³ í•´ë³´ë©´ ì¢‹ì„ ê²ƒ ê°™ë‹¤. ìš”ì•½ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.\nìš”êµ¬ë˜ëŠ” ì¡°íšŒ íŒ¨í„´ì„ ê·¼ê±°ë¡œ ì˜¬ë°”ë¥¸ ìˆ˜ì¤€ì˜ ë¹„ì •ê·œí™”ë¥¼ í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤. ë„ˆë¬´ ì •ê·œí™” ë˜ì–´ìˆìœ¼ë©´ í•„ìš”í•œ ì •ë³´ë¥¼ ì°¾ê¸° ìœ„í•´ í•œ ë²ˆ ë” ì¡°íšŒê°€ í•„ìš”í•  ìˆ˜ ìˆê³  ë¹„íš¨ìœ¨ì ì´ë‹¤. ë„ˆë¬´ ë¹„ì •ê·œí™” ë˜ì–´ìˆìœ¼ë©´ ë¶ˆí•„ìš”í•˜ê²Œ ìˆ˜ë§ì€ ë°ì´í„°ê°€ ì¤‘ë³µë˜ê²Œ ë˜ê³ , ìˆ˜ì • ì‚¬í•­ ë°˜ì˜ì´ ì‰½ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤. Graph DB GraphDBëŠ” ë¡œìš°, ì»¬ëŸ¼ ë“±ì„ ë°”íƒ•ìœ¼ë¡œ ë°ì´í„°ë¥¼ ëª¨ë¸ë§í•˜ëŠ” ëŒ€ì‹ ì— ë…¸ë“œ(í˜¹ì€ ì •ì , Vertex)ì™€ ê´€ê³„(Relation í˜¹ì€ Edge)ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ëª¨ë¸ë§í•œë‹¤. ì´ë•Œ EdgeëŠ” ë°©í–¥ì´ ìˆì„ ìˆ˜ë„ ìˆê³ , ì—†ì„ ìˆ˜ë„ ìˆë‹¤.\nì„œë¡œ ë§ì€ ê´€ê³„ë¥¼ ë§ºëŠ” ì¼€ì´ìŠ¤ì— ì‚¬ìš©í•˜ê¸° ì¢‹ì€ ë“¯í•œë°, ì˜ˆë¥¼ ë“¤ë©´ SNSì˜ ìœ ì € ê°„ì˜ ì¹œë°€ë„, ë„¤íŠ¸ì›Œí¬ì—ì„œ ë„ì‹œ ê°„ì˜ ì†Œìš” ì‹œê°„ ë“±ì„ ë‚˜íƒ€ë‚´ê¸° ì¢‹ë‹¤.\nGraph DBì—ì„œ ëª¨ë¸ë§í•  ìˆ˜ ìˆëŠ” ê·¸ë˜í”„ì™€ ê·¸ ì˜ˆì‹œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.\në°©í–¥ ê·¸ë˜í”„ - ì¡°ì§ êµ¬ì„±ì›ì˜ ìƒí•˜ ê´€ê³„ ë¬´ë°©í–¥ ê·¸ë˜í”„ - ì¡°ì§ êµ¬ì„±ì›ì˜ í˜‘ë ¥ ê´€ê³„ ìœ ë™ ë„¤íŠ¸ì›Œí¬ (Flow network) - ë„ë¡œ ì‹œìŠ¤í…œ, êµí†µ ë„¤íŠ¸ì›Œí¬. (ì˜ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤.) ì´ë¶„ ê·¸ë˜í”„ - ê° ì—°ê²° ê´€ê³„ë“¤ì„ ë”°ë¼ ê°€ë©´ ë‘ ê°œì˜ ì§‘í•©ìœ¼ë¡œ ë²ˆê°ˆì•„ í‘œí˜„ë˜ëŠ” ê·¸ë˜í”„ e.g. ìœ ì € - ê²Œì‹œê¸€ì˜ ì¢‹ì•„ìš” ê´€ê³„ ìœ ì € - ê²Œì‹œê¸€ - ìœ ì € - ê²Œì‹œê¸€ - \u0026hellip; e.g. ì„ ìƒë‹˜ê³¼ í•™ìƒì˜ ê´€ê³„ ì„ ìƒë‹˜ - í•™ìƒ - ì„ ìƒë‹˜ - í•™ìƒ - \u0026hellip; ë‹¤ì¤‘ ê·¸ë˜í”„ - vertex â†” vertex ê°„ì— ì—¬ëŸ¬ edgeê°€ ì¡´ì¬í•  ìˆ˜ ìˆëŠ” ê²½ìš° e.g. ë„¤ë¹„ê²Œì´ì…˜ ê°€ì¤‘ ê·¸ë˜í”„ - edgeì— ê°€ì¤‘ì¹˜ê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš° e.g. ìµœë‹¨ ê²½ë¡œ ì°¾ê¸° ê·¸ë˜í”„ DBë¥¼ ì–¸ì œ ì‚¬ìš©í•  ìˆ˜ ìˆì„ê¹Œ?\ní•­ìƒ ì–´ë–¤ DBë¥¼ ì‚¬ìš©í•  ì§€, ì–´ë–»ê²Œ ëª¨ë¸ë§í• ì§€ëŠ” ì‚¬ìš©í•˜ë ¤ëŠ” íŒ¨í„´, íŠ¹íˆ ì¡°íšŒ íŒ¨í„´ì— ê·¼ê±°í•´ì„œ ê³ ë ¤ë˜ì–´ì•¼í•œë‹¤.\nì˜ˆë¥¼ ë“¤ì–´ ë‹¤ìŒê³¼ ê°™ì€ ì¡°íšŒ íŒ¨í„´ì„ ê°€ì§„ ê²½ìš° ê·¸ë˜í”„ DBë¥¼ ì‚¬ìš©í•˜ë©´ ì¢‹ë‹¤.\nì •ì  Aì—ì„œ ì •ì  Bë¡œ ê°€ëŠ” ì—£ì§€ëŠ” ëª‡ ê°œì¸ê°€? ì •ì  Aì—ì„œ ì •ì  Bë¡œ ê°€ëŠ” ì—£ì§€ ì¤‘ ë¹„ìš©ì´ 100 ë¯¸ë§Œì¸ ì—£ì§€ëŠ” ëª‡ ê°œì¸ê°€? ì •ì  Aì—ì„œ ì •ì  Bë¡œ ê°€ëŠ” ê°€ì¥ íš¨ìœ¨ì ì¸ ê²½ë¡œëŠ” ë¬´ì—‡ì¸ê°€? ì¢€ ë” ì‹¤ìƒí™œê³¼ ë°€ì ‘í•œ ì˜ˆì‹œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.\nìœ ì € Aì™€ ì¹œë°€ë„ê°€ ë†’ì€ ìœ ì €ë“¤ì€ ëˆ„êµ¬ì¸ê°€? ìœ ì € Aì™€ ìœ ì € Bê°€ í•¨ê»˜ ì•„ëŠ” ì¹œêµ¬ê°€ ì¡´ì¬í•˜ëŠ”ê°€? ì§€ì—­ Aì—ì„œ ì§€ì—­ Bê¹Œì§€ ì´ë™í•  ìˆ˜ ìˆëŠ” ê²½ë¡œê°€ ì¡´ì¬í•˜ëŠ”ê°€? ì´ë ‡ê²Œ íŠ¹ì • ì—”í‹°í‹°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•´ë‹¹ ì—”í‹°í‹°ì™€ ì—”í‹°í‹°ì™€ ë‹¤ë¥¸ ì—”í‹°í‹°ë“¤ì˜ ì—°ê²° ê´€ê³„ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì¡°íšŒë¥¼ í•˜ëŠ” ê²½ìš° ê·¸ë˜í”„ DBë¥¼ ì‚¬ìš©í•˜ë©´ ì¢‹ë‹¤.\në°˜ë©´, ë‹¤ìŒê³¼ ê°™ì´ ì—”í‹°í‹°ë‚˜ í…Œì´ë¸” ì „ì²´ì— ê±¸ì¹œ ì§ˆì˜ëŠ” ì í•©í•˜ì§€ ì•Šë‹¤.\nì˜¤ëŠ˜ ë°›ì€ ì¢‹ì•„ìš”ê°€ ê°€ì¥ ë§ì€ ê²Œì‹œê¸€ì€ ì–´ë–¤ ê²Œ ìˆëŠ”ê°€? ê°€ì¥ ì—°ê²°ëœ ê²½ë¡œê°€ ë§ì€ ì§€ì—­ì€ ì–´ë””ì¸ê°€? ì‹¤ì œë¡œëŠ” Graph DBë¥¼ ì´ìš©í•˜ëŠ” ìœ ì¦ˆì¼€ì´ìŠ¤ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ìš´ì†¡ íšŒì‚¬ê°€ ìˆì„ ìˆ˜ ìˆë‹¤.\nâ€œì œí•œ ì‹œê°„ ë‚´ì— ìš´ì†¡ ê°€ëŠ¥í•œ ìµœì†Œ ë¹„ìš© ê²½ë¡œë¥¼ ì°¾ê¸°â€\nìš´ì†¡ ì†Œìš” ì‹œê°„ì„ ê°€ì¤‘ì¹˜ë¡œ í•œ ì¶œë°œ ì‹œì„¤ â†” ë„ì°© ì‹œì„¤ ê°„ì˜ ì—°ê²° ê´€ê³„ê°€ ì¡´ì¬ ê²½ë¡œë¥¼ ê±°ì³ê°€ë˜ ì¤‘ ì œí•œ ì‹œê°„ì„ ì´ˆê³¼í•˜ê²Œ ë˜ë©´ ê·¸ ê²½ë¡œëŠ” ì œì™¸ë¨. ê·¸ ì™¸ì˜ ê°€ëŠ¥í•œ ê²½ë¡œ ì¤‘ ê°€ì¥ ì €ë ´í•œ ê²½ë¡œë¥¼ ì±„íƒ! ì°¸ê³ í•´ë³´ë©´ ì¢‹ì„ ê²ƒ ê°™ì€ ë§í¬ ì¹´ì‚°ë“œë¼ ë°ì´í„° ëª¨ë¸ë§ part.2 - eBayì˜ ì¢‹ì•„ìš” ëª¨ë¸ë§ - http://hochul.net/blog/cassandra-data-modeling-best-practices-part-1/ Data modeling ê´€ë ¨ ì¹´ì‚°ë“œë¼ ë¬¸ì„œ - https://cassandra.apache.org/doc/latest/cassandra/data_modeling/index.html ì‹œê°„ ë‚˜ë©´ ì½ì–´ë³´ë©´ ì¢‹ì„ ê²ƒ ê°™ë‹¤. ë§ˆì¹˜ë©° ê°„ë‹¨í•˜ê²Œ Column-Family DBì™€ Graph DBì— ëŒ€í•´ ì •ë¦¬í•´ë´¤ë‹¤. ì±… ë‚´ìš© ì™¸ì—ë„ ìœ„ì— ì²¨ë¶€í•œ eBayì˜ Cassandra ëª¨ë¸ë§ ì´ì•¼ê¸°ê°€ ê½¤ ì¬ë¯¸ìˆê³ , í‰ì†Œ ê¶ê¸ˆí–ˆë˜ ë‚´ìš©ì„ ì˜ ì•Œë ¤ì¤€ ê²ƒ ê°™ë‹¤. ì±…ì„ ì½ìœ¼ë©´ì„œ ì•Œê²Œ ëì§€ë§Œ ë¬´ì‹¬ì½” ì§€ë‚˜ì¹œ ë‚´ìš©ë“¤ì´ë‚˜ ê¹Œë¨¹ì€ ë‚´ìš©ë“¤ì´ ê½¤ ìˆì—ˆë˜ ê²ƒ ê°™ì€ë° ë¦¬ë·°ë¥¼ ê¸°íšŒ ì‚¼ì•„ í•œ ë²ˆì”© ë‹¤ì‹œ ë˜ëŒì•„ ë³¼ ìˆ˜ ìˆëŠ” ê²ƒ ê°™ë‹¤.\në‹¤ìŒ ì±…ë„ ë¦¬ë·°í•´ë³´ë©´ ì¢‹ì„ ê²ƒ ê°™ë‹¤!\nì´ê±¸ë¡œ 2022ë…„ ì²« ì±… ë¦¬ë·° ë~!\n","date":"2022-03-17T03:30:00+09:00","image":"https://umi0410.github.io/blog/computer-science/book-review-nosql-introduction-3/cassandra-modeling_hu4c562377df99e1314a765d985ca6b3ef_61429_120x120_fill_box_smart1_3.png","permalink":"https://umi0410.github.io/blog/computer-science/book-review-nosql-introduction-3/","title":"(ë„ì„œ) \"NoSQL ì² ì € ì…ë¬¸\" - Column-Family DB, Graph DB"},{"content":"(ë„ì„œ) â€œNoSQL ì² ì € ì…ë¬¸â€ - Key-Value DB, Document DB ì‹œì‘í•˜ë©° ì•ì„  ê¸€ì—ì„œëŠ” â€œNoSQL ì² ì € ì…ë¬¸â€ì´ë¼ëŠ” ë„ì„œì— ëŒ€í•œ ì´í‰ê³¼ NoSQL ë°ì´í„°ë² ì´ìŠ¤ë“¤ì´ ê³µí†µì ìœ¼ë¡œ ê°–ëŠ” íŠ¹ì§•ì— ëŒ€í•´ ì•Œì•„ë´¤ë‹¤.\nì´ë²ˆ ê¸€ì—ì„œëŠ” NoSQLë“¤ ì¤‘ì—ì„œë„ Key-Value DBì™€ Document DBì´ íŠ¹íˆë‚˜ ì„œë¡œ ìœ ì‚¬í•œ í˜•íƒœë¥¼ ë„ëŠ” ê²ƒ ê°™ì•„ ë¬¶ì–´ì„œ ì •ë¦¬í•´ë³´ë ¤í•œë‹¤.\nì¶”ê°€ì ìœ¼ë¡œ ê°ìì˜ ê³ ìœ í•œ íŠ¹ì§•ì€ ì•„ë‹ˆë”ë¼ë„ ê³µí†µì  íŠ¹ì§•ì¼ ìˆ˜ ìˆëŠ” Master - Slave(read replica) êµ¬ì¡°ë‚˜ Partitioning, Sharding ë“±ë“±ì— ëŒ€í•´ì„œë„ ì •ë¦¬í•  ì˜ˆì •ì´ë‹¤.\nKey-Value Database í‚¤ì™€ ê°’ ë¿ì¸ ê°€ì¥ ê°„ë‹¨í•œ í˜•íƒœì˜ NoSQL ì¢…ë¥˜ì´ë‹¤. ì•„ì£¼ ë‹¨ìˆœí•œ ì¡°íšŒë§Œì´ ì§€ì›ëœë‹¤. í‚¤ë¥¼ í†µí•´ì„œë§Œ ì¡°íšŒê°€ ê°€ëŠ¥í•˜ë‹¤. í‚¤ë¥¼ ì•Œê³  ìˆë‹¤ë©´ ë°ì´í„°ë¥¼ ë°”ë¡œ ì°¾ì„ ìˆ˜ ìˆì§€ë§Œ í‚¤ê°€ ì—†ë‹¤ë©´ í’€ì„œì¹˜ë¥¼ í•´ì•¼í•  ìˆ˜ ìˆë‹¤. Key-Value DatabaseëŠ” ê°„ë‹¨í•œ í˜•íƒœì˜ DBì´ê¸° ë•Œë¬¸ì— í…Œì´ë¸”ì´ë‚˜ ê·¸ë˜í”„ë¡œ ë³µì¡í•œ ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚´ë ¤ëŠ” ê²½ìš°ì—ëŠ” ë¶€ì í•©í•˜ë‹¤. ë‹¨ìˆœ ì €ì¥ê³¼ í‚¤ë¥¼ ë°”íƒ•ìœ¼ë¡œí•œ ì¡°íšŒë¡œ ì¶©ë¶„í•œ ê²½ìš°ì— ê°€ë³ê²Œ ì‚¬ìš©í•˜ê¸° ì¢‹ë‹¤.\nì•„ë¬´ë˜ë„ ë‹¨ìˆœí•¨ì€ ë¹ ë¥¸ ì†ë„ì™€ë„ ì—°ê´€ì´ ë˜ê¸° ë•Œë¬¸ì— ì†ë„ê°€ ë¹ ë¥¸ í¸ì´ê³  ëŒ€í‘œì ì¸ ì˜ˆì‹œê°€ Redisì´ë‹¤. ë‹¨ìˆœí•œ ë™ì‘ì— In-Memory Databaseë¼ëŠ” íŠ¹ì§•ìœ¼ë¡œ ì¸í•´ RedisëŠ” ì—„ì²­ë‚œ ì†ë„ë¥¼ ìë‘í•œë‹¤.\në‹¨, ë©”ëª¨ë¦¬ ê°™ì´ ì‘ì€ í¬ê¸°ì˜ ì €ì¥ì†Œë¥¼ ì´ìš©í•  ë•ŒëŠ” ì €ì¥ì†Œê°€ ê°€ë“ ì°¨ì§€ ì•Šë„ë¡ ì£¼ì˜í•´ì•¼í•œë‹¤! ì£¼ë¡œ ì´ë¥¼ ìœ„í•´ ì£¼ë¡œ eviction policyë¼ëŠ” ì €ì¥ì†Œê°€ ê°€ë“ ì°¨ê¸°ì „ì— ë°ì´í„°ë¥¼ ì ì ˆíˆ ì‚­ì œí•˜ëŠ” ì •ì±…ì„ ì„¤ì •í•œë‹¤. ì£¼ë¡œ ì¸-ë©”ëª¨ë¦¬ ì €ì¥ì†ŒëŠ” ìºì‹œë¡œ ì‚¬ìš©ë˜ê³ , ìºì‹œëŠ” ì§€ì—­ì„±ì„ ê·¼ê±°ë¡œ í•˜ê¸° ë•Œë¬¸ì— ì‹œê°„ ì§€ì—­ì„±ì„ ë°”íƒ•ìœ¼ë¡œí•œ LRU ê´€ë ¨ ì •ì±…ì´ ë§ì´ ì‚¬ìš©ëœë‹¤.\nKey-Value DBëŠ” Keyë¥¼ ë°”íƒ•ìœ¼ë¡œ ì¡°íšŒê°€ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì— Keyì— ì¡°íšŒ ì¡°ê±´ì´ í¬í•¨ë˜ì–´ì•¼ í•œë‹¤. ë§Œì•½ ì–´ë–¤ ìœ ì €ì˜ ìµœê·¼ ì•Œë¦¼ ë‚´ì—­ ì •ë³´ë¥¼ Key-Value DB ì¤‘ í•˜ë‚˜ì¸ Redisì— ì €ì¥í•œë‹¤ê³  í•´ë³´ì.\nrecent_notifications:{{username}} = [{{json string}}, {{json stirng}}] ì˜ˆë¥¼ ë“¤ì–´ ìœ ì €ê°€ umi0410ì´ë¼ë©´ ì•„ë˜ì™€ ê°™ì´ Redisì— í•´ë‹¹ ìœ ì €ì˜ ìµœê·¼ ì•Œë¦¼ ë‚´ì—­ ì •ë³´ë¥¼ ì €ì¥í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤. recent_notifications:umi0410 = [ \u0026#34;{\\\u0026#34;id\\\u0026#34;: 1, \\\u0026#34;title\\\u0026#34;: \\\u0026#34;1ë²ˆ ì•Œë¦¼ì…ë‹ˆë‹¤.\\\u0026#34;}\u0026#34;, \u0026#34;{\\\u0026#34;id\\\u0026#34;: 2, \\\u0026#34;title\\\u0026#34;: \\\u0026#34;2ë²ˆ ì•Œë¦¼ì…ë‹ˆë‹¤.\\\u0026#34;}\u0026#34; ] ìœ„ì™€ ê°™ì´ ë°ì´í„°ë¥¼ ì €ì¥í•˜ë©´ ì½ì„ ë•Œì—ë„ íŠ¹ì • ìœ ì €ì˜ ìµœê·¼ ì•Œë¦¼ ì •ë³´ë¥¼ ì½ì–´ì˜¬ ìˆ˜ ìˆì„í…ë°, ì´ë•Œ ì•ì„œ ì–¸ê¸‰í–ˆë“¯ Keyë§Œì„ ë°”íƒ•ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ê²Œ ëœë‹¤.\nRDBì˜ ê²½ìš° ì£¼ë¡œ ì˜ë¯¸ ì—†ëŠ” Auto Increment IDë¥¼ PKì´ì Clustered Indexë¡œ ì„¤ì •í•˜ê¸° ë•Œë¬¸ì— Write ì‹œì— Auto Increment IDë¥¼ ë°”íƒ•ìœ¼ë¡œ ë””ìŠ¤í¬ì— ë°ì´í„°ê°€ ì—°ì†ëœ ìœ„ì¹˜ì— ì €ì¥ë˜ë„ë¡ í•˜ëŠ” í¸ì´ë‹¤. RDBëŠ” PKê°€ ì•„ë‹ˆë¼ë„ ë‹¤ì–‘í•œ ì¡°ê±´ìœ¼ë¡œ ê°’ì„ ê²€ìƒ‰í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— PKëŠ” ì„±ëŠ¥ì„ ê³ ë ¤í•´ ì˜ë¯¸ ì—†ëŠ” Auto Increment IDë¥¼ ë„£ëŠ” ê²ƒì´ë‹¤.\në°˜ë©´ Key-Value DatabaseëŠ” Keyë¥¼ ë°”íƒ•ìœ¼ë¡œ ë°–ì— ë°ì´í„°ë¥¼ ì¡°íšŒí•  ìˆ˜ê°€ ì—†ê¸° ë•Œë¬¸ì— Key (RDBì˜ PKì™€ ìœ ì‚¬í•˜ê²Œ IDì˜ ì—­í• ì„ í•œë‹¤ê³  ë³¼ ìˆ˜ ìˆìŒ)ì— ì˜ë¯¸ê°€ ë‹´ê²¨ì•¼í•œë‹¤.\nğŸ”µ Keyê°€ recent_notifications:umi0410 ì²˜ëŸ¼ ì¡°íšŒ ëª©ì ì— ë¶€í•©í•˜ëŠ” ì •ë³´ë¥¼ í¬í•¨í•˜ëŠ” ê²½ìš° â†’ umi0410 ìœ ì €ì— ëŒ€í•œ ë°ì´í„°ê°€ ì €ì¥ë˜ëŠ” key ê°’ì„ ì•Œ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì§ì ‘ Key ê°’ì„ ì°ì–´ì„œ ë°ì´í„°ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆìŒ âŒ Keyê°€ recent_notifications:1 ì²˜ëŸ¼ ì˜ë¯¸ ì—†ëŠ” ìˆ«ìê°’ì¸ ê²½ìš° â†’ umi0410 ìœ ì €ì— ëŒ€í•œ ë°ì´í„°ë¥¼ ì°¾ìœ¼ë ¤ë©´ Full scanì„ í•´ì•¼í•  ìˆ˜ ìˆìŒ. Key-Value databaseëŠ” ì–¸ì œ ì‚¬ìš©í•˜ë©´ ì¢‹ì„ê¹Œ? ì±…ì— ë‚˜ì˜¨ Key-Value database ì‚¬ìš© ì˜ˆì‹œë¥¼ ë‹¤ì‹œ ë³´ë‹ˆ ë³„ë¡œ ë§ˆìŒì— ì•ˆ ë“¤ì–´ì„œ ë‚´ ìƒê°ëŒ€ë¡œ ì ì–´ë³´ë ¤í•œë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ Key-Value databaseëŠ” Keyë§Œìœ¼ë¡œ ì¡°íšŒ ìš”êµ¬ì‚¬í•­ì„ ë§Œì¡±í•  ìˆ˜ ìˆì–´ì•¼í•œë‹¤.\nRedisì™€ ê°™ì€ In-memory ë°ì´í„°ë² ì´ìŠ¤ì˜ ê²½ìš°ì—ëŠ” ë‚®ì€ ë ˆì´í„´ì‹œê°€ ì¤‘ìš”í•˜ë‹¤ê±°ë‚˜ ìˆ˜ëª…ì´ ì§§ì€ ë°ì´í„°ì— ì£¼ë¡œ ì‚¬ìš©í•œë‹¤. ë§ì´ ë´ì™”ë˜ ì¼€ì´ìŠ¤ëŠ” ìºì‹œë‚˜ ì¥ë°”êµ¬ë‹ˆ ì •ë³´, ì„¸ì…˜ ì •ë³´ ë“±ì´ ìˆëŠ” ê²ƒ ê°™ë‹¤.\nìœ ì €ê°€ ì²˜ìŒ ì•±ì— ì ‘ì†í•  ë•Œ í•„ìš”í•  ë§Œí•œ ì•Œë¦¼ ê°œìˆ˜ë‚˜ í”¼ë“œ ì •ë³´ë“±ì„ ìºì‹œí•´ë‘ë©´ ì¢€ ë” ë¹¨ë¦¬ ìœ ì €ì—ê²Œ ì •ë³´ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.\nì¥ë°”êµ¬ë‹ˆë‚˜ ì„¸ì…˜ ì •ë³´ ê°™ì€ ê²ƒë“¤ì€ ì˜êµ¬ì ìœ¼ë¡œ í•„ìš”í•œ ë°ì´í„°ê°€ ì•„ë‹ˆë©´ì„œ ì •í•©ì„±ì´ ì—„ì²­ ì¤‘ìš”í•˜ë‹¤ê±°ë‚˜ ê´€ê³„ê°€ ë³µì¡í•œ ë°ì´í„°ê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ê°„ë‹¨í•˜ê²Œ Key-Value DBë¥¼ ì´ìš©í•˜ë©´ ì¢‹ì„ ê²ƒ ê°™ë‹¤.\nâ€œRedis ì¥ë°”êµ¬ë‹ˆâ€ë‚˜ â€œRedis shopping cartâ€ë¡œ êµ¬ê¸€ë§í•˜ë©´ ìë£Œê°€ ê½¤ ë‚˜ì™€ì„œ ë‚˜ì¤‘ì— ì‹œê°„ ë˜ë©´ ì¢€ ë” ì°¾ì•„ë³´ê³ ì‹¶ë‹¤.\nDocument database Document DBëŠ” Key-Valueì™€ ê½¤ë‚˜ ìœ ì‚¬í•˜ì§€ë§Œ Valueì˜ í˜•íƒœê°€ ë‹¨ìˆœí•œ ê°’ì´ë¼ê¸°ë³´ë‹¨ JSONì´ë‚˜ YAML, XML ê°™ì€ Semi structured(ë°˜ì •í˜•) í˜•íƒœë¥¼ ë„ëŠ” ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë§í•œë‹¤.\në¬¸ì„œëŠ” Key-Value ìŒì˜ ì§‘í•©ì´ë¼ê³  ë³¼ ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ ë°ì´í„° í˜•íƒœê°€ ë‹¨ìˆœí•˜ë©´ Key-Value DBë¥¼, ê·¸ë³´ë‹¤ ì¢€ ë” ë³µì¡í•˜ë©´ Document DBë¥¼ ì‚¬ìš©í•˜ëŠ” í¸ì´ë¼ê³  í•œë‹¤. ì—¬ê¸°ì— ì¶”ê°€ì ìœ¼ë¡œ í´ëŸ¬ìŠ¤í„°ê°€ í›¨ì”¬ ì»¤ì§€ê³ , í•œ Keyì— ê´€ë ¨ëœ ì •ë³´ê°€ ë°©ëŒ€í•´ì§€ë©´ Columnar DBë¥¼ ë„ì…í•˜ê²Œ ë˜ëŠ” ê²ƒ ê°™ë‹¤.\nDocument DBëŠ” ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì™€ë„ ìœ ì‚¬í•œ ê°œë…ì„ ê°–ê¸°ë„ í•œë‹¤.\nê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì—ì„œëŠ” Row, ë¬¸ì„œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œëŠ” ë¬¸ì„œê°€ ì¡´ì¬ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì—ì„œëŠ” Rowì˜ ì§‘í•©ì¸ í…Œì´ë¸”, Document DBì—ì„œëŠ” ë¬¸ì„œì˜ ì§‘í•©ì¸ ì»¬ë ‰ì…˜ì´ ì¡´ì¬ ë‹¨, ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ëŠ” ê°™ì€ í…Œì´ë¸” ë‚´ì˜ Rowë“¤ì´ ëª¨ë‘ ë™ì¼í•œ í˜•íƒœë¥¼ ê°–ë„ë¡ ìŠ¤í‚¤ë§ˆë¥¼ ê°•ì œí•œë‹¤. ë¬¸ì„œ ë°ì´í„°ë² ì´ìŠ¤ëŠ” ê°™ì€ ì»¬ë ‰ì…˜ ë‚´ì˜ ë¬¸ì„œë“¤ì´ ì–¼ë§ˆë“ ì§€ ë‹¤ë¥¸ í˜•íƒœë¥¼ ê°€ì§ˆ ìˆ˜ ìˆë‹¤! Document DBëŠ” Unstructured dataê°€ ì•„ë‹Œ ê·¸ë‚˜ë§ˆ ì¡°ê¸ˆì€ êµ¬ì¡°ê°€ ì¡´ì¬í•˜ëŠ” Semi structured dataë¥¼ ì €ì¥í•˜ê¸° ë•Œë¬¸ì— ì¢€ ë” ë‹¤ì–‘í•œ ì§ˆì˜ê°€ ê°€ëŠ¥í•˜ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ Keyê°€ ì•„ë‹Œ ì†ì„±ì„ ë°”íƒ•ìœ¼ë¡œë„ ì§ˆì˜ë¥¼ í•  ìˆ˜ ìˆê³ , ì¸ë±ìŠ¤ë¥¼ ê±¸ ìˆ˜ë„ ìˆë‹¤.\në‹¨ RDBì™€ ë§ˆì°¬ê°€ì§€ë¡œ ì¸ë±ìŠ¤ ì„¤ì •ì„ ë„ˆë¬´ ì ê²Œ í•˜ë©´ ì½ê¸° ì„±ëŠ¥ì´ ë‚˜ë¹ ì§ˆ ìˆ˜ ìˆê³ , ì¸ë±ìŠ¤ ì„¤ì •ì„ ë„ˆë¬´ ë§ì´ í•˜ë©´ ì“°ê¸° ì„±ëŠ¥ì´ ë‚˜ë¹ ì§ˆ ìˆ˜ ìˆë‹¤.\nBI(Business Intelligence)ë‚˜ ì¼ë°˜ì ì¸ ì›¹ ì„œë¹„ìŠ¤ëŠ” Write ë³´ë‹¤ Readê°€ í›¨ì”¬ ë§ë‹¤. ë°˜ë©´ ë¡œê·¸ì„± ë°ì´í„°ë“¤ì€ Writeê°€ Readë³´ë‹¤ í›¨ì”¬ ë§ë‹¤.\në§Œì•½ Readì™€ Writeê°€ ë‘˜ ë‹¤ ë§ìœ¼ë©´ì„œë„ ì§§ì€ Latencyê°€ ì¤‘ìš”í•˜ë‹¤ë©´ Writeìš©ìœ¼ë¡œëŠ” ë‹¨ìˆœ ì ì¬í˜• ë°ì´í„°ë² ì´ìŠ¤ì™€ Read ìš©ìœ¼ë¡œëŠ” ìˆ˜ë§ì€ ì¸ë±ìŠ¤ë¥¼ ì§€ì›í•˜ê¸° ìš©ì´í•œ ë°ì´í„° ì›¨ì–´í•˜ìš°ìŠ¤ ë“±ì„ ì´ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤. ì¦‰ ì–´ëŠ í•œ ê°€ì§€ DBë§Œì„ ì„ íƒí•  ê²ƒì´ ì•„ë‹ˆë¼ ê° DBë¥¼ ê° í•„ìš”í•œ ìƒí™©ì— ì ìš©í•  ìˆ˜ë„ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤. ì£¼ë¡œ ì“°ê¸° ì‘ì—…ì— ìµœì í™”ëœ DBì˜ ë‚´ìš©ì´ ì½ê¸° ì‘ì—…ì— ìµœì í™”ëœ DBë¡œ ì „ë‹¬ë˜ë„ë¡ êµ¬ì¶•í•œ ë’¤ ì“°ê¸° ì‘ì—…ê³¼ ì½ê¸° ì‘ì—…ì„ ê°ê° ë‹¤ë¥¸ DBë¥¼ ì´ìš©í•˜ëŠ” í˜•íƒœê°€ ë§ì´ ì‚¬ìš©ëœë‹¤ê³  í•œë‹¤.\në¬¸ì„œ DBì—ì„œ ê´€ê³„ ë‚˜íƒ€ë‚´ê¸° RDBëŠ” ê´€ê³„ë¥¼ ì£¼ë¡œ í…Œì´ë¸” ê°„ì˜ ì°¸ì¡°ë¥¼ í†µí•´ ë‚˜íƒ€ë‚¸ë‹¤. ê´€ê³„ì˜ ì¢…ë¥˜ì—ëŠ” 1 ëŒ€ 1, 1 ëŒ€ ë‹¤, ë‹¤ ëŒ€ ë‹¤ê°€ ìˆë‹¤.\n1 ëŒ€ 1ê³¼ 1 ëŒ€ N ê´€ê³„ 1ì—ì„œ ì™„ì „íˆ ìƒëŒ€ 1ì´ë‚˜ ìƒëŒ€ N ì„ ì™„ì „íˆ ì„œë¸Œ ë¬¸ì„œ í˜•íƒœë¡œ ì •ì˜ë¥¼ í•  ìˆ˜ ìˆë‹¤. M ëŒ€ N ê´€ê³„ í•œ ìª½ì´ í•œ ìª½ì„ ì™„ì „íˆ í¬í•¨í•  ìˆ˜ëŠ” ì—†ì–´ ê²°êµ­ì—” ë‘ ê°œì˜ ì»¬ë ‰ì…˜ì´ í•„ìš”í•˜ë‹¤. ìì‹ ê³¼ ê´€ë ¨ëœ ìƒëŒ€ë°© ì •ë³´ëŠ” ê°ìê°€ ì €ì¥í•˜ê¸° ë•Œë¬¸ì— ì–‘ìª½ì— ë°ì´í„°ê°€ ìµœì‹ í™”ë˜ê³  ì°¸ì¡° ë¬´ê²°ì„±ì„ ë³´ì¥í•˜ë„ë¡ ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ì—ì„œ ì˜ ì²˜ë¦¬í•´ì•¼í•œë‹¤. ì±…ì—ëŠ” ìì‹ ê³¼ ê´€ë ¨ëœ ìƒëŒ€ ë¬¸ì„œë“¤ì˜ IDë¥¼ ë¦¬ìŠ¤íŠ¸ë¡œ ê´€ë¦¬í•´ ì°¸ì¡°í•˜ë„ë¡ ë‚˜ì™€ìˆëŠ”ë° ì´ ê²½ìš°ì—ë„ ì¤‘ì²© ë¬¸ì„œì˜ í˜•íƒœë¡œ ë‚˜íƒ€ë‚¼ ìˆ˜ëŠ” ìˆì„ ê²ƒì´ë¼ ìƒê°í•œë‹¤. ê°„ë‹¨íˆ Key-Value DB, Document DBì— ëŒ€í•´ ì•Œì•„ë´¤ë‹¤. ì´ì œëŠ” NoSQLì—ì„œ ë…¸ë“œì˜ ì—­í• ì€ ì–´ë–¤ ê²ƒë“¤ì´ ìˆì„ì§€, ê° ë…¸ë“œë“¤ì€ ì–´ë–¤ ë°ì´í„°ë“¤ì„ ì–´ë–¤ ë¡œì§ì— ì˜í•´ ë‹´ë‹¹í•˜ê²Œ ë˜ëŠ”ì§€ ì •ë¦¬í•´ë³´ë ¤í•œë‹¤.\në¬¸ì„œ DBëŠ” ì–¸ì œ ì‚¬ìš©í•˜ë©´ ì¢‹ì„ê¹Œ? ë°ì´í„° í˜•íƒœê°€ Key-Valueì— ì €ì¥í•  ì •ë„ë¡œ ê°„ë‹¨í•˜ì§€ëŠ” ì•Šì€ ê²½ìš° Key ë§Œìœ¼ë¡œ ì¡°íšŒ ìš”êµ¬ì‚¬í•­ì„ ì¶©ì¡±í•  ìˆ˜ ì—†ëŠ” ê²½ìš° ACID íŠ¸ëœì­ì…˜ê¹Œì§€ëŠ” í•„ìš”í•˜ì§€ ì•Šì€ ê²½ìš° ë°ì´í„°ì˜ í˜•íƒœê°€ ì •í˜•í™”ë˜ì§€ ì•Šê³  ì¡°ê¸ˆì”©ì€ ë‹¬ë¼ì„œ Schemaë¥¼ ì¤€ìˆ˜í•˜ê¸° í˜ë“  ê²½ìš° ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ë¡œëŠ” ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” í•œê³„ê°€ ìˆì–´ ìˆ˜í‰ Scaleì´ í•„ìš”í•  ì •ë„ì¸ ê²½ìš° ìš”ì²­ì´ ìŸì•„ì§€ëŠ” ê²Œ ì•„ë‹ˆë¼ë©´ ì‚¬ì‹¤ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ë¡œ ë§ì€ ìƒí™©ë“¤ì„ í•´ê²°í•  ìˆ˜ ìˆê³  ê·¸ ê²½ìš° ì•„ì§ì€ ë‚˜ëŠ” ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ì„ í˜¸í•œë‹¤. ì•„ë¬´ë˜ë„ ì—­ì‚¬ê°€ ê¹Šì–´ì„œ ë ˆí¼ëŸ°ìŠ¤ë„ ë§ê³  í¸ë¦¬í•œ ORM ë„êµ¬ë“¤ë„ ë§ê¸° ë•Œë¬¸ì´ë‹¤.\ní•˜ì§€ë§Œ ê³ ì •ëœ ìŠ¤í‚¤ë§ˆë¥¼ ì¤€ìˆ˜í•˜ê¸° í˜ë“¤ê±°ë‚˜ ìˆ˜í‰ scaleì´ í•„ìš”í•œ ê²½ìš°ì—ëŠ” ë¬¸ì„œ DBë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” ì ì ˆí•˜ë‹¤. ì˜ˆë¥¼ ë“¤ë©´ ê²Œì‹œíŒ, ëŒ“ê¸€, ì±„íŒ… ë©”ì‹œì§€ë“±ì´ ë  ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.\në°˜ë©´ ì£¼ë¬¸ì´ë‚˜ ê²°ì œ ë‚´ì—­, ì¬ê³  ìƒí™© ê°™ì€ ë°ì´í„°ë“¤ì€ ACID íŠ¸ëœì­ì…˜ì´ í•„ìš”í•  ìˆ˜ ìˆì–´ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²Œ ì¢‹ì„ ê²ƒ ê°™ë‹¤.\nRDBì—ì„œ ë§ì´ ì‚¬ìš©ë˜ëŠ” ë§ˆìŠ¤í„°-ìŠ¬ë ˆì´ë¸Œ(Read Replica) êµ¬ì¡° ì“°ê¸° ê¶Œí•œì´ ìˆëŠ” Master nodeëŠ” ì—¬ì „íˆ í•œ ëŒ€, Master nodeë¥¼ ë³µì œí•´ Read ìš”ì²­ë§Œ ì²˜ë¦¬í•˜ëŠ” ReplicaëŠ” ì—¬ëŸ¬ ëŒ€ ë‘˜ ìˆ˜ ìˆëŠ” êµ¬ì¡° ì—¬ëŸ¬ ì„œë²„ë¥¼ í•˜ë‚˜ì˜ ì„œë²„ì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í˜•íƒœì¸ í´ëŸ¬ìŠ¤í„° í˜•íƒœ ì¹˜ê³ ëŠ” ê·¸ë‚˜ë§ˆ ë‹¨ìˆœí•˜ë‹¤. ì“°ê¸°ì— ë¹„í•´ ì½ê¸° ìš”ì²­ì´ ì›”ë“±íˆ ë§ì€ ê²½ìš° ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤! ë…¸ë“œ ê°„ í†µì‹ ì´ ë§ì´ í•„ìš” ì—†ê³  ì£¼ë¡œ ë³µì œë¥¼ ìœ„í•´ ë§ˆìŠ¤í„° â†” ìŠ¬ë ˆì´ë¸Œê°„ì˜ í†µì‹ ë§Œ í•˜ë©´ ë˜ëŠ” ê²½ìš°ê°€ ë§ë‹¤. Columnar DBì˜ ê²½ìš° ë‹¤ìˆ˜ì˜ ë§ˆìŠ¤í„°ê°€ ì¡´ì¬í•  ìˆ˜ ìˆê³ , ì´ ê²½ìš° ìƒíƒœ ì²´í¬ë¥¼ ìœ„í•´ ë‹¤ìˆ˜ì˜ ë§ˆìŠ¤í„° ë…¸ë“œ ê°„ì— í†µì‹ ì´ í•„ìš”í•˜ê³ , ì´ë¥¼ ìœ„í•´ â€œê°€ì‹­ í”„ë¡œí† ì½œâ€ ê°™ì€ í”„ë¡œí† ì½œì´ ì¡´ì¬í•˜ê¸°ë„ í•œë‹¤. ë‚˜ëŠ” AWSë¥¼ ì£¼ë¡œ ì‚¬ìš©í•´ì˜¨í„°ë¼ RDSë¥¼ ë‹¤ë£° ë•Œì—ëŠ” Read replica ì–˜ê¸°ê°€ ë¹ ì§ ì—†ì´ ë“±ì¥í•´ì„œ ì¹œìˆ™í–ˆë‹¤. RDBëŠ” ì›ë˜ ìˆ˜í‰ì  Scaleì´ í˜ë“  í¸ì´ë‹¤. ì—„ê²©íˆë„ ì¼ê´€ì„±ì„ ì¤‘ìš”ì‹œí•˜ë‹¤ë³´ë‹ˆ ë¶„ì‚° í™˜ê²½ì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ê²½ìš°ê°€ ë§ì€ ê²ƒ ê°™ê³ (í™•ì‹¤í•˜ì§„ ì•ŠìŒ ã…ã…) ì§€ì›í•œë‹¤í•´ë„ ë…¸ë“œ ìˆ˜ê°€ ì¦ê°€í•¨ì— ë”°ë¼ ì„±ëŠ¥ë„ ì„ í˜•ì ìœ¼ë¡œ ì¦ê°€í•˜ê¸°ëŠ” í˜ë“¤ë‹¤. ê·¸ë˜ë„ RDBì—ì„œì˜ ìˆ˜í‰ì  Scaleì— ëŒ€í•œ ë‹ˆì¦ˆë„ ë§ì´ ì¡´ì¬í•˜ë‹¤ë³´ë‹ˆ ìš”ì¦˜ì€ AWSì—ì„œë„ Auroraì— Multi master ê¸°ëŠ¥ì„ ë¶™ì´ê±°ë‚˜ RDSì—ë„ ìµœëŒ€ 15ê°œ ê°ˆì´ì˜ Read Replicaë¥¼ ì§€ì›í•˜ê¸°ë„ í•œë‹¤.\ní•˜ì§€ë§Œ ì•„ë¬´ë˜ë„ RDBì˜ ì—„ê²©í•œ ì¼ê´€ì„±ì´ ê°–ëŠ” í•œê³„ë¥¼ ì™„ì „íˆ ë–¨ì³ë‚¼ ìˆ˜ëŠ” ì—†ê¸° ë•Œë¬¸ì¼ì§€ ì†ê°€ë½ ë°œê°€ë½ í•©ì³ì„œ ì…€ ìˆ˜ ìˆëŠ” ê°œìˆ˜ ì •ë„ ê¹Œì§€ë§Œ ìˆ˜í‰ Scaleì´ ê°€ëŠ¥í•œ ê²ƒ ê°™ë‹¤.\nê·¸ ê°œìˆ˜ë¥¼ NoSQL ì¤‘ í•˜ë‚˜ì¸ Redisì™€ ë¹„êµí•´ë³´ì. Redisì˜ ê²½ìš°ëŠ” 1000ê°œì˜ ë§ˆìŠ¤í„° ë…¸ë“œê¹Œì§€ë„ ì„ í˜•ì ìœ¼ë¡œ ì„±ëŠ¥ì´ ì¦ê°€í•œë‹¤ê³  í•œë‹¤. ì„ í˜•ì ì¸ ì¦ê°€ë¥¼ ì¡°ê±´ìœ¼ë¡œ í–ˆì„ ë•Œ ìµœëŒ€ 1000ê°œì˜ ë§ˆìŠ¤í„°ì¸ ê²ƒì´ì§€ ì•½ 16,000ì—¬ê°œì˜ ë§ˆìŠ¤í„°ê¹Œì§€ë„ ëŠ˜ë¦´ ìˆ˜ëŠ” ìˆê¸´í•˜ë‹¤. ê²Œë‹¤ê°€ ê° ë§ˆìŠ¤í„° ë…¸ë“œì— ëŒ€í•œ ìŠ¬ë ˆì´ë¸Œê¹Œì§€ êµ¬ì„±í•  ìˆ˜ ìˆìœ¼ë‹ˆ ì–¼ë§ˆë‚˜ í™•ì¥ì„±ì—ì„œ ì°¨ì´ê°€ ë‚˜ëŠ”ì§€ ì–´ëŠ ì •ë„ ì‹¤ê°í•  ìˆ˜ ìˆë‹¤.\níŒŒí‹°ì…”ë‹ (Partitioning) íŒŒí‹°ì…”ë‹ì´ë€ ë¬´ì–¸ê°€ë¥¼ ë¶„ë¦¬í•˜ëŠ” ì‘ì—…ì„ ë§í•˜ëŠ”ë° ë°ì´í„°ë² ì´ìŠ¤ì—ì„œëŠ” ì£¼ë¡œ ë°ì´í„°ë¥¼ ë¶„ë¦¬í•´ì„œ ì €ì¥í•˜ëŠ” ê²½ìš°ë¥¼ ë§í•œë‹¤.\nìˆ˜ì§ íŒŒí‹°ì…”ë‹ - í•œ í…Œì´ë¸”ì„ ì—¬ëŸ¬ ê°€ìƒì˜ í…Œì´ë¸”ë¡œ ë¶„ë¦¬í•´ì„œ ì €ì¥í•˜ëŠ” ê²ƒ ìˆ˜í‰ íŒŒí‹°ì…”ë‹ - partition keyë¥¼ ë°”íƒ•ìœ¼ë¡œ ë¶„ì‚°í•˜ì—¬ ê·¸ì— í•´ë‹¹í•˜ëŠ” ê°’ì„ ì €ì¥í•˜ëŠ” ê²ƒ íŒŒí‹°ì…”ë‹ ì˜ˆì‹œ RDBì—ì„œëŠ” ì£¼ë¡œ ìˆ˜ì§ íŒŒí‹°ì…”ë‹ë§Œì„ ì§€ì›í•˜ê³ , NoSQLì—ì„œëŠ” êµ³ì´ ìˆ˜ì§ íŒŒí‹°ì…”ë‹ì„ ì´ìš©í•˜ê¸°ë³´ë‹¨ ìˆ˜í‰ íŒŒí‹°ì…”ë‹ì„ ì´ìš©í•˜ëŠ” ê²½ìš°ê°€ ë§ë‹¤. (ì™œ NoSQLì—ì„œëŠ” ìˆ˜í‰ íŒŒí‹°ì…”ë‹ì„ ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ì§€ëŠ” ì˜ ëª¨ë¥´ê² ë‹¤.)\nRDBì—ì„œëŠ” ìˆ˜ì§ íŒŒí‹°ì…”ë‹ì„ í†µí•´ ìì£¼ í•¨ê»˜ ì ‘ê·¼í•˜ëŠ” ì»¬ëŸ¼ë“¤ì€ì€ SSD íŒŒí‹°ì…˜ì— ì €ì¥í•˜ê³ , ì˜ ì ‘ê·¼í•˜ì§€ ì•ŠëŠ” ì»¬ëŸ¼ë“¤ì€ HDD íŒŒí‹°ì…˜ì— ì €ì¥í•˜ëŠ” ê²ƒ ê°™ë‹¤.\nNoSQLì—ì„œëŠ” ì£¼ë¡œ Partition keyë¡œ ë°ì´í„°ê°€ ì €ì¥ë  ë…¸ë“œê°€ ê²°ì •ë˜ê³  ê·¸ ë…¸ë“œì— ë°ì´í„°ë¥¼ ì €ì¥í•œë‹¤.\nìƒ¤ë”© (Sharding) ê·¸ì¤‘ì—ì„œë„ ìˆ˜í‰ íŒŒí‹°ì…”ë‹ì€ ìƒ¤ë”©ì´ë¼ëŠ” ë˜ ë‹¤ë¥¸ ì´ë¦„ì„ ê°–ê³  ìˆë‹¤.\nAWS ElasticCacheì˜ Shard. ì¶œì²˜: https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/Shards.html íŒŒí‹°ì…˜ í‚¤(ìƒ¤ë“œ í‚¤)ë¥¼ í†µí•´ ê·¸ í‚¤ì— ëŒ€í•œ ë°ì´í„°ë¥¼ ë‹´ë‹¹í•˜ëŠ” ë…¸ë“œ ê·¸ë£¹ì„ ìƒ¤ë“œë¼ê³  í•˜ê³ , í•œ ìƒ¤ë“œëŠ” Primary ë…¸ë“œë§Œ ì¡´ì¬í•  ìˆ˜ë„ ìˆê³  Read replicaë“¤ë„ ì¡´ì¬í•  ìˆ˜ë„ ìˆë‹¤.\nê·¸ëŸ¼ íŒŒí‹°ì…˜ í‚¤ë¼ëŠ” ë†ˆì„ ë°”íƒ•ìœ¼ë¡œ ë°ì´í„°ê°€ ì–´ë””ì— ì €ì¥ë  ì§€ë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ì–´ë–»ê²Œ ê²°ì •í•˜ëŠ” ê±¸ê¹Œ?\nRange Partitioning - íŒŒí‹°ì…˜ í‚¤ì˜ êµ¬ê°„ì— ë”°ë¼ ì–´ë–¤ ë…¸ë“œê°€ ë‹´ë‹¹í•  ì§€ë¥¼ ë¯¸ë¦¬ ì„ ì–¸í•´ë†“ê³ , ì´ë¥¼ ì°¸ì¡°í•˜ì—¬ ìƒ¤ë“œë¥¼ ì •í•œë‹¤. Hash Partitioning - íŒŒí‹°ì…˜ í‚¤ë¥¼ ì¸ìë¡œ í•´ì‹± í•¨ìˆ˜ë¥¼ ìˆ˜í–‰í•´ ì–»ì–´ì§€ëŠ” ê²°ê³¼ê°’ì„ ìƒ¤ë“œë¡œ ì •í•œë‹¤. ì£¼ë¡œ ë§ì´ ì‚¬ìš©ë˜ëŠ” ì ‘ê·¼ë²•ì€ Range ê¸°ë°˜ê³¼ Hash ê¸°ë°˜ ë‘ ê°€ì§€ì´ë‹¤.\nRange Partitioning Range partitioningì€ ì•„ë˜ì™€ ê°™ì´ ë¯¸ë¦¬ íŒŒí‹°ì…˜ í‚¤ì˜ êµ¬ê°„ì— ë”°ë¼ ì–´ë–¤ ë…¸ë“œê°€ ë‹´ë‹¹í• ì§€ë¥¼ ë¯¸ë¦¬ ì„ ì–¸í•´ì•¼í•œë‹¤. ìƒ¤ë“œê°€ 4ê°œ ì¡´ì¬í•œë‹¤ê³  í•˜ê² ë‹¤.\nid: 1 ~ id: 1000ì€ 1ë²ˆ ìƒ¤ë“œê°€ ë‹´ë‹¹ id: 1001 ~ id: 2000ì€ 2ë²ˆ ìƒ¤ë“œê°€ ë‹´ë‹¹ id: 2001 ~ id: 3000ì€ 3ë²ˆ ìƒ¤ë“œê°€ ë‹´ë‹¹ id: 3001 ~ id: 4000ì€ 4ë²ˆ ìƒ¤ë“œê°€ ë‹´ë‹¹ ì•„ì£¼ ì§ê´€ì ì´ê³  ê°„ë‹¨í•˜ë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤.\ní•˜ì§€ë§Œ ë‹¨ì ë„ ì¡´ì¬í•œë‹¤. ì˜ˆìƒí•˜ì§€ ëª»í•œ íŒŒí‹°ì…˜ í‚¤(4000 \u0026lt; id)ì¸ id: 4001ì¸ ë°ì´í„°ê°€ ë“±ì¥í•˜ê²Œ ë˜ë©´ ì–´ë–»ê²Œ ë ê¹Œ? ì˜¬ë°”ë¥´ê²Œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ì§€ ëª»í•  ìˆ˜ ìˆë‹¤.\në˜í•œ 1ë²ˆ, 2ë²ˆ ìƒ¤ë“œëŠ” ë¹„êµì  ì˜¤ë˜ëœ ìœ ì €ì— ëŒ€í•œ ë°ì´í„°ì´ê³  3, 4ë²ˆ ìƒ¤ë“œëŠ” ìµœê·¼ ìœ ì… ìœ ì €ì— ëŒ€í•œ ë°ì´í„°ë¼ ê° ìƒ¤ë“œë“¤ì— ëŒ€í•œ ìš”ì²­ì˜ ìˆ˜ê°€ ìƒì´í•˜ë‹¤ë©´ ì–´ë–»ê²Œ ë ê¹Œ? ì˜¬ë°”ë¥´ê²Œ ìš”ì²­ì´ ë¶„ì‚°ë˜ì§€ ëª»í•˜ê³  íŠ¹ì • ìƒ¤ë“œë“¤ì—ê²Œë§Œ ì§‘ì¤‘ë  ìˆ˜ ìˆë‹¤ëŠ” ë¬¸ì œê°€ ìˆë‹¤.\në˜í•œ ê²°êµ­ì€ ì–´ë”˜ê°€ì— ì´ Range í• ë‹¹ ì •ë³´ë¥¼ ì €ì¥í•˜ê³  ê·¸ê²ƒì„ ì¡°íšŒí•´ì•¼í•œë‹¤. ê³µí†µìœ¼ë¡œ í•„ìš”í•œ ë°ì´í„°ê°€ ì–´ëŠ í•œ ê³³ì— ì €ì¥ë˜ì–´ì•¼í•œë‹¤ëŠ” ë¶€ë¶„ì—ì„œ ìš”ì²­ì´ ì¦ê°€í•˜ê³  ìƒ¤ë“œë„ í™•ì¥ë˜ëŠ” ìƒí™©ì—ì„œ ì´ëŸ° Range í• ë‹¹ ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” ì¸¡ì´ ë³‘ëª©ì´ ë  ìˆ˜ë„ ìˆë‹¤.\nHash Partitioning Hash partitioningì€ Range partitioningê³¼ ë‹¬ë¦¬ ì–´ë–¤ ìƒ¤ë“œê°€ ì–´ë–¤ íŒŒí‹°ì…˜ í‚¤ë¥¼ ë‹´ë‹¹í•˜ëŠ”ì§€ì— ëŒ€í•œ ë§¤í•‘ í…Œì´ë¸”ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤. ìš”ì²­ìì¸¡ì—ì„œ Hash í•¨ìˆ˜ë¥¼ ìˆ˜í–‰í•œ ê²°ê³¼ê°’ìœ¼ë¡œ ìì‹ ì´ ìš”ì²­í•´ì•¼í•˜ëŠ” ë…¸ë“œë¥¼ ìœ ì¶”í•  ìˆ˜ ìˆë‹¤.\nì˜ˆë¥¼ ë“¤ì–´ Range partitioningê³¼ ê°™ì´ ìƒ¤ë“œê°€ 4ê°œ ì¡´ì¬í•œë‹¤ê³  í•´ë³´ì\nid % 4 == 1 ì´ë©´ 1ë²ˆ ìƒ¤ë“œê°€ ë‹´ë‹¹ id % 4 == 2 ì´ë©´ 2ë²ˆ ìƒ¤ë“œê°€ ë‹´ë‹¹ id % 4 == 3 ì´ë©´ 3ë²ˆ ìƒ¤ë“œê°€ ë‹´ë‹¹ id % 4 == 0 ì´ë©´ 4ë²ˆ ìƒ¤ë“œê°€ ë‹´ë‹¹ í´ë¼ì´ì–¸íŠ¸ì— í•„ìš”í•œ ì •ë³´ëŠ” ìƒ¤ë“œ ê°œìˆ˜ ë¿ì´ë‹¤. id=4001ì¸ ë°ì´í„°ê°€ ë“±ì¥í•´ë„ 4001 % 4ëŠ” 1ì´ë¯€ë¡œ 1ë²ˆ ìƒ¤ë“œê°€ ë‹´ë‹¹í•˜ë©´ ëœë‹¤.\nì§€ê¸ˆ ì˜ˆì‹œì—ì„œëŠ” Partition keyê°€ idë¡œ numericí•œ ê°’ì„ ê°–ê¸° ë•Œë¬¸ì— hash í•¨ìˆ˜ë¥¼ ê±°ì¹˜ì§€ ì•Šê³  ëª¨ë“ˆëŸ¬ ì—°ì‚°ë§Œìœ¼ë¡œë„ ì›í™œíˆ ë™ì‘í•˜ëŠ” ê²ƒ ê°™ì§€ë§Œ ì‹¤ì œë¡œëŠ” non-numericí•œ ê°’ë“¤ì— ëŒ€í•´ì„œë„ ì§€ì›í•˜ê³  ê³¨ê³ ë£¨ ë°ì´í„°ê°€ ë¶„ì‚°ë  ìˆ˜ ìˆë„ë¡ í•˜ê¸° ìœ„í•´ í•´ì‹± í•¨ìˆ˜ë“¤ì„ ì‚¬ìš©í•œë‹¤.\në‹¨ Hashing partitioningì—ë„ ë‹¨ì ì´ ì¡´ì¬í•˜ëŠ”ë° ë°”ë¡œ ìˆ˜í‰ Scaleì‹œì— ê° ìƒ¤ë“œê°€ ë‹´ë‹¹í•˜ëŠ” ë°ì´í„°ê°€ ìƒì´í•´ì§ˆ ìˆ˜ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ë©´ ë…¸ë“œê°€ 2ëŒ€ â†’ 4ëŒ€ë¡œ ì¦ê°€í•˜ëŠ” ê²½ìš°ë¥¼ ì˜ˆë¡œ ë“¤ì–´ë³´ê² ë‹¤.\nê¸°ì¡´ (ë…¸ë“œ 2ëŒ€) id = 1 â†’ 1ë²ˆ ë…¸ë“œ id = 2 â†’ 2ë²ˆ ë…¸ë“œ id = 3 â†’ 1ë²ˆ ë…¸ë“œ id = 4 â†’ 2ë²ˆ ë…¸ë“œ ìˆ˜í‰ Scale í›„ (ë…¸ë“œ 4ëŒ€) id = 1 â†’ 1ë²ˆ ë…¸ë“œ id = 2 â†’ 2ë²ˆ ë…¸ë“œ id = 3 â†’ 1ë²ˆ ë…¸ë“œ 3ë²ˆ ë…¸ë“œ id = 4 â†’ 2ë²ˆ ë…¸ë“œ 4ë²ˆ ë…¸ë“œ ìœ„ì™€ ê°™ì´ ë°ì´í„°ë¥¼ ë‹´ë‹¹í•˜ëŠ” ìƒ¤ë“œë“¤ì´ ë§ì´ ë³€ê²½ë˜ì–´ rebalanceê°€ í•„ìš”í•˜ë‹¤ëŠ” ì–´ë ¤ì›€ì´ ì¡´ì¬í•œë‹¤. ê²Œë‹¤ê°€ ì´ ì–´ë ¤ì›€ì€ Scale out ë•Œ ë¿ë§Œ ì•„ë‹ˆë¼ Scale in ì‹œì—ë„ ì¡´ì¬í•˜ê¸°ë„ í•œë‹¤.\nì´ëŸ° rebalance ê³¼ì •ì„ ì¢€ ë” ìµœì í™”í•˜ê¸° ìœ„í•´ consistent hashingì´ë¼ëŠ” ê°œë…ì´ ì¡´ì¬í•˜ê³  ì´ì— ëŒ€í•œ êµ¬í˜„ì²´ë¡œ virtual nodeë“¤ì„ ë‘ëŠ” ketama consistent hashingë„ ì¡´ì¬í•œë‹¤. ì´ì— ëŒ€í•´ì„œëŠ” ì±…ì— ê¹Šê²Œ ë“±ì¥í•˜ì§„ ì•Šê³  êµ¬ê¸€ë§ìœ¼ë¡œ ë§ì€ ìë£Œë¥¼ ì°¾ì•„ë³¼ ìˆ˜ ìˆê¸°ì— ì´ë²ˆ ê¸€ì—ì„œëŠ” ìƒëµí•˜ë„ë¡ í•˜ê² ë‹¤.\në§ˆì¹˜ë©° Key-Value ë°ì´í„°ë² ì´ìŠ¤ì™€ Document ë°ì´í„°ë² ì´ìŠ¤ì˜ íŠ¹ì§•ì— ëŒ€í•´ ì ì–´ë´¤ë‹¤.\nì±… ë‚´ìš©ì„ ìŠì–´ë²„ë¦¬ê¸° ì „ì— í•œ ë²ˆ ì •ë¦¬í•´ë³´ë©´ì„œ ë³µìŠµí•˜ë ¤í–ˆì—ˆëŠ”ë° ì‚´ì§ ê¹Œë¨¹ì–´ê°€ë˜ ë‚´ìš©ì´ë‚˜ ëŒ€ì¶© ì½ê³  ë„˜ì–´ê°„ ë¶€ë¶„ì— ëŒ€í•´ì„œë„ ì ê²€í•´ë³¼ ìˆ˜ ìˆì—ˆë˜ ê²ƒ ê°™ë‹¤.\n( ì±… ë‚´ìš© ë¿ë§Œ ì•„ë‹ˆë¼ ë‚˜ì¤‘ì— ë³µìŠµí•  ìš©ë„ë¡œ ì œê°€ ê¸°ì¡´ì— ì•Œê³  ìˆë˜ ë‚´ìš©ì´ë‚˜ ì£¼ê´€ì ì¸ ì˜ê²¬ë“¤ë„ ì¡°ê¸ˆì”© ì ì–´ë†¨ìŠµë‹ˆë‹¤. ì˜ëª»ëœ ë‚´ìš©ì´ë¼ ìƒê°ë˜ëŠ” ë¶€ë¶„ì´ ìˆìœ¼ì‹œë©´ ì•Œë ¤ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! )\n","date":"2022-03-12T15:30:54+09:00","image":"https://umi0410.github.io/blog/computer-science/book-review-nosql-introduction-2/partitioning_huae423b6d1a3ea56410a819f008ee156e_828970_120x120_fill_box_smart1_3.png","permalink":"https://umi0410.github.io/blog/computer-science/book-review-nosql-introduction-2/","title":"(ë„ì„œ) \"NoSQL ì² ì € ì…ë¬¸\" - Key-Value ë°ì´í„°ë² ì´ìŠ¤, ë¬¸ì„œ ë°ì´í„°ë² ì´ìŠ¤"},{"content":"ì±…ì„ ì½ê²Œ ëœ ê³„ê¸° ë‹¹ê·¼ë§ˆì¼“ í”Œë«í¼ íŒ€ì˜ ì„œë²„ ì—”ì§€ë‹ˆì–´ë¡œ ì§€ì›í•˜ê³  ë©´ì ‘ì„ ë³´ë©´ì„œ ì €ì¥ì†Œì— ê´€ë ¨í•œ ì§ˆë¬¸ì„ ë§ì´ ë°›ì•˜ì—ˆë‹¤. ì €ì¥ì†ŒëŠ” ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ë‚˜ ë‹¤ì–‘í•œ NoSQL ë°ì´í„°ë² ì´ìŠ¤ë“¤ì„ ì˜ë¯¸í•œë‹¤ê³  í•  ìˆ˜ ìˆê² ë‹¤.\në§ì€ ì§ˆë¬¸ë“¤ì´ ë‚˜ì™”ê³ , ë‹¹ì‹œì˜ ë‚˜ëŠ” ì‚¬ì‹¤ ë°ì´í„°ë² ì´ìŠ¤ ìª½ ì§€ì‹ì€ ê±°ì˜ ì „ë¬´í–ˆë˜ ê²ƒ ê°™ì•„ ì œëŒ€ë¡œ ëŒ€ë‹µì„ ëª»í•œ ê²Œ ë§ì•˜ë˜ ê²ƒ ê°™ë‹¤. ì¸í„´ ê·¼ë¬´ë¥¼ í•˜ë©´ì„œëŠ” ë‚´ê°€ ìµìˆ™í–ˆë˜ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ê°€ ì•„ë‹Œ NoSQL íŠ¹íˆ Redisë‚˜ DynamoDB ë“±ì„ ì£¼ë¡œ ì‚¬ìš©í•˜ëŠ” ëª¨ìŠµë„ ë§ì´ ë³´ê²Œ ë˜ì–´ NoSQLì— ëŒ€í•´ ê´€ì‹¬ì´ ê°€ê²Œ ë˜ì—ˆë‹¤.\nâ€˜ì™œ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ëŠ” ìˆ˜í‰ Scaleì´ ì–´ë µë‹¤ê³ ë“¤ í•˜ëŠ”ê±°ì§€?â€™, â€˜ì™œ NoSQLì€ ìˆ˜í‰ Scaleì´ ìš©ì´í•˜ì§€?â€™\nâ€˜ì–´ë–¤ ê²½ìš°ì— ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ê°€ ì•„ë‹Œ NoSQLì„ ì‚¬ìš©í•˜ëŠ” ê²Œ ì ì ˆí• ê¹Œ?â€™\nâ€˜ì •ë§ NoSQLì´ì–´ì•¼ë§Œí•˜ëŠ” ê²½ìš°ë“¤ì´ ì¡´ì¬í• ê¹Œ?â€™\nìœ„ì™€ ê°™ì€ ê¶ê¸ˆì¦ì„ ê°–ê³  ìˆì—ˆê³ , ê·¸ëŸ° ë©´ì—ì„œ ë‹¤ì–‘í•œ NoSQL ì±…ë“¤ì„ ì°¾ì•„ë³´ë‹¤ê°€ í•˜ë‚˜ì˜ NoSQLì— ë”¥ë‹¤ì´ë¸Œí•˜ëŠ” ì±…ë³´ë‹¤ëŠ” ë‹¤ì–‘í•œ NoSQL ë°ì´í„°ë² ì´ìŠ¤ë“¤ì´ ì–´ë–¤ íŠ¹ì§•ë“¤ì„ ê°–ëŠ”ì§€ ë¹„êµí•´ì£¼ê³ , ì‹¤ì œ ì‚¬ìš© ì‚¬ë¡€ëŠ” ì–´ë–¤ ê²½ìš°ê°€ ìˆì„ì§€ë¥¼ ì•Œë ¤ì£¼ëŠ” ì±…ì„ ì½ì–´ë³´ê³  ì‹¶ì—ˆë‹¤.\nNoSQLì˜ ê³µí†µëœ íŠ¹ì§• Key-Value, Document, Column family (í˜¹ì€ Columnar) ë¥˜ì˜ NoSQL ë°ì´í„°ë² ì´ìŠ¤ë“¤ì— ëŒ€í•´ì„œëŠ” ì¶”í›„ ê° ê¸€ì—ì„œ ì •ë¦¬í•˜ëŠ” ê²ƒìœ¼ë¡œ í•˜ê³  ì´ë²ˆ ê¸€ì—ì„œëŠ” ì¢€ ë” ì „ë°˜ì ì¸ NoSQLì˜ íŠ¹ì§•ì— ëŒ€í•´ ì •ë¦¬í•˜ë ¤í•œë‹¤.\nNoSQLì€ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ê°€ ì•„ë‹Œ ë°ì´í„°ë² ì´ìŠ¤ë“¤ì„ í†µì¹­í•˜ëŠ” ëª…ì¹­ì´ê¸° ë•Œë¬¸ì— ê°ê°ì´ ë‹¤ì–‘í•œ íŠ¹ì§•ì„ ê°–ì§€ë§Œ íƒ„ìƒ ëª©ì  ìì²´ê°€ SQL ë°ì´í„°ë² ì´ìŠ¤ë¡œ ë§Œì¡±í•  ìˆ˜ ì—†ëŠ” ìœ ì¦ˆì¼€ì´ìŠ¤ë¥¼ ìœ„í•´ì„œ ì˜€ê¸° ë•Œë¬¸ì— SQL ë°ì´í„°ë² ì´ìŠ¤ì˜ ë°˜ëŒ€ë˜ëŠ” ìª½ìœ¼ë¡œëŠ” ê³µí†µì ì¸ íŠ¹ì§•ì„ ê°–ëŠ” í¸ì´ë‹¤.\nê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì™€ NoSQLì€ ì ˆëŒ€ì ìœ¼ë¡œ ëˆ„ê°€ ë” ë‚«ë‹¤ë¥¼ ë¹„êµí•  ì¡´ì¬ë¼ê¸° ë³´ë‹¨ ê°ìê°€ ì ì ˆí•œ ëª©ì ì„ ê°–ëŠ” ìƒí˜¸ ë³´ì™„ì ì¸ ì¡´ì¬ì´ë‹¤!\nSchemaless ACID íŠ¹ì„±ì„ ê°–ì§€ ì•ŠëŠ”ë‹¤. ì¢€ ì–µì§€ ë„¤ì´ë°ì´ê¸´ í•˜ì§€ë§Œ BASE íŠ¹ì„±ì„ ê¸°ë°˜ìœ¼ë¡œ í•œë‹¤. Eventual consistency ë¶„ì‚° ì‹œìŠ¤í…œ, ê³ ê°€ìš©ì„±, ëŒ€ê·œëª¨ íŠ¸ë˜í”½ ì •ê·œí™”ë³´ë‹¨ ë¹„ì •ê·œí™”ì™€ ì¤‘ë³µ ê·¸ëŸ¼ ê° íŠ¹ì§•ì— ëŒ€í•´ ì•Œì•„ë³´ì.\nSchemaless ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ëŠ” ê³ ì •ëœ í…Œì´ë¸” ìŠ¤í‚¤ë§ˆë¥¼ ê°–ê³ , ëª¨ë“  ë ˆì½”ë“œëŠ” ê·¸ ìŠ¤í‚¤ë§ˆ êµ¬ì¡°ë¥¼ ë”°ë¼ì•¼ë§Œí•œë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ë°ì´í„° í˜•íƒœê°€ ê³„ì†í•´ì„œ ë³€ê²½ë  ìˆ˜ ìˆëŠ” ê²½ìš°ì—ëŠ” ë¶ˆí¸í•  ìˆ˜ ìˆë‹¤. ë°ì´í„°ê°€ ì ì„ ë•Œì•¼ ê·¸ëƒ¥ alter table ... ë¡œ ìŠ¤í‚¤ë§ˆë¥¼ ë³€ê²½í•˜ë©´ ê·¸ë§Œì´ê² ì§€ë§Œ ë°ì´í„°ì™€ íŠ¸ë˜í”½ì´ ë§ì€ ì‹¤ì œ í”„ë¡œë•ì…˜ì—ì„œëŠ” ì´ëŸ° ì‘ì—…ì´ ì‰½ì§€ ì•Šë‹¤.\në°˜ë©´ ê±°ì˜ ëª¨ë“  NoSQL ë°ì´í„°ë² ì´ìŠ¤ëŠ” ìŠ¤í‚¤ë§ˆë¥¼ ê°•ì œí•˜ì§€ ì•Šê³  ììœ ë¡­ê²Œ ì €ì¥í•  ìˆ˜ ìˆë‹¤.\nACID íŠ¹ì„±ì„ ê°–ì§€ ì•ŠëŠ”ë‹¤. A (Atomic) - í•œ íŠ¸ëœì­ì…˜ì€ ì›ì ë‹¨ìœ„ë¡œ ì „ì²´ ì‘ì—…ì´ ì„±ê³µí•˜ê±°ë‚˜ ì „ì²´ ì‘ì—…ì´ ì‹¤íŒ¨í•´ì•¼í•œë‹¤. ë¶€ë¶„ ì‘ì—…ë§Œ ì ìš©ë˜ì–´ì„œëŠ” ì•ˆëœë‹¤. ì‰½ê²Œ ë§í•˜ë©´ 0ê³¼ 1ì˜ ì´ë¶„ë²•ì  ì‚¬ê³ ë¼ê³  ë³¼ ìˆ˜ ìˆë‹¤. í•œ íŠ¸ëœì­ì…˜ ë‚´ì˜ ì¼ë¶€ ì‘ì—…ë§Œ ìˆ˜í–‰í•œ ì• ë§¤í•œ ìƒíƒœëŠ” ì¡´ì¬í•´ì„  ì•ˆëœë‹¤! C (Consistency) - ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ëœ ë°ì´í„°ëŠ” ì¼ê´€ì„±ì„ ê°€ì ¸ì•¼í•œë‹¤. ë§Œì•½ íŠ¸ëœì­ì…˜ì´ ì ìš©ë˜ì—ˆëŠ”ë° ë‹¤ìŒ Read ìš”ì²­ ì‹œ í•´ë‹¹ ë°ì´í„°ê°€ ì•„ì§ ë°˜ì˜ì´ ì•ˆë˜ì–´ìˆìœ¼ë©´ ì•ˆëœë‹¤. ë§Œì•½ íŠ¸ëœì­ì…˜ì´ ë¡¤ë°±ë˜ì—ˆëŠ”ë° í•´ë‹¹ ë°ì´í„°ê°€ ë‚¨ì•„ìˆëŠ” ìƒíƒœê°€ ì¡´ì¬í•˜ë©´ ì•ˆëœë‹¤. êµ¬ê¸€ë§í•˜ë‹¤ë³´ë©´ Consistencyë¥¼ ì–´ë–¤ ì´ìœ ì—ì„œì¸ì§€ columnì— ëŒ€í•œ ì œì•½ ì¡°ê±´ê³¼ ì—°ê´€ì§€ì–´ ì„¤ëª…í•˜ëŠ” í•œêµ­ì–´ ìë£Œë“¤ì„ ë§ì´ ì°¾ì•„ë³¼ ìˆ˜ ìˆëŠ”ë° ë‚˜ëŠ” ì´ëŠ” ì˜ëª»ëœ ì„¤ëª…ì´ ì•„ë‹Œê°€ ì‹¶ë‹¤. íŠ¹íˆ NoSQLì˜ Eventual consistencyì™€ ëŒ€ì¡°í•´ë³´ë©´ columnì— ëŒ€í•œ ì œì•½ ì¡°ê±´ìœ¼ë¡œ consistencyë¥¼ ì„¤ëª…í•˜ëŠ” ê²ƒì€ ë”ìš± ë” ì˜ëª»ëœ ì„¤ëª…ì´ë¼ê³  ëŠê»´ì§€ì§€ ì•Šë‚˜ ì‹¶ë‹¤. I (Isolation) - íŠ¸ëœì­ì…˜ ê³¼ì • ì¤‘ì—ëŠ” ì„œë¡œ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ ê°„ì—ëŠ” ì„œë¡œì˜ ê³¼ì •ì— ê°„ì„­í•  ìˆ˜ ì—†ë‹¤. Isolationì€ ì ˆëŒ€ì ì¸ ê²ƒì€ ì•„ë‹ˆê³  í•„ìš”ì— ë”°ë¼ ì–¼ë§ˆë‚˜ íŠ¸ëœì­ì…˜ì„ ê³¨ë¹„ì‹œí‚¬ ê²ƒì¸ì§€ë¥¼ ì˜ë¯¸í•˜ëŠ” isolation levelì„ ì¡°ì ˆí•  ìˆ˜ ìˆë‹¤. Read uncommited, Read commited, Repeatable read, Serializable ì™€ ê°™ì€ Isolation levelë“¤ì´ ì¡´ì¬í•œë‹¤. D (Durability) - commitëœ íŠ¸ëœì­ì…˜ì€ ì‹œìŠ¤í…œì´ ë¹„ì •ìƒì ìœ¼ë¡œ ì¢…ë£Œë˜ë”ë¼ë„ ë³´ì¡´ë˜ì–´ì•¼í•œë‹¤. ACIDëŠ” ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì œê³µí•˜ëŠ” íŠ¸ëœì­ì…˜ì„ ì§€ì›í•˜ê¸° ìœ„í•´ ê°€ì ¸ì•¼í•  4ê°€ì§€ íŠ¹ì„±ì„ ì˜ë¯¸í•œë‹¤.\nNoSQLì€ ë³´í†µ ì´ëŸ° ACID íŠ¹ì„±ì„ ì™„ë²½íˆ ì œê³µí•˜ì§€ëŠ” ì•ŠëŠ”ë‹¤. NoSQLì—ë„ íŠ¸ëœì­ì…˜ì´ ì¡´ì¬í•˜ê¸°ëŠ” í•˜ì§€ë§Œ ì•„ë§ˆ ACID íŠ¹ì„±ì„ ëª¨ë‘ ë§Œì¡±í•˜ëŠ” íŠ¸ëœì­ì…˜ì€ ì•„ë‹ ê²ƒì´ë‹¤.\nACID íŠ¸ëœì­ì…˜ì€ ì •ë§ ì—„ê²©í•˜ê²Œ ì¼ê´€ëœ ë°ì´í„°ë¥¼ ê°•ì œí•˜ê¸° ë•Œë¬¸ì— ì´ë¥¼ ìœ„í•´ì„  ì„±ëŠ¥ì„ ë§ì€ ë¶€ë¶„ ì–‘ë³´í•´ì•¼í•˜ê³  ë¶„ì‚° ì‹œìŠ¤í…œì—ì„œëŠ” íŠ¹íˆ ë™ì‘í•˜ê¸° í˜ë“¤ ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.\nBASE íŠ¹ì„±ì„ ê¸°ë°˜ìœ¼ë¡œ í•œë‹¤. BA (Basically available) - ê³ ê°€ìš©ì„±ì„ ê°€ì ¸ì•¼í•œë‹¤. S (Soft state) - ìœ ì €ì˜ ëª…ì‹œì  ëª…ë ¹ ì—†ì´ ë°ì´í„°ê°€ ë³€ê²½ë  ìˆ˜ ìˆë‹¤. Eventual consistencyì— ì˜í•´ ë°ì´í„°ê°€ ë®ì–´ì”Œì›Œì§ˆ ìˆ˜ë„ ìˆê³  TTLì— ì˜í•´ ë°ì´í„°ê°€ ì‚¬ë¼ì§ˆ ìˆ˜ë„ ìˆë‹¤. E (Eventual consistency) - ê²°ê³¼ì ìœ¼ë¡œëŠ” ì¼ê´€ì„±ì„ ëˆë‹¤. ê·¸ ê³¼ì • ì†ì—ì„œ ë°ì´í„°ê°€ ì¼ê´€ë˜ì§€ ì•Šì€ ìƒíƒœë„ ì¡´ì¬í•  ìˆ˜ ìˆë‹¤. ì‚¬ì‹¤ Temporary inconsistencyê°€ ì¢€ ë” ì™€ë‹¿ëŠ” í‘œí˜„ì¼ ìˆ˜ë„.. í¬ì¸íŠ¸ëŠ” *â€˜ê²°ê³¼ì ìœ¼ë¡œëŠ” ì¼ê´€ì„±ì„ ê°–ê¸´ í•˜ëŠ”êµ¬ë‚˜~â€™*ê°€ ì•„ë‹Œ â€˜ì¼ì‹œì ìœ¼ë¡œëŠ” ì¼ê´€ë˜ì§€ ì•Šì„ ìˆ˜ë„ ìˆêµ¬ë‚˜!â€™ ì´ë‹¤. ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì• ì´ˆì— ì—„ê²©í•˜ê²Œ ì¼ê´€ëœ ë°ì´í„°ë“¤ì„ ì €ì¥í•˜ê¸° ìœ„í•œ ì†”ë£¨ì…˜ì´ê¸°ì— ACIDë¥¼ ì§€ì›í•˜ì§€ë§Œ NoSQLì€ ê·¸ëŸ° ì—„ê²©í•¨ìœ¼ë¡œ ì¸í•´ í™•ì¥ì„±ì´ë‚˜ ì„±ëŠ¥ì„ ì œí•œë°›ì§€ ì•Šê³ ì íƒ„ìƒí•œ ì†”ë£¨ì…˜ì´ë‹¤.\nì—¬ê¸°ì„œ ë§í•˜ëŠ” ì„±ëŠ¥ì€ ì‘ì€ ë°ì´í„°ì— ëŒ€í•œ ì„±ëŠ¥ì„ ì˜ë¯¸í•˜ëŠ” ê²Œ ì•„ë‹ˆë¼ ëŒ€ê·œëª¨ ë°ì´í„°ì— ëŒ€í•´ì„œë„ ì¤€ìˆ˜í•œ ì„±ëŠ¥ì„ ë‚´ëŠ” ê²ƒì„ ë§í•œë‹¤. ë°ì´í„°ê°€ ë§ì•„ì§ˆ ìˆ˜ë¡, ìš”ì²­ì´ ë§ì•„ì§ˆ ìˆ˜ë¡ ë²”ìš©ì ì¸ ìˆ˜ì¤€ì˜ ì„œë²„ë¡œëŠ” ìš”ì²­ì„ ë‹¤ ê°ë‹¹í•˜ê¸° í˜ë“ ë° ì´ë ‡ê²Œ ë˜ë©´ ë²”ìš©ì ì¸ ìˆ˜ì¤€ì˜ ì„œë²„ë¥¼ ìˆ˜í‰ì ìœ¼ë¡œ ìŠ¤ì¼€ì¼ í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.\në˜í•œ ê³ ê°€ìš©ì„±ì„ ìœ„í•´ì„œë„ ìˆ˜í‰ì ìœ¼ë¡œ ìŠ¤ì¼€ì¼í•  ìˆ˜ ìˆì–´ì•¼í•œë‹¤. (ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì˜ ê²½ìš° ì£¼ë¡œ ë°±ì—… ì„œë²„ë¥¼ ëŒ€ê¸°ì‹œì¼œë†“ëŠ” ì´ì¤‘í™”ë¥¼ í†µí•´ ê³ ê°€ìš©ì„±ì„ ì§€ì›í•œë‹¤.)\ní•˜ì§€ë§Œ ë‹¨ì¼ ì‹œìŠ¤í…œì´ ì•„ë‹Œ ë¶„ì‚° ì‹œìŠ¤í…œì´ ë˜ê²Œ ë˜ë©´ ëª¨ë“  ë…¸ë“œë“¤ì´ ì¼ê´€ëœ ë°ì´í„°ë¥¼ ê°–ê¸°ê°€ í˜ë“¤ì–´ì§€ëŠ”ë° ì´ë¡œ ì¸í•´ ì—„ê²©í•œ ì¼ê´€ì„±ì´ ì•„ë‹Œ Eventual consistencyë¥¼ ì œê³µí•˜ê²Œ ëœë‹¤.\në°©ê¸ˆ í™•ì¥ì„±ì´ë‚˜ ì„±ëŠ¥, ê³ ê°€ìš©ì„±ì— ëŒ€í•œ íë¦„ìœ¼ë¡œ ë‚˜ì˜¨ ë‚´ìš©ë“¤ì´ CAP ì´ë¡ ê³¼ ê´€ë ¨ëœ ë‚´ìš©ì´ë¼ê³  ë³¼ ìˆ˜ ìˆë‹¤. CAP ì´ë¡ ì— ëŒ€í•´ì„  ë”°ë¡œ ì •ë¦¬í•˜ì§€ ì•Šê² ë‹¤.\nì •ê·œí™”ë³´ë‹¨ ë¹„ì •ê·œí™”ì™€ ì¤‘ë³µ ë‚˜ëŠ” ëª¨ ê¸°ì—…ì˜ ê¸°ìˆ  ë©´ì ‘ì—ì„œ â€˜ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì—ì„œë„ JOINì„ í•˜ì§€ ë§ìëŠ” ì£¼ì¥ì„ ë‚´ëŠ” ì‚¬ëŒë“¤ë„ ìˆëŠ”ë°, ì´ìœ ê°€ ë­˜ê¹Œìš”?â€™ ë¼ëŠ” ì§ˆë¬¸ì„ ë°›ì€ ì ì´ ìˆì—ˆë‹¤. ì•ì„œ ë§í–ˆë“¯ ë‚˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ê´€ë ¨ ì§€ì‹ì´ ë§ì´ ë¶€ì¡±í•˜ê¸°ë„ í–ˆê¸° ë•Œë¬¸ì— ì§ˆë¬¸ì— ëŒ€í•œ ëŒ€ë‹µì€ ë‘˜ì§¸ì¹˜ê³  â€˜ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ JOINì„ ì“°ì§€ ë§ìëŠ” ì‚¬ëŒë„ ìˆë‚˜\u0026hellip;?â€™ ë¼ëŠ” ìƒê° ë¿ì´ì—ˆë‹¤.\nê³„ì† ì–˜ê¸°í•˜ì§€ë§Œ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì¼ê´€ë˜ê³  ì´ìƒ í˜„ìƒì´ ì—†ëŠ” ë°ì´í„°ë“¤ì„ ì €ì¥í•˜ê¸° ìœ„í•œ ì†”ë£¨ì…˜ì´ë‹¤. ê·¸ë¦¬ê³  ê·¸ë¥¼ ìœ„í•´ í…Œì´ë¸” ê°„ì˜ ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚¼ ë•Œ í…Œì´ë¸”ì„ ì •ê·œí™”í•˜ê³  ì°¸ì¡°í•œ ë’¤ ì¡°íšŒí•  ë•Œì—ëŠ” í•„ìš”í•œ ì •ë³´ë“¤ì„ JOINìœ¼ë¡œ ê°€ì ¸ì˜¨ë‹¤. í•˜ì§€ë§Œ JOINì€ ê½¤ë‚˜ ë¹„ì‹¼ ì‘ì—…ì´ë‹¤.\në°˜ë©´ NoSQLì€ ì–´ëŠ ì •ë„ ë°ì´í„°ì˜ ë¶ˆì¼ì¹˜ë¥¼ í—ˆìš©í•˜ê¸°ë„ í•˜ê¸° ë•Œë¬¸ì— ì¡°íšŒ ì‹œ JOINì„ ìˆ˜í–‰í•˜ê¸° ë³´ë‹¤ëŠ” ë¹„ì •ê·œí™”ëœ í˜•íƒœë¡œì„œ ì¤‘ë³µìœ¼ë¡œ ì €ì¥ëœ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ëŠ” ê²½ìš°ê°€ ë§ë‹¤.\nê°œì¸ì ìœ¼ë¡œëŠ” ì´ë ‡ê²Œ ë¹„ì •ê·œí™”í•œ í˜•íƒœë¡œ ì¤‘ë³µëœ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ë°©ì‹ì€ CQRSì™€ë„ ì–´ëŠ ì •ë„ ë¹„ìŠ·í•œ í˜•íƒœë¥¼ ê°–ì§€ ì•Šë‚˜ì‹¶ë‹¤. CQRSì—ì„œëŠ” ë°ì´í„°ë¥¼ ì¡°ì‘í•˜ëŠ” Command ì™€ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ëŠ” Queryì˜ ì±…ì„ì„ ë¶„ë¦¬í•˜ëŠ” í˜•íƒœë¡œ, Queryí•˜ëŠ” ì¸¡ì—ì„œëŠ” ìì‹ ë“¤ì´ ì¡°íšŒí•˜ê¸° ìš©ì´í•œ í˜•íƒœì¸ ê³ ë„í™” ëœ ë·°(ë¹„ì •ê·œí™”ëœ ë°ì´í„°)ë¡œ ë°ì´í„°ë¥¼ ì €ì¥í•œë‹¤. ë°ì´í„°ì˜ ì›ë³¸ì€ Commandë¥¼ ë‹´ë‹¹í•˜ëŠ” ê³³ì— ì €ì¥ëœë‹¤.\në§ˆì¹˜ë©° ì´ë ‡ê²Œ NoSQLì˜ ê³µí†µëœ íŠ¹ì§•ì— ëŒ€í•´ ì±…ì— ë“±ì¥í•œ ë‚´ìš©ê³¼ ì•½ê°„ì˜ ê°œì¸ì ì¸ ì˜ê²¬ì„ ì •ë¦¬í•´ë´¤ë‹¤. ì±…ì´ ë‹´ê³  ìˆëŠ” ë‚´ìš©ì€ ê½¤ë‚˜ ë§ˆìŒì— ë“ ë‹¤! íŠ¹ì •í•œ NoSQL ë°ì´í„°ë² ì´ìŠ¤ì˜ ê¸°ëŠ¥ ìì²´ë¥¼ ì¤„ì¤„ì´ ì†Œê°œí•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì‹¤ìš©ì ì¸ ì˜ˆì‹œ ìƒí™©ê³¼ í•¨ê»˜ ê°ê°ì˜ NoSQLê³¼ RDBì— ëŒ€í•œ ë¹„êµë¥¼ í•´ë³¼ ìˆ˜ ìˆì—ˆë‹¤.\në³„ì ì„ ì¤€ë‹¤ë©´ 4.5ì  ì •ë„..? 0.5ì ì€ ì¢€ ë” ì˜ˆì‹œê°€ ë””í…Œì¼í•˜ê³  ìì„¸í–ˆìœ¼ë©´ ë„ˆë¬´ë‚˜ ì¢‹ì•˜ì„ ê²ƒ ê°™ë‹¤. ì˜ˆì‹œê°€ ì•„ì˜ˆ ì—†ëŠ” ê²ƒì€ ì•„ë‹ˆë¼ ê°„ê°„íˆ ì‹¤ì œ ìœ ì¦ˆì¼€ì´ìŠ¤ë“¤ì´ ë“±ì¥í•˜ê¸´ í•˜ì§€ë§Œ ë„ˆë¬´ ê°„ë‹¨í•˜ê²Œë§Œ ì§šê³  ë„˜ì–´ê°€ì„œ ì¡°ê¸ˆ ì•„ì‰¬ì› ë‹¤.\nì‚¬ì‹¤ ì €ë²ˆ í•˜ë°˜ê¸°ë¶€í„° ì˜¬í•´ ìƒë°˜ê¸°ê¹Œì§€ ë‚´ê°€ í•œ ê²Œ ì„±ì¥í•œ ê²Œ ìˆë‚˜, ìƒˆë¡œ ë°°ìš´ ê²Œ ìˆë‚˜ ì‹¶ì—ˆëŠ”ë° ë¬¸ë“ ì±…ì„ ì½ê²Œ ëœ ê³„ê¸°ë¥¼ íšŒìƒí•´ë³´ë‹ˆ ì €ì¥ì†Œ ì¸¡ë©´ì—ì„œëŠ” ë§ì´ ë°°ì›Œê°€ê³  ìˆëŠ” ê²ƒ ê°™ì•„ ë‹¤í–‰ì´ë‹¤.\nâ€˜ì´ëŸ° ë°ì´í„°ë¥¼ ë‚˜íƒ€ë‚´ë ¤ë©´ ë‹¹ì—°íˆ í…Œì´ë¸”ì„ ì´ëŸ° ì‹ìœ¼ë¡œ ì •ê·œí™”í•´ì„œ\u0026hellip;â€™ ì™€ ê°™ì´ ë‹¨ìˆœíˆ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ í…Œì´ë¸”ì„ ì„¤ê³„í•˜ëŠ” ê¸°ë³¸ì ì¸ ì›ì¹™ì„ ê¸°ë°˜ìœ¼ë¡œ í•œ ê´€ì ì´ ì•„ë‹ˆë¼ â€˜ì´ëŸ° ë°ì´í„°ëŠ” ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ê°€ ì•„ë‹Œ ì´ëŸ° ì´ëŸ° NoSQLì„ ì‚¬ìš©í•˜ë©´ ë” ì í•©í•  ê²ƒì´ê³ , ì „ì²´ ë°ì´í„° ì¡°íšŒìš©ìœ¼ë¡  ì´ëŸ° NoSQLì„ ì‚¬ìš©í•˜ë©´ ë” ì í•©í•  ê²ƒ ê°™ë‹¤.â€™ ì™€ ê°™ì´ íƒˆ RDBì  ê´€ì ë„ ì–´ëŠ ì •ë„ ì¥ì°©í•˜ê²Œ ëœ ê²ƒ ê°™ì•„ ì‹œê°ì´ ì¢€ ë„“ì–´ì§€ê³  ìˆëŠ” ë“¯í•˜ë‹¤.\nì‘ë…„ 2021ë…„ íšŒê³ ì—ì„œ 2022ë…„ì—ëŠ” ì§§ì€ ì•„í‹°í´ ë¿ë§Œ ì•„ë‹ˆë¼ ì²´ê³„ì ì¸ ì •ë³´ë¥¼ ë‹´ì€ ì±…ì„ í†µí•´ì„œë„ ê³µë¶€ë¥¼ í•´ë³´ê² ë‹¤ëŠ” ê²°ì‹¬ì„ í–ˆì—ˆëŠ”ë° 2022ë…„ 1ì›”ì´ ë˜ì ë§ˆì êµ¬ë§¤í–ˆë˜ 2022ë…„ì˜ ì²« ì±…ì„ í¬ê¸°í•˜ì§€ ì•Šê³  ëê¹Œì§€ ì½ê²Œ ë˜ì–´ ë‹¤í–‰ì´ë‹¤! ì•„ë§ˆ ë‹¤ìŒ ì±…ì€ Real MySQLì´ë‚˜ Spring Bootë‚˜ JPA ê´€ë ¨ ì±…ì´ ë˜ì§€ ì•Šì„ì§€?! ã…ã…\n","date":"2022-03-11T23:46:54+09:00","image":"https://umi0410.github.io/blog/computer-science/book-review-nosql-introduction-1/cover_hue5cdea400e5bd3f90bce9c064a33eba6_152854_120x120_fill_q75_box_smart1.jpg","permalink":"https://umi0410.github.io/blog/computer-science/book-review-nosql-introduction-1/","title":"(ë„ì„œ) \"NoSQL ì² ì € ì…ë¬¸\" í›„ê¸° ë° NoSQLì˜ ê³µí†µì  íŠ¹ì§•"},{"content":"ì‹œì‘í•˜ë©° ë§¤ë…„ ê·¸ë¬ì§€ë§Œ 2021ë…„ë„ ì°¸ ë¹ ë¥´ê²Œ ì§€ë‚˜ê°„ ê²ƒ ê°™ë‹¤. ë²Œì¨ ì—°ë§ì´ë¼ë‹ˆ.\nì˜¤ëŠ˜ì€ 2021ë…„ì„ ëŒì•„ë³´ë©° ì˜ í–ˆë˜ ë¶€ë¶„ì— ëŒ€í•´ì„  ë‚˜ ìì‹ ì„ ì¹­ì°¬í•´ì£¼ê³ , ì•„ì‰¬ì› ë˜ ë¶€ë¶„ì— ëŒ€í•´ì„œëŠ” ê°œì„ í•  ë°©ì•ˆì„ ì°¾ì•„ë´„ìœ¼ë¡œì¨ ìƒˆí•´ëŠ” ë” ëœ¨ê²ê³  ì˜ë¯¸ìˆê²Œ ë³´ë‚´ê³ ìí•œë‹¤~!\nê°œë°œ ì™¸ì ì¸ ê±°ëŠ” ê°œì¸ì ìœ¼ë¡œ ì •ë¦¬í•  ê³„íšì´ê³ , ë³¸ íšŒê³ ë¡ì—ì„œëŠ” ê°œë°œ ê´€ë ¨ëœ ë‚´ìš© ìœ„ì£¼ë¡œ ì‘ì„±í–ˆë‹¤.\n2021ë…„ ê°œë°œ ê´€ë ¨ í™œë™ ìš”ì•½ ë‹¤ì–‘í•œ ì´ìœ ë¡œ ë¯¸ë¤„ì™”ë˜ ìŠ¤í”„ë§ì„ ì‚¬ìš©í•´ë³´ê¸° ì‹œì‘í–ˆë‹¤. ë°”ë‹¥ë¶€í„° ì£¼ë„ì ìœ¼ë¡œ ì„¤ê³„/ê°œë°œí•´ë‚˜ê°ˆ ìˆ˜ ìˆëŠ” ì´ˆê¸° ìŠ¤íƒ€íŠ¸ì—…ì— í•©ë¥˜í•´ ë‚˜ë¦„ ë§ì€ ê²½í—˜ì„ í•´ë³¼ ìˆ˜ ìˆì—ˆë‹¤. ì‹¤ì œ ê°œë°œ í”„ë¡œì íŠ¸ì— ì—¬ëŸ¿ ì°¸ì—¬í•´ í˜‘ì—…ì„ í•´ë³´ì•˜ë‹¤. (êµë‚´ ì‚¬ì´ë“œ í”„ë¡œì íŠ¸, ê°œë°œ ë™ì•„ë¦¬, ìŠ¤íƒ€íŠ¸ì—…) CS ì§€ì‹ì„ ë„˜ì–´ ê°œë°œìë¡œì„œ í•„ìš”í•  ë§Œí•œ ë‚´ìš©ë“¤ì„ ë§ì´ ì ‘í•˜ê³  ê³µë¶€í–ˆë‹¤. DB, Transaction, Cache, Redis, Concurrent programming, TDD MSA, DDD, ë©”ì‹œì§€ í, CQRS, SAGA ë“±ì— ëŒ€í•´ AUSG(AWS ëŒ€í•™ìƒ ë™ì•„ë¦¬)ì™€ SOPT(ê°œë°œ ë™ì•„ë¦¬)ì—ì„œ ì§„í–‰í•œ ì„¸ë¯¸ë‚˜ì—ì„œ ElasticBeanstalk ê´€ë ¨ ì„¸ì…˜ì„ ì§„í–‰í–ˆë‹¤. ì·¨ì¤€ì„ ì‹œì‘í–ˆë‹¤. AWS SAA ìê²©ì¦ì„ ê³µë¶€ ì¤‘ì´ë‹¤. ë°±ì—”ë“œ/í´ë¼ìš°ë“œ ë¶„ì•¼ì— ìˆì–´ ëŒ€ë¶€ë¶„ì˜ ê¸°ìˆ  ì„¸ë¯¸ë‚˜ì™€ ê¸°ìˆ  ë¸”ë¡œê·¸ ê¸€ë“¤ì„ ì–´ëŠ ì •ë„ ë‹¤ ì´í•´í•  ìˆ˜ ìˆì–´ì¡Œë‹¤. ë¬´ì—‡ë³´ë‹¤ ì˜¬í•´ì—ëŠ” ë§ˆìŒì´ ë§ëŠ” ì†Œì¤‘í•œ ì‚¬ëŒë“¤ì„ ë§ì´ ë§Œë‚˜ê²Œ ëœ ê²ƒ ê°™ì•„ ê°ì‚¬í•˜ë‹¤. ì¢‹ì•˜ë˜ ì  ìŠ¤íƒ€íŠ¸ì—…ì— í•©ë¥˜í•´ ë§ì´ ì„±ì¥í•  ìˆ˜ ìˆì—ˆë‹¤!\nì‘ë…„ê¹Œì§„ ëŒ€ë¶€ë¶„ì˜ í”„ë¡œì íŠ¸ë¥¼ í˜¼ìí•´ì™”ë˜ ê²ƒ ê°™ì€ë° ê·¸ëŸ¬ë‹¤ë³´ë‹ˆ ê¸°íš, ë””ìì¸, í”„ë¡ íŠ¸ ë“±ì— ë„ˆë¬´ ì—ë„ˆì§€ë¥¼ ëºê²¨ì„œ ë°±ì—”ë“œì— ì§‘ì¤‘í•˜ê¸°ê°€ í˜ë“¤ì—ˆë˜ ê²ƒ ê°™ë‹¤. ì´ëŸ° ì ì—ì„œ ì•„ì‰¬ì›€ì„ ëŠê¼ˆê³ , ìµœëŒ€í•œ ì‹¤ë¬´ì™€ ìœ ì‚¬í•œ ê²½í—˜ì„ í•´ë³´ê³  ì‹¶ë‹¤. ê·¸ë˜ì„œ ì œëŒ€ë¡œ ì‚¬ì´ë“œ í”„ë¡œì íŠ¸ë¥¼ êµ¬í•˜ëŠ” í”Œë«í¼ì—ì„œ íŒ€ì„ êµ¬í•´ë³´ê³ ì í–ˆë‹¤.\në‹¹ì‹œì— ê°œë°œ ë™ì•„ë¦¬ê°€ ì•„ë‹Œ íŒ€ì„ ë”°ë¡œ êµ¬í•˜ê³ ì í–ˆë˜ ì´ìœ ëŠ” ì‚¬ì‹¤ ê°œë°œ ë™ì•„ë¦¬ëŠ” ì¸í„°ë·° ê³¼ì •ì„ ê±°ì³ íŒ€ì„ ì •í•  ìˆ˜ ìˆëŠ” ê²Œ ì•„ë‹ˆë¼ ë³´í†µ ë™ì•„ë¦¬ì›ë“¤ ì¤‘ ëœë¤ìœ¼ë¡œ íŒ€ ë¹Œë”©ì´ ì´ë£¨ì–´ì§€ë‹¤ë³´ë‹ˆ ì‚¬ì‹¤ íŒ€ ë¹Œë”©ì— ìˆì–´ ìš´ì´ ë§ì€ ë¶€ë¶„ì„ ì°¨ì§€í•˜ì§€ë§Œ ë‚´ í”„ë¡œì íŠ¸ë¥¼ ê·¸ë ‡ê²Œ ìš´ì— ë§¡ê¸°ê³  ì‹¶ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì´ì—ˆë‹¤. ì‹¤ì œë¡œ ëŒ€ë¶€ë¶„ì˜ ë™ì•„ë¦¬ê°€ í•œ 1/3 ì •ë„ëŠ” í”„ë¡œì íŠ¸ë‚˜ í˜‘ì—…ì´ ì›í™œíˆ ì´ë£¨ì–´ì§€ì§€ ì•ŠëŠ” ê²ƒ ê°™ë‹¤.\nì–´ì¨Œë“  ë‚˜ë¦„ì˜ ê·¸ëŸ° íŒë‹¨í•˜ì— ê°œë°œ ë™ì•„ë¦¬ë³´ë‹¨ ë”°ë¡œ ì‚¬ì´ë“œ í”„ë¡œì íŠ¸ íŒ€ì„ êµ¬í•´ì„œ í•©ë¥˜í•˜ëŠ” ê²Œ ë” ì¢‹ì€ íŒ€ì›ë“¤ì„ ë§Œë‚  ìˆ˜ ìˆì„ ê²ƒ ê°™ì•˜ê³ , ê²°ê³¼ì ìœ¼ë¡œëŠ” ì‚¬ì´ë“œ í”„ë¡œì íŠ¸ê°€ ì•„ë‹ˆë¼ ì´ˆê¸° ìŠ¤íƒ€íŠ¸ì—…ì— í•©ë¥˜í•˜ê²Œ ë˜ì–´ í•™ìƒìœ¼ë¡œì„œëŠ” ì ì§€ ì•Šì€ ê¸‰ì—¬ë¥¼ ë°›ìœ¼ë©° ì£¼ë„ì ìœ¼ë¡œ ê°œë°œí•´ë‚˜ê°€ê³  ë§ì´ ì„±ì¥í•  ìˆ˜ ìˆì—ˆë˜ ê²ƒ ê°™ë‹¤.\në‚˜ëŠ” ì´ íŒ€ì—ì„œ ê°œë°œ ë¦¬ë“œë¥¼ í•˜ë©° í´ë¼ìš°ë“œ ì¸í”„ë¼ ì„¤ê³„/êµ¬ì¶•, Spring Boot RESTful API ì„œë²„ ê°œë°œ, í”„ë¡ íŠ¸ ì¼ì • ê´€ë¦¬ ë° QA ë“±ì˜ ì—…ë¬´ë¥¼ ë‹´ë‹¹í–ˆë‹¤.\nSpringë„ JPAë„ í…ŒìŠ¤íŠ¸ ì½”ë“œë„ ì²˜ìŒì´ì—ˆëŠ”ë°, ì˜ ì ìš©í•´ë³¼ ìˆ˜ ìˆì—ˆë‹¤. ì§€ì¸ë“¤ê³¼ ìŠ¤í„°ë”” ê·¸ë£¹ì„ ë§Œë“¤ì–´ í† ì˜í•˜ê³  ì¸í”„ëŸ°ì—ì„œ ê°•ì˜ë¥¼ ìˆ˜ê°•í•˜ë©° ê¸°ìˆ ì„ ê³µë¶€í•˜ê³  ì ìš©í•´ë‚˜ê°”ë‹¤. ì„œë¹„ìŠ¤ë¥¼ ê°œë°œí•˜ë©´ì„œ N+1 ì¿¼ë¦¬ì˜ ë¬¸ì œì  ê°™ì€ ë¶€ë¶„ë“¤ì„ ì‹¤ì œë¡œ ê²½í—˜í•´ë³¼ ìˆ˜ë„ ìˆì—ˆê³  ê°œì„ í•´ë‚˜ê°€ë©´ì„œ Latencyê°€ ë‚®ì€ ì„œë¹„ìŠ¤ ì œê³µí•˜ê¸°ìœ„í•œ ì „ëµë“¤ì— ëŒ€í•œ ê´€ì‹¬ë„ ê°–ê²Œ ëœ ê²ƒ ê°™ë‹¤.\nCS ì§€ì‹ì„ ë„˜ì–´ ê°œë°œìë¡œì„œ í•„ìš”í•  ë§Œí•œ ë‚´ìš©ë“¤ì„ ë§ì´ ì ‘í•˜ê³  ê³µë¶€í–ˆë‹¤.\nâ€˜MSAì— ê´€ì‹¬ìˆë‹¤, ê´€ì‹¬ìˆë‹¤.â€™ ë§ë§Œ í•˜ë‹¤ê°€ ì§€ì¸ì´ ì„ ë¬¼í•´ì¤€ â€œë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ íŒ¨í„´â€ì´ë¼ëŠ” ì±…ì„ ì‹œì‘ìœ¼ë¡œ DDDë¼ëŠ” ì£¼ì œì™€ ì¡°ê¸ˆ ë” ìì„¸í•œ MSAì— ëŒ€í•´ ì•Œê²Œ ë˜ì—ˆë‹¤.\nì‹¤ì§ˆì ìœ¼ë¡œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë“¤ì´ ì–´ë–»ê²Œ ë‚®ì€ ì˜ì¡´ì„±ê³¼ ëŠìŠ¨í•œ ê²°í•©ìœ¼ë¡œ ë™ì‘í•  ìˆ˜ ìˆëŠ”ì§€ ê³µë¶€í•´ë³´ë‹¤ë³´ë‹ˆ ë©”ì‹œì§€ íì™€ CQRS, SAGAì™€ ê°™ì€ ë‚´ìš©ë“¤ë„ ì•Œê²Œ ë˜ì—ˆë‹¤.\nê·¸ë¦¬ê³  ìºì‹œë‚˜ í…ŒìŠ¤íŠ¸ ì½”ë“œë“¤ì€ ë§‰ì—°í•˜ê²Œë§Œ ì•Œê³  ìˆë˜ ìƒíƒœì˜€ëŠ”ë° ì‹¤ì œë¡œ ë„ì…í•´ë³´ë©´ì„œ ì£¼ë‹ˆì–´ ì¹˜ê³ ëŠ” ì© ë‚˜ì˜ì§€ ì•Šì€ ì •ë„ê¹Œì§€ëŠ” ì•Œê²Œ ëœ ê²ƒ ê°™ë‹¤!\nê·¸ë¦¬ê³  ê¸°ìˆ  ê´€ë ¨ëœ ì•„í‹°í´ì„ ì½ëŠ” ê±¸ ì°¸ ì¢‹ì•„í•˜ëŠ”ë° ì—´ì‹¬íˆ ì½ì€ ë‚´ìš©ë“¤ì´ ê·¸ëƒ¥ ìŠ¤ì³ì§€ë‚˜ê°€ëŠ” ê²ƒì´ ì•„ì‰½ê¸°ë„ í•˜ê³  ë‚¨ë“¤ì€ ì–´ë–»ê²Œ ìƒê°í•˜ë‚˜ ê¶ê¸ˆí•´ì„œ ì•„í‹°í´ ë‚´ìš©ì— ëŒ€í•œ ìš”ì•½ì´ë‚˜ ë‚´ ìƒê°ì„ ì ì–´ë‚˜ê°€ê¸° ì‹œì‘í–ˆë‹¤. ì´ë ‡ê²Œí•˜ë‹ˆ í™•ì‹¤íˆ ë‚´ìš©ì´ ì˜ ê¸°ì–µë‚˜ê¸°ë„ í•˜ê³ , ê°€ë” ë³¸ì¸ì˜ ìƒê°ì„ ê³µìœ í•´ì£¼ì‹œëŠ” ê²½ìš°ë„ ìˆì–´ì„œ ê·¸ë¥¼ í†µí•´ ë°°ì›Œë‚˜ê°€ê¸°ë„ í•œ ê²ƒ ê°™ë‹¤.\nì´ëŸ° ê³µë¶€ë“¤ì„ ë°”íƒ•ìœ¼ë¡œ ê²°ê³¼ì ìœ¼ë¡œëŠ” ê³¼ê±°ì— ë‚´ê°€ ê¿ˆê¿¨ë˜ ê°œë°œì ìƒì— ì¢€ ë” ê°€ê¹Œì›Œì§„ ê²ƒ ê°™ë‹¤. ë‹¹ì‹œì—” ëŒ€ë¶€ë¶„ì˜ ê¸°ìˆ  ì„¸ë¯¸ë‚˜ê°€ ì˜¤í”„ë¼ì¸ìœ¼ë¡œ ì§„í–‰ëì—ˆê³  ë‚˜ëŠ” ë­ë¼ë„ ë°°ì›Œë³´ë ¤ê³  ì„¸ë¯¸ë‚˜ì— ì°¸ì—¬í–ˆìœ¼ë‚˜ ëŒ€ë¶€ë¶„ì˜ ë‚´ìš©ì„ ì´í•´í•˜ì§€ ëª»í–ˆê³ , ì£¼ë³€ì„ ë‘˜ëŸ¬ë³´ë©° â€˜ì•„ë‹ˆ\u0026hellip; ì—¬ê¸°ìˆëŠ” ì‚¬ëŒë“¤ì€ ì € ì–˜ê¸°ë¥¼ ë‹¤ ì´í•´í•  ìˆ˜ ìˆëŠ”ê±´ê°€..? ëŒ€ë‹¨í•˜ë‹¤â€™ë¼ëŠ” ìƒê°ì„ ê°€ì§€ê³¤í–ˆë‹¤.\nê·¸ë˜ì„œ ë‚˜ë„ ë‚˜ì¤‘ì—ëŠ” ì´ëŸ° ë‚´ìš©ì„ ë‹¤ ì´í•´í•˜ê³  ê³µê°í•  ìˆ˜ ìˆëŠ” ê°œë°œìê°€ ë˜ê³  ì‹¶ì—ˆë‹¤. ê·¸ë¦¬ê³  ì˜¬í•´ë¥¼ ë§ˆë¬´ë¦¬í•˜ë©° ëŒì´ì¼œë³´ë‹ˆ ì´ì œ ëŒ€ë¶€ë¶„ì˜ ê¸°ìˆ  ì„¸ë¯¸ë‚˜ëŠ” ë¬´ë¦¬ ì—†ì´ ì´í•´í•  ìˆ˜ ìˆì—ˆë˜ ê²ƒ ê°™ì•„ ë¿Œë“¯í•˜ë‹¤. +_+\nì˜¬í•´ì— ì¬ë¯¸ìˆê²Œ ë´¤ë˜ ì„¸ì…˜ë“¤ì€ ëŒ€ì¶© ë‹¤ìŒê³¼ ê°™ì•˜ë˜ ê²ƒ ê°™ë‹¤.\n[2019] PAYCO ì‡¼í•‘ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜(MSA) ì „í™˜ê¸° [ìš°ì•„ì½˜2020] ë°°ë‹¬ì˜ë¯¼ì¡± ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì—¬í–‰ê¸° [ìš°ì•„í•œí…Œí¬ì„¸ë¯¸ë‚˜] 191121 ìš°ì•„í•œë ˆë””ìŠ¤ by ê°•ëŒ€ëª…ë‹˜ Google I/O 2012 - Go Concurrency Patterns ë‹¹ê·¼ë§ˆì¼“ì˜ ê³ ì–¸ì–´ ë„ì…ê¸°, ê·¸ë¦¬ê³  í™œìš©ë²• [NHN FORWARD 2021] Redis ì•¼ë¬´ì§€ê²Œ ì‚¬ìš©í•˜ê¸° ìƒê°ì„ ê³µìœ í•˜ê³  ê³µê°í•  ìˆ˜ ìˆëŠ” ì†Œì¤‘í•œ ì‚¬ëŒë“¤ ë§Œë‚˜ê²Œ ëë‹¤.\nì‚¬ì‹¤ ê·¸ë™ì•ˆì€ ì´ëŸ° ì €ëŸ° ì´ìœ ë¡œ ì „ì—­í•œ ë’¤ë¡œëŠ” ë‚˜ë‘ ì˜ ë§ëŠ” ì‚¬ëŒë“¤ì„ ë§Œë‚  ê¸°íšŒê°€ ì ì—ˆë‹¤. ì•„ë¬´ë˜ë„ í•™êµê°€ ê³ ë¦½ë˜ì–´ ìˆê³  ë„ˆë¬´ ì–´ë ¸ë˜ ê²Œ ì£¼ëœ ì›ì¸ì´ì—ˆë˜ ê²ƒ ê°™ë‹¤.\ní•˜ì§€ë§Œ ì˜¬í•´ì—ëŠ” ì˜ ë§ëŠ” ì‚¬ëŒë“¤ì„ ë§Œë‚˜ í•¨ê»˜ ì·¨ì—… ì¤€ë¹„ë¥¼ í•˜ë©´ì„œ ê°ìê°€ ê°€ì§„ ì»¤ë¦¬ì–´ì— ëŒ€í•œ ê°€ì¹˜ê´€ì´ë‚˜ ê°€ê³  ì‹¶ì–´í•˜ëŠ” íšŒì‚¬ ê¸°ì¤€ì„ ê³µìœ í•˜ë©´ì„œ ì„œë¡œ ìê¸° ìì‹ ì— ëŒ€í•´ì„œë„ ì˜ ì•Œì•„ê°ˆ ìˆ˜ ìˆì—ˆë˜ ê²ƒ ê°™ê³  ë§ì€ í˜ì´ ëë˜ ê²ƒ ê°™ë‹¤.\nê°œë°œí•˜ë‹¤ê°€ ë“œëŠ” ê¶ê¸ˆì¦ì´ë‚˜ ì´í•´ ì•ˆë˜ëŠ” ì ì„ ë§ˆìŒ ë†“ê³  ê³µìœ í•  ìˆ˜ ìˆëŠ” ê·¸ë£¹ì´ ìƒê²¼ë‹¤. ã…ã….\nâ€˜ì™œ ì„¸ì…˜ ë§ê³  JWTë¥¼ ì“¸ê¹Œâ€™, â€˜ë°ì´í„°ë‘ íŠ¸ë˜í”½ì´ ì–¼ë§ˆë‚˜ ì»¤ì ¸ì•¼ RDBê°€ ê°ë‹¹í•˜ê¸° í˜ë“  ìˆ˜ì¤€ì´ ë ê¹Œâ€™, â€˜ì¸í„°í˜ì´ìŠ¤ì™€ êµ¬í˜„ì²´ë¡œ êµ¬ë¶„í• ê¹Œ ê·¸ëƒ¥ êµ¬í˜„ì²´ë§Œ ì“¸ê¹Œâ€™ ì´ëŸ° ë‚´ìš©ë“¤ì— ëŒ€í•´ ìì£¼ ëŒ€í™”ë¥¼ ë‚˜ëˆ´ë˜ ê²ƒ ê°™ì€ë° ë”± ì •í•´ì§„ ì •ë‹µì´ ìˆëŠ” ì§ˆë¬¸ë“¤ì€ ì•„ë‹Œ ê²ƒ ê°™ë‹¤. í•˜ì§€ë§Œ ê·¸ì— ëŒ€í•´ í˜¼ìì„œ ê³ ë¯¼ë§Œ í•˜ê¸°ë³´ë‹¤ â€˜ë‚˜ë„ ê·¸ê±° ê¶ê¸ˆí•´â€™ í•˜ë©´ì„œ ê°™ì´ ê³ ë¯¼í•˜ê³  ê³µë¶€í•´ë‚˜ê°€ë‹¤ë³´ë‹ˆ í›¨ì”¬ ë” ì¬ë°Œë”ë¼!\nì•„ì‰¬ì› ë˜ ì , ê°œì„ í•  ì  ì„ íƒê³¼ ì§‘ì¤‘ì„ ì˜ í•˜ì§€ ëª»í–ˆë˜ ê²ƒ ê°™ë‹¤.\nê°œì¸ì ì¸ ì¼ë¡œ ìŠ¬ëŸ¼í”„ê°€ ì°¾ì•„ì™”ë˜ ê²ƒ ê°™ê³  ê·¸ë¥¼ ëŠì–´ë‚´ë ¤ê³  ì´ë˜ ì €ë˜ ì¼ì„ ë²Œë ¸ë˜ ê²ƒ ê°™ë‹¤. ê·¸ëŸ¬ë‹¤ë³´ë‹ˆ í•œ í™œë™ì´ë‚˜ í”„ë¡œì íŠ¸ì— ëª°ì…í•˜ì§€ ëª»í•˜ê³  ë³‘ë ¬ì ìœ¼ë¡œ ì§„í–‰í•˜ë©´ì„œ ì•½ê°„ ëŠ˜ì–´ì§€ê²Œ ëœ ê²ƒ ê°™ì€ë°, í™•ì‹¤í•˜ê²Œ í•˜ë‚˜ì”© í•˜ë‚˜ì”© ì³ëƒˆìœ¼ë©´ ë” ì¢‹ì§€ ì•Šì•˜ì„ê¹Œ ì‹¶ë‹¤.\nê·¸ë¦¬ê³  í”„ë¡œì íŠ¸ ë¿ë§Œ ì•„ë‹ˆë¼ ê³µë¶€ì— ìˆì–´ì„œë„ ë‚˜ë¦„ ê¹Šê²Œ íŒŒëŠ” ê±¸ ì¢‹ì•„í•œë‹¤ê³  ìƒê°í–ˆëŠ”ë° ë©´ì ‘ ì¤€ë¹„ë¥¼ í•˜ë©´ì„œ ë‚´ê°€ ì•„ì§ ë§ì´ ë¶€ì¡±í•˜ë‹¨ ê±¸ ëŠë¼ê²Œ ëê³ , ê·¸ë™ì•ˆ ì„ íƒê³¼ ì§‘ì¤‘ì„ ì˜ í•˜ì§€ ëª»í–ˆë‹¤ëŠ” ê±¸ ì•Œê²Œ ë˜ì—ˆë‹¤.\ní´ë¼ìš°ë“œ ì¸í”„ë¼ ì¡°ê¸ˆ, ì»¨í…Œì´ë„ˆ ì¡°ê¸ˆ, Java spring ì¡°ê¸ˆ, DB ì¡°ê¸ˆ, MSA/DDD ì¡°ê¸ˆ, ìºì‹œ/Redis ì¡°ê¸ˆ, Go ì¡°ê¸ˆ, \u0026hellip; ë­”ê°€ ë‹¤ ë‘ë£¨ë‘ë£¨ ì•Œê³ ëŠ” ìˆëŠ”ë° í´ë¼ìš°ë“œ ì¸í”„ë¼ë¥¼ ì œì™¸í•˜ë©´ ê¹Šì´ê°€ ê·¸ë¦¬ ê¹Šì§„ ëª»í–ˆë˜ ê²ƒ ê°™ë‹¤. ê²Œë‹¤ê°€ ì‚¬ì´ë“œí”„ë¡œì íŠ¸ì—ì„œ ì•ˆë“œë¡œì´ë“œë„ ê±´ë“œë¦¬ê³  ë¦¬ì•¡íŠ¸ë„ ì‚´ì§ ê±´ë“œë¦¬ê³  ì¿ ë²„ ìƒíƒœê³„ìª½ë„ ê±´ë“œë¦¬ê³  ê·¸ëŸ¬ë‹¤ë³´ë‹ˆ ì§‘ì¤‘ì´ ë¶„ì‚°ëœ ê²ƒë„ ìˆëŠ” ê²ƒ ê°™ë‹¤.\nê°œë°œì„ ì¦ê¸°ëŠ” ê±´ ë„ˆë¬´ ì¢‹ì§€ë§Œ, ê²°êµ­ í”„ë¡œê°€ ë˜ë ¤ë©´ ì¦ê¸°ë©´ì„œ ì¬ë°ŒëŠ” ê²ƒë§Œ í•  ìˆ˜ëŠ” ì—†ëŠ” ê²ƒ ê°™ë‹¤. ë•Œë¡œëŠ” ì¡°ê¸ˆ ì¬ë¯¸ê°€ ì—†ëŠ” ê²ƒë„ ê°ìˆ˜í•˜ê³  ë…¸ë ¥í•´ì•¼ í”„ë¡œê°€ ë  ìˆ˜ ìˆëŠ” ê²ƒ ê°™ë‹¤.\nê·¸ë˜ì„œ ìƒˆí•´ì—ëŠ” ê´€ì‹¬ìˆëŠ” ë¶„ì•¼ í­ì„ ì •í•´ ì±…ì„ í†µí•´ ì¢€ ë” í™•ì‹¤íˆ ë‹¤ì´ë¸Œë¥¼ í•´ë³´ê³ ìí•œë‹¤. ê° ë¶„ì•¼ë³„ë¡œ ë² ìŠ¤íŠ¸ì…€ëŸ¬ ê°™ì€ ì±…ë“¤ì„ í•œ ê¶Œì”©ì€ ì½ì–´ë³´ê³ ì ê²°ì‹¬í–ˆë‹¤.\nRDB - Real MySQL NoSQL - Real MongoDB NoSQL - ê° NoSQL ë¹„êµí•˜ëŠ” ë‚´ìš©ì˜ ì–´ë–¤ ì±… í•˜ë‚˜ DDD/MSA - ë„ë©”ì¸ ì£¼ë„ ì„¤ê³„ë¡œ ì‹œì‘í•˜ëŠ” ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ê°œë°œ Redis - Redis in Action Spring Boot - Spring Bootë¥¼ ë‹¤ë£¬ ì–´ë–¤ ì±… í•˜ë‚˜ Go - Effective Go ê¸°íƒ€ - ê°€ìƒ ë©´ì ‘ ì‚¬ë¡€ë¡œ ë°°ìš°ëŠ” ëŒ€ê·œëª¨ ì‹œìŠ¤í…œ ì„¤ê³„ ê¸°ì´ˆ ë©˜íƒˆì´ ì•½í–ˆë‹¤.\nì·¨ì—… ì¤€ë¹„ë¥¼ ì‹œì‘í•˜ê¸° ì „ë¶€í„° ë©˜íƒˆì´ ë§ì´ í”ë“¤ë ¸ë˜ ê²ƒ ê°™ë‹¤. ë‚˜ëŠ” ê·¸ëƒ¥ ì„¤ê³„í•˜ê³  ê°œë°œí•˜ëŠ” ê²Œ ì¢‹ì€ë° ì·¨ì—…ì„ ìœ„í•´ì„  ì½”ë”© í…ŒìŠ¤íŠ¸ë¥¼ ì¤€ë¹„í•´ì•¼í•œë‹¤ëŠ” ê²ƒë¶€í„° ìŠ¤íŠ¸ë ˆìŠ¤ì˜€ê³  JDë¥¼ ë³´ë©´ ìš”êµ¬ ì¡°ê±´ì€ ë¬¼ë¡  ìš°ëŒ€ ì‚¬í•­ê¹Œì§€ ëª¨ë‘ ìì‹ ìˆì–´ì•¼ë§Œ í•  ê²ƒ ê°™ì€ ì••ë°•ë„ ìŠ¤íŠ¸ë ˆìŠ¤ì˜€ë˜ ê²ƒ ê°™ë‹¤.\nê·¸ëŸ¬ë‹¤ë³´ë‹ˆ ì§€ë ˆ ê²ì„ ë¨¹ê³  ì§€ì› ìì²´ë¥¼ ë¯¸ë£¨ê±°ë‚˜ ì§€ì›ê³¼ ë™ì‹œì— ê°‘ìê¸° í”¼ë¡œê°ì´ ëª°ë ¤ì˜¤ê³¤ í–ˆë˜ ê²ƒ ê°™ë‹¤. ê·¸ëŸ¬ë‹¤ë³´ë‹ˆ ì¼ìƒ ìƒí™œì´ë‚˜ ê³µë¶€ì—ë„ ì§€ì¥ì´ ìˆì—ˆë˜ ê²ƒ ê°™ë‹¤.\nê·¸ë˜ì„œ ìƒˆí•´ì—ëŠ” ì»¤ë¦¬ì–´ì™€ ê´€ë ¨í•´ì„œ ì¢€ ë” ê°•í•œ ë©˜íƒˆë¡œ ì—´ì •ì ìœ¼ë¡œ ì„í•˜ë©´ ë” ì¢‹ì„ ê²ƒ ê°™ë‹¤.\n2022 ëª©í‘œ ì§€ì‹ì˜ ê¹Šì´ë¥¼ ë” ê¹Šê²Œ í•´ì•¼ê² ë‹¤ ë¶„ì•¼ë³„ ì±… ì½ê¸° ë™ì˜ìƒ ê°•ì˜ ê¾¸ì¤€íˆ ì‹œì²­í•˜ê¸° ì„ íƒê³¼ ì§‘ì¤‘ì„ í•˜ì ë„ˆë¬´ ë‹¤ì–‘í•œ ë¶„ì•¼ë³´ë‹¤ëŠ” ë‚´ê°€ ìš°ì„ ìˆœìœ„ì— ë‘” ê¸°ìˆ ë“¤ì„ ìœ„ì£¼ë¡œ ê°œìˆ˜ëŠ” ì ë”ë¼ë„ ê¹Šì´ìˆê²Œ ê³µë¶€í•´ë‚˜ê°€ì ìš´ë™ì„ ì†Œí™€íˆ í•˜ì§€ë§ì ìš” ëª‡ ë‹¬ ìš´ë™ì„ ì†Œí™€íˆ í–ˆë”ë‹ˆ ëª¸ì´ ë»ê·¼í•´ì§€ê¸° ì‹œì‘í•œ ê²ƒ ê°™ë‹¤. ìƒˆí•´ì—ë„ ìš´ë™ì„ ê¾¸ì¤€íˆ í•´ì•¼ê² ë‹¤. ìì‹ ê° ìˆë˜ ê²¸ì†í•œ, í•œê²° ê°™ì´ ì—´ì •ì ì¸ ê°œë°œìê°€ ë˜ê³  ì‹¶ë‹¤.\në§ˆì¹˜ë©° ì˜¬í•´ì—ëŠ” ê³„ì†í•´ì„œ â€˜ê¸¸ê²Œ ë³´ìâ€™ëŠ” ë§ì„ ë˜ìƒˆê²¼ë˜ ê²ƒ ê°™ë‹¤. ì§€ê¸ˆ ë‹¹ì¥ ë‚´ê°€ ì½”ë”© í…ŒìŠ¤íŠ¸ì— í†µê³¼í–ˆëŠ”ì§€, ê¸°ìˆ  ë©´ì ‘ì— í†µê³¼í–ˆëŠ”ì§€ì— ì§‘ì°©í•˜ê¸°ë³´ë‹¤ëŠ” ë‚˜ ìì‹ ì´ ê·¸ëŸ¬í•œ ì§€ì‹ë“¤ì„ ìˆ™ì§€í•œ ì—”ì§€ë‹ˆì–´ê°€ ë˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•˜ëŠ” ê²ƒì´ ë” ì¤‘ìš”í•˜ë‹¤ê³  ìƒê°í•˜ê¸° ë•Œë¬¸ì´ë‹¤.\ní•˜ì§€ë§Œ ì‚¬ëŒ ë§ˆìŒì´ë¼ëŠ” ê²Œ ì°¸\u0026hellip; ë¨¸ë¦¬ë¡œëŠ” ì•Œì•„ë„ â€˜í˜¹ì‹œë¼ë„ êµ¬ë ì´ ë‹´ ë„˜ì–´ê°€ë“¯ ìš´ ì¢‹ìœ¼ë©´ ì–´ë–»ê²Œ ë  ìˆ˜ë„ ìˆì§€ ì•Šì„ê¹Œ\u0026hellip;?â€™ ì´ëŸ° ì•ŒëŸ‰í•œ ê¸°ëŒ€ë¥¼ í•˜ê²Œ ë˜ë”ë¼.\nìƒˆí•´ì—ëŠ” ì¢€ ë” ë³¸ì§ˆì ìœ¼ë¡œ ì§€ì‹ì´ ê¹Šê³  ì‹¤ë ¥ ìˆëŠ” ê°œë°œìê°€ ë˜ê¸° ìœ„í•´ ì—¬ìœ ë¥¼ ê°–ê³  ë‚˜ì•„ê°€ì•¼í•  ê²ƒ ê°™ë‹¤!\n","date":"2021-12-20T15:46:54+09:00","permalink":"https://umi0410.github.io/blog/thought/2021-review/","title":"2021ë…„ íšŒê³ "},{"content":"ì‹œì‘í•˜ë©° Sentry monitoring - ëŠë ¤ì§„ API Latency ì§§ì€ ì˜ìƒì„ ë°”íƒ•ìœ¼ë¡œ ë°°í‹€ì„ í•  ìˆ˜ ìˆëŠ” ì„œë¹„ìŠ¤ë¥¼ Spring Boot MVC + JPAë¡œ ê°œë°œí•˜ë˜ ì¤‘ ìœ„ì™€ ê°™ì´ API Latencyê°€ ì²˜ì°¸í•˜ê²Œë„ ëŠë¦° ìš”ì²­ë“¤ì´ ê°ì§€ë˜ê¸° ì‹œì‘í–ˆìŠµë‹ˆë‹¤. ê·¸ë™ì•ˆì€ ì¿¼ë¦¬ ìµœì í™”ë³´ë‹¤ëŠ” ë¡œì§ ê°œë°œì´ ë” ìš°ì„ ì‹œí•˜ë‹¤ë³´ë‹ˆ ì¿¼ë¦¬ ìµœì í™”ë¥¼ ë¯¸ë¤„ì™”ëŠ”ë°, ì´ë²ˆ ê¸°íšŒì— ì´ì— ëŒ€í•´ ë‹¤ë¤„ë³´ë ¤í•©ë‹ˆë‹¤. ê°„ë‹¨í•˜ê²Œ ì½”ë“œë¥¼ ì§œì„œ í…ŒìŠ¤íŠ¸í•´ë³´ëŠë¼ Go ì–¸ì–´ë¥¼ ì´ìš©í–ˆì§€ë§Œ JPAë¥¼ ì´ìš©í•˜ë“  ë­˜ ì´ìš©í•˜ë“  ë¬¸ì œì™€ ê·¸ì— ëŒ€í•œ í•´ê²°ì±…ì˜ ìš”ì§€ëŠ” ë™ì¼í•  ê²ƒì…ë‹ˆë‹¤.\nì•„ë¬´ë˜ë„ ë°±ì—”ë“œì—ì„œ APIë¥¼ ê°œë°œí•˜ë©´ì„œ íŒŒì¼ ë°ì´í„°ë¥¼ ì£¼ê³  ë°›ëŠ” ê²Œ ì•„ë‹ˆë¼ë©´ ì£¼ë¡œ Latencyê°€ ëŠ˜ì–´ë‚˜ëŠ” ì´ìœ ëŠ” ë‹¤ìŒê³¼ ê°™ì„ ê²ƒì…ë‹ˆë‹¤.\në„ˆë¬´ ë§ì€ Write ë¶ˆí•„ìš”í•œ Column(í•„ë“œ) í˜¹ì€ ê´€ê³„ë¥¼ Eager Loading. ì¶”ê°€ì ìœ¼ë¡œ ê²½ìš°ì— ë”°ë¼ N+1 ì¿¼ë¦¬ ë¬¸ì œ ë°œìƒ í•„ìš”í•œ Column(í•„ë“œ) í˜¹ì€ ê´€ê³„ë¥¼ ë’¤ëŠ¦ê²Œ Lazy Loading. ì¶”ê°€ì ìœ¼ë¡œ ê²½ìš°ì— ë”°ë¼ N+1 ì¿¼ë¦¬ ë¬¸ì œ ë°œìƒ ìš”ì²­ë§ˆë‹¤ ë§¤ë²ˆ ìˆ˜í–‰ë˜ëŠ” Joinì´ë‚˜ ì¼ì¢…ì˜ ì—°ì‚°ë“¤ N+1 ì¿¼ë¦¬ ë¬¸ì œ? - Nê°œì˜ ë°ì´í„°ë¥¼ ì¡°íšŒí•œ ê²½ìš°, ê° ë°ì´í„°ë“¤ì˜ ì—°ê´€ ê´€ê³„ë¥¼ ì¶”ê°€ì ìœ¼ë¡œ ì¡°íšŒí•˜ê¸° ìœ„í•´ í•œ ë²ˆì”© ë” ì¡°íšŒí•´ì•¼í•˜ëŠ” ë¬¸ì œ\u0026hellip; ì•„ì£¼ ì•…ëª… ë†’ì€ ë¬¸ì œë¡œ ìë£Œë¥¼ ì‰½ê²Œ ì°¾ì•„ë³¼ ìˆ˜ ìˆë‹¤.\nì‚¬ì‹¤ ì–´ë–»ê²Œ ë³´ë©´ N+1 ì¿¼ë¦¬ ë¬¸ì œê°€ ì›Œë‚™ ì•…ëª…ì´ ë†’ì•„ ê·¸ì— ëŒ€í•œ í•´ê²°ì±…ë“¤ë„ ê°„ë‹¨í•˜ê²ŒëŠ” ë§ì´ ì†Œê°œë˜ëŠ” ê²ƒ ê°™ê¸°ë„ í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì´ë²ˆ ê¸€ì—ì„œëŠ” ì¡°ê¸ˆì€ íŠ¹ì´í•˜ê²Œ ì¡°íšŒìˆ˜ë‚˜ ëŒ“ê¸€ ê°œìˆ˜ì²˜ëŸ¼ ì¼ì¢…ì˜ Count ê¸°ëŠ¥ì´ í•„ìš”í•œ ê²½ìš°ì˜ N+1 ì¿¼ë¦¬ ë¬¸ì œë‚˜ ìš”ì²­ë§ˆë‹¤ ë§¤ë²ˆ ìˆ˜í–‰ë˜ëŠ” Joinì´ë‚˜ ì—°ì‚°ë“¤ë¡œ ì¸í•œ ì˜¤ë²„í—¤ë“œë“¤ì„ ì¤„ì—¬ ìµœì í™”í•˜ëŠ” ë°©ë²•ì€ ì–´ë–¤ ê²ƒë“¤ì´ ìˆì„ì§€ì— ëŒ€í•œ ì œ ê³ ë¯¼ì„ ì†Œê°œí•´ë³´ë ¤ í•©ë‹ˆë‹¤.\n(ì´ ê¸€ì€ RDBë¥¼ ë©”ì¸ DBë¡œ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.)\nì˜ìƒ ì¡°íšŒìˆ˜ ê°™ì€ Count ì„±ê²©ì˜ ê°’ì— ëŒ€í•œ ì‘ì—…ì„ ìµœì í™”í•˜ì§€ ì•Šìœ¼ë©´?! ìŸì•„ì§€ëŠ” ì˜ìƒ ì¡°íšŒ ì´ë²¤íŠ¸ë§ˆë‹¤ RDBì— ë°ì´í„°ë¥¼ Write =\u0026gt; RDBì— ë„ˆë¬´ í° ë¶€í•˜ ë§¤ë²ˆ íŠ¹ì • ì˜ìƒê³¼ ê´€ë ¨ëœ ì¡°íšŒ ë‚´ì—­ì„ RDBì—ì„œ Join í›„ ê·¸ ê°œìˆ˜ë¥¼ ê³„ì‚° =\u0026gt; RDBì— ë¶€í•˜, ëŠë¦° ì‘ì—… RDBì— ì˜ìƒ ì¡°íšŒ ì´ë²¤íŠ¸ë¥¼ Writeí•  ë•Œ ì˜ìƒ ì •ë³´ í…Œì´ë¸”ì— view_count ì»¬ëŸ¼ì„ ì¶”ê°€í•œ ë’¤ view_count ì»¬ëŸ¼ì— ì¡°íšŒìˆ˜ë¥¼ ìºì‹œ =\u0026gt; ìºì‹œ ì •í™•ë„ ë¬¸ì œ, í…Œì´ë¸” ì •ì˜ ë³€ê²½ í•„ìš” ì˜ìƒ ì¡°íšŒìˆ˜ ê°™ì€ Count ì„±ê²©ì˜ ê°’ì„ ìµœì í™”í•´ì£¼ì§€ ì•Šìœ¼ë©´ ìœ„ì™€ ê°™ì€ ë¬¸ì œë“¤ì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤ê³  ë´…ë‹ˆë‹¤.\në”°ë¼ì„œ ì˜ìƒ ì¡°íšŒ ì´ë²¤íŠ¸ì²˜ëŸ¼ ìŸì•„ì§€ëŠ” ë°ì´í„°ëŠ” ë„ˆë¬´ ë§ì€ Write ìš”ì²­ì€ RDBê°€ ì•„ë‹Œ NoSQLì„ ì‚¬ìš©í•˜ëŠ” ê²Œ ì¢‹ì„ ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.\ní•˜ì§€ë§Œ NoSQLì— ì˜ìƒ ì¡°íšŒ ì´ë²¤íŠ¸ë¥¼ ì €ì¥í•œë‹¤ í•´ë„ ë§¤ë²ˆ ì˜ìƒ ì¡°íšŒ ë‚´ì—­ì„ ê°€ì ¸ì˜¨ ë’¤ ê·¸ ê°œìˆ˜ë¥¼ ê³„ì‚°í•˜ëŠ” ë°©ì‹ì€ ì–´ë–¤ DBë¥¼ ì‚¬ìš©í•˜ë˜ ë¶ˆí•„ìš”í•œ Readë„ ë§ì´ ë°œìƒí•  ê²ƒì´ê³ , ë‹¹ì—°íˆ ëŠë¦¬ê² ì£ . ë§Œì•½ ì–´ë–¤ ì˜ìƒì˜ ì¡°íšŒìˆ˜ê°€ 10ë§Œì¸ ê²½ìš° 10ë§Œê°œì˜ ì´ë²¤íŠ¸ë“¤ì„ ì¡°íšŒí•œ ë’¤ ê·¸ ê°œìˆ˜ë¥¼ ì´ìš©í•´ì•¼í• í…Œë‹ˆ ë§ì…ë‹ˆë‹¤. ê²½ìš°ì— ë”°ë¼ì„œëŠ” ì˜ìƒ ì¡°íšŒ ì‹œ ê° ì˜ìƒì— ëŒ€í•œ ì¡°íšŒ ë‚´ì—­ì„ ì¶”ê°€ì ìœ¼ë¡œ ì¡°íšŒí•˜ê²Œ ë˜ëŠ” N+1 ì¿¼ë¦¬ ë¬¸ì œë¥¼ ê²ªì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.\në”°ë¼ì„œ view_count ê°™ì€ columnì„ ì¶”ê°€ì ìœ¼ë¡œ ë‘ëŠ” ê±´ ì–´ë–¨ê¹Œì‹¶ê¸°ë„ í•©ë‹ˆë‹¤ë§Œ ì¼ë°˜ì ìœ¼ë¡œëŠ” ë™ì‹œì„± ì´ìŠˆë¡œ ì¸í•´ view_countì˜ ì •í™•ë„ê°€ ë–¨ì–´ì§€ê²Œ ë  ê²ƒì…ë‹ˆë‹¤. ë˜í•œ ìŠ¤í‚¤ë§ˆê°€ ê°•ìš”ë˜ëŠ” RDBì˜ íŠ¹ì„±ì— ì˜í•´ í…Œì´ë¸” ì •ì˜ê°€ ë³€ê²½ë˜ì–´ì•¼í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.\në™ì‹œì„± ì´ìŠˆ - ë§Œì•½ 100ëª…ì˜ ìœ ì €ì— ëŒ€í•œ ì˜ìƒ ì¡°íšŒë¥¼ ë™ì‹œì— ì²˜ë¦¬í•˜ëŠ” ê²½ìš° 100ê°œì˜ ìŠ¤ë ˆë“œëŠ” ëª¨ë‘ view_count=0 ìœ¼ë¡œ ì¡°íšŒë¥¼ í•œ ë’¤ ìì‹ ì˜ ì¡°íšŒ ì´ë²¤íŠ¸ë¡œ ì¸í•œ +1ì„ ë”í•´ view_count=1ë¡œ ì—…ë°ì´íŠ¸ ì»¤ë§¨ë“œë¥¼ ë‚ ë¦¬ê² ì§€ë§Œ ì‚¬ì‹¤ view_countëŠ” 1ì´ ì•„ë‹Œ 100ì´ ë˜ì–´ì•¼ ì •í™•í•œ ê²ƒì´ë‹¤.\nRedisë¥¼ ë„ì…í•´ë³´ë©´ ì–´ë–¨ê¹Œ RedisëŠ” ë©”ëª¨ë¦¬ë¥¼ ê¸°ë°˜ìœ¼ë¡œí•˜ëŠ” Key-Value í˜•íƒœì˜ NoSQLë¼ì„œ ì¼ë°˜ì ì¸ RDBì— ë¹„í•´ ì•„ì£¼ ë¹ ë¥´ë©´ì„œ ì‹±ê¸€ ìŠ¤ë ˆë“œ ê¸°ë°˜ì´ê¸° ë•Œë¬¸ì— ì •í™•í•œ Countì™€ Incrementê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì•„ê¹Œ ë°œìƒí–ˆë˜ ë¬¸ì œë“¤ì„ ë‹¤ìŒê³¼ ê°™ì´ í•´ê²°í•  ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.\nìŸì•„ì§€ëŠ” ì˜ìƒ ì¡°íšŒ ì´ë²¤íŠ¸ë§ˆë‹¤ RDBì— ë°ì´í„°ë¥¼ Write\n=\u0026gt; RDBì— ë„ˆë¬´ í° ë¶€í•˜ (X), ë¹ ë¥¸ Write (O)\në§¤ë²ˆ íŠ¹ì • ì˜ìƒê³¼ ê´€ë ¨ëœ ì¡°íšŒ ë‚´ì—­ì„ RDBì—ì„œ Join í›„ ê·¸ ê°œìˆ˜ë¥¼ ê³„ì‚°\n=\u0026gt; RDBì— ë¶€í•˜, ëŠë¦° ì‘ì—… (X), Redisì— ìµœê·¼ ì¡°íšŒ ë‚´ì—­ì„ ì €ì¥, ìƒí™©ì— ë”°ë¼ NoSQLì—ì„œ Replicateí•´ì„œ ì˜êµ¬í™”í•˜ëŠ” ê²ƒë„ ì¢‹ìŒ (O)\nRDBì— ì˜ìƒ ì¡°íšŒ ì´ë²¤íŠ¸ë¥¼ Writeí•  ë•Œ ì˜ìƒ ì •ë³´ í…Œì´ë¸”ì— view_count ì»¬ëŸ¼ì„ ì¶”ê°€í•œ ë’¤ view_count ì»¬ëŸ¼ì— ì¡°íšŒìˆ˜ë¥¼ ìºì‹œ\n=\u0026gt; ìºì‹œ ì •í™•ë„ ë¬¸ì œ (X), Redisì˜ ì‹±ê¸€ìŠ¤ë ˆë“œ ê¸°ë°˜ì˜ ì •í™•í•œ ê³„ì‚°\n=\u0026gt; í…Œì´ë¸” ì •ì˜ ë³€ê²½ í•„ìš” (X), NoSQLì˜ ìœ ì—°í•¨ (O)\nì´ëŸ° ì´ìœ ë¡œ ì¸í•´ ì¶”í›„ì— ì¡°íšŒìˆ˜ë‚˜ ëŒ“ê¸€ ìˆ˜, íŒ”ë¡œì›Œ ìˆ˜ ë“±ë“±ì— ëŒ€í•´ Redisë¥¼ ì´ìš©í•˜ë©´ ì–´ë–¨ê¹Œ ì‹¶ì€ ìƒê°ì´ ë“œë„¤ìš”~! ê·¸ëŸ¼ ì‹¤ì œë¡œ ì•ì„œ ì†Œê°œí–ˆë˜ ë¬¸ì œ ìƒí™©ì´ë‚˜ í•´ê²° ë°©ë²•ë“¤ì´ ê°ê° ì„±ëŠ¥ì´ ì–´ë–¨ì§€ ì§ì ‘ ë°ì´í„°ì™€ ì¿¼ë¦¬ë¥¼ ì´ìš©í•´ ì‹¤í—˜í•´ë³´ê² ìŠµë‹ˆë‹¤.\nì‹¤ì œ ì‹¤í—˜ì„ í†µí•´ ê°ê°ì˜ ë°©ì‹ ì„±ëŠ¥ ë¹„êµ ìƒí™© ì†Œê°œ Localì—ì„œ Redis container, MySQL containerì„ ì´ìš©. Goì–¸ì–´ë¡œ ê°€ë³ê²Œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‘ì„± MySQLì˜ Video í…Œì´ë¸”ì— 1000ê°œì˜ ì˜ìƒ ë°ì´í„° ì¡´ì¬. ì¡°íšŒìˆ˜ë¥¼ ìºì‹œí•´ë†“ì€ view_count ì»¬ëŸ¼ ì¡´ì¬. MySQLì˜ View í…Œì´ë¸”ì— ì•½ 2ì²œë§Œ ê°œì˜ ì¡°íšŒ ë‚´ì—­ ì¡´ì¬.(ì¦‰ ì˜ìƒ ë‹¹ ìˆ˜ì²œê°œì˜ ì¡°íšŒ ë‚´ì—­ ì¡´ì¬) ì¸ë±ìŠ¤ëŠ” ì˜ ê±¸ì–´ë†“ìŒ. Redisì— key=video_view_count:{{video_id}}, value={{view_count}} í˜•íƒœë¡œ view_count ìºì‹œ ëœë¤í•˜ê²Œ 5ê°œì˜ ì˜ìƒì— ëŒ€í•œ ì •ë³´ë¥¼ ì œê³µí•  ê²ƒì¸ë° ì´ë•Œ ì¡°íšŒìˆ˜ë„ í¬í•¨ë˜ì–´ì•¼í•œë‹¤. ë¹„êµí•  ë°©ì‹ë“¤ ì†Œê°œ Select í›„ Redisì— ìºì‹œëœ ì¡°íšŒìˆ˜ ì´ìš© ì˜ìƒì— ëŒ€í•œ ì •ë³´ ìì²´ëŠ” Video í…Œì´ë¸”ì„ ì´ìš©í•´ Read ì¡°íšŒìˆ˜ëŠ” Redisì— ìºì‹œëœ ê°’ì„ MGETì„ í†µí•´ ë°°ì¹˜(ë²Œí¬)ë¡œ ì¡°íšŒí•´ì™€ì„œ ì´ìš© Select í•˜ë©° Columnì— ìºì‹œëœ ì¡°íšŒìˆ˜ ì´ìš© ì˜ìƒ ì •ë³´ì™€ ì¡°íšŒìˆ˜ ëª¨ë‘ Video í…Œì´ë¸”ì„ í†µí•´ ë°”ë¡œ Read Select í›„ Batchë¡œ In-Query JPAë¥¼ ì´ìš©í•˜ë©´ì„œ í”íˆ ë°œìƒí–ˆë˜ N+1 ì¿¼ë¦¬ë¥¼ Batchë¡œ í•´ê²°í•  ë•Œì™€ ë™ì¼í•˜ê²Œ Video í…Œì´ë¸” ì¡°íšŒ í›„ View í…Œì´ë¸”ì—ì„œ view.id in (?,?,\u0026hellip;) ì˜ í˜•íƒœë¡œ In-Queryë¥¼ ì´ìš© Select í›„ ë‚˜ì¤‘ì— ê°ê°ì„ Join N+1 ì¿¼ë¦¬ ë¬¸ì œ ê·¸ ìì²´..! ì‹¤í—˜ ê²°ê³¼ ì‹¤í—˜ ê²°ê³¼ 1 ğŸ¥‡ Select í•˜ë©° Columnì— ìºì‹œëœ ì¡°íšŒìˆ˜ ì´ìš© ğŸ¥ˆ Select í›„ Redisì— ìºì‹œëœ ì¡°íšŒìˆ˜ ì´ìš© ğŸ¥‰ Select í›„ ë‚˜ì¤‘ì— ê°ê°ì„ Join Select í›„ Batchë¡œ In-Query ìš°ì„ ì€ ì–´ë–¤ ìª½ìœ¼ë¡œë“  ìºì‹±ì„ ì´ìš©í•˜ëŠ” ê²Œ ì°¸ ë¹ ë¥´êµ¬ë‚˜ ì‹¶ì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì¡°ê¸ˆ ì˜ì•„í•  ìˆ˜ ìˆëŠ” ë¶€ë¶„ë“¤ë„ ì¡´ì¬í•˜ëŠ”ë°ìš”.\nRedisì— ì¡°íšŒìˆ˜ë¥¼ ìºì‹±í•œ ê²½ìš°ë³´ë‹¤ MySQLì— ìºì‹±í•œ ê²½ìš°ê°€ ë” ë¹ ë¥´ë„¤..? ì–´ë–»ê²Œë³´ë©´ ë‹¹ì—°í•˜ê² ì§€ë§Œ MySQLì—ì„œ Join ì—†ì´ view_countë¥¼ ì¡°íšŒí•  ìˆ˜ë§Œ ìˆë‹¤ë©´ Redisë¥¼ ê±°ì¹˜ëŠ” ê²ƒë³´ë‹¤ MySQLë§Œìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ë” ë¹ ë¥¼ ê²ƒì…ë‹ˆë‹¤.\ní•˜ì§€ë§Œ Redisë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ê°€ Read ì†ë„ë•Œë¬¸ë§Œì€ ì•„ë‹ ê²ƒì…ë‹ˆë‹¤. ì•ì„œ ë§ì”€ë“œë¦° ëŒ€ë¡œ ì‹±ê¸€ ìŠ¤ë ˆë“œ ê¸°ë°˜ì˜ ì •í™•í•œ countê°€ ê°€ëŠ¥í•  ê²ƒì´ê³ , RDBì˜ í…Œì´ë¸” ìŠ¤í‚¤ë§ˆë¥¼ ë³€ê²½í•  í•„ìš”ë„ ì—†ì£ .\nê·¸ë¦¬ê³  ë¬´ì—‡ë³´ë‹¤ ì˜ìƒ ì¡°íšŒ ì´ë²¤íŠ¸ ë°œìƒë§ˆë‹¤ RDBì˜ íŠ¹ì • rowì˜ ì¡°íšŒìˆ˜ë¥¼ +1 í•˜ì—¬ update í•˜ëŠ” ê²ƒë³´ë‹¤ëŠ” redisì—ì„œ incrementí•˜ëŠ” ê²ƒì´ ë¹ ë¥¼ ê²ƒì…ë‹ˆë‹¤! ì¦‰, writeê¹Œì§€ ê³ ë ¤í•˜ë©´ ì†ë„ ì¸¡ë©´ì—ì„œë„ redisê°€ ë¹ ë¥¼ ê²ƒì…ë‹ˆë‹¤.\nN+1 ì¿¼ë¦¬ ë¬¸ì œë¥¼ ì•¼ê¸°í•˜ëŠ” ë°©ì‹ì´ Batchë¡œ In-Queryí•˜ëŠ” ë°©ì‹ë³´ë‹¤ ë¹ ë¥´ë„¤..? ì´ ë¶€ë¶„ì€ ì •í™•í•œ ì›ì¸ì€ ëª¨ë¥´ê² ì§€ë§Œ ì•„ë§ˆ ì¶”ì¸¡ì»¨ëŒ€ Batch ë°©ì‹ìœ¼ë¡œ í•œ ë²ˆì— ëª‡ ë§Œê°œ ìˆ˜ì¤€ì˜ ë„ˆë¬´ë‚˜ ë§ì€ ë°ì´í„°ë¥¼ ì¹´í‹°ì…˜ ê³±ìœ¼ë¡œ ì¡°íšŒí•œ ë’¤ ê° videoì˜ ì¡°íšŒìˆ˜ ë‚´ì—­ìœ¼ë¡œ ë„£ì–´ì£¼ë ¤ë‹¤ë³´ë‹ˆ ì¡°íšŒ í›„ ì—°ì‚°ì´ ë§ì€ ì‹œê°„ì„ ì¡ì•„ë¨¹ì€ ê²Œ ì•„ë‹ê¹Œ ì‹¶ìŠµë‹ˆë‹¤. ë°˜ë©´ N+1 ì¿¼ë¦¬ ë°©ì‹ì€ ê° videoì— ëŒ€í•´ í•œ ë²ˆì”© ì¿¼ë¦¬í•œ ë’¤ ë°”ë¡œ ê·¸ ê²°ê³¼ count í•  ìˆ˜ ìˆìœ¼ë‹ˆ ì´ëŸ° íŠ¹ìˆ˜í•œ ê²½ìš°(ë°ì´í„°ê°€ ì—„~ì²­ ë§ì€ ê²½ìš°)ì—ëŠ” ì˜¤íˆë ¤ Batch ë°©ì‹ì´ ëŠë¦´ ìˆ˜ ìˆëŠ” ê²Œ ì•„ë‹ê¹Œ ì‹¶ìŠµë‹ˆë‹¤.\nì‹¤ì œë¡œ ì¡°íšŒìˆ˜ê°€ ì•½ 10ê°œ ì •ë„ì¸ ì˜ìƒì„ ë˜‘ê°™ì´ 5ê°œ ì¡°íšŒí•´ë³´ë‹ˆ ìš°ë¦¬ì˜ ì¼ë°˜ì ì¸ ì˜ˆìƒëŒ€ë¡œ Batch ë°©ì‹ì´ N+1 ì¿¼ë¦¬ë³´ë‹¤ ë¹¨ëëŠ”ë°ìš”! ì•„ë§ˆ ì¹´í‹°ì…˜ ê³±ì´ ì¼ì–´ë‚¬ì§€ë§Œ ì–‘ ìì²´ê°€ ì ì€ ì¿¼ë¦¬ ê²°ê³¼ë¥¼ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ redisì™€ì˜ Në²ˆì˜ í†µì‹ ì´ ë” ëŠë¦¬ê¸° ë•Œë¬¸ì´ ì•„ë‹ê¹Œ ì‹¶ìŠµë‹ˆë‹¤.\nì¡°íšŒìˆ˜ë¥¼ ìœ„í•´ ê°€ì¥ ì´ìƒì ì¸ ì•„í‚¤í…ì³ëŠ”?! ìƒìƒ ì† ì•„í‚¤í…ì³ ì‹¤í—˜ ê²°ê³¼ì—ì„œë„ Redisë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë‚˜ì˜ì§€ ì•Šì€ ê²ƒìœ¼ë¡œ ë³´ì—¬ì§‘ë‹ˆë‹¤. ê·¸ë˜ì„œ ì €ë¼ë©´ ì •ë§ ì´ëŸ° ì‹ìœ¼ë¡œ ìµœì í™”ë¥¼ í•´ë³¼ ìˆ˜ ìˆëŠ” ê¸°íšŒê°€ ìˆë‹¤ë©´ Redisë¥¼ ë„ì…í•´ë³¼ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ê·¸ ë™ì•ˆ ìˆ˜ì—†ì´ ê³ í†µë°›ì•„ì™”ë˜ N+1 ì¿¼ë¦¬ ë¬¸ì œë„ ì–´ëŠ ì •ë„ í•´ê²°í•  ìˆ˜ ìˆê² ì£ ?! ë¶ˆí•„ìš”í•œ ì–‘ë°©í–¥ ì—°ê´€ ê´€ê³„ëŠ” ìµœëŒ€í•œ ë‹¨ë°©í–¥ ì—°ê´€ ê´€ê³„ë¡œ ì œí•œí•˜ê³ , Countê°€ í•„ìš”í•  ë•Œ ê° ì—”í‹°í‹°ë§ˆë‹¤ì˜ íŠ¹ì • Count ê°’ì„ ìœ„í•´ Në²ˆì˜ ì¿¼ë¦¬ë¥¼ ìˆ˜í–‰í•  í•„ìš”ë„ ì—†ì–´ì§ˆ ê²ƒì…ë‹ˆë‹¤.\ní•˜ì§€ë§Œ Redisë¥¼ ë„ì…í•œë‹¤ê³  ë§Œì‚¬ê°€ í•´ê²°ë˜ëŠ” ê²ƒì€ ì•„ë‹ ê²ƒì…ë‹ˆë‹¤. RedisëŠ” ì˜ì†ì„±ì´ ë³´ì¥ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì˜ìƒ ì¡°íšŒ ë‚´ì—­ì´ ì¦ë°œí•´ë²„ë¦´ ìˆ˜ë„ ìˆê³ , ì–‘ì´ í•œì •ì ì¼ ìˆ˜ ìˆì£ . ê·¸ë˜ì„œ ì €ëŠ” ë‹¨ìˆœ Redis ë¿ë§Œ ì•„ë‹ˆë¼ ë‹¤ìŒê³¼ ê°™ì€ ë°©ì‹ì€ ì–´ë–¨ê¹Œ ìƒê°í•´ë³´ê³  ìˆìŠµë‹ˆë‹¤.\nìµœê·¼ ì˜ìƒ ì¡°íšŒ ë‚´ì—­ì€ view_histories:{{username}} í˜•íƒœì˜ key, {{video_id}} í˜•íƒœì˜ valueë¡œ 1ì°¨ì ìœ¼ë¡œ Redisì— ì €ì¥í•œë‹¤. ì¡°íšŒìˆ˜ëŠ” view_count:{{vide_id}} í˜•íƒœì˜ key, {{view_count}} í˜•íƒœì˜ valueë¡œ Redisì— ìºì‹œí•œë‹¤. ìµœê·¼ ì˜ìƒ ì¡°íšŒ ë‚´ì—­ì„ redisë¥¼ í†µí•´ ë¹ ë¥´ê²Œ ì½ê³  ì“¸ ìˆ˜ ìˆë‹¤. ì˜ìƒ ì¡°íšŒìˆ˜ë¥¼ Redisì˜ Incrementë¡œ ë¹„êµì  ì •í™•í•˜ê²Œ ê³„ì‚°í•  ìˆ˜ ìˆë‹¤. ìœ ì €ì˜ ìµœê·¼ ì˜ìƒ ì¡°íšŒ ë‚´ì—­ì„ ê° ìœ ì €ë³„ë¡œ TTLì„ ê±¸ ìˆ˜ ìˆë‹¤. =\u0026gt; Redis ë©”ëª¨ë¦¬ ì ˆì•½ ì˜ìƒì˜ ì¡°íšŒìˆ˜ë¥¼ ì˜ìƒë³„ë¡œ TTL ê±¸ ìˆ˜ ìˆë‹¤ =\u0026gt; Redis ë©”ëª¨ë¦¬ ì ˆì•½ ì˜ìƒ ì¡°íšŒ ì´ë²¤íŠ¸ ì €ì¥ ì‹œ Redisì˜ event:video_viewed ë¼ëŠ” keyì˜ Listì— ì•ì„œ ì–¸ê¸‰í•œ ì¡°íšŒ ë‚´ì—­ê³¼ ë™ì¼í•œ ì¡°íšŒ ë‚´ì—­ì„ ì €ì¥í•œë‹¤.(ë©”ì‹œì§€ íì— Enqueueí•˜ëŠ” ëŠë‚Œ) SQS ê°™ì€ Message queueëŠ” ì¡°íšŒìˆ˜ ì´ë²¤íŠ¸ê°€ ìŸì•„ì§€ëŠ” ê²ƒì— ë¹„í•´ latencyê°€ ëŠë¦¼. ë”°ë¼ì„œ Redisë¥¼ íë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒë„ ê´œì°®ì•„ë³´ì„. Redis event:video_viewed ë¼ëŠ” Listì—ì„œ ì¡°íšŒ ì´ë²¤íŠ¸ë¥¼ ë½‘ì•„ ì„œë²„ë¦¬ìŠ¤í•œ NoSQLì¸ DynamoDBì— ìœ ì €ì˜ ì¡°íšŒ ë‚´ì—­ì„ ì˜êµ¬ì ìœ¼ë¡œ ì €ì¥í•œë‹¤. ì˜ìƒ ì¡°íšŒ ë‚´ì—­ì„ redisì— ìºì‹œí•  ë¿ë§Œ ì•„ë‹ˆë¼ ì˜êµ¬ì ìœ¼ë¡œ ì €ì¥í•˜ê¸° ìœ„í•¨. ë§ˆì¹˜ Redisë¥¼ ë²„í¼, Write-back cacheë¡œ ì´ìš©í•˜ëŠ” ëŠë‚Œì¸ë° NoSQLì´ë¼í•´ë„ ì£¼ê¸°ì ì¸ Bulk writeì€ ì£¼ê¸°ë•Œë§ˆë‹¤ ë¶€ë‹´ë  ìˆ˜ ìˆìŒ. ê·¸ë¦¬ê³  ì¡°íšŒ ì´ë²¤íŠ¸ëŠ” ê³„ì† ê³„ì† ë¹ ë¥´ê²Œ í™•ì¥ë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— NoSQL ì¤‘ì—ë„ ì„œë²„ë¦¬ìŠ¤ì¸ DynamoDBë¥¼ ì‚¬ìš©í•˜ë©´ ì–´ë–¨ê¹Œ ì‹¶ìŒ. (ì£¼ì˜: DynamoDB ì•ˆì¨ë´„\u0026hellip;) (ë‹¨ ìœ„ì˜ ì•„í‚¤í…ì³ëŠ” ì œ ê°œì¸ì ì¸ ìƒê°ì¼ ë¿, ì‹¤ì œë¡œëŠ” ì–´ë–»ê²Œë“¤ ì‚¬ìš©í•˜ì‹œëŠ”ì§€ ê¶ê¸ˆí•˜ë„¤ìš”..! ì´ë ‡ê²Œ ì§ì ‘ í•œ í•„ë“œì— ëŒ€í•´ ë³µì¡í•œ ë°©ì‹ì„ ì´ìš©í•˜ê¸°ë³´ë‹¨ ì¢€ ë” ë‹¨ìˆœíˆ ìºì‹± í”„ë ˆì„ì›Œí¬ë¥¼ ì´ìš©í•˜ëŠ” ê²ƒë„ ì¢‹ì€ ì„ íƒì§€ì¼ ìˆ˜ë„ ìˆì„ ê²ƒ ê°™êµ¬ìš”.)\në§ˆì¹˜ë©° ì´ë ‡ê²Œ Count ì„±í–¥ì˜ ì‘ì—…ì„ ì–´ë–»ê²Œ ìµœì í™”í•  ìˆ˜ ìˆì„ì§€ ìƒìƒê³¼ ì‹¤í—˜ì„ í†µí•´ ì •ë¦¬í•´ë´¤ìŠµë‹ˆë‹¤. ì¤‘ìš”í•œ ê²ƒì€ í•˜ë‚˜ì˜ ì •ë‹µì´ ì¡´ì¬í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆê³ , ì²˜í•œ ìƒí™©ë§ˆë‹¤ ì²œì°¨ë§Œë³„ì˜ ì†”ë£¨ì…˜ë“¤ì´ ìˆì„í…Œë‹ˆ ê°ê°ì„ ì˜ ë¹„êµí•´ë³´ê³  ì˜ PoC í•œ ë’¤ ì‚¬ìš©í•˜ëŠ” ê²ƒì¸ ë“¯í•©ë‹ˆë‹¤.\nìºì‹œë‚˜ Redisì— ëŒ€í•´ ê´€ì‹¬ì´ ë§ì€ í¸ì´ì§€ë§Œ, ì•„ì§ ë§ì´ ë¶€ì¡±í•˜ë‹¤ë³´ë‹ˆ ì¢‹ì€ ë§ì”€ ëŒ“ê¸€ë¡œ ë‹¬ì•„ì£¼ì‹œë©´ ê°ì‚¬íˆ ë°°ì›Œë‚˜ê°€ê² ìŠµë‹ˆë‹¤~! ê°ì‚¬í•©ë‹ˆë‹¤.\n","date":"2021-11-24T03:46:54+09:00","image":"https://umi0410.github.io/blog/optimizing-count-query-strategy/index_hu2e0266c55b356006b8efd84bbe6e386e_394889_120x120_fill_box_smart1_3.png","permalink":"https://umi0410.github.io/blog/optimizing-count-query-strategy/","title":"ì¿¼ë¦¬ ìµœì í™”í•˜ê¸° - ì¡°íšŒìˆ˜ì™€ ê°™ì€ Count ì„±ê²©ì˜ ì‘ì—… ìµœì í™”í•˜ê¸° (N+1 ë¬¸ì œ ê´€ë ¨, feat. Redis)"},{"content":"ì‹œì‘í•˜ë©° â€œì˜¤í”ˆ ê·¸ë˜í”„ ì§€ì›í•´ì£¼ì„¸ìš”.â€ ì˜¤í”ˆê·¸ë˜í”„ê°€ ì‚¬ìš©ëœ ì¸ìŠ¤íƒ€ DM, í˜ë¶ ë©”ì‹ ì €, ì¹´í†¡ ì˜ˆì‹œ ì„œë¹„ìŠ¤ ì¶œì‹œë¥¼ ì•ë‘ê³  ë§ˆë¬´ë¦¬ ì‘ì—…ì„ í•˜ë˜ ì¤‘ ìŠê³  ìˆì—ˆë˜ SNS ê´€ë ¨ ê¸°ëŠ¥ë“¤ì´ ìˆì—ˆìŠµë‹ˆë‹¤. ê·¸ ì¤‘ OpenGraphë¥¼ í†µí•´ \u0026ldquo;ê³µìœ í•˜ê¸°\u0026rdquo; ê¸°ëŠ¥ ìˆ˜í–‰ ì‹œì— ì ì ˆí•œ ë©”íƒ€ë°ì´í„°ë¥¼ ì œê³µí•´ì¤˜ì•¼ í–ˆìŠµë‹ˆë‹¤. ë³„ë¡œ ì–´ë ¤ìš´ ê¸°ëŠ¥ì€ ì•„ë‹ˆì§€ë§Œ ì´ë¥¼ ì œê³µí•˜ê¸° ìœ„í•´ ì ì ˆí•œ ë°©í–¥ì„ ì°¾ê¸°ê°€ ì‰½ì§€ ì•Šì•˜ë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ê³ ë¯¼ê³¼ ì‚½ì§ˆ ëì— ì €ëŠ” CloudFront, API Gateway, Lambda ì„œë¹„ìŠ¤ë“¤ì„ ì´ìš©í•˜ê¸°ë¡œ ê²°ì •í–ˆê³ , Serverless frameworkë¥¼ ì´ìš©í•´ Golang ë°”íƒ•ì˜ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¥¼ ê°œë°œí–ˆìŠµë‹ˆë‹¤.\nOpenGraph? SSR? ë³¸ ê¸€ì€ ì•„í‚¤í…ì³ë‚˜ ê¸°ìˆ  ì„ ì •ì— ëŒ€í•œ ë‚´ìš©ì„ ë§ì´ ë‹´ì„ ê²ƒì´ë¼ì„œ ì •ì˜ì— ëŒ€í•œ ìì„¸í•œ ì„¤ëª…ì€ ìƒëµí•˜ê² ìŠµë‹ˆë‹¤.\nOpenGraphëŠ” \u0026lt;head\u0026gt; íƒœê·¸ ì•ˆì— \u0026lt;meta property=\u0026quot;og:title\u0026quot; content=\u0026quot;ë°°í‹€íŒ¡::ì§§ê³  ì¬ë°ŒëŠ” ë™ì˜ìƒ ë°°í‹€\u0026quot; /\u0026gt; ê³¼ ê°™ì€ í˜•íƒœë¡œ ë©”íƒ€ë°ì´í„°ë“¤ì„ ì •ì˜í•´ SNSë‚˜ í¬ë¡¤ë§ ë´‡ë“¤ì´ ì‚¬ì´íŠ¸ì˜ ì •ë³´ë¥¼ ì¢€ ë” í†µì¼ëœ ë°©ë²•ìœ¼ë¡œ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ê²ƒê³¼ ê´€ë ¨ëœ ê°œë…ì…ë‹ˆë‹¤. ê·¸ë¦¬ê³  SSR(Server Side Rendering)ì€ í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ì—ê²ŒëŠ” ê»ë°ê¸° ê°™ì€ íŒŒì¼ë§Œ ì œê³µë°›ê³  ì‹¤ì œ í˜ì´ì§€ì˜ ë‚´ìš©ì€ Client ì¸¡ì—ì„œ APIì™€ js ë“±ì„ ì´ìš©í•´ ë§Œë“¤ì–´ë‚˜ê°€ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. ì•„ë§ˆ ëŒ€ë¶€ë¶„ì˜ SPA ì•±ë“¤ì€ CSRë¡œ ë°°í¬/ê°œë°œ ë˜ê³  ìˆëŠ” ê²ƒ ê°™ì€ë°ìš”. ê·¸ ì´ìœ ëŠ” í”„ë¡ íŠ¸ì—”ë“œë¥¼ ì œê³µí•  ë•Œ S3ë‚˜ CloudFront, Github Page ë“± ì„œë²„ì˜ ê¸°ëŠ¥ê³¼ ì™„ì „íˆ ë¶„ë¦¬í•˜ì—¬ ì œê³µí•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë¼ëŠ” ì ì´ í¬ê²Œ ì‘ìš©í•˜ì§€ ì•Šì„ê¹Œ ì‹¶ìŠµë‹ˆë‹¤.\n\u0026ldquo;ì™œ OpenGraphë¥¼ ì œê³µí•˜ëŠ”ë° SSRì´ í•„ìš”í•´?\u0026rdquo;\ní¬ë¡¤ë§ ë´‡ë“¤ì€ JSë¥¼ ì‹¤í–‰í•˜ì§€ ì•ŠëŠ” ê²½ìš°ê°€ ëŒ€ë‹¤ìˆ˜ì…ë‹ˆë‹¤. ë°˜ë©´ ì¼ë°˜ì ì¸ CSR ë°©ì‹ì˜ SPA ì•±ë“¤ì€ JSë¥¼ ì´ìš©í•´ ì„œë²„ì—ê²Œ APIë¥¼ í˜¸ì¶œí•´ ê·¸ ì‘ë‹µìœ¼ë¡œ í˜ì´ì§€ë¥¼ ë§Œë“¤ì£ . ë”°ë¼ì„œ JSë¥¼ ì‹¤í–‰í•˜ì§€ ì•ŠëŠ” í¬ë¡¤ë§ ë´‡ì€ ê¸°ëŒ€ë˜ëŠ” ë°ì´í„°ê°€ ì„œë²„ë¡œë¶€í„° ì œê³µë˜ê¸° ì´ì „ì¸ ë¹ˆ ê»ë°ê¸°ì˜ íŒŒì¼ë§Œ ì œê³µë°›ê²Œ ë©ë‹ˆë‹¤. ë”°ë¼ì„œ \u0026ldquo;ê³µìœ í•˜ê¸° ë§í¬\u0026quot;ëŠ” í¬ë¡¤ë§ ë´‡ì´ ì˜¤í”ˆê·¸ë˜í”„ë¥¼ ì½ì„ ìˆ˜ ìˆë„ë¡ SSRë¡œ ì˜¤í”ˆ ê·¸ë˜í”„ ë©”íƒ€ë°ì´í„°ë“¤ì´ ë‹´ê¸´ HTMLì„ ì œê³µí•´ì¤˜ì•¼í•˜ëŠ” ê²ƒì´ì£ !\nì˜¤í”ˆ ê·¸ë˜í”„ ì œê³µì„ ìœ„í•œ SSR(Server Side Rendering) ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ê·¸ë˜ì„œ ì˜¤í”ˆ ê·¸ë˜í”„ë¥¼ ìœ„í•œ ì •ë³´ë§Œì„ SSRë¡œ ì œê³µí•˜ëŠ” ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¥¼ ë§Œë“¤ê³ ìí–ˆìŠµë‹ˆë‹¤. HTML íŒŒì¼ì„ ì œê³µí•˜ëŠ” ì‹œì ì— ë‹¨ìˆœ ì •ì  íŒŒì¼ ì œê³µì´ ì•„ë‹Œ ë¡œì§ ìˆ˜í–‰ í›„ ë™ì ìœ¼ë¡œ íŒŒì¼ì„ ì œê³µí•´ì•¼í•œë‹¤ë©´ ì‚¬ì‹¤ ê°œë°œ ì¤‘ì´ë˜ Spring ì„œë²„ì—ì„œ ì—”ë“œí¬ì¸íŠ¸ í•˜ë‚˜ë§Œ ë” íŒŒì„œ ê°œë°œì„ í•˜ë©´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ë ‡ê²Œ ë˜ë©´ ë©”ì¸ ë°±ì—”ë“œ ì½”ë“œì— SSR ê´€ë ¨ í˜ì´ì§€ ì œê³µ ê¸°ëŠ¥ì´ ì¶”ê°€ë˜ì–´ì•¼í•˜ëŠ”ë° API ì„œë²„ì™€ ê°™ì€ ê³³ì—ì„œ ì¼ì¢…ì˜ í”„ë¡ íŠ¸ì˜ ê¸°ëŠ¥ì„ í•˜ëŠ” SSRì´ ê³µì¡´í•˜ëŠ” í˜•íƒœëŠ” ì„ í˜¸í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê²Œë‹¤ê°€ ë°±ì—”ë“œì¸ Spring bootì—ì„œë„ ì–´ë–¤ ìš”ì²­ì— ëŒ€í•´ ì—ëŸ¬ë¡œ ì‘ë‹µí•  ë•Œ SSRì— ëŒ€í•œ ì—ëŸ¬ ì²˜ë¦¬ë¡œ í•´ì¤˜ì•¼í•  ì§€ APIì— ëŒ€í•œ ì—ëŸ¬ ì²˜ë¦¬ë¡œ í•´ì¤˜ì•¼í•  ì§€ ë“±ë“± ê½¤ë‚˜ ê°œë°œì ìœ¼ë¡œ ê³¨ì¹˜ê°€ ì•„í”ˆ ë¶€ë¶„ì´ ë§ì•˜ìŠµë‹ˆë‹¤.\n{ \u0026#34;message\u0026#34;: \u0026#34;ì˜¬ë°”ë¥´ì§€ ì•Šì€ í˜ì´ì§€ì…ë‹ˆë‹¤.\u0026#34;, \u0026#34;error\u0026#34;: \u0026#34;NotFound\u0026#34; } ì˜ˆë¥¼ ë“¤ë©´ APIì— ëŒ€í•œ ì—ëŸ¬ ì‘ë‹µì€ ìœ„ì™€ ê°™ì€ í˜•íƒœë¥¼ ë„ëŠ” ê²ƒì´ ì¢‹ì„ ê²ƒì´ê³ , ê·¸ë˜ì•¼ í”„ë¡ íŠ¸ì—”ë“œì—ì„œë„ ì²˜ë¦¬ë¥¼ í•˜ê¸° í¸í•  ê²ƒì…ë‹ˆë‹¤. ë°˜ë©´ SSRì— ëŒ€í•œ ì—ëŸ¬ ì‘ë‹µì€ ì–´ì¨Œë“  ì‚¬ìš©ìê°€ ì§ì ‘ ëŒ€ë©´í•˜ëŠ” í˜ì´ì§€ì´ë‹¤ë³´ë‹ˆ ê²°êµ­ ë©”ì¸ ì„œë¹„ìŠ¤ì˜ í”„ë¡ íŠ¸ì—”ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ê°€ ë˜ì–´ ë©”ì¸ ì„œë¹„ìŠ¤ì˜ í”„ë¡ íŠ¸ì—”ë“œê°€ ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ í•´ì¤˜ì•¼í•  ê²ƒì´êµ¬ìš”.\n\u0026lsquo;ì´ê²Œ ë¬´ìŠ¨ ì†Œë¦¬ì§€?\u0026rsquo; ë¼ê³  ìƒê°í•˜ì‹¤ ìˆ˜ ìˆëŠ”ë°, SSRë¡œ ì œê³µëœ í˜ì´ì§€ëŠ” ê²°êµ­ \u0026ldquo;ê³µìœ í•˜ê¸°\u0026quot;ë¥¼ í†µí•´ ë§í¬ë¥¼ ì „ë‹¬ ë°›ì€ ì‚¬ìš©ìê°€ ì§ì ‘ ì ‘ì†í•˜ëŠ” í˜ì´ì§€ì´ë©´ì„œ ë™ì‹œì— í¬ë¡¤ë§ ë´‡ì´ ì˜¤í”ˆ ê·¸ë˜í”„ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•´ê°€ëŠ” í˜ì´ì§€ì´ê¸°ë„ í•©ë‹ˆë‹¤.\ní¬ë¡¤ë§ ë´‡ì€ JSë¥¼ ìˆ˜í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤ ë”°ë¼ì„œ ì˜¬ë°”ë¥¸ ë©”íƒ€ë°ì´í„°ê°€ ë‹´ê¸´ HTML ë§Œë“¤ê¸° ìœ„í•´ì„  SSRì´ í•„ìš”í•˜ë‹¤. SSRë¡œ ì œê³µëœ í˜ì´ì§€ë¡œ ìœ ì €ê°€ ì ‘ì†í–ˆì„ ë•Œ ì„œë¹„ìŠ¤ë¡œ ì˜¬ë°”ë¥´ê²Œ ì ‘ì†í•  ìˆ˜ ìˆì–´ì•¼í•œë‹¤. í•˜ì§€ë§Œ ì„œë¹„ìŠ¤ ìì²´ë¥¼ SSR ë°©ì‹ìœ¼ë¡œ ë³€ê²½í•˜ê¸°ì—ëŠ” ë¬´ë¦¬ê°€ ìˆë‹¤! ìœ„ì™€ ê°™ì€ íŠ¹ì§•ë“¤ë¡œ ì¸í•´ ì˜¤í”ˆ ê·¸ë˜í”„ ì œê³µì„ ìœ„í•œ SSR ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë™ì‘í•˜ë©´ ì¢‹ì§€ ì•Šì„ê¹Œ?! ì‹¶ì—ˆì–´ìš”.\nì˜¤í”ˆê·¸ë˜í”„ ì •ë³´ê°€ ë‹´ê¸´ ë™ì ìœ¼ë¡œ ìƒì„±ëœ HTMLì€ SSR ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì— ì˜í•´ ì œê³µëœë‹¤. SSR ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ëŠ” ìš”ì²­ì´ ë“¤ì–´ì™”ì„ ë•Œ API ì„œë²„ì—ê²Œ í•´ë‹¹ ìš”ì²­ê³¼ ê´€ë ¨ëœ ì •ë³´ë¥¼ ì§ˆì˜í•œë‹¤. ì´ë•Œ SSRì´ ì§ì ‘ DB(ìŠ¤í”„ë§ì´ ì´ìš© ì¤‘ì¸ DB)ë¥¼ ì´ìš©í•˜ì§€ ì•ŠëŠ” ê²Œ ì¢‹ì€ ì´ìœ ëŠ” ì •ë§ ë§ê² ì§€ë§Œ ìš°ì„ ì€ ë‹¤ìŒê³¼ ê°™ë‹¤. SSR ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ê°€ ì§€ì§€ê³  ë³¶ê³  ë­˜ í•´ë„ ìŠ¤í”„ë§ì˜ DB ì„¤ê³„ì—ëŠ” ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ”ë‹¤. SSRë¡œ ì¸í•´ ë©”ì¸ ìŠ¤í”„ë§ì´ í”ë“¤ë¦¬ëŠ” ê²ƒì„ ë°©ì§€í•´ì¤€ë‹¤. ì¼ë‹¨ ê°„ë‹¨í•˜ë‹¤. ê°„ë‹¨í•œ ì¡°íšŒë§Œì„ ìœ„í•´ DBë¥¼ ì„¤ì •í•˜ëŠ” ê²ƒë³´ë‹¤ëŠ” í•„ìš”í•œ APIì˜ í•„ìš”í•œ í•„ë“œë“¤ë§Œ ì •ì˜í•´ì„œ APIë¡œ ì¡°íšŒí•˜ëŠ” ê²Œ ë” ì‰¬ìš¸ ê²ƒì´ë‹¤. ë°˜ë©´ ìŠ¤í”„ë§ì´ API ìŠ¤í™ì„ ë³€ê²½í•  ë•Œ SSRì—ë„ ì˜í–¥ì´ ìˆì„ì§€ë¥¼ ê³ ë ¤í•´ì•¼í•œë‹¤ëŠ” ê²ƒê³¼ ì¶”ê°€ì ì¸ ì¸í”„ë¼ ê´€ë¦¬ê°€ í•„ìš”í•˜ë‹¤ëŠ” ë‹¨ì ë„ ìˆê¸´í•˜ë‹¤. ê³ ë ¤í–ˆë˜ ì¸í”„ë¼ ë° ì„¤ê³„ ElasticBeanstalk Lambda + ALB Lambda + API Gateway + CloudFront ê³ ë ¤í–ˆë˜ ì¸í”„ë¼ëŠ” ìœ„ì™€ ê°™ì•˜ê³  ê²°êµ­ì—ëŠ” 1, 2ë²ˆ ë°©ì‹ì€ ë‹¨ì ë“¤ì´ ì¡´ì¬í•´ì„œ 3ë²ˆìœ¼ë¡œ ì„ íƒí–ˆìŠµë‹ˆë‹¤!\nOption 1) ElasticBeanstalk ë°”íƒ•ì˜ ì¸í”„ë¼ ë¹ˆìŠ¤í†¡ ë°”íƒ•ì˜ ì¸í”„ë¼ ElasticBeanstalkì€ eb clië¥¼ í†µí•´ í¸ë¦¬í•˜ê²Œ ë°°í¬ë¥¼ í•  ìˆ˜ ìˆê³ , auto scaling groupë„ í¸ë¦¬í•˜ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆìŠµë‹ˆë‹¤. ì† ì‰¬ìš°ë©´ì„œë„ ì•ˆì •ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê¸°ëŠ” ë”±ì´ì£ . ê·¸ë¦¬ê³  ê¸°ì¡´ ë©”ì¸ ì„œë²„ì¸ ìŠ¤í”„ë§ ì„œë²„ë„ ë¹ˆìŠ¤í†¡ìœ¼ë¡œ ê´€ë¦¬ë¥¼ í•˜ê³  ìˆì—ˆê¸° ë•Œë¬¸ì— ë¹ˆìŠ¤í†¡ì— ìµìˆ™í•˜ë‹¤ëŠ” ì¥ì ë„ ìˆì—ˆìŠµë‹ˆë‹¤.\në‚´ë¶€ì ìœ¼ë¡œ ë¹ˆìŠ¤í†¡ì˜ ë„ì»¤ í”Œë«í¼ì— ëŒ€í•œ ê¶ê¸ˆì¦ë„ ìˆì—ˆê³  Goë¼ë©´ nano ì¸ìŠ¤í„´ìŠ¤ë¡œë„ ì–´ë–»ê²Œ ì˜ êµ´ë ¤ë³¼ ìˆ˜ ìˆì§€ ì•Šì„ê¹Œ ì‹¶ì€ ë§ˆìŒì— fiber í”„ë ˆì„ì›Œí¬ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê°œë°œì„ í–ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì•„ë¬´ë¦¬ Goë¼ë„ ìƒê°ë³´ë‹¤ nano ì¸ìŠ¤í„´ìŠ¤ë¡œ êµ´ë¦¬ê¸°ëŠ” í˜ë“¤ì—ˆê³ , microë„ ì•„ìŠ¬ì•„ìŠ¬í•˜ë”ë¼êµ¬ìš”.(microë„ ë¹Œë“œí•  ë•Œ OOMìœ¼ë¡œ ì‹¤íŒ¨í•¨.)\në¹ˆìŠ¤í†¡ ì¸ìŠ¤í„´ìŠ¤ ë‚´ë¶€ì—ì„œ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê³  íƒœê·¸ë¥¼ ìˆ˜ì •í•´ì„œ ë°°í¬ë¥¼ íŠ¸ë¦¬ê±° ì‹œí‚¤ëŠ” ë°©ì‹ì„ ì´ìš©í•˜ë©´ ë¹Œë“œ ë„ì¤‘ì˜ OOM ì´ìŠˆëŠ” ì—†ê² ì§€ë§Œ ECRì„ í†µí•´ ì´ë¯¸ì§€ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¥¼ ê´€ë¦¬í•´ì¤˜ì•¼í•˜ê³ , ë¹Œë“œí•  ë•Œë§ˆë‹¤ docker-compose.ymlì—ì„œ ì´ë¯¸ì§€ íƒœê·¸ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì—…ë°ì´íŠ¸ ì‹œì¼œì£¼ëŠ” ê³¼ì •ë„ ë²ˆê±°ë¡œìš¸ ê²ƒ ê°™ì•˜ì£ .\nìŠ¤í”„ë§ì´ t3.smallë¡œ ëŒì•„ê°€ê³  ìˆëŠ”ë°(ìŠ¤í”„ë§ì€ JARë¥¼ ì  í‚¨ìŠ¤ì—ì„œ ë¹Œë“œ) Goë¥¼ ì“°ë©´ì„œ t3.smallì„ ì“°ìë‹ˆ ì´ê±´ ì›¬ ê³µìœ í•˜ê¸° ê¸°ëŠ¥í•˜ë‚˜ì— ë³¸ ì„œë²„ì˜ ëª‡ ë¶„ì˜ 1ì— í•´ë‹¹í•˜ëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•´ì•¼í•˜ëŠ” ì´ìƒí•œ ì•„í‚¤í…ì³ê°€ ë˜ì–´ë²„ë¦´ ê²ƒë§Œ ê°™ì•˜ì£ . ë¹„ìš©ë„ ë¹„ìš©ì´êµ¬ìš”.\nê·¸ë˜ì„œ fiber ê°œë°œí•œ SSR ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¥¼ ElasticBeanstalkì— ë°°í¬í•˜ëŠ” ë°©ì‹ì€ ê¸°ê°ë˜ì—ˆìŠµë‹ˆë‹¤.\nOption 2) Lambda + ALB \u0026lsquo;SSRì„ ìœ„í•´ ì„œë²„ë¥¼ ê´€ë¦¬í•˜ëŠ” ê±´ ë„ˆë¬´ ë‚­ë¹„ê°€ í¬ë‹¤.\u0026lsquo;ëŠ” ìƒê°ì— ì„œë²„ë¦¬ìŠ¤ë¡œ ë°©í–¥ì„ ëŒë ¸ìŠµë‹ˆë‹¤. serverless í”„ë ˆì„ì›Œí¬ë¥¼ ê¸°ì¡´ì— ì´ìš©í•˜ê³  ìˆì—ˆê¸° ë•Œë¬¸ì— í¬ê²Œ ë‚¯ì„  ê¸°ìˆ ì€ ì•„ë‹ˆê¸°ë„ í–ˆêµ¬ìš”.\nLambdaë¥¼ ì´ìš©í•  ë•Œ Goì–¸ì–´ ê°™ì€ ê²½ìš°ì—ëŠ” AWS Lambdaì˜ ì½˜ì†” ì—ë””í„° í™”ë©´ì´ ì œê³µë˜ì§€ ì•Šì•„ ì¢€ ë¶ˆí¸í•´ íŒŒì´ì¬ìœ¼ë¡œ ê°œë°œì„ í• ê¹Œ ì‹¶ì—ˆëŠ”ë°, ë‹¨ë°©í–¥ì´ê¸´ í•˜ì§€ë§Œ APIë¡œ ë°€ì ‘í•˜ê²Œ ë©”ì¸ API ì„œë²„ë‘ í†µì‹ ì„ í•´ì•¼í•˜ëŠ” SSR ì„œë¹„ìŠ¤ì˜ íŠ¹ì„±ìƒ typeì„ ëª…í™•íˆ ì •ì˜í•´ì„œ API ìŠ¤í™ê³¼ ë¹„êµí•˜ê¸°ë„ í¸í•˜ê³ , ê°œë°œ/ë™ì‘ë„ ì•ˆì •ì ìœ¼ë¡œ í•  ìˆ˜ ìˆëŠ” Goë¥¼ ì„ íƒí–ˆìŠµë‹ˆë‹¤.\níŒŒì´ì¬ì€ APIì—ê²Œ ì‘ë‹µë°›ì€ jsonì„ ì–´ë–»ê²Œ ì—­ì§ë ¬í™”í• ê¹Œë¶€í„°ë„ ê³ ë¯¼ì´ì—ˆê³ , ê·€ì°®ì•„ì„œ ê·¸ëƒ¥ jsonì´ë‚˜ dictionaryë¡œ ìš°ê²¨ë„£ì–´ì„œ ê°œë°œì„ í•˜ë©´ ë‹¹ì‹œì—ëŠ” í¸í•˜ì§€ë§Œ ì¼ì£¼ì¼ë§Œ ì§€ë‚˜ë„ ë¬´ìŠ¨ ì½”ë“œì¸ì§€ ì•Œì•„ë³´ê¸° í˜ë“¤ê³  API ìŠ¤í™ì´ ë³€ê²½ë˜ëŠ” ê²½ìš°ì˜ ë””ë²„ê¹…ì€ ê±°ì˜ ê·¹ì•…ì˜ ë‚œì´ë„ì´ê¸° ë•Œë¬¸ì— íŒŒì´ì¬ë„ ë°°ì œí–ˆìŠµë‹ˆë‹¤.\ní•˜ì§€ë§Œ ALB =\u0026gt; Lambdaë¡œ ìš”ì²­ì„ ë°”ë¡œ ë„˜ê¸°ëŠ” ê²½ìš°, ALBì—ì„œ ë„˜ì–´ì˜¨ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ì´ ë„ˆë¬´ ê°„ë‹¨í•´ ì»¤ìŠ¤í„°ë§ˆì´ì§•í•˜ê¸°ê°€ ë” ê¹Œë‹¤ë¡œìš´ í˜•íƒœì˜€ìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ë©´ ê²½ë¡œë¥¼ ë°”íƒ•ìœ¼ë¡œ ë¼ìš°íŒ…í•˜ëŠ” ë¡œì§ì„ ì§ì ‘ êµ¬í˜„í•´ì•¼í–ˆì—ˆëŠ”ë°ìš”. ë³´í†µì˜ ì›¹ í”„ë ˆì„ì›Œí¬ì—ì„œ ì œê³µí•˜ëŠ” /*, /b/* ì´ëŸ° í‘œí˜„ë“¤ì„ ë°”íƒ•ìœ¼ë¡œ í•œ ê²½ë¡œì™€ í•¸ë“¤ëŸ¬ê°„ì˜ ë§µí•‘ì´ ë¶ˆê°€ëŠ¥í–ˆë˜ ê²ƒì…ë‹ˆë‹¤. ì´ìœ ëŠ” ì‰½ê²Œ ë§í•´ Lambdaì—ëŠ” stringìœ¼ë¡œ pathê°€ ë“¤ì–´ì˜¤ê³  ì‘ë‹µë„ stringìœ¼ë¡œ ì¤˜ì•¼í•˜ëŠ” ê²ë‹ˆë‹¤. ì´ ë°©ì‹ì€ ê¸°ì¡´ì˜ ì›¹í”„ë ˆì„ì›Œí¬ë¥¼ ì´ìš©í•´ ê°œë°œí•˜ë˜ ë°©ì‹ê³¼ëŠ” ê±°ë¦¬ê°€ ë©€ì£ .\në”°ë¼ì„œ ì´ ë°©ì‹ë„ ê¸°ê°ë˜ì—ˆìŠµë‹ˆë‹¤.\nOption 3) Lambda + API Gateway + CloudFront Lambda ë°”íƒ•ì˜ ì¸í”„ë¼ ë“œë””ì–´ ìµœì¢… ì±„íƒì•ˆ! \u0026quot;CloudFrontë¡œ HTTP/S ê´€ë ¨ ê¸°ëŠ¥ì„ ì²˜ë¦¬í•˜ê³ , ê·¸ Originì„ API Gatewayë¡œ ë‘” ë’¤ Lambdaë¡œ ìš”ì²­ ì²˜ë¦¬í•˜ê¸°\u0026rdquo; ì…ë‹ˆë‹¤. ì‚¬ì‹¤ API Gatewayì˜ ì´ëŸ° ì €ëŸ° ê¸°ëŠ¥ì´ ë³„ë¡œ í•„ìš” ì—†ì—ˆê¸°ì— \u0026lsquo;Lambdaë¥¼ ALBë¡œ ë…¸ì¶œì‹œí‚¬ ìˆ˜ ìˆìœ¼ë©´ ê°„ë‹¨í•˜ê²Œ ê·¸ë ‡ê²Œ í•˜ì\u0026lsquo;ë¼ê³  ìƒê°í–ˆë˜ ë°©ì‹ì´ Option 1ì´ì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ëŒë‹¤ë¡œ ALB TargetGroupì— ëŒ€í•œ ìš”ì²­ì„ ì§ì ‘ ì²˜ë¦¬í•˜ê¸°ì—ëŠ” ê°œë°œì ìœ¼ë¡œ ë§ì€ ë¶ˆí¸íˆ ìˆì—ˆì–´ìš”. ì •ë§ ê°„ë‹¨í•œ ì‘ì—…ìš© ê°™ì€ ëŠë‚Œ!\në°˜ë©´ Lambdaê°€ APIGatewayì—ê²Œì„œ ìš”ì²­ì„ ì „ë‹¬ë°›ìœ¼ë©´ ì•„ì£¼ í¸ë¦¬í•˜ê³  ìµìˆ™í•œ ë°©ì‹ìœ¼ë¡œ ê°œë°œì„ í•  ìˆ˜ê°€ ìˆì—ˆìŠµë‹ˆë‹¤.\n// ì½”ë“œ ì¼ë¶€ë¥¼ ì˜ˆì‹œë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤. func init(){ app = fiber.New() app.Use(logger.New()) app.Get(\u0026#34;/health\u0026#34;, func(ctx *fiber.Ctx) error { return ctx.SendString(\u0026#34;OK\u0026#34;) }) app.Get(\u0026#34;/\u0026#34;, handleIndex) app.Get(\u0026#34;/c/:clipId\u0026#34;, handleClip) app.Get(\u0026#34;/b/:battleId/:clipId\u0026#34;, handleBattleWithClips) app.Get(\u0026#34;/*\u0026#34;, handleDefaultNotFound) } func main() { // ëŒë‹¤ê°€ ì‹¤í–‰ëœë‹¤. // ìš”ì²­ë§ˆë‹¤ Handlerë¥¼ í˜¸ì¶œí•œë‹¤. lambda.Start(Handler) } func Handler(ctx context.Context, req events.APIGatewayV2HTTPRequest) (events.APIGatewayV2HTTPResponse, error) { return fiberadapter.New(app).ProxyWithContextV2(ctx, req) } ìœ„ì™€ ê°™ì´ ëŒë‹¤ë¡œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ í•¸ë“¤ëŸ¬ë¥¼ ì°¾ì•„ í˜¸ì¶œí•˜ëŠ” ë¡œì§ì„ ì§ì ‘ êµ¬í˜„í•˜ì§€ ì•Šê³  ê¸°ì¡´ì˜ ìœ ëª…í•œ ì›¹ í”„ë ˆì„ì›Œí¬ë“¤ê³¼ ê·¸ì— ëŒ€í•œ ì–´ëŒ‘í„°ë¥¼ í†µí•´ ê°œë°œí•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤! (ì°¸ê³ : aws-lambda-go-api-proxy) ëŒë‹¤ì˜ í•¸ë“¤ëŸ¬ê°€ fiber ì•±ì—ê²Œ ìš”ì²­ì„ ë„˜ê²¨ì„œ ê·¸ ì‘ë‹µì„ ë¦¬í„´í•˜ëŠ” í˜•íƒœì£ . fiber ì•±ì˜ í•¸ë“¤ëŸ¬ë“¤ì€ SSR ë°©ì‹ì˜ ë™ì ìœ¼ë¡œ ìƒì„±ëœ HTMLë“¤ì„ ë¦¬í„´í•´ì¤¬ìŠµë‹ˆë‹¤.\nawslabs Github - https://github.com/awslabs/aws-lambda-go-api-proxy AWSì—ì„œ ê°œë°œ ì¤‘ì¸ ì˜¤í”ˆì†ŒìŠ¤ ê°™ìŠµë‹ˆë‹¤. ìµœê·¼ ì»¤ë°‹ë„ 6ì¼ ì „ì¸ í™œë°œí•œ í”„ë¡œì íŠ¸ì¸ê°€ë´ìš”! (ê·¼ë° ì™œ ALB(TargetGroup) - Lambdaì— ëŒ€í•œ ì–´ëŒ‘í„°ë‚˜ í”„ë¡ì‹œ ì˜¤í”ˆì†ŒìŠ¤ëŠ” ê°œë°œì„ í•´ì£¼ì§€ ì•Šì€ ê±¸ê¹Œìš”.. ê¶ê¸ˆí•©ë‹ˆë‹¤.)\nì–´ì¨Œë“  Lambda + API Gatewayë¥¼ ì´ìš©í•˜ë©´ì„œ ì €ë ´í•˜ë©´ì„œë„ í¸ë¦¬í•˜ê²Œ ê°œë°œì„ í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œ ëë‚˜ë©´ ì¢‹ì•˜ê² ì§€ë§Œ ë‹¤ìŒ ì‚½ì§ˆì´ ìˆì—ˆìŠµë‹ˆë‹¤.\nAPI Gatewayë¥¼ ì»¤ìŠ¤í…€ ë„ë©”ì¸ ë„¤ì„ìœ¼ë¡œ ì´ìš©í•˜ê¸°. ì¦‰ ê¸°ë³¸ì ìœ¼ë¡œ API GatewayëŠ” AWS ìì²´ì ì¸ ë„ë©”ì¸ ë„¤ì„ì„ í†µí•´ ì œê³µë˜ê³ , ì¸ì¦ì„œë„ AWS ì¸¡ì—ì„œ ì œê³µì„ í•´ì¤ë‹ˆë‹¤. í•˜ì§€ë§Œ Custom domainì„ ì´ìš©í•˜ê³  ì‹¶ë‹¤ë©´? ìš°ë¦¬ì˜ ë„ë©”ì¸ì„ ì¸ì¦í•´ì¤˜ì•¼ê² ì§€ìš”. í•˜ì§€ë§Œ ê¸°ë³¸ì ìœ¼ë¡œëŠ” ê·¸ë ‡ê²Œ í•  ìˆ˜ ì—†ê³  ìœ„ì˜ ë§í¬ì˜ ë°©ë²•ì„ í†µí•´ì„œëŠ” ê°€ëŠ¥í•©ë‹ˆë‹¤. API Gatewayì— Custom domain nameì„ ë‹¬ê¸° ìœ„í•œ ì¶”ê°€ì ì¸ ë°©ë²•ë“¤ì´ì—ìš”.\nAPI Gateway doesn\u0026rsquo;t directly support http without TLS, presumably as a security feature \u0026hellip; - \u0026ldquo;Redirect http:// requests to https:// on AWS API Gateway (using Custom Domains)\u0026rdquo;\ní•˜ì§€ë§Œ ì´ë ‡ê²Œ API Gatewayë¥¼ Custom Domain nameìœ¼ë¡œ ì´ìš©í•  ìˆ˜ ìˆê²Œ í–ˆë”ë‹ˆ ì´ë²ˆì—” ë˜ ë‹¤ë¥¸ ì´ìŠˆê°€ ì¡´ì¬í–ˆì£ . ì¦‰, API GatewayëŠ” 443 HTTPSë§Œì„ ì§€ì›í•˜ê³  80 HTTPëŠ” ì§€ì›ì„ í•˜ì§€ ì•Šê³  HTTP-\u0026gt;HTTPSë¡œì˜ ë¦¬ë‹¤ì´ë ‰ì…˜ë„ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒì´ì—ˆìŠµë‹ˆë‹¤ ã„±-\u0026hellip; ê·¸ëŸ¼ ì–´ë–¤ ë¬¸ì œëƒ ìˆëƒ\u0026hellip; í•´ë‹¹ HTTPë¡œ ë§í¬ë¥¼ ì ‘ì†í•˜ë©´ ì•„ë¬´ëŸ° ì‘ë‹µì´ ì—†ìŠµë‹ˆë‹¤. ì¹˜ëª…ì ì´ì£ . ë”°ë¼ì„œ HTTPS Redirectë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” CloudFrontë¥¼ ì•ë‹¨ì— ë¶™ì´ê³  API Gatewayë¥¼ Originìœ¼ë¡œ ì„¤ì •í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ê°œì„ í–ˆìŠµë‹ˆë‹¤. ê·¸ ìµœì¢… ì•„í‚¤í…ì³ê°€ ìœ„ì˜ ê·¸ë¦¼ê³¼ ê°™êµ¬ìš”.\nê²°ê³¼ ê²°ê³¼ì ìœ¼ë¡œ ìœ„ì™€ ê°™ì´ URLì´ HTTP ì´ê±´ HTTPS ì´ê±´ ìƒê´€ ì—†ì´ ì›í™œíˆ ì˜¤í”ˆ ê·¸ë˜í”„ë¥¼ í†µí•´ ì ì ˆí•œ ì •ë³´ë¥¼ ì œê³µí•  ìˆ˜ ìˆì—ˆê³ , ì´ì œ ì •ë§ ì¶œì‹œê°€ ë‹¤ê°€ì˜¤ëŠ” ê²ƒ ê°™ì•„ ê±±ì • ë°˜ ì„¤ë ˜ ë°˜ì´ê¸°ë„ í•©ë‹ˆë‹¤.\në§ˆì¹˜ë©° SSRë¡œ ì˜¤í”ˆ ê·¸ë˜í”„ í•˜ë‚˜ ì œê³µí•˜ê² ë‹¤ê³  ì¼ìš”ì¼ ë‚´ë‚´ ì‚½ì§ˆì„ í•˜ê²Œ ëœ ê²ƒ ê°™ìŠµë‹ˆë‹¤. í‰ì†Œì— ì„œë²„ë¦¬ìŠ¤ëŠ” ì•„ë¬´ë˜ë„ ë²¤ë” lock-in ì´ìŠˆë‚˜ ê°œë°œ/ë””ë²„ê¹… ê³¼ì •ì—ì„œ ë¡œì»¬ê³¼ ì‹¤ì œ í´ë¼ìš°ë“œ í™˜ê²½ì˜ ì°¨ì´ë¡œ ì¸í•œ ë¶ˆí¸ ë“±ë“±ìœ¼ë¡œ ì¸í•´ ë³„ë¡œ ì„ í˜¸í•˜ì§€ ì•Šì•˜ëŠ”ë° ê·¸ë˜ë„ ê³µìœ í•˜ê¸° ê¸°ëŠ¥ì€ ì´ì œ ì•ìœ¼ë¡œ íŠ¸ë˜í”½ ê±±ì •ì„ í¬ê²Œ í•˜ì§€ ì•Šê³  ê°€ë³ê²Œ ì˜ ì‚¬ìš©í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ì•„ ì¢‹ìŠµë‹ˆë‹¤ ã…ã…\nì•„ì‰¬ìš´ ì ì€ ì¢€ ë” ê° ì„œë¹„ìŠ¤ë¥¼ ê° ì„œë¹„ìŠ¤ì˜ ì—­í• ì´ë‚˜ íŠ¹ì„±ì— ë§ì¶° ì‚¬ìš©í•  ìˆ˜ ìˆì—ˆìœ¼ë©´ ì¢‹ì•˜ì„í…ë°, ë‹¨ìˆœíˆ íŠ¹ì • ìƒí™©ì„ í•´ê²°í•˜ê¸° ìœ„í•œ ìˆ˜ë‹¨ìœ¼ë¡œ ì´ìš©í•˜ê²Œ ëœ ì ì´ ì¡°ê¸ˆ ì•„ì‰½ìŠµë‹ˆë‹¤.\nì˜ˆë¥¼ ë“¤ì–´ Lambdaë¥¼ ë…¸ì¶œì‹œí‚¤ê¸° ìœ„í•´ êµ³ì´ API Gatewayë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ALBë¡œ ê°„ë‹¨í•˜ê²Œ ì¶©ë¶„íˆ ë…¸ì¶œ ì‹œí‚¬ ìˆ˜ ìˆì—ˆì§€ë§Œ, ê°œë°œì ìœ¼ë¡œ API Gateway-Lambdaê°„ì˜ ì‘ì—…ì´ Adpater frameworkì„ í†µí•´ ê°œë°œí•˜ê¸° í¸í•´ì„œ API Gatewayë¥¼ ì´ìš©í•˜ê²Œ ëì£ . API Gatewayì˜ API Keyë¥¼ ì´ìš©í•˜ëŠ” ì¸ì¦/ì¸ê°€ ê¸°ëŠ¥ì´ë‚˜ ì“°ë¡œí‹€ë§ ì œí•œê³¼ ê°™ì€ ê¸°ëŠ¥ë“¤ì€ í•˜ë‚˜ë„ í•„ìš”ê°€ ì—†ëŠ”ë° ë§ì´ì£ .\nê±°ê¸°ì— CloudFrontëŠ” ì‚¬ì‹¤ìƒ Content Deliveryë‚˜ ìºì‹±ì´ë¼ëŠ” ì£¼ìš©ë„ë¡œ ì‚¬ìš©ë˜ë©´ ì¢‹ì•˜ê² ì§€ë§Œ ë‹¨ìˆœíˆ API Gatewayë¥¼ ì‚¬ìš©í•˜ë©´ì„œ HTTPSë¡œì˜ ë¦¬ë‹¤ì´ë ‰íŠ¸ë¥¼ ìœ„í•´ì„œ ì‚¬ìš©ëì„ ë¿ì´ë¼ëŠ” ì ì´ ì•„ì‰½ìŠµë‹ˆë‹¤.\në¬¼ë¡  CloudFrontë‚˜ API Gateway ê°™ì€ ì„œë¹„ìŠ¤ë“¤ë„ ê¸°ë³¸ì ìœ¼ë¡œ ì¼  ë§Œí¼ ëˆì´ ë‚˜ê°€ëŠ” ê²Œ ì•„ë‹ˆë¼ í˜¸ì¶œí•œ ë§Œí¼ ëˆì´ ë‚˜ê°€ëŠ” í˜•íƒœì´ë©´ì„œë„ ë§¤ìš° ì €ë ´í•œ ì„œë¹„ìŠ¤ë“¤ì´ê¸° ë•Œë¬¸ì— ì§€ê¸ˆì€ ë¶ˆí•„ìš”í•˜ì§€ë§Œ íŠ¹ì • ìƒí™©ì„ í•´ê²°í•˜ê¸° ìœ„í•œ ì„œë¹„ìŠ¤ë“¤ì²˜ëŸ¼ ëŠê»´ì§€ë”ë¼ë„ í›„ì— ì €í¬ ì„œë¹„ìŠ¤ê°€ ì„±ì¥í•˜ë©´ ë¶„ëª…íˆ CloudFrontì˜ ì£¼ê¸°ëŠ¥ì¸ ìºì‹± ìì²´ì˜ ì¤‘ìš”ì„±ë„ ì¦ê°€í•  ìˆ˜ë„ ìˆì„ ê²ƒì´ê³ , ê·¸ ì •ë„ ê·œëª¨ê°€ ëœë‹¤ë©´ ê°„ë‹¨í•œ ì„œë²„ë¦¬ìŠ¤ ì•„í‚¤í…ì³ê°€ ì•„ë‹Œ ì¢€ ë” ì •êµí•œ êµ¬ì¶•í˜• ì•„í‚¤í…ì³ë¡œ ê°œì„ í•  ìˆ˜ë„ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤!\nì´ìƒ ì˜¤í”ˆ ê·¸ë˜í”„ë¥¼ ìœ„í•œ SSR ì„œë¹„ìŠ¤ êµ¬ì¶•ê¸°ì˜€ìŠµë‹ˆë‹¤~!\n","date":"2021-11-07T03:46:54+09:00","image":"https://umi0410.github.io/blog/ssr-serverless-og/architecture_hu5fca6240e5304ba626b4c28b580410af_204723_120x120_fill_box_smart1_3.png","permalink":"https://umi0410.github.io/blog/ssr-serverless-og/","title":"AWS Lambda + API Gatewayë¥¼ í†µí•´ SSRë¡œ OpenGraph ë©”íƒ€ë°ì´í„° ì œê³µí•˜ê¸°"},{"content":"ì‹œì‘í•˜ë©° Github PlayStore ì¶œì‹œ í”„ë¡œì íŠ¸ ë° íŒ€ ì†Œê°œ í˜ì´ì§€ í•™êµ ìˆ˜ì—…ì„ ë“£ë‹¤ë³´ë‹ˆ í•œ í•™ê¸°ì— 2ê°œ 3ê°œì˜ í”„ë¡œì íŠ¸ë¥¼ ê°œë°œí•´ì•¼í•˜ëŠ” ê²½ìš°ê°€ ìˆì—ˆìŠµë‹ˆë‹¤. ì™„ì „ ê°œë°œì´ ì²˜ìŒì´ì—ˆë˜ ì‹œê¸°ì—ëŠ” ì´ëŸ¬í•œ ì–‘ì ì¸ ê°œë°œ ì†ì—ì„œë„ ë°°ìš¸ ì ì´ ë§ì•˜ì§€ë§Œ ì–´ëŠ ì •ë„ ì§€ë‚˜ê³  ë‚˜ë‹ˆ ì–‘ì ì¸ ê°œë°œ ì†ì—ì„œëŠ” í¬ê²Œ ë°°ìš¸ ì ì´ ëŠê»´ì§€ì§€ ì•Šì•˜ê³ , ë¨¸ë¦¬ê°€ ì•„ë‹Œ ì†ìœ¼ë¡œ ê°œë°œì„ í•˜ê³  ìˆëŠ” ëŠë‚Œì„ ë°›ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.\në”°ë¼ì„œ ì €ëŠ” ë‹¨ìˆœíˆ ì°ì–´ë‚´ê¸° ì‹ì˜ ê°œë°œì„ ë°˜ë³µí•˜ê¸° ë³´ë‹¤ëŠ” í•œ ì„œë¹„ìŠ¤ë¥¼ ê¾¸ì¤€íˆ ê°œë°œí•´ë‚˜ê°€ë©° ê·¸ ì†ì— ë§ì€ ìƒê°ì„ ë‹´ì•„ë‚´ê³ ì í–ˆìŠµë‹ˆë‹¤. ì²˜ìŒì—ëŠ” ê°€ë³ê²Œ ê´€ì‹¬ìˆë˜ ê¸°ìˆ ë“¤ì„ ììœ ë¡­ê²Œ ì ìš©í•´ë³¼ ìˆ˜ ìˆëŠ” ê°œë°œ ë†€ì´í„°ë¥¼ ë§Œë“¤ê³ ì í•˜ëŠ” ë§ˆìŒì— ì‹œì‘í–ˆê³  ì œê°€ ê´€ì‹¬ìˆë˜ ê¸°ìˆ ë“¤ì€ ë‹¤ìŒê³¼ ê°™ì•˜ìŠµë‹ˆë‹¤.\nKubernetes Golangì„ ì´ìš©í•œ ì„œë²„ ê°œë°œ TDD MSA, DDD(Domain Driven Design) ArgoCDë¥¼ ì´ìš©í•œ CD(Continuous deploy \u0026amp; delivery) ë² í”„ í•˜ë‚˜ì™€ í•¨ê»˜ ì‹œì‘í–ˆë˜ ì„œë¹„ìŠ¤ì—ì„œ ê¸°ì¡´ì— ì¹œë¶„ì´ ì—†ë˜ ë””ìì´ë„ˆë‹˜, ê°œë°œìë‹˜ë“¤ì´ ì¶”ê°€ë˜ë©´ì„œ ë¦¬ë”ë¡œì„œ ì±…ì„ê°ì´ ì¡°ê¸ˆ ìƒê²¨ë‚˜ê¸°ë„ í–ˆê³ , ê¸°ê°„ì´ ê¸¸ì–´ì§€ë‹¤ë³´ë‹ˆ ë‹¨ìˆœíˆ ê°œë°œ ë†€ì´í„°ë³´ë‹¤ëŠ” ì¶œì‹œë¥¼ í•´ë³´ìëŠ” ëª©í‘œë¥¼ ê°–ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.\nê·¸ë¦¬ê³  ëŒ€ë¶€ë¶„ì˜ ì½”ë“œë¥¼ ì˜¤í”ˆì†ŒìŠ¤ë¡œ ê´€ë¦¬í•˜ê³  ìˆëŠ”ë° ê°œì¸ì ìœ¼ë¡œëŠ” í•™ìƒë“¤ì´ ì‹¤ì œ í”„ë¡œë•ì…˜ ìˆ˜ì¤€ì˜ ì‘ì—…ì— ì°¸ì—¬í•´ë³¼ ìˆ˜ ìˆëŠ” ê²½í—˜ì´ ë§ì§€ ì•Šì€ë° ìš°ë¦¬ í•™êµ í•™ìƒë“¤ì€ ìì‹ ì´ ì‚¬ìš©í•˜ëŠ” ì˜¤í”ˆì†ŒìŠ¤ ì„œë¹„ìŠ¤ì¸ ì¿ ë®¤ì— ììœ ë¡­ê²Œ ê¸°ì—¬í•¨ìœ¼ë¡œì¨ ì‹¤ì œ ê°œë°œì— ì°¸ì—¬í•´ë³¼ ìˆ˜ ìˆëŠ” ê¸°íšŒì˜ ì¥ì´ ë˜ì—ˆìœ¼ë©´ í•˜ëŠ” ê¿ˆì´ ìˆìŠµë‹ˆë‹¤. ì•„ë¬´ë˜ë„ í•™ìƒë“¤ì´ ê°ì ë‹¤ë¥¸ ê°œë°œ ì–¸ì–´ì™€ ê´€ì‹¬ì‚¬ë¥¼ ê°–ë‹¤ë³´ë‹ˆ MSAë¥¼ ì„ íƒí•œ ê²ƒì´ ì´ ë¶€ë¶„ì— ìˆì–´ì„œëŠ” ì¢‹ê²Œ ì‘ìš©í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ë„¤ìš”.\nì¿ ë®¤? ë­í•˜ëŠ” ì„œë¹„ìŠ¤ì§€? ì¿ ë®¤ëŠ” ê³µì§€ì‚¬í•­ í‘¸ì‹œ ì•Œë¦¼ê³¼ êµë‚´ ì»¤ë®¤ë‹ˆí‹°ë¥¼ ì£¼ë¡œ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤ì—ìš”! ê²½í¬ëŒ€í•™êµì˜ í©ë¿Œë ¤ì§„ ê³µì§€ì‚¬í•­ì„ í•œ ê³³ì—ì„œ ì¡°íšŒí•  ìˆ˜ ìˆê³ , ìƒˆë¡œìš´ ê³µì§€ì‚¬í•­ì€ ì„ íƒì ìœ¼ë¡œ í‘¸ì‹œì•Œë¦¼ì„ ë°›ì•„ë³¼ ìˆ˜ ìˆë‹µë‹ˆë‹¤. ë˜í•œ êµë‚´ ì»¤ë®¤ë‹ˆí‹°ë¡œì„œ í•™êµ ì¸ì¦ì´ í•™êµ ì‚¬ì´íŠ¸ì™€ ì—°ë™ë˜ì–´ ê°„í¸í•˜ê³  ë‹¤ì–‘í•œ ì£¼ì œì— ê±¸ì³ í•™ìƒë“¤ì˜ ì˜ê²¬ì´ ì ê·¹ ë°˜ì˜ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³´í†µì˜ ì»¤ë®¤ë‹ˆí‹°ëŠ” ê²Œì‹œíŒ í˜•íƒœë¡œ êµ¬í˜„ë˜ì–´ ê²Œì‹œíŒì„ í•˜ë‚˜ í•˜ë‚˜ ì°¾ì•„ë‹¤ë…€ì•¼ í•˜ì§€ë§Œ ì¿ ë®¤ëŠ” ë§ˆì¹˜ ì¸ìŠ¤íƒ€ì—ì„œ í•´ì‹œíƒœê·¸ë“¤ì„ íŒ”ë¡œìš°í•˜ë“¯ ê²Œì‹œíŒì„ íŒ”ë¡œìš° í•´ë‘ë©´ í”¼ë“œì—ì„œ ìì‹ ì´ íŒ”ë¡œìš° í•´ë‘” ê²Œì‹œê¸€ì„ ëª¨ë‘ ëª¨ì•„ë³¼ ìˆ˜ ìˆì–´ìš”.\në‚´ê°€ ì¢‹ì•„í•˜ëŠ” ìƒê°ì´ ë‹´ê¸´ ê°œë°œ ì €ëŠ” ë‹¨ìˆœí•˜ê²Œ ì†ìœ¼ë¡œ í•˜ëŠ” ê°œë°œë³´ë‹¨ ì´ëŸ° ì €ëŸ° ìƒê°ë“¤ì´ ë‹´ê²¨ìˆëŠ” ê°œë°œì„ ì¢‹ì•„í•˜ê³  ê·¸ì— ëŒ€í•´ ììœ ë¡­ê²Œ ì–˜ê¸°ë‚˜ëˆ„ëŠ” ì‹œê°„ì„ ì‚¬ë‘í•©ë‹ˆë‹¤. ì œê°€ ì¿ ë®¤ë¥¼ ê°œë°œí•˜ë©´ì„œ í–ˆë˜ ê³ ë¯¼ë“¤ê³¼ ê·¸ëŸ° ìƒê°ë“¤ì„ ì–´ë–»ê²Œ ë…¹ì—¬ëƒˆëŠ”ì§€ ê°„ë‹¨íˆ ì •ë¦¬í•´ë³´ê² ìŠµë‹ˆë‹¤.\n\u0026lsquo;RESTfulí•˜ê²Œ APIë¥¼ ê°œë°œí•´ë‚˜ê°€ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ?\u0026rsquo; RESTfulí•˜ë‹¤ëŠ” ë§ì˜ ì •ì˜ëŠ” ì´ê³³ ì €ê³³ ë‹¤ë“¤ ë‹¤ë¥´ê²Œ í‘œí˜„í•˜ê³ ë“¤ ìˆëŠ” ê²ƒ ê°™ì§€ë§Œ HTTP methodë¡œ ë™ì‘ì„, URLë¡œ ë¦¬ìŠ¤ì†Œë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì ì€ ê³µí†µì ìœ¼ë¡œ í‘œí˜„ë˜ëŠ” íŠ¹ì§•ì¸ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ CRUDëŠ” Post, Get, Patch, Delete ë“±ì˜ ë©”ì†Œë“œì™€ ì—°ê²°ë˜ì£ . ê·¼ë° ë¶„ëª… CRUDì™€ ê¹”ë”íˆ ë§ì•„ë–¨ì–´ì§€ì§€ ì•ŠëŠ” ì‘ì—…ë“¤ì´ ì¡´ì¬í•©ë‹ˆë‹¤!\nê´€ë ¨ ê¸€\nHow to design a REST API to handle non-CRUD operations? - Stack exchange REST API design for non-CRUD actions, e.g. save, deploy, execute code - Stackoverflow ì¶œì²˜ - https://toss.im/slash-21/sessions/1-7\nìœ„ì™€ ê°™ì´ í† ìŠ¤ì—ì„œë„ RESTfulí•˜ì§€ ì•Šì€ APIë“¤ì— ëŒ€í•´ ê³ ë¯¼ì„ ë§ì´ í–ˆë˜ ê²ƒ ê°™ê³  ì´ ê²½ìš° ë‹¤ìŒê³¼ ê°™ì€ ì»¨ë²¤ì…˜ë“¤ì„ ì ìš©í•œ ê²ƒ ê°™ìŠµë‹ˆë‹¤.\nPathì˜ ë§ˆì§€ë§‰ì— ë™ì‘ì„ ë‚˜íƒ€ë‚´ëŠ” ë™ì‚¬ë¥¼ ì ìš© ì´ëŸ° APIë“¤ì€ POST ë©”ì†Œë“œë¥¼ ì´ìš© # ê¸°ì¡´ ë°©ì‹ ì¢‹ì•„ìš” ìƒì„± POST /likes {article: 1} ì¢‹ì•„ìš” ì‚­ì œ DELETE /likes/{{like_id}} # ê°œì„ í•œ ë°©ì‹ ì¢‹ì•„ìš” POST /articles/1/like ì¢‹ì•„ìš” ì·¨ì†Œ POST /articles/1/unlike ì‹¤ì œ ì¿ ë®¤ ì‘ì—…ì„ ì˜ˆë¡œ ë“¤ìë©´ ê²Œì‹œê¸€ì— ëŒ€í•œ ì¢‹ì•„ìš” ì‘ì—… ìˆ˜í–‰ ì‹œ ìœ„ì™€ ê°™ì´ APIë¥¼ ì¢€ ë” ì§ê´€ì ìœ¼ë¡œ ê°œì„ í–ˆìŠµë‹ˆë‹¤. ê¸°ì¡´ì—ëŠ” ì¢‹ì•„ìš” ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ likeë¼ëŠ” ë¦¬ì†ŒìŠ¤ë¡œ ì´ìš©í•˜ë©´ì„œ like ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ìƒì„±, ì‚­ì œì— ë§µí•‘ì‹œì¼°ìŠµë‹ˆë‹¤.\ní•˜ì§€ë§Œ ì´ëŠ” ë‹¤ì†Œ ê¸°ê³„ì ì´ê³  APIë¥¼ ì‚¬ìš©í•˜ì—¬ ê°œë°œí•˜ëŠ” í´ë¼ì´ì–¸íŠ¸(ì‚¬ëŒ)ì…ì¥ì—ì„œëŠ” ì™€ë‹¿ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ í´ë¼ì´ì–¸íŠ¸ëŠ” ì¢‹ì•„ìš”ë¥¼ ì·¨ì†Œí•˜ë ¤ë©´ ìì‹ ì´ ì·¨ì†Œí•˜ê³ ì í•˜ëŠ” ì¢‹ì•„ìš” ë‚´ì—­ì˜ IDë¥¼ ì•Œì•„ì•¼í•˜ë¯€ë¡œ ë¶ˆí¸í•˜ì£ .\nê·¸ë˜ì„œ ì•„ë˜ì™€ ê°™ì´ API í˜•íƒœë¥¼ ê°œì„ í–ˆê³ , í´ë¼ì´ì–¸íŠ¸ëŠ” ì¢€ ë” í¸ë¦¬í•˜ê²Œ APIë¥¼ ì´ìš©í•  ìˆ˜ ìˆì–´ì¡ŒìŠµë‹ˆë‹¤~!\n\u0026lsquo;APIì˜ Latencyë¥¼ ì¤„ì´ê¸° ìœ„í•´ì„œëŠ” ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ?\u0026rsquo; ê°œë°œì„ í•˜ë‹¤ë³´ë‹ˆ ë°ì´í„°ê°€ ê·¸ë ‡ê²Œ ë§ì€ ê²ƒë„ ì•„ë‹Œë° ì–´ëŠ ìˆœê°„ë¶€í„° latencyê°€ ê¸¸ë‹¤ëŠ” ëŠë‚Œì„ ë°›ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ì–´ë–»ê²Œ latencyë¥¼ ì¤„ì¼ ìˆ˜ ìˆì„ê¹Œë¥¼ ì•Œì•„ë³´ê²Œ ëì£ . ì£¼ëœ ì›ì¸ì€ N+1 ë¬¸ì œë¼ê³  ë¶ˆë¦¬ëŠ” DB Queryê°€ ì´ìŠˆì˜€ë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ê²Œì‹œê¸€ì„ ì—¬ëŸ¬ ê°œ ì¡°íšŒí•œ ë’¤ ë§µí•‘ì„ í•  ë•Œ ê²Œì‹œê¸€ í•˜ë‚˜ í•˜ë‚˜ë§ˆë‹¤ì˜ ëŒ“ê¸€ ê°œìˆ˜, ì¢‹ì•„ìš” ê°œìˆ˜, ë¶ë§ˆí¬ ê°œìˆ˜ ë“±ì„ ìˆœì°¨ì ìœ¼ë¡œ ì¡°íšŒí•˜ë‹¤ë³´ë‹ˆ ì´ ë¶€ë¶„ì—ì„œ ë³‘ëª©ì´ ë°œìƒí•œ ê²ƒì´ì—ˆì–´ìš”!\nì €ëŠ” ì´ ë¶€ë¶„ì—ì„œ redisë¥¼ ì ìš©í•´ë³´ì•˜ê³  redisë¥¼ ì ìš©í•˜ì ìƒí™©ë§ˆë‹¤ ë‹¤ë¥´ê² ì§€ë§Œ ëŒ€ì²´ë¡œ latencyê°€ ì•½ 1/5ë¡œ ì¤„ì–´ë“œëŠ” íš¨ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. redisë¥¼ ì ìš©í•˜ë˜ ë‹¹ì‹œì—” N+1 ë¬¸ì œì™€ ê·¸ê²ƒì„ Fetch join(í˜¹ì€ Eager loading)ë¡œ í•´ê²°í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ì¸ì§€ ìì²´ê°€ ì—†ì—ˆì–´ì„œ redisë¥¼ ì ìš©í–ˆë˜ ê²ƒ ê°™ì€ë° Fetch joinìœ¼ë¡œë„ ê¸€ì„ ì“°ë©´ì„œ ìƒê°í•´ë³´ë‹ˆ ê°„ë‹¨íˆ í•´ê²°í•  ìˆ˜ ìˆì—ˆì„ ê²ƒ ê°™ê¸´í•˜ë„¤ìš”.\nì‹œê°„ì´ ëœë‹¤ë©´ redis ë¿ë§Œ ì•„ë‹ˆë¼ fetch joinë„ ì ìš©í•´ì„œ ë” ìµœì í™”í•´ë³¼ ìˆ˜ ìˆìœ¼ë©´ ì¢‹ì„ ê²ƒ ê°™ì•„ìš”. ê·¸ë˜ë„ redisë¥¼ ì¨ë³´ë©´ì„œ ë§ì€ ê²ƒë“¤ì„ ë°°ì›Œë³¼ ìˆ˜ ìˆì—ˆë˜ ê²ƒ ê°™ì•„ ì¬ë¯¸ìˆì—ˆìŠµë‹ˆë‹¤! ã…ã…\n\u0026lsquo;MSAì—ì„œ ê´€ì‹¬ì‚¬/ì±…ì„ ë¶„ë¦¬ë¥¼ ì–´ë–»ê²Œ í•  ìˆ˜ ìˆì„ê¹Œ?\u0026rsquo; ì¶œì²˜: ë§ˆì´í¬ë¡œ ì„œë¹„ìŠ¤ì— ëŒ€í•œ ë°ì´í„° ê³ ë ¤ ì‚¬í•­ - ë§ˆì´í¬ë¡œì†Œí”„íŠ¸ ë¸”ë¡œê·¸\nì²˜ìŒ ì¿ ë®¤ë¥¼ ì„¤ê³„í•˜ë©´ì„œ MSAë¥¼ ë„ì…í•˜ê³ ì í–ˆì„ ë•ŒëŠ” ì–´ë–»ê²Œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¥¼ ë‚˜ëˆ ì•¼í• ê¹Œì— ëŒ€í•œ ê³ ë ¤ê°€ ê±°ì˜ ì—†ì—ˆë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì§€ê¸ˆì€ DDDë¥¼ ê³µë¶€í•˜ë©° ë†’ì€ ì‘ì§‘ë„ì™€ ë…ë¦½ì„±ì„ ì·¨í•˜ë©´ì„œ ì„œë¹„ìŠ¤ë¥¼ ë‚˜ëˆ„ëŠ” ê²Œ ì¢‹ê² ë‹¤ëŠ” ìƒê°ì´ ë“¤ì§€ë§Œ ë‹¹ì‹œì—” ê·¸ëƒ¥ ë‚˜ëˆ„ê³  ì‹¶ì€ ëŒ€ë¡œ ë‚˜ëˆ ë²„ë ¸ë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì•½ê°„ ì˜¤ë²„ ì—”ì§€ë‹ˆì–´ë§ì´ ë  ìˆ˜ ìˆëŠ” ì„¤ê³„ë¥¼ í•œ ê²ƒì€ ê·¸ë ‡ë‹¤ì¹˜ê³  ê·¸ ì†ì—ì„œ ì„œë¹„ìŠ¤ë“¤ì„ êµ¬í˜„í•´ ë‚˜ê°ˆ ë•Œì—ë„ ì‹¤ìˆ˜í–ˆë˜ ê²ƒì´ í•˜ë‚˜ ìˆìŠµë‹ˆë‹¤. ë°”ë¡œ ìœ„ì˜ ì‚¬ì§„ì²˜ëŸ¼ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ê°€ í•˜ë‚˜ì˜ DBë¥¼ ë°”ë¼ë³´ë©´ ì•ˆëœë‹¤ëŠ” ì›ì¹™ì„ ì–´ê¸´ ê²ƒì¸ë°ìš”.\nì˜ˆë¥¼ ë“¤ì–´ ê²Œì‹œê¸€ ì„œë¹„ìŠ¤ì™€ ëŒ“ê¸€ ì„œë¹„ìŠ¤ê°€ ë¶„ë¦¬ë˜ì–´ ìˆì„ ë•Œ ìœ„ì˜ ì´ë¯¸ì§€ì™€ ê°™ì´ ì–´ë–¤ ëŒ“ê¸€ì˜ ì‘ì„±ìê°€ í•´ë‹¹ ê²Œì‹œê¸€ì˜ ì‘ì„±ìì™€ ì¼ì¹˜í•˜ëŠ”ì§€ì— ëŒ€í•œ ì •ë³´ê°€ í•„ìš”í•˜ë‹¤ê³  ê°€ì •í•´ë´…ì‹œë‹¤. ê¸°ì¡´ì—ëŠ” ëŒ“ê¸€ ì„œë¹„ìŠ¤ê°€ ê²Œì‹œê¸€ DBë¥¼ ì§ì ‘ ì¡°íšŒí•´ì„œ article.authorì™€ comment.authorë¥¼ ë¹„êµí–ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ë ‡ê²Œ ë¶„ë¦¬ëœ ì„œë¡œ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ê°€ ê°™ì€ ë°ì´í„°ì— ì ‘ê·¼í•˜ëŠ” í˜•íƒœëŠ” MSAì—ì„œëŠ” ë§¤ìš° ì•ˆ ì¢‹ê²Œ í‰ê°€ë˜ëŠ” ì•ˆí‹° íŒ¨í„´ì…ë‹ˆë‹¤.\në”°ë¼ì„œ ì €ëŠ” ëŒ“ê¸€ì„ ì¡°íšŒí•  ë•Œ ê²Œì‹œê¸€ ì„œë¹„ìŠ¤ì—ê²Œ ê²Œì‹œê¸€ ì •ë³´ë¥¼ ì¡°íšŒí•´ article.authorì™€ comment.authorë¥¼ ë¹„êµí•  ìˆ˜ ìˆë„ë¡ í–ˆìŠµë‹ˆë‹¤. ë§Œì•½ ê²Œì‹œê¸€ ì„œë¹„ìŠ¤ê°€ ë¹„ì •ìƒìœ¼ë¡œ ë™ì‘í•˜ë”ë¼ë„ ëŒ“ê¸€ ì„œë¹„ìŠ¤ì—ëŠ” í° íƒ€ê²© ì—†ì´ ëŒ“ê¸€ ì‘ì„±ìê°€ ê²Œì‹œê¸€ ì‘ì„±ìì™€ ì¼ì¹˜í•˜ëŠ”ì§€ ì •ë³´ë§Œ falseë¡œ ì²˜ë¦¬ë  ë¿ì…ë‹ˆë‹¤.\nì•„ë§ˆ ë” ê³ ë„í™”ëœ í˜•íƒœëŠ” ëŒ“ê¸€ ì„œë¹„ìŠ¤ì—ì„œ ìê¸° ì„œë¹„ìŠ¤ë§Œì´ ì´ìš©í•  ê²Œì‹œê¸€ ì‘ì„±ì ì •ë³´ í…Œì´ë¸”ì„ ì„¤ê³„í•˜ê±°ë‚˜ ëœ ì •ê·œí™”í•œë‹¤ë©´ ëŒ“ê¸€ë§ˆë‹¤ ê²Œì‹œê¸€ì˜ ì‘ì„±ì idë„ ê¸°ì…í•˜ëŠ” ë°©ì‹ì„ ì´ìš©í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ì•„ìš”. í•˜ì§€ë§Œ ê·¸ëŸ° í˜•íƒœë¥¼ ì ìš©í•˜ê¸° ì´ì „ì— ìš°ì„ ì€ ì¢€ ë” latencyê°€ ê¸¸ ìˆ˜ëŠ” ìˆì§€ë§Œ ê°„ë‹¨íˆ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ê°„ì— ë™ê¸°ì ìœ¼ë¡œ í†µì‹ (ê²Œì‹œê¸€ ì‘ì„±ì ì •ë³´ë¥¼ ëŒ“ê¸€ ì„œë¹„ìŠ¤ê°€ APIë¡œ ì§ì ‘ í˜¸ì¶œ)í•˜ëŠ” ë°©ì‹ì„ ì ìš©í•´ë´¤ìŠµë‹ˆë‹¤.\n\u0026lsquo;ì–´ë–¤ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•´ ë¹Œë“œ/ë°°í¬ë¥¼ ìë™í™”í• ê¹Œ?\u0026rsquo; ê³¼ê±°ì—ëŠ” ë°°í¬ ë„êµ¬ë¡œì„œ Spinnakerë¥¼ ì£¼ë¡œ ì‚¬ìš©í–ˆì§€ë§Œ SpinnakerëŠ” ê·¸ ê´€ë¦¬ ë¦¬ì†ŒìŠ¤ê°€ ë§Œë§Œì¹˜ ì•Šê²Œ ë“ ë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤. Jenkinsë‚˜ ê·¸ ì™¸ì˜ ì„œë¹„ìŠ¤ë“¤ê³¼ ì—°ë™ì‹œì¼œ í•˜ë‚˜ì˜ Pipelineì„ ë§Œë“œëŠ” ë°ì—ëŠ” Spinnakerê°€ ì í•©í–ˆì§€ë§Œ ê¼­ ê·¸ëŸ° ì—°ë™ ì‘ì—…ì´ í•„ìš”ê°€ ì—†ë‹¤ë©´ êµ³ì´ Spinnakerë¥¼ ì‚¬ìš©í•  í•„ìš”ê°€ ì—†ì„ ê²ƒ ê°™ì•˜ìŠµë‹ˆë‹¤.\nì‹¤ìš©ì£¼ì˜ ë°ë¸Œì˜µìŠ¤ for MSA - ì¹´ì¹´ì˜¤í…Œí¬ CI/CD ë„êµ¬ ë° ë°©ë²•ë¡  ë„ì…ê¸° - ë©”ì‰¬ì½”ë¦¬ì•„, VROONG ê·¸ë˜ì„œ ìœ„ì˜ ê¸€ë“¤ì—ë„ ì†Œê°œë˜ëŠ” í‰ì†Œ ê´€ì‹¬ ìˆë˜ ArgoCDë¥¼ ë°°í¬ ë„êµ¬ë¡œ ì„ íƒí–ˆê³ , ì˜¤í”ˆì†ŒìŠ¤ë¡œì„œ ê´€ë¦¬ë˜ëŠ” í”„ë¡œì íŠ¸ì´ë‹¤ë³´ë‹ˆ Github ë‚´ì—ì„œ ë§ì€ ì‘ì—…ì´ ì´ë£¨ì–´ì§€ë¯€ë¡œ CIëŠ” Github Actionì„ ì´ìš©í•˜ê¸°ë¡œ ê²°ì •í–ˆìŠµë‹ˆë‹¤.\nê·¸ë¦¬ê³  Spinnakerë¥¼ ì‚¬ìš©í–ˆì„ ë• Helm ì°¨íŠ¸ë¥¼ í†µí•œ ë°°í¬ê°€ ë§‰ ì§€ì›ë˜ë˜ ì‹œê¸°ì˜€ì–´ì„œ ë²„ì „ ë¬¸ì œì¸ì§€ ë²„ê·¸ì¸ì§€ Helm ì°¨íŠ¸ê°€ ì˜ ì ìš©ì´ ì•ˆëë˜ ì´ìŠˆê°€ ìˆì–´ ì •ë§ ì•„ì‰¬ì› ëŠ”ë°ìš”. ArgoCDëŠ” kustomizeë‚˜ Helmì„ ì ê·¹ì ìœ¼ë¡œ ì§€ì›í•˜ê³  ìˆëŠ” ê²ƒ ê°™ì•„ Helmìœ¼ë¡œ ë°°í¬í•˜ëŠ” ê²ƒë„ ë„ˆë¬´ë‚˜ í¸ë¦¬í–ˆì–´ìš”. ì§€ê¸ˆì€ Kubernetesì˜ Nginx Ingress Controllerë‚˜ ArgoCD Notification ê°™ì€ ì„œë¹„ìŠ¤ë“¤ì€ Helmìœ¼ë¡œ ë°°í¬/ê´€ë¦¬í•˜ê³  ìˆë‹µë‹ˆë‹¤.\ní”„ë¡œì íŠ¸ ë¦¬ë“œì™€ íŒ€ì›ë“¤ê°„ì˜ ì˜ì‚¬ì†Œí†µ ì €í¬ íŒ€ì€ ì£¼ë¡œ ë…¸ì…˜ì„ í†µí•´ íšŒì˜ ë‚´ìš© ê¸°ë¡ ë° ì§„í–‰ ì‚¬í•­ ê³µìœ ë¥¼ í•˜ê³ , íšŒì˜ëŠ” ë””ìŠ¤ì½”ë“œë¡œ ì§„í–‰í–ˆìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ ë³´ë‹ˆ í•´ë‹¹ í˜ì´ì§€ì— ê¸°ë¡í•˜ê¸° ì „ê¹Œì§€ í•©í•˜ë©´ ë”± 1ë…„ ì •ë„ ëœ ê²ƒ ê°™ë„¤ìš” ë²Œì¨..! ì‹œê°„ì´ ì°¸ ë¹ ë¥¸ ê²ƒ ê°™ì•„ìš” ã…ã…\në””ìŠ¤ì½”ë“œë¡œ íšŒì˜í•˜ê¸° í˜ë“  ìƒí™©ì—” ììœ ë¡­ê²Œ ì¹´í†¡ìœ¼ë¡œ ì´ìŠˆë¥¼ ê³µìœ í•˜ê¸°ë„ í•©ë‹ˆë‹¤. ì–¼ë§ˆ ì „ì— ìš´ì˜ í™˜ê²½ì„ êµ¬ì¶•í•˜ë©´ì„œ S3 + CloudFrontë¥¼ êµ¬ì¶•í•  ë•Œ ê²ªì€ ì´ìŠˆ ê´€ë ¨ í†¡ì„ ê°€ì ¸ì™€ ë´¤ìŠµë‹ˆë‹¤. íŠ¹íˆ ì„œë¡œ í¬ì§€ì…˜ì´ ë‹¤ë¥¸ ê²½ìš° ì´ìŠˆì— ëŒ€í•´ ìì„¸íˆ ë¬˜ì‚¬í•˜ë ¤ ë…¸ë ¥í•˜ê³  íŒ€ì›ì˜ ì‘ì—…ì— í•­ìƒ ê°ì‚¬ë¥¼ í‘œí•˜ëŠ” ê±¸ ìŠì§€ ì•Šìœ¼ë ¤ ë…¸ë ¥í•˜ê³  ìˆì–´ìš”. ì½”ë¡œë‚˜ì™€ ê±°ë¦¬ ìƒì˜ ë¬¸ì œë¡œ í•œ ë²ˆë„ ëµ™ì§€ ëª»í•œ íŒ€ì›ë“¤ë„ ê³„ì‹œì§€ë§Œ ë‚˜ë¦„ ë‚´ì  ì¹œë°€ê°ì´ ë§ì´ ìŒ“ì¸ ê²ƒ ê°™ì•„ìš” ã…ã… ê¼­ ì¿ ë®¤ê°€ ì•„ë‹ˆë¼ë„ ê¸°íšŒê°€ ëœë‹¤ë©´ ì•ìœ¼ë¡œë„ ê°™ì´ ì‘ì—…í•˜ê±°ë‚˜ ë§Œë‚˜ëµ™ê³  ì‹¶ê¸°ë„ í•©ë‹ˆë‹¤.\nì•ìœ¼ë¡œì˜ ë¯¸ë˜..? ì‚¬ì‹¤ ê°œë°œ ë†€ì´í„°ë¡œ ì‹œì‘í•œ ì£¼ì œë¼ì„œ ê·¸ë ‡ê²Œ ì°¸ì‹ í•˜ì§€ë„ ì•Šê³ , ëŒ€í•™ìƒ ì»¤ë®¤ë‹ˆí‹°ì—ëŠ” ì—ë¸Œë¦¬íƒ€ì„ì´ë¼ëŠ” í° ì¥ë²½ì´ ìˆì–´ì„œ ìš°ë¦¬ ì„œë¹„ìŠ¤ì˜ ë¯¸ë˜ê°€ ì–´ë–»ê²Œ ë  ì§€ëŠ” ëª¨ë¥´ê² ìŠµë‹ˆë‹¤. ì²˜ìŒì—” ì»¤ë®¤ë‹ˆí‹° ê¸°ëŠ¥ì„ ì£¼ê¸°ëŠ¥ìœ¼ë¡œ ë°€ì–´ë¶™ì—¬ ê°œë°œí–ˆë˜ ë°˜ë©´ í™œì„± ìœ ì €ê°€ ë³„ë¡œ ì—†ì„ ê²½ìš°ë¥¼ ê³ ë ¤í•˜ë‹ˆ ì»¤ë®¤ë‹ˆí‹°ë³´ë‹¤ëŠ” ê³µì§€ì‚¬í•­ê³¼ í•™ì‚¬ì¼ì •ì„ í¸ë¦¬í•˜ê²Œ ì „ë‹¬í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì´ ë” ìš°ì„ ì‹œ ë˜ì–´ì•¼í•  ê²ƒ ê°™ì•˜ì–´ìš”. ê·¸ë˜ì„œ ê·¸ ë¶€ë¶„ë“¤ì„ ë³´ì™„í•˜ì—¬ MVPë¥¼ ì¶œì‹œ ì¤€ë¹„ ì¤‘ì´ê³  ì´í›„ ë‹¤ì–‘í•œ í”¼ë“œë°±ì„ ë°›ì•„ë³´ë©´ì„œ ê³„ì†í•´ì„œ ë””ë²¨ë¡­í•´ë‚˜ê°ˆì§€ ìœ ì§€ë§Œ í•  ì§€ íŒ€ì›ë“¤ê³¼ ìƒì˜í•´ë´ì•¼í•  ê²ƒ ê°™ê¸´ í•©ë‹ˆë‹¤.\nê·¸ë˜ë„ ëŒ€í•™êµë¥¼ ì¡¸ì—…í•˜ê¸° ì „ì— ì´ë ‡ê²Œ ê¸¸ê²Œ í•œ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•´ë³¼ ìˆ˜ ìˆì—ˆë˜ ê²ƒë„ ë¿Œë“¯í•˜ê³  íŒ€ì›ë“¤ê³¼ ê¾¸ì¤€íˆ í˜‘ì—…í•´ë‚˜ê°€ëŠ” ê²½í—˜ì„ í•  ìˆ˜ ìˆì—ˆë˜ ì , ë‹¤ì–‘í•œ ì´ìŠˆë¥¼ ë§ì´í•˜ê³  í•´ê²°í•  ìˆ˜ ìˆì—ˆë˜ ì ì—ì„œ ì„œë¹„ìŠ¤ì˜ ë¯¸ë˜ê°€ ì–´ë–»ê²Œ ë˜ë“  ì†Œì¤‘í•œ ê²½í—˜ì„ í•œ ê²ƒ ê°™ìŠµë‹ˆë‹¤.\nì¿ ë®¤ íŒ€ì›ë“¤ ëª¨ë‘ ê½ƒê¸¸ ê±·ê³  í–‰ë³µí–ˆìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤~! í™”ì´íŒ…!!!\n","date":"2021-10-02T15:46:54+09:00","image":"https://umi0410.github.io/blog/khumu/khumu-dev-review/thumbnail-wide_hu54b7b06ccaab22efd2d5450276cad720_83729_120x120_fill_box_smart1_3.png","permalink":"https://umi0410.github.io/blog/khumu/khumu-dev-review/","title":"ì¿ ë®¤ MVP ê°œë°œê¸°"},{"content":"ì‹œì‘í•˜ë©° ë“œë””ì–´ ì—ëŸ¬ë¥¼ ë‹¤ë¤„ë³¼ ì°¨ë¡€ê°€ ëë„¤ìš”. ì‘ë…„ê¹Œì§€ë§Œ í•´ë„ Errorë‚˜ Exception ì²˜ë¦¬ì˜ ì¤‘ìš”ì„±ì„ ì˜ ëª°ëë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ API í´ë¼ì´ì–¸íŠ¸ë‘ ì‘ì—…ì„ í•˜ë©´ í• ìˆ˜ë¡ ì—ëŸ¬ ì²˜ë¦¬ì˜ ì¤‘ìš”ì„±ì„ ëŠë¼ê²Œ ë˜ëŠ” ê²ƒ ê°™ì•„ìš”. ì™œëƒí•˜ë©´ ë°±ì—”ë“œì—ì„œ ê°ê°ì˜ ì—ëŸ¬ ì¼€ì´ìŠ¤ì— ëŒ€í•œ status_codeë‚˜ error_typeë“±ì„ ëª…í™•íˆ ì •ì˜í•˜ì§€ ì•Šìœ¼ë©´ í´ë¼ì´ì–¸íŠ¸ëŠ” ì—ëŸ¬ë¥¼ í•´ì„í•  ë°©ë²•ì´ ì—†ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.\në˜í•œ ì—ëŸ¬ë¥¼ ì˜ ì²˜ë¦¬í•œ ë’¤ ì˜¬ë°”ë¥´ê²Œ ì‘ë‹µí•˜ê±°ë‚˜ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” ê²ƒì€ ìœ ì§€/ë³´ìˆ˜ ì‹œì— ë°±ì—”ë“œ ê°œë°œì ìŠ¤ìŠ¤ë¡œ ì—ê²Œë„ ì •ë§ ì¤‘ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìš°ë¦¬ëŠ” ì‹¤ì œ ìš´ì˜ í™˜ê²½ì˜ ë¡œê·¸ë¥¼ ë§ˆì¹˜ ìš°ë¦¬ê°€ ë¡œì»¬ì—ì„œ ê°œë°œí•  ë•Œ ì²˜ëŸ¼ í•­ìƒ ë³´ê³ ìˆì„ ìˆ˜ëŠ” ì—†ê¸° ë•Œë¬¸ì´ì£ . ì¦‰ ì—ëŸ¬ ë¡œê·¸ë§Œ ë”°ë¡œ \u0026ldquo;í¸ë¦¬í•˜ê²Œ\u0026rdquo; ë³¼ ìˆ˜ ìˆê±°ë‚˜ ì—ëŸ¬ ë¡œê·¸ë¡œ ì¸í•œ Notification Systemì´ ìˆìœ¼ë©´ í›¨ì”¬ ì—ëŸ¬ë¥¼ ì¶”ì (Tracing)í•˜ê¸° ì‰½ê² ì£ !\nê·¸ë¦¬ê³  Golangì€ ë‹¤ë¥¸ ì–¸ì–´ë“¤ê³¼ ë‹¬ë¦¬ Try Catchì˜ í˜•íƒœë¡œ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì ì„ ëª¨ë‘ë“¤ ì•Œê³  ê³„ì‹¤ ê²ë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ ì—ëŸ¬ë¥¼ ê·¸ëŸ¼ ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ì§€ì— ëŒ€í•œ ë°©ì•ˆì€ ëšœë ·ì´ ì¸ì§€í•˜ì§€ ëª»í•œ ê²½ìš°ê°€ ë§ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.(ì œê°€ ê·¸ë¬ìŠµë‹ˆë‹¤. ã…ã…..) ê·¸ë˜ì„œ ëŒ€ì¶© ì—ëŸ¬ ë¡œê·¸ë¥¼ ì¶œë ¥í•˜ê²Œë§Œ í•˜ê³  í†µì¼ì„± ì—†ëŠ” ë°©ì‹ìœ¼ë¡œ ê·¸ë•Œ ê·¸ë•Œ ë– ì˜¤ë¥´ëŠ” ëŒ€ë¡œ ì—ëŸ¬ì²˜ë¦¬ë¥¼ í•´ì™”ë˜ ê²ƒ ê°™ì•„ìš”.\nê·¸ëŸ¼ ì´ë²ˆ ê¸€ì—ì„œëŠ” ì—ëŸ¬ë¥¼ ì™œ ìš°ì•„í•˜ê²Œ, ì˜ ì²˜ë¦¬í•´ì•¼í•˜ëŠ”ì§€ ì‚´í´ë³´ê³  ê·¸ë¥¼ ìœ„í•œ ë°©ë²•ë„ ì†Œê°œí•´ë³´ê² ìŠµë‹ˆë‹¤.\nğŸ“¦ ì—ëŸ¬ë¥¼ Wrapping í•˜ì ë‹¤ë¥¸ ì–¸ì–´ë“¤ì€ ì—ëŸ¬ë¥¼ ìƒì†í•´ ì •ì˜í•˜ëŠ” ë°©ì‹ì„ ì´ìš©í•˜ì§€ë§Œ Golangì€ ì—ëŸ¬ë¥¼ Wrappingí•˜ëŠ” ë°©ì‹ì„ ì´ìš©í•©ë‹ˆë‹¤. ì¢€ ë‚¯ì„¤ì–´ì„œ ê·¸ë ‡ì§€ ìµìˆ™í•´ì§€ë©´ í›¨ì”¬ ê°„ê²°í•œ ê²ƒ ê°™ìŠµë‹ˆë‹¤.\nì˜ˆë¥¼ ë“¤ì–´ Redis ê´€ë ¨ ì—ëŸ¬ëŠ” ëª¨ë‘ ì¶”ìƒì ì¸ ì—ëŸ¬ì¸ RedisErrorì— ì†í•˜ê³  ì¡°íšŒ ë„ì¤‘ ë°œìƒí•œ ì—ëŸ¬ëŠ” RedisGetErrorë¼ê³  ì •ì˜í•˜ëŠ” ê²½ìš°ê°€ ìˆë‹¤ê³  í•´ë³´ê² ìŠµë‹ˆë‹¤. ìë°”ì˜ ê²½ìš°ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì •ì˜í•˜ê² ì£ .\npublic class RedisError extends Exception{ public RedisError(String msg){ super(msg); } } public class RedisGetError extends RedisError{ public RedisError(){ super(\u0026#34;ë ˆë””ìŠ¤ ì¡°íšŒ ê´€ë ¨ ì—ëŸ¬\u0026#34;) } } public class Something{ public void somethingWithRedis(){ try{ redis.get(\u0026#34;X\u0026#34;); } catch (RedisGetError e){ ... // ë ˆë””ìŠ¤ ì¡°íšŒ ê´€ë ¨ ì—ëŸ¬ ì¼€ì´ìŠ¤ì— ëŒ€í•œ ëŒ€ì‘ } catch (RedisError e){ ... // ë ˆë””ìŠ¤ ì¡°íšŒë¥¼ ì œì™¸í•œ ë ˆë””ìŠ¤ ê´€ë ¨ ì—ëŸ¬ ì¼€ì´ìŠ¤ì— ëŒ€í•œ ëŒ€ì‘ } catch (Exception e){ ... // ê·¸ ì™¸ì˜ ëª¨ë“  ì—ëŸ¬ ì¼€ì´ìŠ¤ì— ëŒ€í•œ ëŒ€ì‘ } } } ì´ë ‡ê²Œ Javaì˜ ê²½ìš°ëŠ” ìƒì†ì„ í†µí•´ ê° ì—ëŸ¬ ì¼€ì´ìŠ¤ì— ëŒ€í•´ ëŒ€ì‘í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ Golangì—ì„œëŠ” ì£¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ ë°©ë²•ìœ¼ë¡œ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.\nerror.New(msg string) ìœ¼ë¡œ sentinel error(ë” ì´ìƒ ìª¼ê°¤ ìˆ˜ ì—†ëŠ” ìµœìƒìœ„ ì—ëŸ¬ ê°™ì€ ëŠë‚Œ)ë¥¼ ì •ì˜\nfmt.Errorf(\u0026quot;%s: %w\u0026quot;, msg, sentinelErr) ìœ¼ë¡œ sentinel errorë¥¼ ê°ì‹¼(wrap) ìì‹ ì—ëŸ¬ë¥¼ ì •ì˜\nì—ëŸ¬ë¥¼ Wrapping í•˜ë©´ sentinel errorì— ì¢€ ë” ì •ë³´ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆì–´ ì¹œì ˆí•œ ì—ëŸ¬ê°€ ë˜ì£ !\nerrors.Is(err, parentErr) ìœ¼ë¡œ errì˜ wrapping chainì— parentErrì´ ì¡´ì¬í•˜ëŠ”ì§€ íŒë‹¨\nì—ëŸ¬ë¥¼ Wrappingí•œë‹¤ëŠ” ê°œë…ì´ ì˜ ì´í•´ë˜ì§€ ì•ŠëŠ” ë¶„ë“¤ì€ Wrapping and Un-wrapping of error in Go (Golang)ì„ ì°¸ê³ í•´ì£¼ì‹œë©´ ì¢‹ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.\nê·¸ëŸ¼ Goì—ì„  ìœ„ì™€ ê°™ì€ ì¼€ì´ìŠ¤ê°€ ì–´ë–»ê²Œ êµ¬í˜„ë  ìˆ˜ ìˆëŠ”ì§€ ì ì–´ë³´ê² ìŠµë‹ˆë‹¤.\nvar ( ErrRedis = errors.New(\u0026#34;ë ˆë””ìŠ¤ ê´€ë ¨ ì—ëŸ¬\u0026#34;) ErrRedisGet = fmt.Errorf(\u0026#34;ì¡°íšŒ ë„ì¤‘ ì—ëŸ¬: %w\u0026#34;, ErrRedis) ) type Something struct{} func (s *Something) somethingWithRedis(){ _, err := redis.Get(\u0026#34;X\u0026#34;); if err != nil{ if errors.Is(err, ErrRedisGet){ ... // ë ˆë””ìŠ¤ ì¡°íšŒ ê´€ë ¨ ì—ëŸ¬ ì¼€ì´ìŠ¤ì— ëŒ€í•œ ëŒ€ì‘ } else if errors.Is(err, ErrRedis){ ... // ë ˆë””ìŠ¤ ì¡°íšŒë¥¼ ì œì™¸í•œ ë ˆë””ìŠ¤ ê´€ë ¨ ì—ëŸ¬ ì¼€ì´ìŠ¤ì— ëŒ€í•œ ëŒ€ì‘ } else{ ... // ê·¸ ì™¸ì˜ ëª¨ë“  ì—ëŸ¬ ì¼€ì´ìŠ¤ì— ëŒ€í•œ ëŒ€ì‘ } } } Goì—ì„œ errorëŠ” interfaceì´ê¸° ë•Œë¬¸ì— ê°„í˜¹ type assertionì„ ì´ìš©í•´ ì—ëŸ¬ì˜ íƒ€ì…ì„ ë¹„êµí•˜ê±°ë‚˜ ì§ì ‘ error variableì™€ ë¹„êµí•˜ëŠ” ê²½ìš°ë„ ìˆê¸´í•©ë‹ˆë‹¤ë§Œ ë°”ëŒì§í•˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤. type assertionì€ ì• ì´ˆì— ë‹¤ì†Œ ë¶ˆì•ˆí•˜ê±°ë‚˜ ë²ˆê±°ë¡œìš´ ë©´ì´ ìˆê³  ì§ì ‘ error valueì™€ ë¹„êµí•˜ëŠ” ê²½ìš°ëŠ” í•´ë‹¹ error valueë¥¼ ì œê³µí•˜ë˜ packageê°€ ì¶”í›„ì—ëŠ” ì–´ë–¤ error valueë¥¼ ì¬ì •ì˜í•  ì§€ ëª¨ë¥´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ErrRedisGet ë¥¼ ë¦¬í„´í•˜ë˜ íŒ¨í‚¤ì§€ê°€ ErrRedisGet ë¥¼ Wrappingí•œ ErrRedisHashGet ë¥¼ ë¦¬í„´í•˜ëŠ” í˜•íƒœë¡œ ë³€ê²½ëë‹¤ê³  ê°€ì •í•©ì‹œë‹¤.\nvar ( ErrRedis = errors.New(\u0026#34;ë ˆë””ìŠ¤ ê´€ë ¨ ì—ëŸ¬\u0026#34;) ErrRedisGet = fmt.Errorf(\u0026#34;ì¡°íšŒ ë„ì¤‘ ì—ëŸ¬: %w\u0026#34;, ErrRedis) ) func (r *redis) HashGet(key string) string, error{ if (Hash Get ë„ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí•œ ê²½ìš°){ return \u0026#34;\u0026#34;, ErrRedisGet // ì´ ë²„ì „ì—ì„œëŠ” ErrRedisGetì„ ë¦¬í„´í•¨. } ... // ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•Šì€ ê²½ìš° } func (s *Something) somethingWithRedis(){ _, err := redis.HashGet(\u0026#34;X\u0026#34;); if err != nil{ if err == ErrRedisGet{ // Redis ì¡°íšŒ ë„ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí•œ ê²½ìš°ì— ëŒ€í•œ ëŒ€ì‘ } ... } } ê¸°ì¡´ ë²„ì „ì—ì„  ErrRedisGet ì„ ë¦¬í„´í•˜ê³ , ê·¸ ê²°ê³¼ë¥¼ í™•ì¸í•˜ëŠ” ë©”ì†Œë“œì—ì„œë„ ErrRedisGet ê³¼ ì§ì ‘ ==ìœ¼ë¡œ ë¹„êµë¥¼ í•˜ë‹ˆ ì˜¬ë°”ë¥´ê²Œ ë™ì‘í•©ë‹ˆë‹¤.\nchain.png var ( ErrRedis = errors.New(\u0026#34;ë ˆë””ìŠ¤ ê´€ë ¨ ì—ëŸ¬\u0026#34;) ErrRedisGet = fmt.Errorf(\u0026#34;ì¡°íšŒ ë„ì¤‘ ì—ëŸ¬: %w\u0026#34;, ErrRedis) ErrRedisHashGet = fmt.Errorf(\u0026#34;í•´ì‰¬ ì¡°íšŒ ë„ì¤‘ ì—ëŸ¬: %w\u0026#34;, ErrRedisGet) ) func (r *redis) HashGet(key string) string, error{ if (Hash Get ë„ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí•œ ê²½ìš°){ return \u0026#34;\u0026#34;, ErrRedisHashGet // ì´ ë²„ì „ì—ì„œëŠ” ErrRedisGetì„ ë¦¬í„´í•¨. } ... // ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•Šì€ ê²½ìš° } func (s *Something) somethingWithRedis(){ _, err := redis.HashGet(\u0026#34;X\u0026#34;); if err != nil{ // ë§Œì•½ ì•„ë˜ì²˜ëŸ¼ errors.Isë¥¼ ì´ìš©í•˜ë©´ ErrRedisGetì€ ì‹¤ì œë¡œ ë¦¬í„´ëœ // ErrRedisHashGetì˜ wrapping chainì— ì¡´ì¬í•˜ë¯€ë¡œ ê¸°ì¡´ê³¼ ë™ì¼í•˜ê²Œ // ì˜¬ë°”ë¥´ê²Œ ë™ì‘í•  ìˆ˜ ìˆìŒ. // if errors.Is(err, ErrRedisGet){} // í•˜ì§€ë§Œ ì´ì œëŠ” ==ì„ í†µí•œ ì§ì ‘ ë¹„êµëŠ” ì˜ˆìƒí•œëŒ€ë¡œ ë™ì‘í•˜ì§€ ëª»í•¨ ã…œã…œ if err == ErrRedisGet{ ... // ã…œã…œ } ... } } í•˜ì§€ë§Œ ë‹¤ìŒ ë²„ì „ì—ì„  redis.HashGet() ì´ Hashì— ëŒ€í•œ ì¡°íšŒ ë„ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ë• ErrRedisGetì´ ì•„ë‹Œ ê·¸ê²ƒì„ Wrapí•œ ErrRedisHashGetì„ ë¦¬í„´í•œë‹¤ë©´ ê¸°ì¡´ì˜ ==ì„ ì´ìš©í•œ ì§ì ‘ ë¹„êµëŠ” ì˜¬ë°”ë¥¸ ê²°ê³¼ë¥¼ ê°€ì ¸ë‹¤ì£¼ì§€ ëª»í•  ê²ƒì…ë‹ˆë‹¤.\në‹¤ì†Œ ì–´ë µê±°ë‚˜ ë‚¯ì„¤ ìˆ˜ ìˆëŠ” ë‚´ìš©ì´ë¼ ê°„ë‹¨í•œ ë‚´ìš©ì„ ìœ„ì£¼ë¡œ ì˜ˆì‹œë¥¼ ë“¤ì–´ë´¤ìŠµë‹ˆë‹¤. ê´€ì‹¬ì´ ìˆìœ¼ì‹  ë¶„ë“¤ì€ ê¸°ë³¸ìœ¼ë¡œ ì œê³µë˜ëŠ” errors íŒ¨í‚¤ì§€ ì™¸ì— https://github.com/pkg/errors ë¼ëŠ” íŒ¨í‚¤ì§€ë¥¼ ì´ìš©í•˜ëŠ” ê²½ìš°ë„ ìˆìœ¼ë‹ˆ í•œ ë²ˆ ì‚´í´ë³´ì‹œë©´ ì¢‹ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.\nì, ê·¸ëŸ¼ ì—ëŸ¬ë¥¼ Wrapí•˜ë¼ëŠ” ë‚´ìš© í•˜ë‚˜ ê°–ê³  ì–˜ê¸°ë¥¼ ì£¼ì ˆ ì£¼ì ˆ ê¸¸ê²Œ í–ˆìœ¼ë‹ˆ ì´ì œ ì‹¤ì œë¡œ ì›¹ ë°±ì—”ë“œ ê°œë°œì—ì„œì˜ ì—ëŸ¬ ì²˜ë¦¬ì— ëŒ€í•´ ì•Œì•„ë´…ì‹œë‹¤~!\nğŸ¤” ì›¹ì„œë²„ê°€ ì—ëŸ¬ë¥¼ ì œëŒ€ë¡œ ì²˜ë¦¬í•˜ì§€ ì•Šìœ¼ë©´? ì—ëŸ¬ë¥¼ ì œëŒ€ë¡œ ì²˜ë¦¬í•˜ì§€ ì•Šìœ¼ë©´ ì¼ë°˜ì ìœ¼ë¡œ ì›¹ í”„ë ˆì„ì›Œí¬ë“¤ì€ 500 Internal Errorë¡œ ì‘ë‹µí•˜ê¸° ë•Œë¬¸ì— ClientëŠ” 500 Internal Error ì‘ë‹µ ë°–ì— ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤\u0026hellip; ê²½ìš°ì— ë”°ë¼ì„œëŠ” BodyëŠ” ì˜¬ë°”ë¥´ê²Œ ë°›ì„ ìˆ˜ë„ ìˆê¸´í•˜ì§€ë§Œ ë§¤ìš° ë¶ˆì•ˆí•˜ì£ . ì—ëŸ¬ì˜ ì›ì¸ì„ ëª¨ë¥´ë‹ˆ í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œë„ ìœ ì €ì—ê²Œ \u0026ldquo;ì•Œ ìˆ˜ ì—†ëŠ” ì´ìœ ë¡œ ìš”ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\u0026rdquo; ê°™ì€ ë©”ì‹œì§€ë¥¼ ë„ìš´ë‹¤ë©´ ìœ ì € ê²½í—˜ë„ ë‹¹ì—°íˆ ì¢‹ì§€ ì•Šì•„ì§€ê² ì£ .\nê° ì—ëŸ¬ ì¼€ì´ìŠ¤ì— ì ì ˆíˆ ëŒ€ì‘í•´ì„œ ì‘ë‹µí•˜ë©´ í´ë¼ì´ì–¸íŠ¸ì™€ ìœ ì €ê°€ ëª¨ë‘ ì˜ ë°˜ì‘í•  ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.\në¡œê·¸ì¸í•˜ì§€ ì•Šì€ ìœ ì €ì˜ ìš”ì²­ì´ë¼ ì—ëŸ¬ê°€ ë‚œ ê²½ìš° =\u0026gt; 401 Unauthorized ì‘ë‹µ =\u0026gt; í´ë¼ì´ì–¸íŠ¸ëŠ” ìœ ì €ë¥¼ ë¡œê·¸ì¸ ì°½ìœ¼ë¡œ ì•ˆë‚´í•¨. ê¶Œí•œì´ ì—†ëŠ” ìœ ì €ì˜ ìš”ì²­ì´ë¼ ì—ëŸ¬ê°€ ë‚œ ê²½ìš° =\u0026gt; 403 Forbidden ì‘ë‹µ =\u0026gt; í´ë¼ì´ì–¸íŠ¸ëŠ” ìœ ì €ì—ê²Œ ê¶Œí•œì´ ì—†ì–´ì„œ ë¶ˆê°€ëŠ¥í•˜ë‹¤ëŠ” ì¹œì ˆí•œ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ë„ì›€. ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•´ ì—ëŸ¬ê°€ ë‚œ ê²½ìš° =\u0026gt; 404 Not Found ì‘ë‹µ =\u0026gt; í´ë¼ì´ì–¸íŠ¸ëŠ” ìœ ì €ì—ê²Œ í•´ë‹¹ ë¦¬ì†ŒìŠ¤ê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì¹œì ˆí•œ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ë„ì›€. Fiberì—ì„œ ì—ëŸ¬ ì²˜ë¦¬í•˜ëŠ” ë²• fiberëŠ” golang ì›¹ í”„ë ˆì„ì›Œí¬ë“¤ ì¤‘ì—ì„œ ë¬¸ì„œê°€ ì°¸ ì˜ ë˜ì–´ìˆëŠ” í¸ì´ë¼ê³  ìƒê°í•©ë‹ˆë‹¤. Error Handling íŒŒíŠ¸ë¥¼ ë³´ë©´ ì›¹ í”„ë ˆì„ì›Œí¬ë‹¨ì—ì„œëŠ” ì–´ë–»ê²Œ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•  ì§€ ê°„ë‹¨íˆ ì‚´í´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. Default Error HandlerëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ê²ƒì´ê³ , Custom Error Handlerì„ ë”°ë¡œ ì •ì˜í•´ ì´ìš©ì„ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì €ëŠ” ì €ë²ˆ ì‹œê°„ì— ë‹¤ë¤˜ë˜ Middleware ë°©ì‹ì„ ì´ìš©í•´ ì—ëŸ¬ë¥¼ ì˜ ì²˜ë¦¬í•´ë³´ê² ìŠµë‹ˆë‹¤.\nerrorhandler.png ê°„ë‹¨íˆ ì¡°ê¸ˆ ì„¤ëª…ì„ ë“œë¦¬ìë©´ Fiberì—ì„œ ì œê³µí•˜ëŠ” Error HandlerëŠ” fiber.Handlerë“¤ì´ ë¦¬í„´í•œ error íƒ€ì…ì„ ì‹¤ì œ HTTP Responseë¡œ ì–´ë–»ê²Œ ë³€í™˜ì„ í• ê¹Œì— ëŒ€í•œ ë‚´ìš©ì„ í¬í•¨í•˜ê³  ìˆëŠ” ê²ƒì´ê³ , ì œê°€ ì •ì˜í•˜ëŠ” ë¯¸ë“¤ì›¨ì–´ ë°©ì‹ì˜ Error HandlerëŠ” í•˜ë‚˜ì˜ middlewareë¡œì„œ ë‹¤ë¥¸ fiber.Handler(ë¯¸ë“¤ì›¨ì–´ í˜¹ì€ ìš”ì²­ í•¸ë“¤ëŸ¬)ê°€ ë¦¬í„´í•œ errorì„ fiberì˜ Default Error Handlerê°€ ì´í•´í•  ìˆ˜ ìˆëŠ” fiberì˜ error typeìœ¼ë¡œ ë³€í™˜ì‹œí‚¤ëŠ” ê²ƒì´ë¼ê³  ë³´ì‹œë©´ ë©ë‹ˆë‹¤.\nì˜ˆì‹œ - usernameìœ¼ë¡œ User ì¡°íšŒ ì „ì²´ ì½”ë“œëŠ” ì´ì „ ê¸€ë“¤ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ì œ ê¹ƒí—™ umi0410/how-to-backend-in-goì— ì˜¬ë ¤ë‘ê² ìŠµë‹ˆë‹¤. ê¸€ì—ì„œëŠ” ê°„ë‹¨í•œ ì½”ë“œ ë¹„êµì™€ HTTP ì‘ë‹µë§Œ ì„¤ëª…ë“œë¦´ê²Œìš”.\nì—ëŸ¬ë¥¼ ì˜ Wrappingí•œ ì •ë„ì— ë”°ë¼ ë‹¤ë¥´ê²Œ ì‘ë‹µí•˜ëŠ” ì„¸ ê°€ì§€ ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤.\nWorst - ì—ëŸ¬ë¥¼ ì–´ë”˜ê°€ì— ì •ì˜í•˜ì§€ë„ Wrapí•˜ì§€ë„ ì•Šì€ ìµëª… ì—ëŸ¬ ë¦¬í„´ =\u0026gt; ì ì ˆíˆ ì—ëŸ¬ë¥¼ íŒë‹¨í•  ìˆ˜ ì—†ì–´ 500 Error Ungraceful - ì–´ë”˜ê°€ì— ì •ì˜ëœ Errorì„ ë¦¬í„´ =\u0026gt; ì—ëŸ¬ë¥¼ ì ì ˆíˆ íŒë‹¨í•´ ì˜¬ë°”ë¥¸ Status codeë¡œ ì‘ë‹µì€ ê°€ëŠ¥í•˜ì§€ë§Œ ì—ëŸ¬ì— ëŒ€í•œ ìì„¸í•œ ë¬¸ë§¥ì´ë‚˜ ì„¤ëª…ì´ ì—†ìŒ. Graceful - ì—ëŸ¬ë¥¼ ì˜ Wrapí•´ì„œ ë¦¬í„´ =\u0026gt; ì—ëŸ¬ë¥¼ ì ì ˆíˆ íŒë‹¨í•´ ì˜¬ë°”ë¥¸ Status codeë¡œ ì‘ë‹µí•  ìˆ˜ ìˆê³  ì—ëŸ¬ì— ëŒ€í•œ ìì„¸í•œ ë¬¸ë§¥ì´ë‚˜ ì„¤ëª…ë„ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì œì‹œë¨. ì½”ë“œë¡œ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.\nvar ( ErrResourceNotFound = errors.New(\u0026#34;ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë¦¬ì†ŒìŠ¤\u0026#34;) users = []*User{ \u0026amp;User{Name: \u0026#34;ìš°ë¯¸ì‰\u0026#34;, Age: 25, Username: \u0026#34;umi0410\u0026#34;}, } ) ... ìƒëµ func (svc *UserService) GetUserWorst(username string) (*User, error) { for _, user := range users { if user.Username == username { return user, nil } } return nil, errors.New(\u0026#34;ìœ ì €ê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ìœ ì €(username=\u0026#34; + username + \u0026#34;)\u0026#34;) } func (svc *UserService) GetUserUngracefully(username string) (*User, error) { for _, user := range users { if user.Username == username { return user, nil } } return nil, ErrResourceNotFound } func (svc *UserService) GetUserGracefully(username string) (*User, error) { for _, user := range users { if user.Username == username { return user, nil } } return nil, fmt.Errorf(\u0026#34;ì…ë ¥ëœ username=%s: %w\u0026#34;, username, ErrResourceNotFound) } ìœ„ì™€ ê°™ì´ ì—ëŸ¬ì™€ ì—ëŸ¬ë¥¼ ë¦¬í„´í•˜ëŠ” ì„œë¹„ìŠ¤ ë©”ì†Œë“œë“¤ì„ ì •ì˜í•˜ê³  ì»¤ìŠ¤í…€ ì—ëŸ¬ í•¸ë“¤ëŸ¬ë¡œì„œì˜ ë¯¸ë“¤ì›¨ì–´ëŠ” ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.\nfunc customErrorHandler(ctx *fiber.Ctx) error { // ë‹¤ìŒ í•¸ë“¤ëŸ¬ë¥¼ í˜¸ì¶œí•œ ë’¤ // ë³¸ ë¯¸ë“¤ì›¨ì–´ì˜ ì‘ì—…ì€ ì‚¬í›„ì²˜ë¦¬! err := ctx.Next() if err != nil { log.Error(err) if errors.Is(err, ErrResourceNotFound) { // fiberì˜ Default Error Handlerê°€ ì•Œì•„ë“¤ì„ ìˆ˜ ìˆëŠ” í˜•íƒœì˜ fiber Errorì„ ë¦¬í„´ return fiber.NewError(404, err.Error()) } } return err } ì´ ë¯¸ë“¤ì›¨ì–´ëŠ” ë‹¤ë¥¸ ì¼ë°˜ì ì¸ ë¯¸ë“¤ì›¨ì–´ë“¤ê³¼ëŠ” ì•½ê°„ì€ ë‹¤ë¥´ê²Œ ë™ì‘í•œë‹¤ê³  ë³¼ ìˆ˜ ìˆëŠ”ë°ìš”. ëŒ€ë¶€ë¶„ì˜ ë¯¸ë“¤ì›¨ì–´ë“¤ì€ ìš”ì²­ì„ ì‹¤ì œë¡œ ì²˜ë¦¬í•˜ê¸° ì „ì— ìì‹ ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ì‚¬ì „ì²˜ë¦¬ ë°©ì‹ì„ ì´ìš©í•˜ëŠ”ë°ìš”. ì˜ˆë¥¼ ë“¤ì–´ ì €ë²ˆ ê¸€ì—ì„œ ì‚´í´ë³¸ basic auth ë¯¸ë“¤ì›¨ì–´ëŠ” ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” í•¸ë“¤ëŸ¬ ì´ì „ì— ë¯¸ë“¤ì›¨ì–´ë¡œì„œ ìš”ì²­ìì˜ ì¸ì¦ ì •ë³´ë¥¼ ê¸°ì…(ì‚¬ì „ì²˜ë¦¬)í•˜ëŠ” ì—­í• ì„ í–ˆì£ . í•˜ì§€ë§Œ ì´ ë¯¸ë“¤ì›¨ì–´ëŠ” ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” í•¸ë“¤ëŸ¬ì˜ ê²°ê³¼ ì—ëŸ¬ë¥¼ ì´ìš©í•˜ê¸° ë•Œë¬¸ì— ë¯¸ë“¤ì›¨ì–´ê°€ ì‹œì‘í•˜ìë§ˆì ë‹¤ìŒ í•¸ë“¤ëŸ¬ë¥¼ í˜¸ì¶œí•˜ê³  ê·¸ ê²°ê³¼ ì—ëŸ¬ë¥¼ ì´ìš©í•©ë‹ˆë‹¤. ì‚¬í›„ì²˜ë¦¬ ë°©ì‹ì´ì£ !\nê·¸ëŸ¼ ì´ì œ customErrorHandlerê°€ ë¦¬í„´í•œ ì—ëŸ¬ë¥¼ fiberì˜ Default Error Handlerê°€ ì˜ ì²˜ë¦¬í•´ì¤„ ê²ƒì…ë‹ˆë‹¤.\n$ curl http://localhost:8000/worst/jinsu -w \u0026#34;\\t%{http_code}\\n\u0026#34; ìœ ì €ê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ìœ ì €(username=jinsu)\t500 $ curl http://localhost:8000/ungraceful/jinsu -w \u0026#34;\\t%{http_code}\\n\u0026#34; ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë¦¬ì†ŒìŠ¤\t404 $ curl http://localhost:8000/graceful/jinsu -w \u0026#34;\\t%{http_code}\\n\u0026#34; ì…ë ¥ëœ username=jinsu: ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë¦¬ì†ŒìŠ¤\t404 ì‘ë‹µì„ ë³´ì‹œë©´ worst caseì˜ ê²½ìš° status codeê°€ 500ì´ê¸° ë•Œë¬¸ì— í´ë¼ì´ì–¸íŠ¸ê°€ í•´ë‹¹ ì—ëŸ¬ ì¼€ì´ìŠ¤ì— ëŒ€í•´ ì˜¬ë°”ë¥¸ ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ì—†ìŠµë‹ˆë‹¤.. ì‘ë‹µì„ ì •ê·œí‘œí˜„ì‹ì„ ì´ìš©í•´ íŒë‹¨í•´ì•¼í• ê¹Œìš”..? ã…ã…\u0026hellip;\nê·¸ë¦¬ê³  ungraceful caseì˜ ê²½ìš° status codeëŠ” 404ë¡œ ì˜ ì •ì˜ë˜ì—ˆì§€ë§Œ ì‘ë‹µ ë°”ë””ê°€ ë‹¤ì†Œ ë¶ˆì¹œì ˆí•´ í´ë¼ì´ì–¸íŠ¸ì¸¡ì—ì„œ ë””ë²„ê¹…í•˜ê¸°ê°€ í˜ë“¤ê² ì£ .\në°˜ë©´ gracefulí•œ ê²½ìš°ì—ëŠ” status codeë„ ì˜ ì •ì˜ë˜ì—ˆê³  ì—ëŸ¬ ë°”ë””ë„ ìì„¸í•©ë‹ˆë‹¤ êµ¿êµ¿ì´ì—ìš”!\në§ˆì¹˜ë©° ì •ë§ ì‘ë…„ê¹Œì§€ëŠ” ì—ëŸ¬ë¥¼ í•¸ë“¤ë§í•˜ëŠ” ê²ƒì— ëŒ€í•´ ë³„ ìƒê°ì´ ì—†ì—ˆë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì‚¬ì´ë“œ í”„ë¡œì íŠ¸ë¥¼ í•˜ë©´ì„œ ì—ëŸ¬ë¥¼ ì œëŒ€ë¡œ ì²˜ë¦¬í•˜ì§€ ì•Šì•„ Index Out Of Range ëŸ°íƒ€ì„ ì—ëŸ¬ í•˜ë‚˜ì—ë„ ì„œë²„ê°€ ì¢…ë£Œë˜ì–´ë²„ë¦°ë‹¤ê±°ë‚˜ ëª¨ë“  ì—ëŸ¬ë¥¼ 500 Internal Errorë¡œ ë¦¬í„´í•´ë²„ë¦¬ëŠ” ì¼€ì´ìŠ¤ë¥¼ ê²ªìœ¼ë©´ì„œ \u0026lsquo;ì•„\u0026hellip; ì—ëŸ¬ë¥¼ ì˜ ì²˜ë¦¬í•´ì•¼ í•˜ëŠ”êµ¬ë‚˜\u0026lsquo;ë¥¼ ëŠê»´ë³¼ ìˆ˜ ìˆì—ˆê³ , ì‹¤ì œ í”„ë¡œë•íŠ¸ë¥¼ ê°œë°œí•˜ë©´ì„œ \u0026lsquo;í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ ì—ëŸ¬ì— ëŒ€í•œ ì ì ˆí•œ ì•¡ì…˜ì„ ì·¨í•˜ê¸° ìœ„í•´ì„  status codeë‚˜ error_typeë“±ì„ ì˜ ì „ë‹¬í•´ì•¼ê² êµ¬ë‚˜\u0026rsquo; ë¼ëŠ” ìƒê°ë„ í•´ë³¼ ìˆ˜ ìˆì—ˆë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤.\nê²Œë‹¤ê°€ Goì—ì„œ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ê¹Šê²Œ ìƒê°ì„ ëª»í•´ë´¤ì—ˆëŠ”ë° yorkie ë¼ëŠ” ì˜¤í”ˆì†ŒìŠ¤ì— ê¸°ì—¬(PR #222 )í•˜ê²Œ ë˜ë©´ì„œ ë©˜í† ë‹˜ê»˜ì„œ ì˜ ì´ëŒì–´ì£¼ì…”ì„œ ì—ëŸ¬ë¥¼ Wrappingí•œë‹¤ëŠ” ê°œë…ì— ëŒ€í•´ ìì„¸íˆ ì•Œì•„ë³¼ ìˆ˜ ìˆì—ˆë˜ ê¸°íšŒê°€ ëœ ê²ƒ ê°™ìŠµë‹ˆë‹¤.\nì´ë²ˆì— ë””í”„ë§Œ 10ê¸°ë¡œ í™œë™í•˜ê²Œ ë˜ì—ˆëŠ”ë° 10ê¸° ì¸í„°ë·° ë‹¹ì‹œì—ë„ í´ë¼ì´ì–¸íŠ¸ì™€ í˜‘ì—…í•˜ë©´ì„œ ì–´ë ¤ì› ë˜ ì ê³¼ í•´ê²°í•´ë‚˜ê°„ ë°©ì‹ê³¼ ê´€ë ¨ëœ ì§ˆë¬¸ì„ ë°›ì•˜ì„ ë•Œì—ë„ ì—ëŸ¬ í•¸ë“¤ë§ê³¼ ê´€ë ¨ì§€ì–´ ë‹µë³€ì„ í–ˆì„ë§Œí¼ ì—ëŸ¬ í•¸ë“¤ë§ì€ \u0026lsquo;ê·¸ë˜ë„ ë‚´ê°€ í•œí¸ìœ¼ë¡œëŠ” ì•„ì§ ì„±ì¥í•˜ê³  ìˆë‚˜ë³´ë‹¤.. ã…ã…\u0026lsquo;ë¥¼ ëŠë‚„ ìˆ˜ ìˆì—ˆë˜ ìƒˆë¡œìš´ ê²½í—˜ì´ì—ˆë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤! ì´ ê¸€ì„ ì½ìœ¼ì‹œëŠ” ì—¬ëŸ¬ë¶„ë“¤ë„ ì´ì œ ì—ëŸ¬ ì˜ ì²˜ë¦¬í•˜ê³  ì €ì™€ í•¨ê»˜ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì¹­ì°¬ë°›ëŠ” ë°±ì—”ë“œ ê°œë°œìê°€ ë˜ì–´ë´…ì‹œë‹¤~!\nì°¸ê³  Working with Errors in Go 1.13 - https://go.dev/blog/go1.13-errors Wrapping and Un-wrapping of error in Go (Golang) - https://golangbyexample.com/wrapping-and-unwrapping-error-golang/ Add RPC Config validation and handle the errors (yorkie PR #222) - https://github.com/yorkie-team/yorkie/pull/222 fiber docs Error Handling - https://docs.gofiber.io/guide/error-handling ErrorëŠ” ê²€ì‚¬ë§Œ í•˜ì§€ë§ê³ , ìš°ì•„í•˜ê²Œ ì²˜ë¦¬í•˜ì„¸ìš”. - http://cloudrain21.com/golang-graceful-error-handling ","date":"2021-09-05T01:46:54+09:00","image":"https://umi0410.github.io/blog/golang/how-to-backend-in-go-errorhandle/chain_hua96618047d845851ee10ee4de25bc827_61443_120x120_fill_box_smart1_3.png","permalink":"https://umi0410.github.io/blog/golang/how-to-backend-in-go-errorhandle/","title":"Golangìœ¼ë¡œ ë°±ì—”ë“œ ê°œë°œí•˜ê¸° - 5. Error Handling. ì—ëŸ¬ ì˜ ì²˜ë¦¬í•˜ê¸° (feat. fiber)"},{"content":"ì‹œì‘í•˜ë©° ì•ˆë…•í•˜ì„¸ìš”. ì €ë²ˆ ê¸€ì—ì„œëŠ” fiber ë¼ëŠ” ì›¹ í”„ë ˆì„ì›Œí¬ë¡œ ê°„ë‹¨íˆ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“œëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë´¤ìœ¼ë‹ˆ ì´ë²ˆì—” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ë‹¤ë³´ë©´ ê¼­ í•„ìš”í•´ì§€ëŠ” middleware ì‘ì„±ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤. ì—¬íƒœê¹Œì§€ ë°±ì—”ë“œì—ì„œ ì„œë²„ë¥¼ ê°œë°œí•˜ë©´ì„œëŠ” JSì˜ Express í”„ë ˆì„ì›Œí¬ë¥¼ ì œì™¸í•˜ê³ ëŠ” ë¯¸ë“¤ì›¨ì–´ ê°œë°œì´ ê·¸ë‹¥ ì‰½ê²Œ ì´í•´ë˜ëŠ” ë¶€ë¶„ì€ ì•„ë‹ˆì—ˆë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤. Expressì—ì„œ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‘ì„±í•˜ëŠ” ë°©ë²•ì€ êµ‰ì¥íˆ ì§ê´€ì ì´ê³  ë¬¸ì„œë„ ë§ì€ í¸ì´ì—ˆê±°ë“ ìš”. í•˜ì§€ë§Œ Springì€ Filterë‚˜ Interceptorë¥¼ ì´í•´í•˜ê¸° ìœ„í•´ ë§ì€ ë‚´ìš©ì„ ì•Œì•„ì•¼í•˜ê³ , DjangoëŠ” Class basedë‚˜ function based, ê·¸ë¦¬ê³  middlewareë¥¼ ì¶”ê°€í•˜ëŠ” ë²• ë“±ì´ ì¢€ ë³µì¡í•œ í¸ì´ë¼ê³  ìƒê°í•©ë‹ˆë‹¤.\nê·¸ë¦¬ê³  Golangì€ ì•„ë¬´ë˜ë„ ì½”ë“œë¡œ ë§í•˜ëŠ” ì‚¬ëŒë“¤ì´ ë§ì•„ì„œì¸ì§€ ê·¸ë‹¥ middleware ì‘ì„±ê³¼ ê°™ì€ ë¶€ë¶„ë“¤ì´ ë¬¸ì„œë¡œ ì˜ ë‚˜ì™€ìˆì§„ ì•Šê³ , ì½”ë“œë¥¼ ê¹Œë³´ë©´ì„œ ë§Œë“œëŠ” ê²½ìš°ê°€ ë§ì•˜ë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ì´ë²ˆ ê¸€ì—ì„œëŠ” fiber ë¡œ ì›¹ì„œë²„ë¥¼ ë„ìš°ë©´ì„œ ê°„ë‹¨íˆ ë¯¸ë“¤ì›¨ì–´ í•˜ë‚˜ ë§Œë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤.\nì œê³µë˜ëŠ” Basic Authentication middlewareì„ ì´ìš©í•´ ìš”ì²­ ìœ ì €ë¥¼ ì‹ë³„ ì‹ë³„ëœ ìœ ì € ì •ë³´ê°€ ì‚½ì…ëœ loggerë¥¼ contextì— ì£¼ì… ì´ë ‡ê²Œ í•˜ë©´ ì´í›„ service layerë“±ì—ì„œëŠ” ìš”ì²­ ìœ ì €ê°€ ì‚½ì…ëœ loggerì„ í†µí•´ ë¡œê·¸ë¥¼ ì‘ì„±í•˜ë‹ˆ ë¡œê·¸ ì¶”ì í•˜ê¸°ê°€ ìš©ì´í•´ì§€ê² ì£ ? ã…ã… (BasicAuthë¥¼ ì´ìš©í•˜ëŠ” ì´ìœ ëŠ” ë‚¨ì´ ì‘ì„±í•œ ë¯¸ë“¤ì›¨ì–´ë¥¼ ê°€ì ¸ë‹¤ì“°ëŠ” ë°©ë²•ì„ í¸í•˜ê²Œ ì•Œì•„ë³´ê¸° ìœ„í•¨ì¼ ë¿ ì¸ì¦ ë°©ë²•ìœ¼ë¡œ ê¶Œì¥í•´ì„œëŠ” ì•„ë‹™ë‹ˆë‹¤.)\në¯¸ë“¤ì›¨ì–´?? ê·¸ê²Œ ë­ì•¼? ì™œ í•„ìš”í•´?! ì›¹ í”„ë ˆì„ì›Œí¬ì—ì„œ ë§í•˜ëŠ” ë¯¸ë“¤ì›¨ì–´ëŠ” ë³´í†µ ìš”ì²­ì— ë”°ë¥¸ í•¸ë“¤ëŸ¬ë¥¼ ìˆ˜í–‰í•˜ê¸° ì „ í˜¹ì€ ìˆ˜í–‰í•œ í›„ì— ìˆ˜í–‰í•˜ëŠ” ì‘ì—…ì„ ë§í•©ë‹ˆë‹¤. ì£¼ë¡œ ì²´ì¸ì˜ í˜•íƒœë¼ê³  ë³´ì‹œë©´ ë˜ê³  í•œ ë¯¸ë“¤ì›¨ì–´ì—ì„œ ì‘ë‹µì„ ì™„ë£Œí•˜ë©´ ê±”ê°€ ìš”ì²­ í•¸ë“¤ëŸ¬ì˜ ì—­í• ì„ í•˜ê²Œ ëœë‹¤ê³  ë³´ë©´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì‘ë‹µì„ ì™„ë£Œí•˜ì§€ ì•Šìœ¼ë©´ ë‹¤ìŒ ë¯¸ë“¤ì›¨ì–´ë¥¼ í˜¸ì¶œí•˜ì£ .\nì„œë²„ ê°œë°œì„ ì²˜ìŒí•  ë•ŒëŠ” ë¯¸ë“¤ì›¨ì–´ì˜ í•„ìš”ì„±ì„ ì˜ ëŠë¼ì§€ ëª»í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì–´ëŠì •ë„ ê°œë°œì„ í•˜ê±°ë‚˜ ë°°í¬ë¥¼ í•´ë‚˜ê°€ë‹¤ë³´ë©´ \u0026lsquo;ì•„\u0026hellip; ëª¨ë“  ìš”ì²­ë§ˆë‹¤ ~~~í•œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê³  ì‹¶ì€ë°\u0026rsquo; ì´ëŸ° ìƒê°ì´ ë“¤ ë•Œê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ API ë³„ë¡œ ë ˆì´í„´ì‹œë¥¼ ì²´í¬í•˜ê³  ì‹¶ì„ ìˆ˜ë„ ìˆê³ , bodyë‚˜ query stringì„ ë¡œê·¸ë¡œ ë‚¨ê¸°ê±°ë‚˜ ì–´ë–¤ ìœ ì €ì˜ ìš”ì²­ì¸ì§€ ë§¤ ìš”ì²­ë§ˆë‹¤ ì •ë³´ë¥¼ ì£¼ì…í•˜ê³  ì‹¶ì„ ìˆ˜ ìˆì£ . ì´ëŸ° ê²½ìš° middlewareë¥¼ ì´ìš©í•˜ë©´ ëª¨ë“  ìš”ì²­ì€ ë¯¸ë“¤ì›¨ì–´ë¥¼ ê±°ì¹˜ë©´ì„œ ì²˜ë¦¬ë˜ê¸° ë•Œë¬¸ì— í¸ë¦¬í•˜ê²Œ ì‘ì—…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!\nëŒ€í‘œì ìœ¼ë¡œëŠ” ì¸ì¦ì´ë‚˜ ìºì‹±, ë¡œê¹…, ì‘ë‹µ íƒ€ì„ì•„ì›ƒ ë“±ì— ì‚¬ìš©í•˜ê³  ìˆëŠ” ê²ƒ ê°™ì•„ìš”!\në‚¨ì´ ë§Œë“  ë¯¸ë“¤ì›¨ì–´ ì‚¬ìš©í•´ë³´ê¸° - BasicAuth Goë¥¼ í†µí•´ ê°œë°œí•˜ëŠ” ì´ìƒ ì €í¬ëŠ” ë¬¸ì„œì—ë§Œ ì˜ì¡´í•  ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤. ì½”ë“œë¥¼ ê¹Œë´ì•¼ì£  !_! Guidelines for creating Middleware - fiber Github Issue ì´ìŠˆì—ëŠ” ë¯¸ë“¤ì›¨ì–´ ì‘ì„±ì— ëŒ€í•œ ëª‡ ê°€ì§€ ê°€ì´ë“œë¼ì¸ì´ ì œì‹œë˜ì–´ìˆë”ë¼êµ¬ìš”. ì°¸ê³ í•´ë³´ì‹œë©´ ì¢‹ì„ ê²ƒ ê°™ê¸°ë„ í•©ë‹ˆë‹¤.\nì €ëŠ” gofiber/fiber/middleware/basicauth ì˜ ì½”ë“œë¥¼ ë°”íƒ•ìœ¼ë¡œ í•´ì„í•´ë³´ê² ìŠµë‹ˆë‹¤. ë§í¬ë¥¼ ë”°ë¼ê°€ë©´ READMEê°€ ìˆê¸´í•˜ì§€ë§Œ ì •ë³´ê°€ ë§ì§€ëŠ” ì•Šì£ .\n// fiberì˜ basicauth ë¯¸ë“¤ì›¨ì–´ ì½”ë“œ ì¤‘ ì¼ë¶€ì…ë‹ˆë‹¤. // Config defines the config for middleware. type Config struct { // Next defines a function to skip this middleware when returned true. // // Optional. Default: nil Next func(c *fiber.Ctx) bool // Users defines the allowed credentials // // Required. Default: map[string]string{} Users map[string]string // Realm is a string to define realm attribute of BasicAuth. // the realm identifies the system to authenticate against // and can be used by clients to save credentials // // Optional. Default: \u0026#34;Restricted\u0026#34;. Realm string // Authorizer defines a function you can pass // to check the credentials however you want. // It will be called with a username and password // and is expected to return true or false to indicate // that the credentials were approved or not. // // Optional. Default: nil. Authorizer func(string, string) bool // Unauthorized defines the response body for unauthorized responses. // By default it will return with a 401 Unauthorized and the correct WWW-Auth header // // Optional. Default: nil Unauthorized fiber.Handler // ContextUser is the key to store the username in Locals // // Optional. Default: \u0026#34;username\u0026#34; ContextUsername string // ContextPass is the key to store the password in Locals // // Optional. Default: \u0026#34;password\u0026#34; ContextPassword string } ìœ„ì˜ ì½”ë“œê°€ BasicAuth ë¯¸ë“¤ì›¨ì–´ì˜ ì„¤ì •ì„ ë‹´ë‹¹í•˜ëŠ” Config íƒ€ì…ì— ëŒ€í•œ ì½”ë“œì…ë‹ˆë‹¤. ê°„ë‹¨íˆ ëª‡ ê°œë§Œ ì•Œì•„ë‘ë©´ ì´í•´í•˜ëŠ” ë°ì— ë„ì›€ì´ ë˜ëŠ” ê²ƒë“¤ë§Œ ì§šì–´ë³´ê² ìŠµë‹ˆë‹¤.\nNext - nilì´ ì•„ë‹Œ ê²½ìš° Next(*fiber.Ctx)ê°€ trueë¥¼ ë°˜í™˜í•˜ë©´ Basic Auth ë¯¸ë“¤ì›¨ì–´ ìì²´ë¥¼ ê±´ë„ˆëœ€. Users - ì´ mapì— ì •ì˜ëœ ìœ ì €ë§Œì´ ìœ íš¨í•œ ìœ ì €ë¡œ ì´ìš©ë  ìˆ˜ë„ ìˆìŒ. (Authorizerê°€ nilì¸ ê²½ìš° ì´ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì¸ì¦ ì§„í–‰) Authorizer - ì¸ì¦ ë¡œì§ì„ ë‹´ë‹¹í•¨. nilë¡œ ë‘˜ ê²½ìš° Usersì—ì„œ ì¼ì¹˜í•˜ëŠ” ìœ ì €ë¥¼ ì°¾ìŒ. ì—¬ê¸¸ ì»¤ìŠ¤í„°ë§ˆì´ì§•í•´ì„œ DBì—ì„œ ì°¾ê±°ë‚˜ í•  ìˆ˜ë„ ìˆìŒ. ContextUsername, ContextPassword - ì¸ì¦ í›„ Contextì— ì–´ë–¤ í‚¤ë¡œ ê° ì •ë³´ë¥¼ ë‹´ì„ì§€. (ê¸°ë³¸ê°’ì€ \u0026ldquo;username\u0026rdquo;, \u0026ldquo;password\u0026rdquo;) ì˜¤í˜¸.. ë§‰ìƒ ì½”ë“œë¥¼ ê¹Œë³´ë‹ˆ ê·¸ë‹¥ ì–´ë µì§€ ì•Šì£ ?! ê·¸ëŸ¼ ê³¼ì—° ì´ ì½”ë“œë“¤ì´ ì„¤ëª…í•œ ê²Œ ë§ëŠ”ì§€ í•œ ë²ˆ ì„œë²„ë¥¼ ë„ì›Œë´…ì‹œë‹¤.\nBasic Auth ë¯¸ë“¤ì›¨ì–´ë¥¼ ë‹¤ì–‘í•˜ê²Œ ì„¤ì •í•´ë³´ê¸° 1. í•­ìƒ ì¸ì¦ì— ì„±ê³µí•˜ëŠ” Authorizerë¥¼ ì´ìš©í•˜ëŠ” Config // newBasicAuthConfigAlwaysAllow ëŠ” ì–¸ì œë‚˜ ì¸ì¦ì— ì„±ê³µí•˜ëŠ” Authorizerë¥¼ // ì´ìš©í•˜ëŠ” Configë¥¼ ë§Œë“­ë‹ˆë‹¤. func newBasicAuthConfigAlwaysAllow() *basicauth.Config{ return \u0026amp;basicauth.Config{ Authorizer: func(username string, password string) bool { return true }, } } func main(){ ... app.Use(basicauth.New(*newBasicAuthConfigAlwaysAllow())) ... } # curl -u username:passwordëŠ” í•´ë‹¹ usernameê³¼ passwordë¡œ Basic authë¥¼ í•˜ëŠ” ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤. $ curl -u wrong:wrong localhost:8000 Welcome! $ curl -u foo:bar localhost:8000 Welcome! Authorizerê°€ usernameê³¼ passwordê°€ ì–´ë–»ë“  trueë¥¼ ë°˜í™˜í•´ ì¸ì¦ì— ì„±ê³µí•©ë‹ˆë‹¤.\n2. ë¯¸ë¦¬ ì •ì˜ëœ ìœ ì €ì— ëŒ€í•´ì„œë§Œ ì¸ì¦ì— ì„±ê³µí•˜ëŠ” Authorizerë¥¼ ì´ìš©í•˜ëŠ” Config // newBasicAuthConfigAlwaysAllow ëŠ” Usersì— ì¡´ì¬í•˜ëŠ” ìœ ì € ì •ë³´ì— ëŒ€í•´ì„œë§Œ // ì¸ì¦ì— ì„±ê³µí•˜ëŠ” Authorizerë¥¼ ì´ìš©í•˜ëŠ” Configë¥¼ ë§Œë“­ë‹ˆë‹¤. func newBasicAuthConfigAllowOnlyAdmin() *basicauth.Config{ return \u0026amp;basicauth.Config{ Users: map[string]string{ \u0026#34;foo\u0026#34;: \u0026#34;bar\u0026#34;, }, } } func main(){ ... app.Use(basicauth.New(*newBasicAuthConfigAllowOnlyAdmin())) ... } # curl -u username:passwordëŠ” í•´ë‹¹ usernameê³¼ passwordë¡œ Basic authë¥¼ í•˜ëŠ” ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤. $ curl -u wrong:wrong localhost:8001 Unauthorized $ curl -u foo:bar localhost:8001 Welcome! ì•ì„œ ë§í–ˆë“¯ Authorizerë¥¼ ì„¤ì •í•˜ì§€ ì•Šê³  nilë¡œ ë‘˜ ê²½ìš° Users ë§µì˜ ë°ì´í„°ë¥¼ ì´ìš©í•˜ëŠ” Authorizerê°€ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤. ì €ëŠ” username=foo, password=barì¸ ìœ ì € ì •ë³´ë¥¼ ë§µì— ê¸°ë¡í–ˆê¸° ë•Œë¬¸ì— foo:bar ìš”ì²­ë§Œì´ ìŠ¹ì¸ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nì, ì´ë ‡ê²Œ ë‚¨ì´ ì‘ì„±í•œ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì„¤ì •ë§Œ ì¡°ê¸ˆ ë°”ê¿”ì„œ ì´ìš©í•´ë´¤ëŠ”ë°, ì½”ë“œë¥¼ ì½ëŠ” ê²ƒë„ ê·¸ê±¸ ë°”íƒ•ìœ¼ë¡œ ê°€ì ¸ë‹¤ê°€ ì“°ëŠ” ê²ƒë„ ì–´ë µì§€ ì•Šë‹¤ëŠ” ê±¸ ì•Œê²Œ ëêµ°ìš”. ì´ì œëŠ” ì§ì ‘ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‘ì„±í•´ë³´ê² ìŠµë‹ˆë‹¤.\nCustom middleware ì‘ì„±í•˜ê¸° ì»¤ìŠ¤í…€ìœ¼ë¡œ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‘ì„±í•  ë•Œì—ëŠ” ê·¸ë‹¥ ì •í•´ì§„ ê¸°ì¤€ì´ ë§ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤. ëŒ€ë¶€ë¶„ì˜ ë¯¸ë“¤ì›¨ì–´ë“¤ì€ Skipper ë“±ì˜ ê°œë…ìœ¼ë¡œ(basic auth ë¯¸ë“¤ì›¨ì–´ì—ì„  Nextë¼ê³  ì •ì˜ë¨.) í•´ë‹¹ ë¯¸ë“¤ì›¨ì–´ì˜ ê¸°ëŠ¥ì„ ì‹¤í–‰í•˜ì§€ ì•Šê³  ë„˜ì–´ê°€ëŠ” ì„¤ì •ì´ë‚˜ ë­ ê°ì¢… ì„¤ì •ë“¤ì´ ì¡´ì¬ëŠ” í•˜ì§€ë§Œ ìš°ë¦¬ëŠ” ê·¼ë³¸ì ìœ¼ë¡œ ì»¤ìŠ¤í…€ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì–´ë–»ê²Œ ì‘ì„±í•˜ëŠ”ì§€ì— ëŒ€í•´ ê¶ê¸ˆí•˜ë‹ˆê¹Œ ê·¸ ë¶€ë¶„ë§Œ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.\npackage fiber ... // Handler defines a function to serve HTTP requests. type Handler = func(*Ctx) error fiber í”„ë ˆì„ì›Œí¬ì—ì„œëŠ” middlewareì„ ì •ì˜í•  ë•Œ fiber.Handler ë¼ëŠ” ì¼ì¢…ì˜ í•¨ìˆ˜ íƒ€ì…ì„ ì´ìš©í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  fiber.HandlerëŠ” ë³´í†µì€ í´ë¡œì ¸ë¥¼ ì´ìš©í•˜ëŠ” í˜•íƒœë¡œ ì œê³µë©ë‹ˆë‹¤. ì œê°€ ë³¼ ë• ì¢€ íŠ¹ì´í•œ ê²ƒ ê°™ì€ë° ì•„ë§ˆ echoë„ ì´ëŸ° ì‹ìœ¼ë¡œ í´ë¡œì ¸ë¥¼ ì´ìš©í•´ ë¯¸ë“¤ì›¨ì–´ë¥¼ ìƒì„±í–ˆë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ë‹¤ìŒê³¼ ê°™ì´ ë§ì´ì£ .\nfunc NewMiddleware(config Config) fiber.Handler { // configì— ê¸°ë³¸ê°’ì„ ë„£ì€ configë¥¼ í´ë¡œì ¸ë¡œ ì ‘ê·¼í•˜ë ¤ í•¨. config = injectDefaultValues(config) // ì‹¤ì œ ë¯¸ë“¤ì›¨ì–´ ì—­í• ì„ í•  í•¨ìˆ˜. // configì— í´ë¡œì ¸ë¡œ ì ‘ê·¼í•œë‹¤. return func(c *fiber.Ctx) error{ ... // ë‹¤ìŒ ë¯¸ë“¤ì›¨ì–´(í˜¹ì€ ìš”ì²­ í•¸ë“¤ëŸ¬)ë¥¼ ìˆ˜í–‰í•œë‹¤. return c.Next() } } ê·¼ë° ì´ëŸ° ê²½ìš°ëŠ” ì•„ë¬´ë˜ë„ configë¥¼ ì„¤ì •í•´ì•¼í•˜ëŠ” ê²½ìš°ì¸ ê²ƒ ê°™ê³  ì €í¬ëŠ” ê·¸ëƒ¥ ìµœëŒ€í•œ ì‹¬í”Œí•˜ê²Œ ë§Œë“¤ì–´ë³¼ê²Œìš”. ëª©í‘œëŠ” Basic Authë¥¼ ê±°ì¹œ ë’¤ ìœ ì € ì •ë³´ê°€ ê¸°ì…ëœ loggerë¥¼ contextì— ì‚½ì…í•´ì£¼ëŠ” ê²ƒì…ë‹ˆë‹¤. ê·¸ëŸ¼ ì–´ë–¤ ê³„ì¸µì—ì„œë“  ctx.Get(\u0026quot;logger\u0026quot;) ë“±ì„ ì´ìš©í•´ loggerì— í¸ë¦¬í•˜ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆì£ ! log í”„ë ˆì„ì›Œí¬ëŠ” sirupsen/logrus ë¥¼ ì´ìš©í•˜ê² ìŠµë‹ˆë‹¤. ì»¬ëŸ¬ë„ ì˜ ë‚˜ì˜¤ê³  í™•ì¥ì„±ë„ ì¢‹ì€ ê±¸ë¡œ ì•Œê³  ìˆì–´ìš”!\nvar injectLoggerMiddleware = func (ctx *fiber.Ctx) error{ // basic auth middlewareê°€ ì£¼ì…í•œ usernameì„ ì´ìš©í•©ë‹ˆë‹¤. username := ctx.Locals(\u0026#34;username\u0026#34;) logger := log.WithField(\u0026#34;user\u0026#34;, username) // contextì— loggerë¼ëŠ” í‚¤ë¡œ ìœ ì € ì •ë³´ë¥¼ ì£¼ì…í•œ loggerë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤! ctx.Locals(\u0026#34;logger\u0026#34;, logger) // ë‹¤ìŒ ë¯¸ë“¤ì›¨ì–´(í˜¹ì€ ìš”ì²­ í•¸ë“¤ëŸ¬)ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤. return ctx.Next() } func main(){ ... // injectLoggerMiddlewareëŠ” basicauthê°€ contextì— ì£¼ì…í•œ usernameì„ ì´ìš©í•˜ê¸° ë•Œë¬¸ì— // ê¼­ basicauth middleware ë‹¤ìŒì— ìˆ˜í–‰ë˜ì–´ì•¼í•©ë‹ˆë‹¤! app.Use(basicauth.New(*newBasicAuthConfigAllowOnlyAdmin())) app.Use(injectLoggerMiddleware) // ìš”ì²­ í•¸ë“¤ëŸ¬ëŠ” ì´ëŸ° ì‹ìœ¼ë¡œ middlewareì—ê²Œ ì£¼ì…ë°›ì€ loggerë¥¼ contextì—ì„œ êº¼ë‚´ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. app.Get(\u0026#34;\u0026#34;, func(ctx *fiber.Ctx) error { logger := ctx.Locals(\u0026#34;logger\u0026#34;).(*log.Entry) logger.Info(\u0026#34;ìœ ì €ê°€ ì ‘ì†í–ˆìŠµë‹ˆë‹¤\u0026#34;) return ctx.SendString(\u0026#34;Welcome!\\n\u0026#34;) }) ... } log.png ê·¸ëŸ¼ ë‹¤ìŒê³¼ ê°™ì´ Basic Authë¥¼ í†µí•´ ê°ê° ë‹¤ë¥¸ ìœ ì €ë¡œ ìš”ì²­ì„ ë³´ë‚´ë©´ í•´ë‹¹ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ë™ì•ˆì€ í•´ë‹¹ context ì†ì˜ loggerì„ ì´ìš©í•´ ë¡œê·¸ë¥¼ ë‚¨ê¸¸ ìˆ˜ ìˆëŠ” ê±¸ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ ì •ë¦¬í•´ë³´ë‹ˆ golangì—ì„œë„ middlewareë¥¼ ì‘ì„±í•˜ëŠ” ê²Œ ê·¸ë¦¬ ì–´ë µì§€ ì•Šë„¤ìš”~!\në§ˆì¹˜ë©° echo í”„ë ˆì„ì›Œí¬ë¥¼ ì“°ë©´ì„œëŠ” ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‘ì„±í•  ë•Œ ì¢€ ì• ë¥¼ ë¨¹ì—ˆë˜ ê¸°ì–µì´ ìˆëŠ”ë°, ë§‰ìƒ fiberë¡œ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‘ì„±í•´ë³´ë‹ˆ ìƒê°ë³´ë‹¤ ë§ì´ ì§ê´€ì ì´ê³  ì‰¬ì›Œì„œ ì¢€ ë†€ëìŠµë‹ˆë‹¤. (ì‚¬ì‹¤ ê¸€ì„ ì“¸ í•„ìš”ê°€ ì—†ì—ˆì„ì§€ë„..?) ê·¸ë˜ë„ Goë¡œ ì‘ì„±ëœ í•œê¸€ ìë£Œë„ ë§ì•„ì¡Œìœ¼ë©´ ì¢‹ê² ê³ , ëˆ„êµ°ê°€ëŠ” fiber ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‘ì„±í•˜ëŠ” ë°©ë²•ì´ ì¢€ ì´í•´ë˜ì§€ ì•Šê³  ì–´ë ¤ìš°ì‹¤ ìˆ˜ ìˆìœ¼ë‹ˆ ë„ì›€ì´ ë  ìˆ˜ ìˆìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤ ã…ã… ë‹¤ìŒì—” ì„œë²„ ê°œë°œì— ìˆì–´ ë˜ í•˜ë‚˜ì˜ ì¤‘ìš”í•œ ì ì¸! ì—ëŸ¬ í•¸ë“¤ë§ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤! ê°ì‚¬í•©ë‹ˆë‹¤.\nì°¸ê³  Guidelines for creating Middleware - fiber Github Issue Fiber middleware Fiber error handling Redhat - ë¯¸ë“¤ì›¨ì–´ë€ ","date":"2021-09-01T12:46:54+09:00","image":"https://umi0410.github.io/blog/golang/how-to-backend-in-go-middleware/log_hu6da6c55463c6a62988b186d685cd2c7c_23812_120x120_fill_box_smart1_3.png","permalink":"https://umi0410.github.io/blog/golang/how-to-backend-in-go-middleware/","title":"Golangìœ¼ë¡œ ë°±ì—”ë“œ ê°œë°œí•˜ê¸° - 4. Custom Middleware(ë¯¸ë“¤ì›¨ì–´) ì‘ì„±í•´ë³´ê¸° (feat. fiber)"},{"content":"ì‹œì‘í•˜ë©° ì´ë²ˆì—ëŠ” Goì–¸ì–´ì—ì„œ ìœ ëª…í•œ ì›¹ í”„ë ˆì„ì›Œí¬ë¥¼ ë¹„êµí•´ë³´ê³  ê°„ë‹¨í•˜ê²Œ Pingpong ì„œë²„ë¥¼ ê°œë°œí•´ë³´ê² ìŠµë‹ˆë‹¤. ë‹¤ë§Œ \u0026ldquo;Golangìœ¼ë¡œ ë°±ì—”ë“œ ê°œë°œí•˜ê¸°\u0026ldquo;ë¥¼ ì£¼ì œë¡œ ê¸€ì„ ì“°ë©´ì„œ ì£¼ ëª©ì ìœ¼ë¡œ í–ˆë˜ ê²ƒì€ ê°œë°œí•˜ë©´ì„œ ê³„ì† ê¶ê¸ˆí–ˆì§€ë§Œ ì–´ë”˜ê°€ì—ì„œ ëšœë ·í•œ ì„¤ëª…ì„ ì°¾ì•„ë³´ê¸° í˜ë“¤ì—ˆë˜ ë‚´ìš©ë“¤ì„ ë‹¤ë¤„ë³´ê³ ìí•˜ëŠ” ê²ƒì´ì—ˆê¸° ë•Œë¬¸ì— ì´ë²ˆ ì£¼ì œëŠ” ê·¸ë‹¥ ì£¼ ëª©ì ì— í•´ë‹¹í•˜ëŠ” ì£¼ì œëŠ” ì•„ë‹ˆë¯€ë¡œ ì´ë²ˆì—” ì•„ì£¼ ê°€~ë³ê²Œ í›‘ì–´ë³´ê³  ë„˜ì–´ê°€ê² ìŠµë‹ˆë‹¤. ì™œëƒí•˜ë©´ ì›¹ í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ í•´ë‹¹ ì›¹í”„ë ˆì„ì›Œí¬ì˜ ë¬¸ì„œë‚˜ ì´ëŸ° ì €ëŸ° ë¸”ë¡œê·¸ë“¤ì— ì´ë¯¸ ë„ˆë¬´ë„ ë§ì´ ìë£Œê°€ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.\nGolangìœ¼ë¡œ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê°œë°œí•˜ëŠ” ë°©ë²•ë“¤ ë³´í†µ ë‹¤ë¥¸ ì–¸ì–´ ê°™ì€ ê²½ìš° Javaì—ì„œëŠ” Spring MVC í˜¹ì€ Spring WebFlux, Pythonì€ FastApi, Flask, Django, Node.jsëŠ” Express, nest, koaì²˜ëŸ¼ ê° ì–¸ì–´ë§ˆë‹¤ ì†ì— ê¼½ì„ ë§Œí•œ ëŒ€í‘œì ì¸ ì›¹ í”„ë ˆì„ì›Œí¬ë“¤ì´ ìˆëŠ” ê²ƒ ê°™ì€ë° GoëŠ” ê·¸ë ‡ì§€ê°€ ì•ŠìŠµë‹ˆë‹¤. GoëŠ” ì˜ ë‚˜ê°€ëŠ” ì›¹ í”„ë ˆì„ì›Œí¬ë“¤ì´ ë„ˆë¬´ë„ ë‹¤ì–‘í•˜ê²Œ ì¡´ì¬í•©ë‹ˆë‹¤. ì•„ì£¼ ì•„ì£¼ ë‹¤ì–‘í•œ í”„ë ˆì„ì›Œí¬ê°€ ì¡´ì¬í•˜ì§€ë§Œ ê·¸ë‹¥ ìš°ìœ„ê°€ ëšœë ·í•˜ì§„ ì•ŠìŠµë‹ˆë‹¤. ì–´ë–¤ í•œ ê¸°ìˆ ì´ ìƒíƒœê³„ë¥¼ ë…ì í•´ë²„ë¦¬ê±°ë‚˜ ê·¸ ê¸°ìˆ ë§Œì´ ê°•ìš”ë˜ëŠ” ì¼ ì—†ì´ ì„œë¡œ(í”„ë ˆì„ì›Œí¬ê°„)ê°€ ê²½ìŸí•˜ë©° ì¢‹ì€ ê¸°ìˆ ë¡œ ë‚˜ì•„ê°€ëŠ” ê²Œ ì¥ì ì´ ë  ìˆ˜ë„ ìˆê³ , ë„ˆë¬´ í”„ë ˆì„ì›Œí¬ê°€ ë‹¤ì–‘í•´ì„œ ì„ íƒí•˜ê¸° ê³¤ë€í•˜ë‹¤ëŠ” ê²ƒì´ ë‹¨ì ì´ ë  ìˆ˜ë„ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì»¤ë®¤ë‹ˆí‹°ê°€ í•œ ë° ì§‘ì¤‘ëœë‹¤ë©´ ë” ë²„ê·¸ í”½ìŠ¤í•˜ê¸° ì‰¬ìš¸í…ë° ê·¸ëŸ° ë©´ì—ì„œëŠ” ì¡°ê¸ˆ ì•„ì‰½ê¸°ë„ í•©ë‹ˆë‹¤.\në‹¤ë§Œ í•œ ê°€ì§€ íë¦„ì´ ìˆë‹¤ë©´ Pythonì„ ì‚¬ìš©í•˜ëŠ” ê°œë°œìë¶„ë“¤ì´ \u0026quot;Pythonic\u0026quot;ì´ë¼ëŠ” ì² í•™(?)ì„ êµ‰ì¥íˆ ì¢‹ì•„í•˜ì‹œë“¯ Goë¥¼ ì‚¬ìš©í•˜ëŠ” ê°œë°œìë¶„ë“¤ì€ \u0026quot;GoìŠ¤ëŸ¬ì›€\u0026quot;ì„ êµ‰ì¥íˆ ì¢‹ì•„í•˜ëŠ” ê²½í–¥ì´ ìˆì–´ ì–´ë–¤ í”„ë ˆì„ì›Œí¬ê°€ ê³„ì†í•´ì„œ ì¸ê¸°ë¥¼ ë„ëŠ” ë°ì—ëŠ” \u0026quot;GoìŠ¤ëŸ¬ìš´ê°€\u0026quot;ê°€ í° ì˜í–¥ì„ ë¼ì¹˜ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì•„ë§ˆ GoìŠ¤ëŸ¬ì›€ì´ë€ ë‹¤ìŒê³¼ ê°™ì€ íŠ¹ì§•ë“¤ì„ ì–˜ê¸°í•˜ëŠ” ê²ƒì¼ ê²ë‹ˆë‹¤.\níƒ€ì…ì„ í†µí•´ ì•ˆì •ì ìœ¼ë¡œ ê°œë°œí•œë‹¤. (interface{} ì™€ ê°™ì€ ë¹ˆ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì´ìš©í•˜ë©´ì„œ type assertionì´ë‚˜ reflectë¥¼ ì´ìš©í•˜ëŠ” ê²ƒì„ ì§€ì–‘) ê°€ë³ê³  ê°„ê²°í•˜ë‹¤. (Spring MVCì™€ ê°™ì€ ë°©ì‹ì€ ì§€ì–‘. í”„ë ˆì„ì›Œí¬ì—ì„œ ì“¸ ë° ì—†ì´ ë§ì€ ê±¸ ì§€ì›í•˜ë©´ì„œ ì„œë¹„ìŠ¤ê°€ ë¬´ê±°ì›Œì§€ëŠ” ê²ƒì„ ì§€ì–‘.) ë¹ ë¥´ë‹¤. ë™ì‹œì„±ì„ goroutineê³¼ channelì„ ì´ìš©í•´ ì˜ ì‚¬ìš©í•œë‹¤. (ê·¼ë° ì´ ë¶€ë¶„ì€ web frameworkì„ ê³ ë¥¼ ë•ŒëŠ” ì˜í–¥ì„ ë¼ì¹˜ì§€ ì•ŠëŠ” ê²ƒ ê°™ê³  ê°œë°œìì˜ ì½”ë“œì— ëŒ€í•œ goìŠ¤ëŸ¬ì›€ì¼ ê²ƒì…ë‹ˆë‹¤.) í”„ë ˆì„ì›Œí¬ ì¶”ì²œ net/http - Go í‘œì¤€(ë¹ŒíŠ¸ì¸) íŒ¨í‚¤ì§€ github.com/labstack/echo - ìŠ¤íƒ€ 20k github.com/gofiber/fiber - â¤ï¸ ìŠ¤íƒ€ 14.6k github.com/gin-gonic/gin - ìŠ¤íƒ€ 50k github.com/beego/beego - ìŠ¤íƒ€ 26k \u0026hellip; ì´ëŸ° íŠ¹ì§•ë“¤ì„ ê°€ì§„ ì›¹í”„ë ˆì„ì›Œí¬ë¡œ í•œêµ­ì—ì„œ ë§ì´ ì“°ì´ëŠ” ë“¯í•œ í”„ë ˆì„ì›Œí¬ë“¤ì€ fiber, echo, gin ì´ ì„¸ ì¹œêµ¬ë“¤ì¸ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì €ë„ ë‹¤ ê¹Šì´ ìˆê²Œ ì¨ë³¸ ê±´ ì•„ë‹ˆì§€ë§Œ ê·¸ ë™ì•ˆ ë¦¬ì„œì¹˜ í•´ì˜¨ ê²ƒë“¤ì´ë‚˜ í•œêµ­ Go ì»¤ë®¤ë‹ˆí‹°ì—ì„œ ì˜¤ê°€ëŠ” ì´ëŸ° ì €ëŸ° ë‚´ìš©ë“¤ì„ ì°¸ê³ í–ˆì„ ë•Œì˜ ì˜ê²¬ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. ginì€ ì˜¤ëœ ì‹œê°„ ê°œë°œë˜ì–´ ì˜¨ í”„ë¡œì íŠ¸ì´ê³  ê¾¸ì¤€íˆ ìŠ¤íƒ€ë„ ë§ì§€ë§Œ ì•„ë§ˆ ì¢€ \u0026lsquo;ë¬´ê²ë‹¤. ëŠë¦¬ë‹¤.\u0026rsquo; ì´ëŸ° ì–˜ê¸°ê°€ ìˆì—ˆë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤. echoëŠ” ê°„ê²°í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©´ì„œ í•„ìš”í•œ ê¸°ëŠ¥ë“¤ì€ ë‹¤ ìˆê³  ê°œë°œì´ í™œë°œí•˜ê²Œ ì´ë£¨ì–´ì§€ê³  ìˆëŠ” ë“¯í•œ ëŠë‚Œì´ì§€ë§Œ ë¬¸ì„œê°€ ê·¸ë‹¥ ì¹œì ˆí•˜ì§€ ì•Šê³  ì© ë¹ ë¥¸ ê±´ ì•„ë‹ˆë‹¤ëŠ” ìƒê°ì´ ë“­ë‹ˆë‹¤. ë¬¸ì„œê°€ ê±°ì˜ ê·¸ëƒ¥ ì˜ˆì‹œ ì½”ë“œ ì‘ì„±í•œ ì •ë„ì…ë‹ˆë‹¤. ê·¸ë˜ë„ Go ì–¸ì–´ íŠ¹ì„±ìƒ ë‚¨ì˜ ì½”ë“œë¥¼ ê¹Œì„œ ë´ë„ í•´ì„í•˜ê¸° ì‰½ê³  ì£¼ì„ë„ ì˜ ë‹¬ë ¤ìˆëŠ” í¸ì´ë¼ í° ì–´ë ¤ì›€ì€ ì—†ì—ˆìŠµë‹ˆë‹¤. fiberëŠ” ìš”ì¦˜ ê°€ì¥ í•«í•œ í”„ë ˆì„ì›Œí¬ ê°™ìŠµë‹ˆë‹¤. ë¹ ë¥´ê²Œ ê¹ƒí—™ ìŠ¤íƒ€ ìˆ˜ë„ ëŠ˜ì–´ë‚˜ê³  ìˆê³  fasthttpë¥¼ ì‚¬ìš©í•´ì„œì¸ì§€ ì•„ë§ˆ ì›”ë“±íˆ ë¹ ë¥¸ ê²ƒìœ¼ë¡œ ì•Œë ¤ì ¸ìˆìŠµë‹ˆë‹¤. ê²Œë‹¤ê°€ ë¬¸ì„œë„ ë„ˆë¬´ ì˜ ì‘ì„±ë˜ì–´ìˆê³  ê°œë°œë„ í™œë°œíˆ ì´ë£¨ì–´ì§€ê³  ìˆìŠµë‹ˆë‹¤.\nì´ëŸ¬í•œ ì´ìœ ë¡œ ì €ëŠ” í˜„ì¬ fiberì™€ echoë¥¼ ì´ìš© ì¤‘ì´ê³  ì¶”í›„ ìƒˆë¡œìš´ ì„œë¹„ìŠ¤ë¥¼ ê°œë°œí•´ì•¼í•œë‹¤ë©´ fiberë¥¼ ì´ìš©í•  ì˜ˆì •ì…ë‹ˆë‹¤! (ì‚¬ì‹¤ ginì´ ìŠ¤íƒ€ëŠ” ê¾¸ì¤€íˆ ë§ì´ ëŠ˜ì–´ë‚˜ê³  ìˆê³  ìŠ¤íƒ€ ìˆ˜ ìì²´ë„ 1íƒ€ì¸ë° ì™œ í•œêµ­ì—ì„œ ë§ì´ë“¤ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ì§€ëŠ” ì˜ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤. ì•„ì‹œëŠ” ë¶„ì´ë‚˜ ginì„ ì‚¬ìš©í•´ë³´ì‹  ë¶„ ìˆìœ¼ì‹œë©´ ì˜ê²¬ ë¶€íƒë“œë¦½ë‹ˆë‹¤..!)\nì˜ˆì‹œ ì½”ë“œ ê°„ë‹¨í•˜ê²Œ net/http ë‚˜ fiber ì¤‘ í•˜ë‚˜ë¥¼ ì´ìš©í•´ GET /pingì— ì‘ë‹µí•˜ëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ì–´ë³´ì•˜ìœ¼ë‹ˆ ì°¸ê³ í•˜ì‹¤ ë¶„ë“¤ì€ ì°¸ê³ í•˜ì‹œê¸¸ ë°”ëë‹ˆë‹¤. ì›¬ë§Œí•˜ë©´ ê³µì‹ ë¬¸ì„œì˜ Getting startedë‚˜ Exampleë“¤ì„ ë³´ì‹œëŠ” ê±¸ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.\në‹¤ë¥¸ ê¸€ë“¤ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ì˜ˆì‹œ ì½”ë“œëŠ” https://github.com/umi0410/how-to-backend-in-goì˜ webapp ë””ë ‰í† ë¦¬ì— ì—…ë¡œë“œ í•´ë‘ê² ìŠµë‹ˆë‹¤.\npackage main import ( \u0026#34;flag\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;github.com/gofiber/fiber/v2\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net/http\u0026#34; ) var ( framework string port = flag.Int(\u0026#34;p\u0026#34;, 8888, \u0026#34;ì„œë²„ê°€ Listení•  port ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.\u0026#34;) ) func init() { flag.Parse() if len(flag.Args()) != 1 { log.Fatal(\u0026#34;í•˜ë‚˜ì˜ ì¸ìë¥¼ ì „ë‹¬í•´ frameworkë¥¼ ì •ì˜í•´ì£¼ì„¸ìš”. (e.g. http, echo, fiber)\u0026#34;) } framework = flag.Arg(0) } func main() { switch framework { case \u0026#34;http\u0026#34;: RunNewHttpServer() case \u0026#34;fiber\u0026#34;: RunNewFiberServer() default: log.Fatal(\u0026#34;ì§€ì›í•˜ì§€ ì•ŠëŠ” framework ì…ë‹ˆë‹¤.\u0026#34;) } } func RunNewHttpServer() { addr := fmt.Sprintf(\u0026#34;:%d\u0026#34;, *port) log.Printf(\u0026#34;Server is listening %d\u0026#34;, *port) http.HandleFunc(\u0026#34;/ping\u0026#34;, func(w http.ResponseWriter, req *http.Request) { if _, err := w.Write([]byte(\u0026#34;PingPong by net/http\\n\u0026#34;)); err != nil { log.Print(err) } }) if err := http.ListenAndServe(addr, nil); err != nil { log.Print(err) } } func RunNewFiberServer() { addr := fmt.Sprintf(\u0026#34;:%d\u0026#34;, *port) app := fiber.New() app.Get(\u0026#34;/ping\u0026#34;, func(c *fiber.Ctx) error { return c.SendString(\u0026#34;Pingpong by fiber\\n\u0026#34;) }) log.Printf(\u0026#34;Server is listening %d\u0026#34;, *port) if err := app.Listen(addr); err != nil { log.Print(err) } } output.png ë§ˆì¹˜ë©° ê°„ë‹¨í•˜ê²Œ Goì–¸ì–´ì—ì„œ ìœ ëª…í•œ í”„ë ˆì„ì›Œí¬ë“¤ì„ ë¹„êµí•´ë³´ê³  Pingpong ì„œë²„ ì˜ˆì œ ì½”ë“œë¥¼ ì‘ì„±í•´ë´¤ìŠµë‹ˆë‹¤. ì•ì„œ ì–¸ê¸‰ë“œë ¸ë“¯ì´ ì•„ë¬´ë˜ë„ ì›¹ í”„ë ˆì„ì›Œí¬ë¡œ hello worldë¥¼ ì°ëŠ” ìˆ˜ì¤€ì˜ ì„œë²„ë¥¼ ì‘ì„±í•˜ëŠ” ë‚´ìš©ì€ ì´ë¯¸ ì–´ëŠ ê³³ì—ì„œë“  ì°¾ì•„ë³¼ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì´ë²ˆ ê¸€ì€ ê°€ë³ê²Œ ë§ˆë¬´ë¦¬í•˜ê³  ì´ëŸ° ì €ëŸ° í”„ë ˆì„ì›Œí¬ë“¤ì˜ ê³µì‹ ë¬¸ì„œë¥¼ ë³´ì‹œëŠ” ê±¸ ì¶”ì²œë“œë¦½ë‹ˆë‹¤ ã…ã… ë‹¤ìŒ ê¸€ì€ ë¯¸ë“¤ì›¨ì–´ ì‘ì„±ì´ë‚˜ ì—ëŸ¬ ì²˜ë¦¬ì— ëŒ€í•´ ë‹¤ë¤„ë³¼ ì˜ˆì •ì¸ë° ì´ë²ˆ ê¸€ ë³´ë‹¤ ì¬ë°Œì„ ê²ƒìœ¼ë¡œ ì˜ˆìƒë©ë‹ˆë‹¤. \u0026lsquo;ì—ëŸ¬ë¥¼ ì–´ë–»ê²Œ ì²˜ë¦¬í• ê¹Œ\u0026lsquo;ë‚˜ \u0026lsquo;ë¯¸ë“¤ì›¨ì–´ëŠ” ì–´ë–»ê²Œ ì‘ì„±í•  ìˆ˜ ìˆì„ê¹Œ\u0026lsquo;ì™€ ê°™ì€ ë‚´ìš©ì€ ê·¸ë‹¥ í”íˆ ì°¾ì•„ë³¼ ìˆ˜ ìˆëŠ” ë‚´ìš©ì€ ì•„ë‹Œ ê²ƒ ê°™ì•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ê·¸ëŸ¼ ë‹¤ìŒ ê¸€ì—ì„œ ë´ìš” ìš°ë¦¬~ ã…ã… ğŸ‘‹\nì°¸ê³  ê°„ë‹¨í•œ ì›¹ ì„œë²„ (HTTP ì„œë²„) - http://golang.site/go/article/111-%EA%B0%84%EB%8B%A8%ED%95%9C-%EC%9B%B9-%EC%84%9C%EB%B2%84-HTTP-%EC%84%9C%EB%B2%84 Understanding Listen Ports and Addresses - https://www.ateam-oracle.com/listen-addresses https://www.esparkinfo.com/top-golang-web-framework-development.html https://blog.devgenius.io/best-web-framework-of-golang-in-2021-aae4b2ad9bf ë‚´ê°€ Go ì–¸ì–´ë¥¼ ì„ íƒí•œ ì´ìœ  - https://pronist.tistory.com/67 ","date":"2021-08-13T12:46:54+09:00","image":"https://umi0410.github.io/blog/golang/how-to-backend-in-go-webapp/output_hu537a11d34916ac1c2def7909b69ddbc5_22456_120x120_fill_box_smart1_3.png","permalink":"https://umi0410.github.io/blog/golang/how-to-backend-in-go-webapp/","title":"Golangìœ¼ë¡œ ë°±ì—”ë“œ ê°œë°œí•˜ê¸° - 3. ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œí•´ë³´ê¸° (feat. fiber)"},{"content":"ì‹œì‘í•˜ë©° ì €ëŠ” Go ì–¸ì–´ë¥¼ ê³µë¶€í•˜ë©´ì„œ ì²˜ìŒìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¼ëŠ” ê²ƒì„ ì ‘í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ê³¼ê±°ì—ëŠ” ê·¸ì € ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ëŠ” ê²ƒì—ë§Œ ê´€ì‹¬ì´ ìˆì—ˆì§€ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì–´ë–»ê²Œ ê³„ì¸µì„ ë‚˜ëˆ  ì„¤ê³„í• ì§€, ì–´ë–»ê²Œ í•´ì•¼ ìœ ì§€ ë³´ìˆ˜í•˜ê¸° ì‰¬ìš°ë©´ì„œ ì•ˆì •ì ì¸ ê°œë°œì„ í•  ìˆ˜ ìˆì„ì§€ì— ëŒ€í•œ ê³ ë¯¼ì„ í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\ní•˜ì§€ë§Œ Goë¥¼ ê³µë¶€í•˜ë©´ì„œë¶€í„°ëŠ” í´ë¦° ì•„í‚¤í…ì³ë‚˜ MSA, ë™ì‹œì„± íŒ¨í„´ ë“±ì„ ë¹„ë¡¯í•´ í…ŒìŠ¤íŠ¸ ì½”ë“œì— ëŒ€í•´ì„œë„ ê³µë¶€í•´ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ê·¸ ì¤‘ì—ì„œë„ í…ŒìŠ¤íŠ¸ ì½”ë“œì— ëŒ€í•´ ê³µë¶€í•´ë³´ë©° ìµí˜”ë˜ ì ë“¤ì„ ë°”íƒ•ìœ¼ë¡œ ì´ë²ˆ ê¸€ì—ì„œëŠ” Golangìœ¼ë¡œ ë°±ì—”ë“œ ê°œë°œì„ í•˜ë©´ì„œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì–´ë–»ê²Œ ì‘ì„±í•  ìˆ˜ ìˆì„ì§€ì— ëŒ€í•´ ì•Œì•„ë³´ë ¤í•©ë‹ˆë‹¤.\në³¸ ê¸€ì—ì„œ ì‚¬ìš©ëœ ì˜ˆì‹œ ì½”ë“œëŠ” ì €ì˜ Github how-to-backend-in-go ë ˆí¬ì§€í† ë¦¬ì— ì—…ë¡œë“œ í•´ë‘˜í…Œë‹ˆ ì°¸ê³ í•˜ì‹¤ ë¶„ë“¤ì€ ì°¸ê³ í•´ì£¼ì„¸ìš”~!\nTDD (Test Driven Development)ì™€ ìœ ë‹› í…ŒìŠ¤íŠ¸ ì‚¬ìš©ìì˜ ë°˜ì‘ì— ë§ì¶° ì¬ë¹ ë¥´ê²Œ ëŒ€ì‘í•  ìˆ˜ ìˆë„ë¡ ê°œë°œ ì£¼ê¸°ê°€ ë¹¨ë¼ì§€ë©´ì„œ DevOps ë¬¸í™” ë¿ë§Œ ì•„ë‹ˆë¼ TDDë„ ë§ì€ ì¸ê¸°ë¥¼ ì–»ê²Œ ëœ ê²ƒ ê°™ìŠµë‹ˆë‹¤. TDDë€ ê°œë°œì„ ë¨¼ì € ë‹¤~ ì§„í–‰í•œ ë’¤ í•œ ë²ˆì— ë°°í¬í•˜ê±°ë‚˜ ì‹œê°„ ë‚  ë•Œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì§œëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ìš°ë¦¬ê°€ ê°œë°œí•´ì•¼í•  ìµœì†Œí•œì˜ ë‚´ìš©ë“¤ì„ ê²€ì¦í•  ìˆ˜ ìˆëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ë¨¼ì € ì‘ì„±í•œ ë’¤ í•´ë‹¹ í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼í•˜ëŠ” ì½”ë“œë¥¼ ê°œë°œí•´ë‚˜ê°€ëŠ” ê°œë°œ ë°©ë²•ë¡ ì…ë‹ˆë‹¤.\nTDDì— ëŒ€í•´ ì„¤ëª…í•˜ìë©´ TDDë§Œìœ¼ë¡œë„ ì±… ëª‡ ê¶Œì˜ ë¶„ëŸ‰ì´ ë  ìˆ˜ ìˆê³ , ì € ë˜í•œ TDDë¥¼ ì˜ ì•„ëŠ” ê²ƒì€ ì•„ë‹ˆê¸°ì— ìì„¸í•œ ì„¤ëª…ì€ ìƒëµí•˜ê² ìŠµë‹ˆë‹¤. ì´ë²ˆ ê¸€ì˜ ì£¼ëœ ë‚´ìš©ì€ TDDì— ëŒ€í•´ ì†Œê°œí•˜ëŠ” ê²ƒë³´ë‹¤ëŠ” Golangìœ¼ë¡œ ìœ ë‹› í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ëŠ” ìš”ë ¹ì…ë‹ˆë‹¤.\nìœ ë‹› í…ŒìŠ¤íŠ¸ëŠ” ë‹¤ë¥¸ ê³„ì¸µê³¼ ë¬´ê´€í•˜ê²Œ ë…ë¦½ì ìœ¼ë¡œ ê°ê°ì˜ ë©”ì†Œë“œì˜ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê²ƒì´ë¼ê³  ë³¼ ìˆ˜ ìˆê² ìŠµë‹ˆë‹¤. ê³„ì¸µë§ˆë‹¤ í•´ë‹¹ í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ ê²€ì¦í•˜ê³ ì í•˜ëŠ” ì£¼ìš”í•œ ë‚´ìš©ì€ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìœ ë‹› í…ŒìŠ¤íŠ¸ëŠ” ì£¼ë¡œ ìì‹ ë§Œì„ í…ŒìŠ¤íŠ¸ í•˜ê¸° ë•Œë¬¸ì— ìê¸° ê³„ì¸µì˜ ë™ì‘ì„ í…ŒìŠ¤íŠ¸í•˜ì§€ ë‹¤ë¥¸ ê³„ì¸µì˜ ë™ì‘ê¹Œì§€ í…ŒìŠ¤íŠ¸í•˜ì§„ ì•ŠìŠµë‹ˆë‹¤. ë˜í•œ ê²½ìš°ì— ë”°ë¼ ì•„ì˜ˆ ë‹¤ë¥¸ ê³„ì¸µì„ ì‹¤ì œë¡œ ì´ìš©í•˜ì§€ ì•Šê³  ëª¨í‚¹(Mocking)í•œ íƒ€ì…ì„ ì´ìš©í•˜ëŠ” ê²½ìš°ë„ ìˆìŠµë‹ˆë‹¤.\nData access layer\nuserRepository.Create(user *entity.User) - ìœ ì € í…Œì´ë¸”ì— í•´ë‹¹ ë°ì´í„°ê°€ ì˜ ì €ì¥ë˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸ Business layer\nuserService.Create(ctx *fiber.Ctx, user UserCreateInput) - ìœ ì € ìƒì„± ê´€ë ¨ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì£¼ë¡œ í…ŒìŠ¤íŠ¸.\nDBì— ì˜ ì˜ì†í™” ë˜ì—ˆëŠ”ì§€ ê¹Œì§€ëŠ” í…ŒìŠ¤íŠ¸ í•  í•„ìš” ì—†ìŒ. ì´ëŠ” Data access layerì—ì„œ í…ŒìŠ¤íŠ¸ í•  ë‚´ìš©\nPresentation layer\nuserHandler.Craete(ctx *fiber.Ctx) - ì‘ë‹µ ì½”ë“œê°€ ë°”ë¼ë˜ ëŒ€ë¡œ 201 ë²ˆì´ ë§ëŠ”ì§€. JSONìœ¼ë¡œ ì˜ ì‘ë‹µí•˜ëŠ”ì§€\në§ˆì°¬ê°€ì§€ë¡œ DBì— ì˜ ì˜ì†í™” ë˜ì—ˆëŠ”ì§€ê¹Œì§€ëŠ” í…ŒìŠ¤íŠ¸í•  í•„ìš” ì—†ìŒ. ì´ëŠ” Data access layerì—ì„œ í…ŒìŠ¤íŠ¸ í•  ë‚´ìš©.\në˜í•œ ì–´ë–¤ business layerì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ëŒ€í•´ì„œë„ ìì„¸íˆ í…ŒìŠ¤íŠ¸ í•  í•„ìš” ì—†ìŒ. ì´ ë˜í•œ Business layerì—ì„œ í…ŒìŠ¤íŠ¸í•  ë‚´ìš©\nì°¸ê³ ë¡œ ì €ëŠ” Business layerë¥¼ ìœ„ì£¼ë¡œ í…ŒìŠ¤íŠ¸í•˜ê³  ìˆìŠµë‹ˆë‹¤. Data access layerì˜ ê²½ìš° ë§ì€ ë¶€ë¶„ì´ Database framework(ORM)ì„ í†µí•´ ê²€ì¦ì´ ë˜ì—ˆê³ , Presentation layerë„ Web frameworkë“¤ì— ì˜í•´ ë§ì€ ë¶€ë¶„ì´ ê²€ì¦ë˜ì—ˆì„ ë¿ ì•„ë‹ˆë¼ í¬ìŠ¤íŠ¸ë§¨ ê°™ì€ ë„êµ¬ë“¤ì„ í†µí•´ í™•ì¸í•´ëŠ” ê²ƒì´ ë” í¸í•œ ê²½ìš°ë„ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë°˜ë©´ Business layerì˜ ë™ì‘ì€ ë§¤ìš° ì¤‘ìš”í•˜ê³ , í…ŒìŠ¤íŠ¸ ì½”ë“œ ì—†ì´ ë§¤ë²ˆ ìˆ˜ì‘ì—…ìœ¼ë¡œ ê·¸ ë™ì‘ì„ ê²€ì¦í•˜ëŠ” ê²ƒì€ ë§¤ìš° ë²ˆê±°ë¡­ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.\n(ê³„ì¸µì´ë‚˜ ê´€ì‹¬ì‚¬ë¥¼ ì–´ë–»ê²Œ ë‚˜ëˆ„ëƒì— ë”°ë¼ Business layerëŠ” ë‹¤ì–‘í•˜ê²Œ ë¶ˆë¦¬ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ë‚´ë¶€ ê³„ì¸µ, ë„ë©”ì¸ ê³„ì¸µ, ì½”ì–´ ë¡œì§ ê³„ì¸µ ë“±ë“±ìœ¼ë¡œ ë¶ˆë¦¬ê¸°ë„ í•©ë‹ˆë‹¤.)\nUnit testë¥¼ ë„ì…í•˜ê¸° ì „ì— ì•Œì•„ë‘ë©´ ì¢‹ì€ ê²ƒë“¤ ìœ ì—°ì„±ì„ ìœ„í•œ ì˜ì¡´ì„± ì£¼ì… ë° ë³€ìˆ˜ ì´ˆê¸°í™” ë°©ë²• mockingì— ëŒ€í•˜ì—¬ assert êµ¬ë¬¸ ì´ìš© Springì„ ë°”íƒ•ìœ¼ë¡œ ê°œë°œí•˜ëŠ” ê²½ìš° JUnitì´ë¼ëŠ” í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ë¥¼ ì£¼ë¡œ ì´ìš©í•˜ê³  ì´ë¥¼ í†µí•´ í…ŒìŠ¤íŠ¸í•˜ëŠ” ë°©ì‹ì´ ê±°ì˜ ì •í˜•í™” ë˜ì–´ìˆëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ Golangì€ ê·¸ë‹¥ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” í˜•íƒœê°€ ì •í˜•í™”ë˜ì–´ìˆì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì–´ë–¤ ì–¸ì–´ë‚˜ í”„ë ˆì„ì›Œí¬ë¥¼ í†µí•´ ìœ ë‹› í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‚¬ìš©í•˜ë“  ìœ„ì˜ ì„¸ ê°€ì§€ í•­ëª©ë“¤ì„ ì–´ë–»ê²Œ ì´ìš©í•  ì§€ ì•Œì•„ì•¼í•  ê²ƒì…ë‹ˆë‹¤.\n1. ìœ ì—°ì„±ì„ ìœ„í•œ ì˜ì¡´ì„± ì£¼ì… ë° ë³€ìˆ˜ ì´ˆê¸°í™” ë°©ë²• ì–´ë– í•œ ëª¨ë“ˆì´ ìì‹ ì˜ ë©¤ë²„ ë³€ìˆ˜ë“¤ì„ ë‚´ë¶€ì ìœ¼ë¡œ ìƒì„±í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì™¸ë¶€ì—ì„œ ì£¼ì… ë°›ëŠ” í˜•íƒœì¸ ì˜ì¡´ì„± ì£¼ì…ì€ ìœ ì—°í•œ ì˜ì¡´ì„± ê´€ë¦¬ë¥¼ ìœ„í•´ ê¶Œì¥ë©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ Userì— ëŒ€í•œ ë„ë©”ì¸/ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì‹¤í–‰í•˜ë©° UserRepositoryë¥¼ ì´ìš©í•´ Userë¥¼ ì˜ì†ì ìœ¼ë¡œ ì €ì¥í•˜ê¸°ë„ í•˜ëŠ” UserServiceê°€ UserRepositoryì— ì˜ì¡´í•˜ëŠ” ê²½ìš°ë¥¼ ì‚´í´ë´…ì‹œë‹¤.\n// 1. ì˜ì¡´ì„± ì£¼ì… í˜•íƒœ - Good func NewUserService(userRepository UserRepository) *UserService{ return \u0026amp;UserService{ userRepository: userRepository, } } // 2. ì˜ì¡´ì„±ì„ ì£¼ì…í•˜ì§€ ì•ŠëŠ” í˜•íƒœ - Bad func NewUserServiceWithoutInjection(client *ent.UserClient) *UserService{ return \u0026amp;UserService{ userRepository: NewUserRepository(client), } } ì²« ë²ˆì§¸ - ì˜ì¡´ì„± ì£¼ì… í˜•íƒœëŠ” í…ŒìŠ¤íŠ¸ í•˜ëŠ” ê²½ìš°ë‚˜ ê°œë°œ í™˜ê²½ì— ë”°ë¼ ìœ ë™ì ìœ¼ë¡œ ì ì ˆí•œ UserServiceê°€ ì´ìš©í•  UserRepositoryë¥¼ ì£¼ì…ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¦‰ ì‹¤ì œë¡œ API ì„œë²„ë¥¼ êµ¬ë™ì‹œí‚¬ ë•Œì—ëŠ” NewUserService(userRepository UserRepository) ë©”ì†Œë“œì— ì‹¤ì œë¡œ DBë¥¼ ì´ìš©í•˜ëŠ” Repositoryì¸ UserRepositoryImpl ì„ ì£¼ì…í•˜ê³ , ìœ ë‹› í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•  ë•Œì—ëŠ” ëª¨í‚¹í•œ íƒ€ì…ì¸ MockUserRepositoryë¥¼ ì£¼ì…í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.\në‘ ë²ˆì§¸ - ì˜ì¡´ì„±ì„ ì£¼ì…í•˜ì§€ ì•ŠëŠ” í˜•íƒœëŠ” ìì‹ ì´ ì˜ì¡´í•˜ëŠ” UserRepositoryê°€ ì´ë¯¸ NewUserServiceByItSelfë¼ëŠ” ë©”ì†Œë“œì—ì„œ NewUserRepository ë¼ëŠ” ë©”ì†Œë“œë¥¼ í†µí•´ íŠ¹ì • UserRepositoryë¥¼ ì´ìš©í•˜ë„ë¡ ì •ì˜ë˜ì–´ìˆê¸° ë•Œë¬¸ì— Mockingì„ ì ìš©í•˜ê¸°ë„ í˜ë“¤ê³ , ë§Œì•½ ë‹¤ë¥¸ ëª¨ë“ˆë“¤ ë˜í•œ UserRepositoryë¥¼ ì´ìš©í•˜ëŠ” ê²½ìš° Singletonìœ¼ë¡œ ì´ìš©í•˜ì§€ ëª»í•˜ê³  ì—¬ëŸ¬ UserRepositoryê°€ ìƒì„±ë  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì‚¬ì‹¤ ent.UserClientë¼ëŠ” DB Client ë˜í•œ ì£¼ì…ë°›ì§€ ì•Šê³  ë‚´ë¶€ì ìœ¼ë¡œ ìƒˆë¡œ ìƒì„±í•´ì•¼ ì˜ì¡´ì„±ì„ ì™„ì „íˆ ì£¼ì…ë°›ì§€ ì•ŠëŠ” í˜•íƒœì´ê² ì§€ë§Œ ê·¸ëŸ° ë°©ì‹ì€ ë„ˆë¬´ë„ êµ¬í˜„í•˜ê¸° ë²ˆê±°ë¡œì›Œ í¸ì˜ìƒ DB clientëŠ” ì£¼ì…ë°›ì•˜ìŠµë‹ˆë‹¤. ì´ê²ƒë§Œ ë´ë„ ê°œë°œí•˜ëŠ” í˜•íƒœê°€ ì¼ê´€ë˜ì§€ ëª»í•˜ê³  ë¶ˆí¸í•œ ì‚¬í•­ì´ ë§ë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì£ .\n2. Mockingì— ëŒ€í•˜ì—¬ ëª¨í‚¹ì´ë€ ì‹¤ì œë¡œ ì„œë²„ê°€ ì‹¤í–‰ë  ë•Œ ì‚¬ìš©í•˜ëŠ” ëª¨ë“ˆì´ ì•„ë‹Œ ê°€ì§œ ëª¨ë“ˆì„ ì´ìš©í•˜ëŠ” ê¸°ë²•ì…ë‹ˆë‹¤. ì•ì—ì„œ ì ê¹ ì–¸ê¸‰í–ˆë“¯ì´ ì¢…ì¢… í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„± ì‹œì— ì¢…ì¢… Mockingì´ ì´ìš©ë©ë‹ˆë‹¤. ì˜ì¡´ì„± ì£¼ì… íŒ¨í„´ì„ í†µí•´ í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œëŠ” ì‹¤ì œ typeì´ ì•„ë‹Œ Mocking typeì„ ìœ ë™ì ìœ¼ë¡œ ì£¼ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ ì™€ë‹¿ì§€ ì•Šì„ ìˆ˜ ìˆëŠ”ë° ì˜ˆë¥¼ ë“¤ì–´ UserServiceì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë£°ê³¼ ë¡œì§ì´ ì˜ ë™ì‘í•˜ëŠ”ì§€ë¥¼ í™•ì¸í•  ë•Œ Data access layerì˜ ë™ì‘ê¹Œì§€ í…ŒìŠ¤íŠ¸í•˜ê³  ì‹¶ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš° Data access layerì˜ ëª¨ë“ˆì„ ê°€ì§œ íƒ€ì…ìœ¼ë¡œ ëª¨í‚¹í•©ë‹ˆë‹¤.\ntype MockUserRepository struct{} func (m MockUserRepository) Create(input *UserCreateInput) (*ent.User, error) { return \u0026amp;ent.User{ ID: input.ID, Password: input.Password, Name: input.Name, }, nil } func TestUserService_Create(t *testing.T){ // í•´ë‹¹ ì´ë¦„ì˜ ìœ ì €ê°€ ìˆëŠ”ì§€ í™•ì¸ s := NewUserService(new(MockUserRepository)) _, err := s.Create(\u0026amp;UserCreateInput{ID: \u0026#34;jinsu_umi\u0026#34;, Name: \u0026#34;Jinsu Park\u0026#34;, Password: \u0026#34;123123123\u0026#34;}) assert.NoError(t, err) } ì´ëŸ° ì‹ìœ¼ë¡œ MockUserRepository íƒ€ì…ì—ì„œëŠ” Create ë©”ì†Œë“œê°€ ì§ì ‘ DBì— ìœ ì €ë¥¼ ì˜ì†í™”í•˜ëŠ” ì‘ì—…ì„ ìƒëµí•œ ë’¤ ê·¸ëŸ´ì‹¸í•œ ë¦¬í„´ê°’ì„ ë¦¬í„´í•˜ë„ë¡ë§Œ êµ¬í˜„í•¨ìœ¼ë¡œì¨ UserRepsotiroyë¥¼ ëª¨í‚¹í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.\ní•˜ì§€ë§Œ ì´ë ‡ê²Œ ìˆ˜ì‘ì—…ìœ¼ë¡œ Mock typeì„ ë§¤ë²ˆ ì •ì˜í•˜ëŠ” ê²ƒì€ ê·€ì°®ì„ ìˆ˜ ìˆì£ . ë”°ë¼ì„œ ì´ë²ˆ ê¸€ì˜ ë’¤ì—ì„œëŠ” mocking frameworkë“¤ì— ëŒ€í•´ì„œë„ ì •ë¦¬í•´ë³´ê² ìŠµë‹ˆë‹¤.\nì¢…ì¢… Stubê³¼ Mockì— ëŒ€í•´ í˜¼ë™ì´ ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ ì‹¤ì œ ëª¨ë“ˆì´ ì•„ë‹Œ ê°€ì§œ ëª¨ë“ˆì„ ì´ìš©í•˜ëŠ” ê¸°ë²• ìì²´ë¥¼ mockingì´ë¼ê³  í•©ë‹ˆë‹¤. ì´ë¥¼ ì¢€ ë” ì„¸ë¶„í™”í•´ì„œ ë´¤ì„ ë• stubì€ ë‹¨ìˆœíˆ í…ŒìŠ¤íŠ¸ë¥¼ ê°„ë‹¨íˆ í†µê³¼ì‹œí‚¤ê¸° ìœ„í•´ ì‹¤ì œ ëª¨ë“ˆì„ ëŒ€ì²´í•˜ëŠ” ê°€ì§œ ê°ì²´ë¥¼ ë§í•˜ê³  mockì€ ì˜ˆìƒê°’ê¹Œì§€ ë¹„êµë¥¼ í•˜ê³ , ë•Œë•Œë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤íŒ¨ì‹œí‚¤ê¸°ë„ í•˜ëŠ” ë” ìŠ¤ë§ˆíŠ¸í•œ stubì´ë¼ê³  ë³¼ ìˆ˜ ìˆë‹¤ê³  í•©ë‹ˆë‹¤.\nì°¸ê³ : https://stackoverflow.com/questions/3459287/whats-the-difference-between-a-mock-stub\n3. assert êµ¬ë¬¸ ì´ìš©í•˜ê¸° func TestUserService_Create(t *testing.T){ // í•´ë‹¹ ì´ë¦„ì˜ ìœ ì €ê°€ ìˆëŠ”ì§€ í™•ì¸ s := NewUserService(new(MockUserRepository)) t. _, err := s.Create(\u0026amp;UserCreateInput{ID: \u0026#34;jinsu_umi\u0026#34;, Name: \u0026#34;Jinsu Park\u0026#34;, Password: \u0026#34;123123123\u0026#34;}) // ì´ëŸ° ì‹ìœ¼ë¡œ ë¡œê·¸ë¥¼ í†µí•´ í•˜ë‚˜ í•˜ë‚˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ í™•ì¸í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ //t.Log(\u0026#34;ì—ëŸ¬ê°€ ì¡´ì¬í•˜ì§€ ì•Šì•„ì•¼í•©ë‹ˆë‹¤.\u0026#34;) //t.Log(\u0026#34;err == nil ì¸ì§€ í™•ì¸í•˜ì‹­ì‹œì˜¤. err == nil: \u0026#34; , err == nil) // assertë¥¼ ì´ìš©í•´ ìë™ìœ¼ë¡œ ì„±ê³µ/ì‹¤íŒ¨ë¥¼ íŒë‹¨í•©ë‹ˆë‹¤. assert.NoError(t, err) } assert ë¼ëŠ” ë°©ì‹ì„ í†µí•œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ê²€ì¦ì€ ë‹¤ì–‘í•œ í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤. ëˆˆìœ¼ë¡œ í•˜ë‚˜ í•˜ë‚˜ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë“¤ì˜ ê²°ê³¼ë¥¼ í™•ì¸í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ assertë¼ëŠ” ë°©ì‹ì„ í†µí•´ ìë™ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ì˜ ì„±ê³µ/ì‹¤íŒ¨ë¥¼ íŒë‹¨í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì €ëŠ” ì£¼ë¡œ github.com/stretchr/testify íŒ¨í‚¤ì§€ì˜ assert ë©”ì†Œë“œë¥¼ ì´ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.\ntest-output.png assertë¥¼ í†µí•´ í…ŒìŠ¤íŠ¸ì˜ ì„±ê³µ/ì‹¤íŒ¨ ì—¬ë¶€ë¥¼ íŒë‹¨í•˜ë©´ ì„±ê³µì‹œì—ëŠ” í¬ê²Œ stdoutì„ í™•ì¸í•  í•„ìš” ì—†ê³ , ì‹¤íŒ¨í•œ ê²½ìš°ì—ëŠ” ê·¸ê²ƒì— ëŒ€í•œ ì—ëŸ¬ ë©”ì‹œì§€ë“¤ë§Œ í™•ì¸í•˜ë©´ ë˜ê¸° ë•Œë¬¸ì— í¸ë¦¬í•©ë‹ˆë‹¤. ë§Œì•½ ë¡œê·¸ë‚˜ í”„ë¦°íŠ¸ ë¬¸ì„ í†µí•´ ìˆ˜ì‘ì—…ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ íŒë‹¨í•´ì•¼í•œë‹¤ë©´\u0026hellip; ë§¤ë²ˆ í…ŒìŠ¤íŠ¸ë§ˆë‹¤ ë„ˆë¬´ ë¶ˆí¸í•˜ê² ì£ ?!\nGolangì—ì„œ Mocking ì´ìš©í•˜ê¸° ì´ë²ˆì—” Golangì—ì„œ Mockingì„ ì´ìš©í•˜ëŠ” ë°©ë²•ì„ ì¢€ ë” ìì„¸íˆ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤. golangì—ì„œ Mockingì„ ì´ìš©í•˜ëŠ” ë°©ë²•ì€ í¬ê²Œ 3ê°€ì§€ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.\nì§ì ‘ Mock type êµ¬í˜„í•˜ê¸° golang/mock ì¦‰ gomock í”„ë ˆì„ì›Œí¬ ì´ìš©í•˜ê¸° stretchr/testify/mock í”„ë ˆì„ì›Œí¬ ì´ìš©í•˜ê¸° ìë°”ì˜ ê²½ìš° ë”°ë¡œ ë¯¸ë¦¬ mock íƒ€ì…(ì¦‰ ê°€ì§œ íƒ€ì…)ì„ ì‘ì„±í•´ë†“ì§€ ì•Šë”ë¼ë„ ê·¸ë¦¬ê³  ê¸°ì¡´ íƒ€ì…ì´ interfaceê°€ ì•„ë‹Œ concreteí•œ ì¼ë°˜ classì´ë”ë¼ë„ ìƒì† í˜¹ì€ í”„ë¡ì‹œë¥¼ í†µí•´ mock íƒ€ì…ì„ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë°˜ë©´ Golangì€ íˆ¬ëª…í•œ ë™ì‘ê³¼ ì—„ê²©í•œ íƒ€ì…ì´ íŠ¹ì§•ì¸ ë§Œí¼ í…ŒìŠ¤íŠ¸ ì§„í–‰ ì‹œì— ìë™ìœ¼ë¡œ ì ì ˆí•œ mock íƒ€ì…ì„ ìƒì„±í•˜ê±°ë‚˜ í”„ë¡ì‹œë¥¼ ì´ìš©í•˜ê±°ë‚˜ interfaceê°€ ì•„ë‹Œ structì— ë‹¤ë¥¸ typeì˜ structë¥¼ í• ë‹¹í•  ìˆ˜ë„ ì—†ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ Goì—ì„œ mockingì„ ì´ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ì•„ë˜ì™€ ê°™ì€ ì œì•½ ì¡°ê±´ë“¤ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ì ì„ ìƒê°í•´ë³¸ë‹¤ë©´ Goì—ì„œëŠ” Mockingì„ ì´ìš©í•˜ëŠ” ê²ƒì€ ë‹¤ë¥¸ ì–¸ì–´ì— ë¹„í•´ ì‰¬ìš´ í¸ì€ ì•„ë‹Œ ê²ƒì²˜ëŸ¼ ëŠê»´ì§€ê¸°ë„ í•©ë‹ˆë‹¤.\ninterfaceë¡œ ì„ ì–¸ëœ ë³€ìˆ˜ì—ë§Œ mock typeì„ í• ë‹¹í•  ìˆ˜ ìˆë‹¤. mock typeì„ ì§ì ‘ ì •ì˜í•˜ê±°ë‚˜ mocking frameworkì„ ì´ìš©í•´ ì½”ë“œë¥¼ ìƒì„±í•œë‹¤.(í…ŒìŠ¤íŠ¸ ì§„í–‰ ì‹œ ìë™ì´ ì•„ë‹˜. ì§ì ‘ ìš°ë¦¬ê°€ ì‹¤í–‰ì‹œì¼œì•¼í•¨.) ì£¼ë¡œ 1ë²ˆ(ì§ì ‘ Mock type êµ¬í˜„í•˜ê¸°) ê°™ì€ ê²½ìš°ëŠ” ì´ mock íƒ€ì…ì´ ìš°ë¦¬ ì„œë¹„ìŠ¤ì—ì„œ ìì£¼ ì‚¬ìš©ë  ê²ƒì´ê³  ê·¸ëƒ¥ ì˜ˆìƒì¹˜ëª»í•œ callì´ë‚˜ missing call(í˜¸ì¶œë˜ê¸¸ ì˜ˆìƒí–ˆì§€ë§Œ í˜¸ì¶œë˜ì§€ ì•ŠëŠ” ê²½ìš°)ì— ëŒ€í•œ ëŒ€ì‘ì´ í•„ìš” ì—†ëŠ” ê²½ìš° ì‚¬ìš©í•˜ë©´ ì¢‹ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ë°˜ë©´ 2, 3ë²ˆì€ ì´ë²ˆ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ 1íšŒì„± mockingì¸ ê²½ìš° ë§ì´ ì‚¬ìš©ë˜ê¸°ë„ í•˜ê³  mock íƒ€ì…ì˜ ë©”ì†Œë“œì— ëŒ€í•œ unexpected callì´ë‚˜ missing call ì— ëŒ€í•œ ëŒ€ì‘ì„ ìˆ˜í–‰í•˜ê³ ìí•˜ëŠ” ê²½ìš° ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nì¶”ê°€ì ìœ¼ë¡œ 1ë²ˆ ë°©ì‹ì´ ì•„ë‹Œ 2, 3 ë²ˆ ë°©ì‹ì²˜ëŸ¼ ëª¨í‚¹ í”„ë ˆì„ì›Œí¬ë¥¼ ì´ìš©í•˜ëŠ” ê²Œ ë” í¸í–ˆë˜ ì ì´ ìˆëŠ”ë°ìš”. ë°”ë¡œ ë©”ì†Œë“œê°€ ì—¬ëŸ¬ ê°œ ì¡´ì¬í•˜ëŠ” íƒ€ì…ì„ ëª¨í‚¹í•  ë•Œ ì…ë‹ˆë‹¤. Golangì´ ì§€í–¥í•˜ëŠ” ë°©í–¥ ìì²´ê°€ interfaceëŠ” ë§ì€ ë©”ì†Œë“œë¥¼ ê°–ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒì´ê¸´ í•˜ì§€ë§Œ ë­.. ê²½ìš°ì— ë”°ë¼ ë©”ì†Œë“œê°€ ë§ì•„ì§ˆ ìˆ˜ë„ ìˆì£  ã…ã…. interfaceë¥¼ ëª¨í‚¹í•˜ê¸° ìœ„í•´ ë³„ë¡œ í…ŒìŠ¤íŠ¸ ì‹œì— í•„ìš”ë„ ì—†ëŠ” ë©”ì†Œë“œë“¤ì„ êµ¬í˜„í•˜ëŠ” ê²ƒì€ ê½¤ë‚˜ ê·€ì°®ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ mocking í”„ë ˆì„ì›Œí¬ë“¤ì„ ì´ìš©í•˜ë©´ ê¸°ë³¸ì ìœ¼ë¡œ ëª¨í‚¹í•˜ë ¤ëŠ” interfaceë“¤ì˜ ë©”ì†Œë“œë“¤ì€ ëª¨ë‘ êµ¬í˜„ë˜ê³ , ìš°ë¦¬ëŠ” í•„ìš”í•œ ê²½ìš°ì—ë§Œ ì¶”ê°€ì ìœ¼ë¡œ êµ¬í˜„ì„ í•´ë‚˜ê°€ëŠ” í˜•íƒœì´ë¯€ë¡œ ëª¨í‚¹ í”„ë ˆì„ì›Œí¬ë¥¼ ì´ìš©í•˜ëŠ” ê²ƒì´ í¸ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\në°˜ë©´ mocking í”„ë ˆì„ì›Œí¬ë¥¼ ì´ìš©í•  ë•Œì˜ ë‹¨ì ì€ í”„ë ˆì„ì›Œí¬ ì‚¬ìš©ë²•ì„ ìµí˜€ì•¼í•œë‹¤ëŠ” ê²ƒì´ë‚˜ ë‚´ê°€ ì§ì ‘ ì‘ì„±í•˜ì§€ ì•Šì€ ì½”ë“œê°€ ë§ì´ ìƒì„±ëœë‹¤ëŠ” ì ì´ ë˜ê² ë„¤ìš”. ê·¸ëŸ¼ ì´ì œ gomockê³¼ testify/mockì„ ë¹„êµí•´ë³´ê² ìŠµë‹ˆë‹¤. \u0026ldquo;GoMock vs. Testify: Mocking frameworks for Go\u0026rdquo; - codecentric blogì—ë„ ë‚´ìš©ì´ ì˜ ì •ë¦¬ë˜ì–´ìˆìœ¼ë‹ˆ ì°¸ê³ í•´ë³´ì„¸ìš”.\nGolang mocking í”„ë ˆì„ì›Œí¬ gomock vs testify/mock ë¹„êµ star-comparison.png golangì—ì„œ ì§ì ‘ ì œì‘í•˜ëŠ” gomockê³¼ stretchr/testifyë¼ëŠ” ìœ ëª…í•œ í…ŒìŠ¤íŠ¸ ê´€ë ¨ ë ˆí¬ì§€í† ë¦¬ì˜ í•˜ìœ„ íŒ¨í‚¤ì§€ì¸ testify/mock ì€ Golangì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê°€ì¥ ìœ ëª…í•œ ëª¨í‚¹ í”„ë ˆì„ì›Œí¬ë“¤ì…ë‹ˆë‹¤. ê¹ƒí—™ ìŠ¤íƒ€ë§Œ ë†“ê³  ë´¤ì„ ë•Œì—ëŠ” testifyê°€ í›¨ì”¬ ë§ì§€ë§Œ testifyëŠ” ë‹¤ë¥¸ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ íŒ¨í‚¤ì§€ë“¤ë„ í•¨ê»˜ ìˆì–´ì„œ ì •í™•íˆ ë¹„êµëŠ” ì•ˆë˜ê² ë„¤ìš”.\nì €ë„ ë‘ í”„ë ˆì„ì›Œí¬ì˜ íŠ¹ì§•ì— ëŒ€í•´ ì •í™•íˆëŠ” ëª¨ë¥´ì§€ë§Œ ê°„ë‹¨íˆ ì•„ëŠ” ì„ ì—ì„œ ì£¼ê´€ì ì¸ ì¶”ì²œì„ í•˜ìë©´ gomockì„ ì¶”ì²œë“œë¦¬ê² ìŠµë‹ˆë‹¤. testify/mockì— ë¹„í•´ ì›ë³¸ interface íƒ€ì…ì„ ë°”íƒ•ìœ¼ë¡œ ëª¨í‚¹ ë©”ì†Œë“œë¥¼ ì¢€ ë” safeí•˜ê²Œ ì •ì˜í•  ìˆ˜ ìˆì—ˆë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ë‹¤ë§Œ ì •ë§ ë­˜ ì“°ë“  ìƒê´€ ì—†ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ê°ì ì¡°ê¸ˆì˜ ì¥ë‹¨ì ì€ ìˆì§€ë§Œ ë­ í•˜ë‚˜ê°€ íŠ¹ì¶œë‚˜ê±°ë‚˜ ëª¨ìë€ ëŠë‚Œì€ ì•„ë‹™ë‹ˆë‹¤. ë‘ í”„ë ˆì„ì›Œí¬ì˜ íŠ¹ì§•ì„ ì•„ë˜ì™€ ê°™ì´ ì •ë¦¬í•´ë´¤ìŠµë‹ˆë‹¤. (ì°¸ê³ ë¡œ ì•Œì•„ë³´ë‹ˆ ì œê°€ ì¢‹ì•„í•˜ëŠ” ì„œë¹„ìŠ¤ì¸ ArgoCD (K8sì˜ GitOps ë°©ì‹ì˜ ë°°í¬ ë„êµ¬)ì—ì„œëŠ” testify/mockì„ ì´ìš©í•˜ë”êµ°ìš”\u0026hellip; T.T)\nì½”ë“œ ìƒì„± ë„êµ¬ë¥¼ ì´ìš©í•´ ì›í•˜ëŠ” interfaceì˜ mock typeì„ ì •ì˜, êµ¬í˜„í•˜ëŠ” ì½”ë“œë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì´ testify/mockì´ ì¢€ ë” í¸í•¨.\ntestify/mock ì´ ì¢€ ë” ë©”ì†Œë“œë¥¼ mockingí•˜ê³  expectationì„ ì„¤ì •í•˜ëŠ” ê²Œ ì§ê´€ì ì´ê³  ê°„ê²°í•˜ë‹¤. ì´ ë¶€ë¶„ì´ testify/mockì˜ í° ì¥ì ì¸ë“¯ í•¨.\ntestify/mock ì˜ ì½”ë“œ ìƒì„± ë„êµ¬ì¸ mockeryê°€ gomockì˜ ì½”ë“œ ìƒì„± ë„êµ¬ì¸ mockgenë³´ë‹¤ ì“°ê¸° í¸í•˜ë‹¤ëŠ” ì˜ê²¬ì´ ìˆìŒ. (ë³¸ì¸ì€ ì˜ ì²´ê° ëª»í•˜ê² ìŒ)\ngomockì´ ì¢€ ë” type safeí•˜ê²Œ ëª¨í‚¹ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤. ì¼ë‹¨ ë©”ì†Œë“œê°€ gomockì€ íƒ€ì…ì„ ê¸°ë°˜ìœ¼ë¡œ ìë™ì™„ì„± ë˜ì§€ë§Œ testify/mockì€ ë©”ì†Œë“œ ëª…ì„ ë¬¸ìì—´ë¡œ ë°›ìŒ. ì´ ë¶€ë¶„ì´ gomockì˜ í° ì¥ì ì¸ë“¯ í•¨.\në‘ í”„ë ˆì„ì›Œí¬ ëª¨ë‘ unexpected callì´ë‚˜ missing call, íŠ¹ì • íšŸìˆ˜ ë§Œí¼ call ë“±ë“±ì˜ ê¸°ëŠ¥ë“¤ì€ ì œê³µí•˜ëŠ” ê²ƒ ê°™ìŒ. ë‹¨ ì¡°ì‚¬í•œ ë°”ë¡œëŠ” testify/mockì€ ëª¨í‚¹ ë©”ì†Œë“œ êµ¬í˜„ ì‹œì— ì¸ì ê°’ì„ ì´ìš©í•  ìˆ˜ ì—†ìŒ.\nê·¸ëŸ¼ ë§ë¡œë§Œ ì„¤ëª…í•˜ì§€ ë§ê³  ì½”ë“œë¡œ í•œ ë²ˆ ê°„ë‹¨í•˜ê²Œ ë¹„êµë“œë¦¬ê² ìŠµë‹ˆë‹¤!\n1. ì§ì ‘ mock íƒ€ì… ì‘ì„± type ManualMockUserRepository struct{} func (m *ManualMockUserRepository) Create(input *UserCreateInput) (*ent.User, error) { log.Info(\u0026#34;ì§ì ‘ Mocking. Args: \u0026#34;, input) return \u0026amp;ent.User{}, nil } func TestUserService_CreateWithManualMock(t *testing.T){ s := NewUserService(new(ManualMockUserRepository)) _, err := s.Create(\u0026amp;UserCreateInput{ID: \u0026#34;jinsu_umi\u0026#34;, Name: \u0026#34;Jinsu Park\u0026#34;, Password: \u0026#34;123123123\u0026#34;}) // ì´ëŸ° ì‹ìœ¼ë¡œ ë¡œê·¸ë¥¼ í†µí•´ í•˜ë‚˜ í•˜ë‚˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ í™•ì¸í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ //t.Log(\u0026#34;ì—ëŸ¬ê°€ ì¡´ì¬í•˜ì§€ ì•Šì•„ì•¼í•©ë‹ˆë‹¤.\u0026#34;) //t.Log(\u0026#34;err == nil ì¸ì§€ í™•ì¸í•˜ì‹­ì‹œì˜¤. err == nil: \u0026#34; , err == nil) // assertë¥¼ ì´ìš©í•´ ìë™ìœ¼ë¡œ ì„±ê³µ/ì‹¤íŒ¨ë¥¼ íŒë‹¨í•˜ì‹­ì‹œì˜¤. assert.NoError(t, err) } ì•ì„œ ë§ì”€ë“œë¦° ëŒ€ë¡œ ì§ì ‘ mock typeì„ ì‘ì„±í•˜ëŠ” ê²½ìš°ì…ë‹ˆë‹¤. ì •ë§ ì •ë§ safeí•˜ì§€ë§Œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë§ˆë‹¤ ë©”ì†Œë“œê°€ returní•˜ëŠ” ê°’ì´ë‚˜ ë™ì‘ì„ ë‹¤ë¥´ê²Œ í•˜ê³  ì‹¶ë‹¤ë©´ ì½”ë“œê°€ ë³µì¡í•´ì§€ê±°ë‚˜ í•œ interfaceì— ëŒ€í•œ ë‹¤ì–‘í•œ mock typeì„ ì—¬ëŸ¬ ê°œ ì‘ì„±í•´ì•¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n2. testify/mock ì´ìš© testify/mockì„ ì´ìš©í•˜ëŠ” ê²½ìš° mockeryë¼ê³  í•˜ëŠ” ì½”ë“œ ìƒì„± CLI ë„êµ¬ë¥¼ ì´ìš©í•˜ë©´ í¸ë¦¬í•©ë‹ˆë‹¤. ë³¸ ì½”ë“œëŠ” mockeryë¥¼ í†µí•´ ìƒì„±ëœ mock íƒ€ì…ì„ ì´ìš©í–ˆìŠµë‹ˆë‹¤.\nfunc TestUserService_CreateWithMockery(t *testing.T){ mockUserRepository := \u0026amp;MockUserRepository{} // methodë¥¼ ë¬¸ìì—´ ìì²´ë¡œ ì„¤ì •í•´ì•¼í•´ì„œ safeí•˜ì§€ ì•ŠìŒ. mockUserRepository.On(\u0026#34;Create\u0026#34;, mock.Anything).Run(func(args mock.Arguments) { t.Log(\u0026#34;testify/mockê³¼ mockeryë¥¼ ì´ìš©í•œ Mocking. Args: \u0026#34;, args.Get(0)) }).Return(\u0026amp;ent.User{}, nil) // í•´ë‹¹ ì´ë¦„ì˜ ìœ ì €ê°€ ìˆëŠ”ì§€ í™•ì¸ s := NewUserService(mockUserRepository) _, err := s.Create(\u0026amp;UserCreateInput{ID: \u0026#34;jinsu_umi\u0026#34;, Name: \u0026#34;Jinsu Park\u0026#34;, Password: \u0026#34;123123123\u0026#34;}) assert.NoError(t, err) } ì•ì„œ ë§ì”€ë“œë¦° ëŒ€ë¡œ ë©”ì†Œë“œ ëª…ì´ unsafeí•˜ê²Œ .On(methodName string, ...)ì˜ í˜•íƒœë¡œ ë¬¸ìì—´ì„ ì´ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤. argument ë˜í•œ ë‹¨ìˆœíˆ mock.Argumentsë¥¼ í†µí•´ ì–»ì„ ìˆ˜ ìˆê³  ì´ì— ëŒ€í•´ .Getì„ í†µí•´ ì–»ëŠ” ê°’ì€ interface{}ì´ê¸° ë•Œë¬¸ì— type assertionì„ ê±°ì³ì•¼ë§Œ ë‚´ë¶€ ê°’ì„ ë³µì‚¬í•´ì„œ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n3. gomock ì´ìš© gomockì€ mockgen(ì°¸ê³ : https://github.com/golang/mock)ì´ë¼ëŠ” ì½”ë“œ ìƒì„± CLI ë„êµ¬ë¥¼ ì´ìš©í•©ë‹ˆë‹¤. ë³¸ ì½”ë“œëŠ” mockgenì„ í†µí•´ ìƒì„±ëœ mock íƒ€ì…ì„ ì´ìš©í–ˆìŠµë‹ˆë‹¤.\nfunc TestUserService_CreateWithMockgen(t *testing.T){ // gomock controllerì„ ë§Œë“¤ê³  Finish ì‹œì¼œì£¼ëŠ” ë“±ì˜ ë¶ˆí¸í•¨ ì¡´ì¬. ctrl := gomock.NewController(t) defer ctrl.Finish() mockUserRepository := NewGomockRepository(ctrl) // ì›ë˜ì˜ typeì„ ê¸°ë°˜ìœ¼ë¡œ methodê°€ safeí•˜ê²Œ ì œê³µë¨. mockUserRepository.EXPECT().Create(gomock.Any()).DoAndReturn( func(input *UserCreateInput) (*ent.User, error) { t.Log(\u0026#34;Gomockì„ ì´ìš©í•œ Mocking. Args: \u0026#34;, input) return \u0026amp;ent.User{}, nil }) // í•´ë‹¹ ì´ë¦„ì˜ ìœ ì €ê°€ ìˆëŠ”ì§€ í™•ì¸ s := NewUserService(mockUserRepository) _, err := s.Create(\u0026amp;UserCreateInput{ID: \u0026#34;jinsu_umi\u0026#34;, Name: \u0026#34;Jinsu Park\u0026#34;, Password: \u0026#34;123123123\u0026#34;}) assert.NoError(t, err) } gomock controllerë¼ëŠ” ë…€ì„ì„ ìƒì„±í•´ì£¼ê³  finish ì‹œì¼œì¤˜ì•¼í•˜ëŠ” ë¶ˆí¸í•¨ì´ ìƒê²¨ë‚¬ìŠµë‹ˆë‹¤ë§Œ ëª¨í‚¹í•˜ê³ ì í•˜ëŠ” ë©”ì†Œë“œë¥¼ safeí•˜ê²Œ ì œê³µë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. .DoAndReturun() ë©”ì†Œë“œì˜ ì¸ìë¡œì„œ ì–´ë–¤ í•¨ìˆ˜ë¡œ ëª¨í‚¹í•  ì§€ë¥¼ ì „ë‹¬í•˜ëŠ”ë° ì‚¬ì‹¤ ì´ í•¨ìˆ˜ ìì²´ë¥¼ interface{}ê°€ ë°›ê¸° ë•Œë¬¸ì— ì¸ìëŠ” ì œê°€ ì •ì˜í•˜ê¸° ë‚˜ë¦„ì´ë¼ ì›ë³¸ interfaceì™€ ì‹±í¬ë˜ì§€ëŠ” ì•ŠëŠ” ì•½ê°„ì˜ ì•„ì‰¬ì›€ì´ ì¡´ì¬í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ testify/mockì²˜ëŸ¼ argsì˜ ìˆœì„œì— ë”°ë¼ .Get()ì„ í•œ ë’¤ interface{} íƒ€ì…ì˜ ê°ê°ì˜ ì¸ìë“¤ì„ type assertioní•  í•„ìš”ë„ ì—†ê³  ê°€ë…ì„±ì´ ë” ì¢‹ë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.\ní…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±í•´ë³´ê¸° *_test.go í˜•íƒœì˜ íŒŒì¼ ìƒì„±í•˜ê¸° func Test* (t *testing.T){...} í˜•íƒœì˜ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‘ì„±í•˜ê¸° ë¡œê·¸ë‚˜ Printë¬¸ì´ ì•„ë‹Œ assert ë¬¸ì„ ì´ìš©í•´ í…ŒìŠ¤íŠ¸ ì„±ê³µ/ì‹¤íŒ¨ íŒë‹¨ì„ ìë™í™”í•˜ê¸° Golangì—ì„œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ í•˜ê¸° ìœ„í•´ì„  ìš°ì„  ìœ„ì˜ 3ê°€ì§€ ì‚¬í•­ë§Œ ì•Œì•„ë‘ë©´ ë©ë‹ˆë‹¤.\nê·¸ë¦¬ê³  ì¶”ê°€ì ìœ¼ë¡œ golangì—ì„  í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì†ì— nestedëœ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ì–¼ë§ˆë“ ì§€ ì§‘ì–´ë„£ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë„ˆë¬´ë„ˆë¬´ í¸ë¦¬í•˜ì£ ~! ê·¸ëŸ¼ ì´ë²ˆì—ë„ ì½”ë“œë¡œ ì˜ˆì‹œë¥¼ ë³´ì—¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤. Userì— ëŒ€í•œ Domain/Business layerì—ì„œì˜ ë„ë©”ì¸ ë£°ì„ í…ŒìŠ¤íŠ¸í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤. Data access ê³„ì¸µì„ í†µí•´ Userê°€ ì˜ì†ì ìœ¼ë¡œ ì˜ ì €ì¥ë˜ì—ˆëŠ”ì§€ë³´ë‹¤ëŠ” ë„ë©”ì¸ ë£°ì„ í…ŒìŠ¤íŠ¸í•˜ë ¤ëŠ” ëª©ì ì´ê¸° ë•Œë¬¸ì— Data access ê³„ì¸µ(Repository)ì— ëŒ€í•´ì„œëŠ” ëª¨í‚¹ì„ ì ìš©í–ˆìŠµë‹ˆë‹¤.\n// nested test caseë¥¼ ì‘ì„±í•˜ê³  ì‹¶ì€ ê²½ìš°. ì´ë ‡ê²Œ ì‘ì„±í•˜ì‹­ì‹œì˜¤. func TestA(t *testing.T){ t.Run(\u0026#34;A-a\u0026#34;, func(t *testing.T){ t.Run(\u0026#34;A-a-1\u0026#34;, func(t *testing.T){ ... }) }) } // service_test.go ì˜ˆì‹œ func TestUserService_ìœ ì €_ìƒì„±(t *testing.T){ // repository mocking ctrl := gomock.NewController(t) defer ctrl.Finish() mockUserRepository := NewGomockRepository(ctrl) // ì›ë˜ì˜ typeì„ ê¸°ë°˜ìœ¼ë¡œ methodê°€ safeí•˜ê²Œ ì œê³µë¨. mockUserRepository.EXPECT().Create(gomock.Any()).DoAndReturn( func(input *UserCreateInput) (*ent.User, error) { t.Log(\u0026#34;Gomockì„ ì´ìš©í•œ Mocking. Args: \u0026#34;, input) return \u0026amp;ent.User{}, nil }) // í•´ë‹¹ ì´ë¦„ì˜ ìœ ì €ê°€ ìˆëŠ”ì§€ í™•ì¸ s := NewUserService(mockUserRepository) t.Run(\u0026#34;ì„±ê³µ\u0026#34;, func(t *testing.T) { _, err := s.Create(\u0026amp;UserCreateInput{ID: \u0026#34;jinsu_umi\u0026#34;, Name: \u0026#34;Jinsu Park\u0026#34;, Password: \u0026#34;123123123\u0026#34;}) assert.NoError(t, err) }) t.Run(\u0026#34;ì—ëŸ¬) ë„ˆë¬´ ì§§ì€ ì•„ì´ë””\u0026#34;, func(t *testing.T) { _, err := s.Create(\u0026amp;UserCreateInput{ID: \u0026#34;short\u0026#34;, Name: \u0026#34;Jinsu Park\u0026#34;, Password: \u0026#34;123123123\u0026#34;}) assert.ErrorIs(t, err, ErrInvalidUserID) assert.ErrorIs(t, err, ErrInvalidValue) }) t.Run(\u0026#34;ì—ëŸ¬) ë„ˆë¬´ ê¸´ ì´ë¦„\u0026#34;, func(t *testing.T) { _, err := s.Create(\u0026amp;UserCreateInput{ID: \u0026#34;jinsu_umi\u0026#34;, Name: \u0026#34;ë‹ˆë…¸ë§‰ì‹œë¬´ìŠ¤ ì¹´ì´ì € ì˜ì œ ì˜ëƒë„ë¥´ì•¤ ìŠ¤íŒŒë¥´íƒ€ ì£½ì§€ ì•Šì•„ ë‚˜ëŠ” ì£½ì§€ì•Šì•„ ì˜¤ì˜¤ì˜¤ì˜¤ ë‚˜ëŠ” ì¹´ì´ì € ì˜ì œ\u0026#34;, Password: \u0026#34;123123123\u0026#34;}) assert.ErrorIs(t, err, ErrInvalidUserName) assert.ErrorIs(t, err, ErrInvalidValue) }) t.Run(\u0026#34;ì—ëŸ¬) ë„ˆë¬´ ì§§ì€ ë¹„ë°€ë²ˆí˜¸ë“¤\u0026#34;, func(t *testing.T) { errorPasswords := []string{ \u0026#34;123\u0026#34;, \u0026#34;abc\u0026#34;, \u0026#34;a1b2\u0026#34;, \u0026#34;asd\u0026#34;, } for _, errorPassword := range errorPasswords { t.Run(\u0026#34;í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤) \u0026#34; + errorPassword, func(t *testing.T) { _, err := s.Create(\u0026amp;UserCreateInput{ID: \u0026#34;jinsu_umi\u0026#34;, Name: \u0026#34;Jinsu Park\u0026#34;, Password: errorPassword}) assert.ErrorIs(t, err, ErrInvalidPassword) assert.ErrorIs(t, err, ErrInvalidValue) }) } }) } TestUserService_ìœ ì €_ìƒì„± ì´ë¼ëŠ” í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì•ˆì— ì„±ê³µí•˜ëŠ” ê²½ìš°ì™€ ì˜¬ë°”ë¥´ì§€ ì•Šì€ IDë‚˜ ì´ë¦„, ë¹„ë°€ë²ˆí˜¸ë¡œ ì¸í•´ ì—ëŸ¬ê°€ ë°œìƒí•´ì•¼í•˜ëŠ” ê²½ìš°ë¥¼ nestedëœ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¡œ ì‘ì„±í–ˆìŠµë‹ˆë‹¤. íŠ¹íˆë‚˜ ë¹„ë°€ë²ˆí˜¸ëŠ” í•œ ë²ˆ ë” nestedëœ ì¼€ì´ìŠ¤ë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤. ê°™ì€ ë¡œì§ì„ ë‹¤ì–‘í•œ ì¸í’‹ì„ ì´ìš©í•´ í…ŒìŠ¤íŠ¸ í•˜ê³  ì‹¶ì€ ê²½ìš°ì—ëŠ” errorPasswords ë¶€ë¶„ì²˜ëŸ¼ ì¸í’‹ í˜¹ì€ ê²°ê³¼ê°’ì„ ë°°ì—´ë¡œ ì„ ì–¸í•œ ë’¤ í…ŒìŠ¤íŠ¸ í•˜ëŠ” ê²½ìš°ë¥¼ ì¢…ì¢… ë³´ê²Œë˜ë”êµ°ìš”. (ì°¸ê³ : \u0026ldquo;Using Subtests and Sub-benchmarks\u0026rdquo; - Go Blog, \u0026ldquo;Uber Go style guide\u0026ldquo;ì˜ test-tables íŒŒíŠ¸ - uber)\ntest-with-ide.png run-each-test.png ê²Œë‹¤ê°€ GoLandë¥¼ ë¹„ë¡¯í•´ Goì–¸ì–´ë¥¼ ì§€ì›í•˜ëŠ” IDEë¥¼ ì´ìš© ì¤‘ì´ì‹œë¼ë©´ ë†’ì€ í™•ë¥ ë¡œ ì´ë ‡ê²Œ í¸ë¦¬í•˜ê²Œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ê³  ê²°ê³¼ë¥¼ í™•ì¸í•˜ì‹¤ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ë‘ ë²ˆì§¸ ì‚¬ì§„ì— ë³´ì´ë“¯ ë‚´ë¶€ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ì— ëŒ€í•œ ë‹¨ì¼ ì‹¤í–‰ë„ ê°€ëŠ¥í•˜ë‹¤ëŠ” ì ~! ì´ì œ ì¢€ ë” í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‰½ê²Œ ì´ìš©í•  ìˆ˜ ìˆê² êµ°ìš”. ã…ã…\në§ˆì¹˜ë©° ì´ë²ˆ í¸ì„ ì¤€ë¹„í•˜ë©´ì„œ ì²˜ìŒ ìœ ë‹› í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•  ë•Œ ì°¾ì•„ë´¤ë˜ ìë£Œë“¤ë„ ë‹¤ì‹œ í•œ ë²ˆ ì½ì–´ë³´ê³  etcdë‚˜ argocd ê°™ì€ Goë¡œ ì‘ì„±ëœ ìœ ëª… ì˜¤í”ˆ ì†ŒìŠ¤ë“¤ì€ ì–´ë–»ê²Œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ”ì§€ë„ ì°¾ì•„ë³´ëŠ” ë“± ê½¤ ì¡°ì‚¬ë¥¼ ë§ì´ í•˜ê²Œëœ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì•„ë¬´ë˜ë„ í…ŒìŠ¤íŠ¸ ì½”ë“œë¼ëŠ” ê²ƒì´ ì–´ë– í•œ ë°©í–¥ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ì½”ë“œì™€ ê°œë°œì„ ì„¤ê³„í•´ë‚˜ê°ˆì§€, ì–´ë””ê¹Œì§€ í…ŒìŠ¤íŠ¸í•  ì§€ì™€ ê°™ì€ ë°©ë²•ë¡ ì ì¸ ë¶€ë¶„ê³¼ í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ ìì²´ì˜ ì‚¬ìš©ë²•, ëª¨í‚¹ í”„ë ˆì„ì›Œí¬ ì‚¬ìš©ë²•ê³¼ ê°™ì€ ì•½ê°„ì€ Golang íŠ¹í™”ì ì¸ ë‚´ìš© ë“±ë“± ë‹¤ì–‘í•œ ì˜ì—­ì— ê±¸ì¹œ ë‚´ìš©ì´ë¼ ì‰½ì§„ ì•Šì€ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ê·¸ë˜ë„ ì´ë²ˆì„ ê¸°íšŒ ì‚¼ì•„ ì €ë„ í‰ì†Œì— ê¶ê¸ˆí–ˆë˜ mockery vs testify/mock ì˜ ë¹„êµë„ í•´ë³¼ ìˆ˜ ìˆì—ˆë˜ ê²ƒ ê°™ê³ , mockingì„ ì ìš©í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì¢€ ë” ìì„¸íˆ ì•Œì•„ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤! ê°ì‚¬í•©ë‹ˆë‹¤~!\nì˜ˆì‹œ ì½”ë“œ: https://github.com/umi0410/how-to-backend-in-go/tree/master/testcode\nì°¸ê³  ìë£Œ What\u0026rsquo;s the difference between a mock \u0026amp; stub? - https://stackoverflow.com/questions/3459287/whats-the-difference-between-a-mock-stub gomock vs testify - https://blog.codecentric.de/2019/07/gomock-vs-testify/ mockery Github Repository - https://github.com/vektra/mockery stretchr/testify Github Repository - https://github.com/stretchr/testify gomock Github Repository - https://github.com/golang/mock Using Subtests and Sub-benchmarks - https://blog.golang.org/subtests uber-go Guide - https://github.com/uber-go/guide/blob/master/style.md ","date":"2021-07-17T12:46:54+09:00","image":"https://umi0410.github.io/blog/golang/how-to-backend-in-go-testcode/test-with-ide_hu7b61495424919d2e1c8d663236a41b57_159980_120x120_fill_box_smart1_3.png","permalink":"https://umi0410.github.io/blog/golang/how-to-backend-in-go-testcode/","title":"Golangìœ¼ë¡œ ë°±ì—”ë“œ ê°œë°œí•˜ê¸° - 2. í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„± ë° Goì—ì„œ Mocking ì´ìš©í•˜ê¸° (gomock, testify ì´ìš©)"},{"content":"ì‹œì‘í•˜ë©° Go ì–¸ì–´ë¥¼ ì²˜ìŒ ì‹œì‘í•œ ì§€ ë²Œì¨ 1ë…„ì´ ì§€ë‚¬ë‹¤ë‹ˆ ì‹œê°„ì´ ì°¸ ë¹ ë¥¸ ê²ƒ ê°™ìŠµë‹ˆë‹¤! JavaëŠ” Springì´ë¼ê³ í•˜ëŠ” ê±°ëŒ€í•œ í”„ë ˆì„ì›Œí¬ê°€ ìë¦¬ ì¡ê³  ìˆì–´ ë”±íˆ ì–´ë–¤ í”„ë ˆì„ì›Œí¬ë‚˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í• ì§€ì— ëŒ€í•œ ê³ ë¯¼ì´ ë³„ë¡œ í•„ìš” ì—†ì—ˆë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ë°˜ë©´ Go ì–¸ì–´ëŠ” ì •í˜•í™”ëœ ì•„í‚¤í…ì³ì— ëŒ€í•œ ë‚´ìš©ì´ ë³„ë¡œ ì—†ê³  í”„ë ˆì„ì›Œí¬ë‚˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ëŒ€ì„¸ë„ ì°¸ ë¹ ë¥´ê²Œ ë³€í•˜ë‹¤ë³´ë‹ˆ ê·¸ê²Œ ì¥ì ì´ë¼ë©´ ì¥ì ì´ê² ì§€ë§Œ ì´ë˜ì €ë˜ ê³ ìƒë„ í–ˆë„¤ìš”.\nê²Œë‹¤ê°€ Go ì–¸ì–´ëŠ” ê°œë°œ ì…ë¬¸ìë“¤ì´ ë§ì´ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì–¸ì–´ë¼ ê·¸ëŸ°ì§€ ì•„ì§ ì›¹ ë°±ì—”ë“œ ê°œë°œì— ìµìˆ™í•˜ì§€ ì•Šì€ (ì €ì²˜ëŸ¼) ì‚¬ëŒë“¤ì„ ìœ„í•œ ìë£Œë“¤ì€ ë§ì´ ì—†ì—ˆë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ë©´ Javaì˜ ìŠ¤í”„ë§ì´ë‚˜ Node.jsì˜ express, Pythonì˜ django ê°™ì€ í”„ë ˆì„ì›Œí¬ë“¤ì€ ì¸í”„ëŸ°ë§Œ ê°€ë´ë„ A to Zë¡œ ì•Œë ¤ì£¼ëŠ” ê°•ì˜ê°€ ë§ì£ . í•˜ì§€ë§Œ Go ì–¸ì–´ëŠ” ë³´í†µ ì–¸ì–´ ì…ë¬¸ ë‚´ìš©ë“¤ì´ ë§ê³ , \u0026ldquo;ì~! ì—¬ëŸ¬ë¶„ë“¤ì€ ì–´ì°¨í”¼ ê°œë°œ ì´ˆë³´ìë“¤ì´ ì•„ë‹ˆì‹œì–ì•„ìš”? ì´ì¯¤í•˜ë©´ Golangì„ ë§›ë³´ì…¨ìœ¼ë‹ˆ ì•Œì•„ì„œë“¤ ì…ë§›ëŒ€ë¡œ ì“°ì‹­ì‹œì˜¤~!\u0026quot; ì‹ìœ¼ë¡œ ì…ë¬¸ ì´í›„ì˜ ë‚´ìš©ì€ ë³´í†µ ë™ì‹œì„± íŒ¨í„´ì— ëŒ€í•œ ë‚´ìš©ë“¤ì¼ ë¿ ë°±ì—”ë“œ ê°œë°œì„ ìœ„í•œ ì•„í‚¤í…ì³ë‚˜ Unit testë¥¼ ì–´ë–»ê²Œ ì‹¤ì œë¡œ ì ìš©í•˜ëŠ”ì§€ ê°™ì€ ì˜ˆì‹œëŠ” ë§ì´ ì—†ì—ˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ì´ë²ˆì—” Golangìœ¼ë¡œ ì›¹ ë°±ì—”ë“œ ê°œë°œì„ í•˜ëŠ” ê³¼ì •ì— ëŒ€í•´ ì¢€ ì ì–´ë³¼ê¹Œí•©ë‹ˆë‹¤!\nì´ë²ˆ ê¸€ì€ ê·¸ëŸ° ë‚´ìš©ì„ ë‹¤ë£° ì‹œë¦¬ì¦ˆ ì¤‘ ì²« ë²ˆì§¸ë¡œ Golangìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…í•˜ëŠ” ê²ƒê³¼ ê´€ë ¨í•œ ë‚´ìš©ì„ ë‹´ì•„ë´¤ìŠµë‹ˆë‹¤. ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ”ì§€ì— ëŒ€í•œ ì„¸ì„¸í•œ ë‚´ìš©ë³´ë‹¨ ì–´ë–¤ í”„ë ˆì„ì›Œí¬ë¥¼ ì¶”ì²œë“œë¦¬ê³ , ê·¸ í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ëª¨ìŠµì´ ì–´ë– í•œì§€ ê°€ë³ê²Œ ì“°ìœ½ ë³´ì‹œë©´ ì¢‹ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.\n3 layered architectureì— ëŒ€í•´ ê°„ë‹¨íˆ ì§šê³  ë„˜ì–´ê°€ê² ìŠµë‹ˆë‹¤ Presentation layer - ì–´ë–»ê²Œ ë°ì´í„°ê°€ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë³´ì—¬ì¤„ ì§€ì— ëŒ€í•œ ì‘ì—…ì„ ë‹´ë‹¹. í´ë¼ì´ì–¸íŠ¸ëŠ” ì´ ê³„ì¸µì„ í†µí•´ ìƒí˜¸ì‘ìš©í•œë‹¤. Business/Domain layer - Presentation layerì™€ Data access layerì˜ ì‚¬ì´ì— ìœ„ì¹˜í•´ ë¹„ì¦ˆë‹ˆìŠ¤ ë£°ê³¼ ê·¸ ë£°ì„ ë”°ë¥´ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ êµ¬í˜„. ë³´í†µ ì´ ê³„ì¸µì— Serviceë¼ê³  í•˜ëŠ” í´ë˜ìŠ¤(í˜¹ì€ íƒ€ì… ë“±ë“±)ê°€ ìœ„ì¹˜í•œë‹¤. Data Access Layer - DBì— ì ‘ê·¼í•˜ëŠ” ì‘ì—…ì„ ë‹´ë‹¹. DAO(Data Access Object, repository)ê°€ ìœ„ì¹˜í•œë‹¤. ëŒ€ë¶€ë¶„ì˜ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ 3 layered architectureë¼ê³ í•˜ëŠ” êµ¬ì¡°ë¡œ ê¸°ì´ˆë¡œ í•˜ì—¬ ê°œë°œë©ë‹ˆë‹¤. ê·¸ ì†ì—ì„œ ì—¬ëŸ¬ ë‹¨ìˆœ ì‘ì—…ì´ë‚˜ ê°œë³„ì ìœ¼ë¡œ ê°œë°œí•˜ê¸´ ë²ˆê±°ë¡œìš´ ê¸°ëŠ¥ë“¤ì´ ì¡´ì¬í•  ìˆ˜ ìˆëŠ”ë°, ìš°ë¦¬ëŠ” í”„ë ˆì„ì›Œí¬ë‚˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ë“¤ì„ ì˜ë¦¬í•˜ê²Œ ê°€ì ¸ë‹¤ ì”€ìœ¼ë¡œì„œ ì¢€ ë” ìœ ì§€ ë³´ìˆ˜ í•˜ê¸° ì‰¬ìš´ ê°œë°œì„ í•  ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.\nPresentation layer app.Get(\u0026#34;/users/:id\u0026#34;, func(ctx *fiber.Ctx) error { userId := ctx.Params(\u0026#34;id\u0026#34;) // ... ê¸°íƒ€ ì‘ì—… ìƒëµ return ctx.JSON(map[string]string{ \u0026#34;userId\u0026#34;: userId, }) }) presentation-layer-output.png url path variableì€ ì–´ë–»ê²Œ ì¸ì‹í•  ê²ƒì¸ì§€, Golangì˜ mapì„ ì–´ë–»ê²Œ JSONìœ¼ë¡œ ì§ë ¬í™”í•  ì§€ì™€ ê°™ì€ ë¡œì§ë“¤ì´ ëª¨ë‘ í”„ë ˆì„ì›Œí¬ì—ì„œ ì œê³µë¨.\nì €ëŠ” Presentation layerëŠ” ëŒ€ë¶€ë¶„ ì›¹ í”„ë ˆì„ì›Œí¬ ìì²´ë‚˜ í•´ë‹¹ ì›¹ í”„ë ˆì„ì›Œí¬ê°€ ì œê³µí•˜ëŠ” í˜•íƒœë¥¼ ë”°ë¥´ëŠ” í•¸ë“¤ëŸ¬ ë‹¨ì—ì„œ ì œê³µì´ ëœë‹¤ê³  ìƒê°í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ì–´ë–»ê²Œ ì‘ë‹µì„ JSON í˜•íƒœë¡œ ì œê³µí• ì§€ HTML, XML, ì´ì§„ ë°ì´í„°(gRPC)ì™€ ê°™ì€ ë‚´ìš©ë“¤ ë§ì´ì£ . ì¦‰ Presentation layerì—ì„œëŠ” ìš°ë¦¬ê°€ ê·¸ë‹¥ ê°œë°œí•  ê²ƒì´ ë§ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤.\nBusiness layer Domain logicê³¼ Business logicì˜ ì°¨ì´ëŠ” ì–´ëŠ ì •ë„ ì¡´ì¬í•˜ëŠ” ê±¸ë¡œ ì•Œê³  ìˆìŠµë‹ˆë‹¤ë§Œ 3 tierë¡œ ë‚˜ëˆ´ì„ ë•ŒëŠ” ë™ì¼í•œ ê³„ì¸µìœ¼ë¡œ ë³´ê² ìŠµë‹ˆë‹¤.\n// Domain/Business layer ì½”ë“œ ì˜ˆì‹œ - ìš°ë¦¬ ë„ë©”ì¸ íŠ¹ì • ì½”ë“œë“¤ì´ ë§ì•„ ë‚¨(ìš°ë¦¬ íŒ€ í˜¹ì€ ê¸°ì—…ì´ ì•„ë‹Œ ì‚¬ëŒë“¤)ì´ ë§Œë“  ì˜¤í”ˆì†ŒìŠ¤ë¡œ ëŒ€ì²´í•˜ê¸° í˜ë“¦. func (svc *UserService) updateProfileImage(requestUser *User, imageFile Image) (*UserResponse, error){ requestUserê°€ ì¸ì¦ëœ ìœ ì €ì¸ê°€ ì¸ì¦ëœ ìœ ì €ê°€ ì•„ë‹ˆë¼ë©´ ì–´ë–¤ ì—ëŸ¬ë¥¼ ë¦¬í„´í•  ê²ƒì¸ê°€ imageFileì´ ì œëŒ€ë¡œ ëœ Imageì¸ê°€ ì œëŒ€ë¡œ ëœ Imageê°€ ì•„ë‹ˆë¼ë©´ ì–´ë–¤ ì—ëŸ¬ë¥¼ ë¦¬í„´í•  ê²ƒì¸ê°€ imageFileì„ ì—…ë¡œë“œ ì—…ë¡œë“œ ê³¼ì • ì¤‘ ì—ëŸ¬ ë°œìƒ ì‹œ ì–´ë–¤ ì—ëŸ¬ë¥¼ ë¦¬í„´í•  ê²ƒì¸ê°€ ìœ ì €ì˜ ì¹œêµ¬ë“¤ì—ê²Œ ìƒˆë¡œìš´ í”„ë¡œí•„ ì‚¬ì§„ ì—…ë¡œë“œì— ëŒ€í•œ ì•Œë¦¼ ë°œì†¡ ... ë“±ë“± ìƒëµ return ìƒëµ } ë°˜ë©´ Domain/Business layerì—ì„œëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë£°ê³¼ ë¡œì§ì´ë¼ê³  í•˜ëŠ” ìš°ë¦¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ í•µì‹¬ì ì¸ ê¸°ëŠ¥ì— ëŒ€í•œ êµ¬í˜„ì´ë‚˜ ì¡°í•©ì´ ì´ë£¨ì–´ì§€ê²Œ ë˜ëŠ”ë° ì´ ë¶€ë¶„ íƒ€ ì˜¤í”ˆì†ŒìŠ¤ë“¤ë¡œ ëŒ€ì²´ë˜ê¸°ëŠ” í˜ë“  ë¶€ë¶„ì´ ë§ì•„ ë‹¹ì—°íˆ ì§ì ‘ ê°œë°œí•˜ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤. ìœ„ì˜ ì½”ë“œë¥¼ ë³´ë©´ ë‹¤ì–‘í•œ ìš°ë¦¬ ì„œë¹„ìŠ¤ì˜ ë¡œì§ë“¤ì´ êµ¬í˜„ë˜ê±°ë‚˜ ì¡°í•©ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nData access layer jpa-method.png Javaì˜ JPA í”„ë ˆì„ì›Œí¬ì˜ ê²½ìš° ê¸°ë³¸ì ìœ¼ë¡œ CRUD ë©”ì†Œë“œë¥¼ ì œê³µí•´ì¤€ë‹¤.\ndjango-method.png Pythonì˜ djangoì˜ ê²½ìš° Join ê¸°ëŠ¥ë„ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•´ì¤€ë‹¤.\nì´ì œ Data Access Layerë§Œì´ ë‚¨ì•˜ë„¤ìš”. ì´ ê³„ì¸µ ë˜í•œ ëŒ€ë¶€ë¶„ì˜ ê°ì²´ì§€í–¥ ì–¸ì–´ë“¤ì—ì„  ORMì´ë¼ëŠ” ê°œë…ì„ í†µí•´ ëŒ€ë¶€ë¶„ì˜ í”„ë ˆì„ì›Œí¬ë“¤ì´ ë§ì€ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ê·¸ë˜ì„œ í•„ìš”í•œ ê²½ìš°ì—ë§Œ ì¶”ê°€ì ìœ¼ë¡œ ì •ì˜í•˜ëŠ” í˜•íƒœë¡œ í¸ë¦¬í•˜ê²Œ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nê·¸ë ‡ë‹¤ë©´ Goì—ì„œëŠ” ì–´ë–»ê²Œ Data access layerë¥¼ í¸í•˜ê²Œ ì´ìš©í•  ìˆ˜ ìˆì„ê¹Œìš”? ì´ë²ˆ ê¸€ì—ì„œëŠ” Golangì€ ì´ Data Access Layer(Repository)ì—ì„œ ì–´ë–¤ DB frameworkì„ ì‚¬ìš©í•˜ë©´ ì¢‹ì„ì§€ ì–´ë–¤ ì‹ìœ¼ë¡œ ì‚¬ìš©í•´ë‚˜ê°ˆ ìˆ˜ ìˆì„ì§€ì— ëŒ€í•´ ë‹¤ë¤„ë³´ë ¤ í•©ë‹ˆë‹¤.\nGolangì˜ ì¢‹ì€ DB framework ì¢€ ì¶”ì²œí•´ì£¼ì„¸ìš”. ent-gorm-stars.png ì°¨íŠ¸ ì¶œì²˜: https://star-history.t9t.io/\nGolangì—ëŠ” Djangoë‚˜ JPAì™€ ê°™ì€ ê°•ë ¥í•œ ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ í”„ë ˆì„ì›Œí¬ê°€ ëª‡ ë…„ ì „ê¹Œì§€ ì¡´ì¬í•˜ì§€ ì•Šì•˜ë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ìƒ ì¿¼ë¦¬ë¬¸ì„ ì§ì ‘ ì§¤ ê²Œ ì•„ë‹Œ ê²½ìš°ë¼ë©´ ì–¼ë§ˆ ì „ê¹Œì§€ëŠ” gorm ì´ë¼ê³ í•˜ëŠ” í”„ë ˆì„ì›Œí¬ê°€ ê±°ì˜ ìœ ì¼í•œ ì„ íƒì§€ì˜€ë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ìš”ì¦˜ ì¶”ì„¸ë¥¼ ë³´ë©´ ë¬´ì„­ê²Œ entë¼ëŠ” íŒ¨í‚¤ì§€ê°€ ì«“ì•„ì˜¤ê³  ìˆëŠ” ëª¨ìŠµì„ ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nğŸ‘ gorm í”„ë ˆì„ì›Œí¬ ì‚¬ìš© í›„ê¸° ì œê°€ golang ê°œë°œì„ ë§‰ ì‹œì‘í–ˆë˜ ë•Œê°€ 2020ë…„ ì—¬ë¦„ì¯¤ì´ì—ˆê¸°ì— ì €ë„ gormì„ ì²« ë°ì´í„°ë² ì´ìŠ¤ í”„ë ˆì„ì›Œí¬ë¡œ ì‚¬ìš©í–ˆì—ˆì§€ë§Œ ëª‡ ê°€ì§€ ë‹¨ì ë“¤ì´ ì¡´ì¬í–ˆìŠµë‹ˆë‹¤.\në¬¸ì„œì˜ ë‚´ìš©ì´ ë¹ˆì•½í–ˆê³ , ì—ëŸ¬ì— ëŒ€í•œ ì„¤ëª…ì´ë‚˜ ë””ë²„ê¹…ì´ ì‰½ì§€ ì•Šì•˜ë‹¤.\në¬¸ì„œì˜ ë‚´ìš©ë“¤ì´ ì‹¤ì§ˆì ì¸ ë‹¤ì–‘í•œ ì¼€ì´ìŠ¤ì— ëŒ€í•œ ì˜ˆì‹œë‚˜ ì„¤ëª…ì´ ë¶€ì¡±í–ˆë‹¤ê³  ëŠê»´ì¡ŒìŠµë‹ˆë‹¤. ë˜í•œ ì—ëŸ¬ê°€ ë°œìƒí•œ ê²½ìš° ì™œ ì—ëŸ¬ê°€ ë°œìƒí•œ ê²ƒì¸ì§€ ì •í™•í•œ ìœ„ì¹˜ë‚˜ ì´ìœ ê°€ ì œê³µë˜ì§€ ì•Šì•„ ë””ë²„ê¹…í•˜ê¸°ë„ í˜ë“¤ì—ˆë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤.\në¶ˆí¸í•œ struct tag ê¸°ë°˜ì˜ í…Œì´ë¸”, ì»¬ëŸ¼ ì„¤ì •\nGoê°€ ê°•ë ¥íˆ typeì„ ê°•ì œí•˜ë©´ì„œ ë†’ì€ ì•ˆì •ì„±ê³¼ í¸ì˜ì„±ì„ ì œê³µí•˜ëŠ” ë°˜ë©´ gormì€ struct tagë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì—¬ëŸ¬ ì„¤ì •ë“¤ì„ ê´€ë¦¬í•˜ë„ë¡ ê°œë°œë˜ì—ˆìŠµë‹ˆë‹¤. Go ì–¸ì–´ë¥¼ ì¢‹ì•„í•˜ì§€ë§Œ struct tagì— ëŒ€í•´ì„œëŠ” ê°€ëœ©ì´ë‚˜ ì¡°ê¸ˆì˜ ë¶ˆë§Œì„ ê°–ê³  ìˆì—ˆëŠ”ë° ì´ëŸ° ì €ëŸ° ì»¬ëŸ¼ ì„¤ì •ë“¤ë§ˆì € struct tagë¡œ ì´ìš©í•˜ë‹ˆ ì •í™•íˆ ì´ tagê°€ ë™ì‘í•˜ëŠ” íƒœê·¸ì¸ì§€, ì™œ ì—ëŸ¬ê°€ ë‚˜ê±°ë‚˜ ì ìš©ì´ ì•ˆë˜ëŠ”ì§€ë„ ì•ˆì „í•˜ê²Œ í™•ì¸í•  ìˆ˜ ì—†ì—ˆê³  ë¬´ì—‡ë³´ë‹¤ ê°€ë…ì„±ì´ ë„ˆë¬´ ë„ˆë¬´~! ì¢‹ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\nì œê³µë˜ëŠ” ë©”ì†Œë“œê°€ ë³„ë¡œ ì—†ë‹¤.\ngormì€ ì•„ì£¼ ê°€ë²¼ìš´ ëŠë‚Œì´ì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ë°ì´í„°ë² ì´ìŠ¤ í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•¨ì—ë„ ë¶ˆêµ¬í•˜ê³  ë„ˆë¬´ë‚˜ ì œê³µë˜ëŠ” ë©”ì†Œë“œê°€ ì—†ë‹¤ê³  ëŠê»´ì¡ŒìŠµë‹ˆë‹¤. JPAë‚˜ DjangoëŠ” ì¡°ê¸ˆì˜ ì„¤ì •ë§Œ í•´ì£¼ë©´ CRUDì™€ Joinê¹Œì§€ ì œê³µí•´ì£¼ëŠ”ë° gormì€ ê±°ì˜ ì •ë§ ì •ë§ ê¸°ë³¸ì ì¸ ê¸°ëŠ¥ì„ í•˜ëŠ” ë©”ì†Œë“œì— ì ì ˆí•œ ì¸ìë¥¼ ì „ë‹¬í•¨ìœ¼ë¡œì¨ ë™ì‘ì‹œì¼œì•¼í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ë©”ì†Œë“œê°€ ì–´ë–¤ ë§¤ê°œë³€ìˆ˜ë¥¼ ì™œ í•„ìš”ë¡œ í•˜ëŠ”ì§€ì— ë‚´ìš©ì´ ê·¸ë‹¥ ì—†ê³  ê·¸ëƒ¥ í†µìœ¼ë¡œ Createë©”ì†Œë“œì— ì•Œì•„ì„œ ì ì ˆí•œ inteface{}ì¸ìë¥¼ ì „ë‹¬í•´ì•¼í•˜ëŠ” í˜•íƒœë¼ Goì˜ ì¥ì ì¸ ê°•ë ¥í•œ typeì„ ë°”íƒ•ìœ¼ë¡œí•œ ì•ˆì •ì„±, í¸ì˜ì„±ì„ ëˆ„ë¦´ ìˆ˜ë„ ì—†ì—ˆê³  ì´ëŸ´êº¼ë©´ íŒŒì´ì¬ ì“°ì§€\u0026hellip; ì‹¶ì€ ìƒê°ì´ ìì£¼ ë“¤ì—ˆìŠµë‹ˆë‹¤.\nğŸ‘ ì¶”ì²œí•˜ëŠ” í”„ë ˆì„ì›Œí¬ - ent ë¬¼ë¡  ìœ„ì˜ Github star historyë§Œ ë´ë„ ì•„ì‹¤ ìˆ˜ ìˆê² ì§€ë§Œ entëŠ” ë§¤ìš° ë¬´ì„­ê²Œ ì„±ì¥ ì¤‘ì¸ Golangì˜ ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤. ê²Œë‹¤ê°€ ì•„ë§ˆ Facebookì—ì„œ ë‚´ë¶€ì ìœ¼ë¡œ ì‚¬ìš©í•˜ë‹¤ê°€ ì˜¤í”ˆì†ŒìŠ¤í™”í•œ í”„ë¡œì íŠ¸ì¸ ê±¸ë¡œ ì•Œê³  ìˆëŠ”ë° ë”°ë¼ì„œ ì–´ëŠ ì •ë„ì˜ ì™„ì„±ë„ë‚˜ í¸ì˜ì„±ì´ ë³´ì¥ë˜ê² ì£ . ã…ã… ì €ëŠ” ì‚¬ì´ë“œ í”„ë¡œì íŠ¸ì—ì„œ gormì„ ì‚¬ìš©í•˜ë‹¤ê°€ ë§ì€ ë¶ˆí¸ì„ ëŠê¼ˆê³ , Go ê°œë°œ ì»¤ë®¤ë‹ˆí‹°ì—ì„œ entê°€ ê·¸ë ‡ê²Œë‚˜ í•«í•˜ë‹¤ê¸¸ë˜ entë¡œ data access layerë¥¼ ë§ˆì´ê·¸ë ˆì´ì…˜í–ˆê³  ë§Œì¡± ì¤‘ì…ë‹ˆë‹¤. ã…ã…\nentì˜ ì‚¬ìš© í›„ê¸° ë° íŠ¹ì§•ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.\níƒ€ì…ì„ ë°”íƒ•ìœ¼ë¡œ ì•ˆì „í•˜ê³  í¸ë¦¬í•˜ê²Œ í…Œì´ë¸”ì„ ì„¤ê³„í•  ìˆ˜ ìˆë‹¤.\ní…Œì´ë¸”, ì»¬ëŸ¼ ì •ì˜ë“¤ì´ ëª¨ë‘ ent íŒ¨í‚¤ì§€ì˜ ì»¬ëŸ¼ type í˜¹ì€ í…Œì´ë¸” type, ê´€ê³„ type ë“±ë“±ì„ ì´ìš©í•´ì„œ ì •ì˜í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë„ˆë¬´ ë„ˆë¬´ í¸ë¦¬í•˜ì£ . ê²Œë‹¤ê°€ ë³µì¡í•œ struct tagë„ ì•ˆë…•~! entëŠ” ë¯¸ë¦¬ ì •ì˜ëœ íƒ€ì…ê³¼ ë©”ì†Œë“œë“¤ë¡œ ë‹¤ì–‘í•œ ì„¤ì •ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\në‹¤ì–‘í•œ ë©”ì†Œë“œ ì œê³µ\ngo generateë¼ê³  í•˜ëŠ” ê¸°ëŠ¥ì„ í†µí•´ ìš°ë¦¬ê°€ ì •ì˜í•œ ìŠ¤í‚¤ë§ˆ(í…Œì´ë¸” ë° í•„ë“œ ì„¤ì •)ì„ ë°”íƒ•ìœ¼ë¡œ ë‹¤ì–‘í•œ íƒ€ì…ê³¼ ë©”ì†Œë“œë“¤ì„ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤. ì´ ë¶€ë¶„ìœ¼ë¡œ ì¸í•´ ê½¤ ë¹Œë“œ ì‹œê°„ì´ ëŠ˜ì–´ë‚˜ëŠ” ëŠë‚Œì´ê¸´í•œë° ê·¸ë˜ë´¤ì 2ì´ˆ ì •ë„ì¸ë° entê°€ ì œê³µí•´ì£¼ëŠ” ë©”ì†Œë“œë“¤ë¡œ ì¸í•´ ê°œë°œì  í¸ì˜ì™€ ì•ˆì •ì„±ì´ í›¨ì”¬ í¬ë‹¤ê³  ëŠë¼ê¸° ë•Œë¬¸ì— ë§Œì¡±í•˜ê³  ìˆìŠµë‹ˆë‹¤.\në³„ ë‹¤ë¥¸ ë¬¸ì„œê°€ í•„ìš” ì—†ë‹¤..?\nê·¸ëƒ¥ ë©”ì†Œë“œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì´ìš©í•  ìˆ˜ ìˆë‹¤ë³´ë‹ˆ ê·¸ ì‚¬ìš© ë°©ë²•ì´ ì§ê´€ì ì¸ í¸ì´ê³ , ê²½ìš°ì— ë”°ë¼ì„œëŠ” ì½”ë“œ ìì²´ë¥¼ ê¹Œë³´ë©´ ì´í•´ë˜ëŠ” ë³„ ë‹¤ë¥¸ ë¬¸ì„œ ì—†ì´ë„ ì´ìš©í•  ìˆ˜ ìˆì—ˆë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤.\nì°¸ì¡° ê´€ê³„ ì„¤ì •ì´ ì¢€ í—·ê°ˆë¦°ë‹¤ (ëª‡ ì•ˆ ë˜ëŠ” ë‹¨ì  ì¤‘ í•˜ë‚˜)\në­”ê°€ Fromì´ë‚˜ Toë“±ì„ í†µí•´ ì°¸ì¡° ê´€ê³„ë¥¼ ì •ì˜í•˜ëŠ”ë° ì´ Fromì´ ì–´ë–¤ í…Œì´ë¸”ì„ Fromìœ¼ë¡œ ìƒê°í•˜ëŠ”ê±´ì§€ ë­”ê°€ ë§ì´ ì• ë§¤í•©ë‹ˆë‹¤. ì»¤ë®¤ë‹ˆí‹°ë¥¼ ë³´ë©´ ì´ë¡œ ì¸í•´ ë§ì€ ë¶„ë“¤ë„ í˜¼ë€ì„ ê²ªê³  ìˆëŠ” í˜„í™©ì…ë‹ˆë‹¤.\ní•˜ì§€ë§Œ ë„ˆë¬´ ê±±ì •ì€ ë§ˆì„¸ìš”~! ì´ë²ˆ ê¸€ì—ì„œ ì •ë¦¬í•´ë“œë¦¬ë ¤í•˜ë‹ˆê¹Œìš”~! ã…ã…\nEnt íŒ¨í‚¤ì§€ë¥¼ í†µí•´ Database ì‘ì—…í•´ë³´ê¸° \u0026ldquo;ì‹œì‘í•˜ë©°\u0026ldquo;ì—ì„œë„ ë§ì”€ë“œë ¸ë‹¤ì‹œí”¼ ì‚¬ì‹¤ Go ì–¸ì–´ë¡œ ê°œë°œí•˜ì‹œëŠ” ë¶„ë“¤ ì¤‘ì— ì •ë§ ê°œë°œ ìì²´ê°€ ìµìˆ™í•˜ì§€ ì•Šì€ ë¶„ë“¤ì€ ì •ë§ ì ìœ¼ë¦¬ë¼ ìƒê°í•©ë‹ˆë‹¤\u0026hellip;ã…ã… ë”°ë¼ì„œ ë„ˆë¬´ ë””í…Œì¼í•œ ë‚´ìš©ì„ ì§ì ‘ ì•Œë ¤ë“œë¦¬ê¸° ë³´ë‹¤ëŠ” ì»¤ë‹¤ë€ íë¦„ì´ë‚˜ í—·ê°ˆë¦¬ëŠ” ìš”ì†Œë“¤ì„ ì§šì–´ë“œë¦¬ëŠ” ë°©í–¥ìœ¼ë¡œ ê¸€ì„ ì‘ì„±í•´ ë³´ê² ìŠµë‹ˆë‹¤.\nì˜ˆì‹œ Application - ì—¬í–‰ ìƒí’ˆ ê´€ë¦¬ CRUD ì„œë¹„ìŠ¤ 1:Nì˜ ì—¬í–‰ ìƒí’ˆ ë‹´ë‹¹ì ê´€ê³„ - ë‹´ë‹¹ì(ì¼ì¢…ì˜ ìœ ì €)ëŠ” ì—¬í–‰ ìƒí’ˆê³¼ 1:N ê´€ê³„ ìœ„ì˜ ê´€ê³„ë¥¼ ê°–ëŠ” ì—¬í–‰ ìƒí’ˆ ê´€ë¦¬ CRUD ì„œë¹„ìŠ¤ë¥¼ ë§Œë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤. ë³¸ ê¸€ì—ì„œëŠ” ì½”ë“œë¥¼ ì§§ê²Œ ì§§ê²Œ ì˜ë¼ì„œ ì˜¬ë¦´í…Œë‹ˆ ì›ë³¸ ì½”ë“œë¥¼ ë³´ê³ ì‹¶ìœ¼ì‹  ë¶„ë“¤ì€ ì œ ê¹ƒí—™ì„ ì°¸ê³ í•´ì£¼ì„¸ìš”.\nì›ë³¸ ì½”ë“œ - https://github.com/umi0410/how-to-backend-in-go\n1. ent package ì„¤ì¹˜ # ì°¸ê³ : https://entgo.io/docs/tutorial-setup/#installation $ go get entgo.io/ent/cmd/ent ìš°ì„  entëŠ” ë‹¤ì–‘í•œ ëª…ë ¹ ê¸°ëŠ¥ë„ ì œê³µí•˜ê³  ì €í¬ëŠ” ê·¸ê±¸ í•„ìš”ë¡œ í•˜ê¸° ë•Œë¬¸ì— entë¥¼ ì„¤ì¹˜í•´ì£¼ì–´ì•¼í•©ë‹ˆë‹¤. ìŠ¤í‚¤ë§ˆ ì •ì˜ ì½”ë“œ ë˜í•œ ent ë¥¼ ì´ìš©í•´ ìë™ìœ¼ë¡œ ê¸°ë³¸ í˜•íƒœë¥¼ ì œê³µ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ent íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•œ ì´í›„ ì €í¬ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ëª…ë ¹ì„ ìˆ˜í–‰í•˜ê²Œ ë  ê²ƒì…ë‹ˆë‹¤.\n$ go run entgo.io/ent/cmd/ent init {{ì—”í‹°í‹° ì´ë¦„}} - ì—”í‹°í‹° ì´ë¦„ì„ ë°”íƒ•ìœ¼ë¡œí•œ ì´ˆê¸° ìŠ¤í‚¤ë§ˆ ì½”ë“œ ìƒì„± $ go generate ./ent - ì •ì˜í–ˆë˜ ìŠ¤í‚¤ë§ˆë¥¼ ë°”íƒ•ìœ¼ë¡œ í•œ ë§ì€ boilerplate ì½”ë“œë¥¼ ìë™ìœ¼ë¡œ ìƒì„± 2. ìŠ¤í‚¤ë§ˆ ì„¤ì • $ go run entgo.io/ent/cmd/ent init User # or shortly $ ent init User $ go run entgo.io/ent/cmd/ent init TourProduct # or shortly $ ent init TourProduct ìœ„ì˜ ëª…ë ¹ì–´ë“¤ì„ í†µí•´ Userì™€ Userê°€ ê´€ë¦¬í•˜ëŠ” TourProductë¼ëŠ” ì—”í‹°í‹°ë“¤ì˜ ìŠ¤í‚¤ë§ˆë¥¼ ì‘ì„±í•  ê²ƒì…ë‹ˆë‹¤. ì •í™•í•œ ìŠ¤í‚¤ë§ˆ ì‘ì„±ì— ëŒ€í•œ ì„¤ëª…ì€ ìƒëµí•˜ê² ìŠµë‹ˆë‹¤. ent ê³µì‹ ë¬¸ì„œì— ë§¤ìš° ì˜ ì„¤ëª…ë˜ì–´ìˆê³ , examples in ent githubì—ì„œ ëŒ€ë¶€ë¶„ì˜ ì˜ˆì‹œ ì½”ë“œë„ í™•ì¸í•´ë³¼ ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.\nâ­ ì°¸ì¡° ê´€ê³„ ì„¤ì • ì‹œì˜ Fromê³¼ To ë‹¤ë§Œ í•œ ê°€ì§€. Edgeë¥¼ ì´ìš©í•´ ì°¸ì¡° ê´€ê³„ë¥¼ ì„¤ì •í•  ë•Œ Fromê³¼ Toì˜ ì‚¬ìš©ì— ëŒ€í•´ í•œ ê°€ì§€ë§Œ ì§šê³  ë„˜ì–´ê°€ë ¤ í•©ë‹ˆë‹¤. ì €ë¥¼ í¬í•¨í•´ ë§ì€ ent ì‚¬ìš©ìë¶„ë“¤ê»˜ì„œ Edge ì„¤ì • ì‹œì— ë§ì€ í˜¼ë€ì„ ê²ªìŠµë‹ˆë‹¤. ê·¸ ì´ìœ ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ìš°ë¦¬ëŠ” 1:N ê´€ê³„ì—ì„œ Nìª½ì´ From, 1ìª½ì´ Toê°€ ë˜ë©° Nìª½ í…Œì´ë¸”ì—ì„œ 1ì„ ì°¸ì¡°í•˜ëŠ” ë‚´ìš©ì„ ì •ì˜í•˜ëŠ” ë°˜ë©´ entëŠ” ê·¸ ë°˜ëŒ€ë¡œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.\n(entì—ì„œì˜ ì°¸ì¡° ê´€ê³„ ì •ì˜ ë°©ì‹ì— ëŒ€í•´ ê¶ê¸ˆí•˜ì§€ ì•Šìœ¼ì‹  ë¶„ë“¤ì€ ë„˜ì–´ê°€ì…”ë„ ë©ë‹ˆë‹¤.)\no2m-relation.png ì¶œì²˜: https://entgo.io/docs/schema-edges\nìœ„ì™€ ê°™ì€ ê²½ìš° ë°ì´í„°ë² ì´ìŠ¤ìƒìœ¼ë¡œëŠ” Pet í…Œì´ë¸”ì´ ìì‹ ì˜ owner_id ì»¬ëŸ¼ì„ í†µí•´ Userì„ ì°¸ì¡°í•˜ë¯€ë¡œ Petì´ From, Userê°€ Toê°€ ë˜ë©° ì´ë¥¼ í†µí•´ ownerë¼ëŠ” ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ entëŠ” ê·¸ ë°˜ëŒ€ë¡œ Userê°€ Petì„ ê´€ë¦¬(ì°¸ì¡°)í•œë‹¤ëŠ” ì˜ë¯¸ë¡œ Userê°€ From, Petì´ Toê°€ ë˜ì–´ petsë¼ëŠ” ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì‹ìœ¼ë¡œ ì •ì˜í•˜ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ ê¸°ì¡´ì˜ í…Œì´ë¸” ì„¤ê³„ ë°©ì‹ê³¼ëŠ” ëŒ€ì¡°ë˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì¸í•´ ë§ì€ ì‚¬ëŒë“¤ì´ í˜¼ë€ì„ ê²ªëŠ” ê²ƒ ê°™ì•„ìš”.\nì´ë ‡ê²Œ í…Œì´ë¸”ì„ ì •ì˜í•˜ë„ë¡ entë¥¼ ê°œë°œí•œ ê°œë°œìë“¤ì˜ ì˜ë„ë‚˜ ì² í•™ì€ ë­”ì§€ ì˜ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤. í˜¹ì‹œ ì•„ì‹œëŠ” ë¶„ì´ ìˆë‹¤ë©´ ì•Œë ¤ì£¼ì‹œë©´ ì¢€ ë” entfë¥¼ ì´í•´í•˜ëŠ” ë°ì— ë„ì›€ì´ ë  ê²ƒ ê°™ì•„ìš”!\nì•„ë¬´íŠ¼ entì—ì„œëŠ” 1:N ë°©ì‹ì—ì„œ 1ì´ ì—°ê´€ ê´€ê³„ì˜ ì£¼ì¸ì²˜ëŸ¼ ë™ì‘/ì •ì˜í•œë‹¤ê³  ìƒê°í•˜ê³  ì‘ì—…í•˜ê³  ìˆìŠµë‹ˆë‹¤.(ì‹¤ì œ ë¬¸ì„œì—ì„œë„ Fromìª½. ì¦‰ 1 í˜¹ì€ User ìª½ì´ ì—°ê´€ ê´€ê³„ì˜ ì£¼ì¸ì´ë¼ê³  ê¸°ìˆ ë˜ì–´ìˆëŠ”ë°, ì´ ë¶€ë¶„ì€ JPAì™€ëŠ” ê±°ì˜ ë°˜ëŒ€ë¼ê³  ë³¼ ìˆ˜ ìˆì£ .) ì €ëŠ” ê·¸ëƒ¥ ì˜ˆì‹œë¥¼ ì°¸ê³ í•˜ë©´ì„œ ì‹¤ì œ í…Œì´ë¸”ì˜ ì°¸ì¡° ê´€ê³„ë‘ ë°˜ëŒ€ë¼ê³  ì™¸ì› ì–´ìš”.(ã…ã…\u0026hellip;.;;)\nìŠ¤í‚¤ë§ˆ ì •ì˜ ë° ì ìš© // ent/schema/user.go package schema import ( \u0026#34;entgo.io/ent\u0026#34; \u0026#34;entgo.io/ent/schema/edge\u0026#34; \u0026#34;entgo.io/ent/schema/field\u0026#34; ) // User holds the schema definition for the User entity. type User struct { ent.Schema } // Fields of the User. func (User) Fields() []ent.Field { return []ent.Field{ // íƒ€ì…ì„ ê¸°ë°˜ìœ¼ë¡œ ì•ˆì „í•˜ê³  í¸ë¦¬í•˜ê²Œ ì»¬ëŸ¼ì„ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. field.String(\u0026#34;id\u0026#34;), field.String(\u0026#34;name\u0026#34;), field.Bool(\u0026#34;isActivated\u0026#34;).Default(true), } } // Edges of the User. func (User) Edges() []ent.Edge { return []ent.Edge{ // entì—ì„œëŠ” Toë¥¼ ì •ì˜í•˜ëŠ” ìŠ¤í‚¤ë§ˆ, ì¦‰ ì—¬ê¸°ì„  User // ê°€ ì°¸ì¡° ê´€ê³„ì˜ ì£¼ì¸ì´ë¼ê³  ì •ì˜í•©ë‹ˆë‹¤. // ì¼ë°˜ì ì¸ JPAì˜ ë°©ì‹ê³¼ëŠ” ë°˜ëŒ€ì…ë‹ˆë‹¤. edge.To(\u0026#34;products\u0026#34;, TourProduct.Type), } } $ go generate ./ent ì•„ë¬´íŠ¼ ì €ëŠ” User ìŠ¤í‚¤ë§ˆë¥¼ ì´ë ‡ê²Œ ì„¤ì •í–ˆê³  ì´ ìŠ¤í‚¤ë§ˆë“¤ì„ ì ìš©í•´ entê°€ generateí•´ì¤€ ì½”ë“œë“¤ì„ ì´ìš©í•´ë³´ê² ìŠµë‹ˆë‹¤.\n(TourProduct ìŠ¤í‚¤ë§ˆëŠ” ìƒëµí–ˆìŠµë‹ˆë‹¤. ì›ë³¸ ì½”ë“œë¥¼ ì°¸ê³ í•´ì£¼ì„¸ìš”.)\n3. repository ì •ì˜ entê°€ ë°ì´í„°ë² ì´ìŠ¤ ê´€ë ¨ ì‘ì—…ì„ ìœ„í•œ ë‹¤ì–‘í•œ ë©”ì†Œë“œë¥¼ ì§€ì›í•´ì¤ë‹ˆë‹¤. í•˜ì§€ë§Œ entëŠ” ê°„ë‹¨ ê°„ë‹¨í•œ ë©”ì†Œë“œë“¤ì„ ì¡°í•©í•´ì„œ ì‚¬ìš©í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ êµ¬í˜„í•˜ëŠ” ê³„ì¸µì—ì„œ ë§¤ë²ˆ entì˜ ë©”ì†Œë“œë¥¼ ì¡°í•©í•˜ë©° ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ê³„ì¸µì˜ ê´€ì‹¬ì‚¬ì™€ ì±…ì„ì„ íë¦¬ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ëª‡ ê°€ì§€ ë©”ì†Œë“œë“¤ì„ data access layerì¸ repositoryì— ì •ì˜í•˜ê² ìŠµë‹ˆë‹¤.\nì˜ˆë¥¼ ë“¤ë©´ íŠ¹ì • userê°€ ê´€ë¦¬í•˜ëŠ” ì—¬í–‰ ìƒí’ˆì„ ëª¨ë‘ ì¡°íšŒí•˜ëŠ” FindAllByManager(managerID string)ì™€ ê°™ì€ ë©”ì†Œë“œ ë§ì´ì£ . ì´ ì‘ì—…ì„ ìœ„í•´ì„œëŠ” User í…Œì´ë¸”ê³¼ TourProduct í…Œì´ë¸”ì„ ì¡°ì¸í•´ì•¼í•˜ëŠ”ë° entê°€ ì—­ì‹œ ì´ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.\n// repository.go ... type TourProductRepository struct{ Client *ent.TourProductClient } func (repo *TourProductRepository) FindAllByManager(managerID string) []*ent.TourProduct{ result := repo.Client.Query(). // íŠ¹ì • manager_idì˜ TourProductë¥¼ ì¡°íšŒí•˜ë„ë¡ ì¡°ì¸ Where(tourproduct.HasManagerWith(user.ID(managerID))). WithManager(). AllX(context.TODO()) return result } 4. ì‹¤í–‰ // main.go func main(){ ... fmt.Println(\u0026#34;ì „ì²´ ìœ ì € ì¡°íšŒ\u0026#34;) for _, user := range userRepository.FindAll() { fmt.Printf(\u0026#34;User(id=%s, name=%s)\\n\u0026#34;, user.ID, user.Name) } fmt.Println(\u0026#34;--------------------------------------------------------------------------\u0026#34;) fmt.Println(\u0026#34;ì „ì²´ ì—¬í–‰ ìƒí’ˆ ì¡°íšŒ\u0026#34;) for _, tour := range tourProductRepository.FindAll() { fmt.Printf(\u0026#34;TourProduct(id=%d, name=%s, manager=%s)\\n\u0026#34;, tour.ID, tour.Name, tour.Edges.Manager.ID) } fmt.Println(\u0026#34;--------------------------------------------------------------------------\u0026#34;) fmt.Println(user1.ID + \u0026#34;ê°€ ê´€ë¦¬í•˜ëŠ” ì „ì²´ ì—¬í–‰ ìƒí’ˆ ì¡°íšŒ\u0026#34;) for _, tour := range tourProductRepository.FindAllByManager(user1.ID) { fmt.Printf(\u0026#34;TourProduct(id=%d, name=%s, manager=%s)\\n\u0026#34;, tour.ID, tour.Name, tour.Edges.Manager.ID) } } ì „ì²´ ìœ ì € ì¡°íšŒ User(id=umi0410, name=ë°•ì§„ìˆ˜) User(id=devumi, name=ê°œë°œì) -------------------------------------------------------------------------- ì „ì²´ ì—¬í–‰ ìƒí’ˆ ì¡°íšŒ TourProduct(id=1, name=ë¯¸êµ­ ë‰´ìš• ì—¬í–‰, manager=umi0410) TourProduct(id=2, name=ìœ ëŸ½ ì—¬í–‰, manager=devumi) -------------------------------------------------------------------------- umi0410ê°€ ê´€ë¦¬í•˜ëŠ” ì „ì²´ ì—¬í–‰ ìƒí’ˆ ì¡°íšŒ TourProduct(id=1, name=ë¯¸êµ­ ë‰´ìš• ì—¬í–‰, manager=umi0410) ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ 2ëª…ì˜ ìœ ì €ë¥¼ ë§Œë“¤ì—ˆê³ , ê°ê°ì˜ ìœ ì €ê°€ ê´€ë¦¬í•˜ëŠ” 2ê°œì˜ ì—¬í–‰ ìƒí’ˆì„ ë§Œë“¤ì–´ì„œ ì¡°íšŒí•˜ëŠ” í”„ë¡œê·¸ë¨ì„ ë§Œë“¤ì–´ë³´ì•˜ìŠµë‹ˆë‹¤. repository ê³„ì¸µì—ì„œ ë§Œë“  FindAll()ì´ë‚˜ FindAllByManager()ì™€ ê°™ì€ ë©”ì†Œë“œë“¤ì„ í†µí•´ í¸ë¦¬í•˜ê²Œ ì‘ì—…í•  ìˆ˜ ìˆë„¤ìš”!\në§ˆì¹˜ë©° ê¸€ì„ ì“°ë‹¤ë³´ë‹ˆ ë°±ì—”ë“œ ê°œë°œì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ê°€ ì™œ í•„ìš”í•˜ê³  ì–´ë–¤ ì‹ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ”ì§€ë¥¼ ë‹¤ë£¨ëŠ” ê¸€ë„ ì•„ë‹ˆê³ , Golangì—ì„œ ent í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ìì„¸íˆ ì•Œë ¤ì£¼ëŠ” ê¸€ë„ ì•„ë‹Œ ì´ë„ ì €ë„ ì•„ë‹Œ ê¸€ì´ ëœ ê±´ ì•„ë‹Œê°€ ì‹¶ê¸°ë„ í•©ë‹ˆë‹¤.\nê·¸ë˜ë„ ì•ìœ¼ë¡œ Golangìœ¼ë¡œ ë°±ì—”ë“œ ê°œë°œí•˜ëŠ” ê²ƒì— ëŒ€í•´ ì²œì²œíˆ í•œ 5~6í¸ ì •ë„ì˜ ê¸€ì„ ì¨ë‚˜ê°€ë³¼ê¹Œí•˜ëŠ”ë° ì´ë•Œ DB ê´€ë ¨ëœ ë‚´ìš©ì„ ìš°ì„  ì§šê³ ëŠ” ë„˜ì–´ê°€ì•¼í•  ê²ƒ ê°™ê¸°ë„ í–ˆê³ , ë¬´ì—‡ë³´ë‹¤ í•œê¸€ë¡œ ëœ ent ìë£Œë¥¼ í•˜ë‚˜ë„ ì°¾ì„ ìˆ˜ ì—†ë‹¤ëŠ” ì ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ ê´€ë ¨ í”„ë ˆì„ì›Œí¬ì¸ entë¥¼ ì†Œê°œí•´ë³´ê³ ì í–ˆìŠµë‹ˆë‹¤! ã…ã…\nì§€ë©´ ì‚¬ì • ìƒ ì½”ë“œë“¤ì„ ì˜ë¼ì„œ ì˜¬ë ¸ëŠ”ë° ì›ë³¸ ì½”ë“œëŠ” https://github.com/umi0410/how-to-backend-in-go ì— ì˜¬ë ¤ë†“ì„í…Œë‹ˆ ì°¸ê³ í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤.\nì°¸ê³  https://entgo.io/ https://github.com/ent/ent ","date":"2021-07-03T12:46:54+09:00","image":"https://umi0410.github.io/blog/golang/how-to-backend-in-go-db/o2m-relation_huda98d5d877ff5063fa9c786910881686_21160_120x120_fill_box_smart1_3.png","permalink":"https://umi0410.github.io/blog/golang/how-to-backend-in-go-db/","title":"Golangìœ¼ë¡œ ë°±ì—”ë“œ ê°œë°œí•˜ê¸° - 1. ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…í•˜ê¸° (Ent í”„ë ˆì„ì›Œí¬ ì´ìš©)"},{"content":"ë¬¸ì œ ì„¤ëª… ë¬¸ì œ ì¶œì²˜: https://programmers.co.kr/learn/courses/30/lessons/67258\nê°ê°ì˜ ë³´ì„ìƒì€ í•˜ë‚˜ì˜ ë³´ì„ì„ íŒë§¤ ì—°ì†ëœ ë³´ì„ìƒë“¤ì„ ì‡¼í•‘í•˜ë©´ì„œ ë°©ë¬¸í•  ë•Œë§ˆë‹¤ ë³´ì„ì„ êµ¬ë§¤ ëª¨ë“  ì¢…ë¥˜ì˜ ë³´ì„ì„ êµ¬ë§¤í•  ë•Œê¹Œì§€ ì§„í–‰ ëª¨ë“  ì¢…ë¥˜ì˜ ë³´ì„ì„ êµ¬ë§¤í•˜ëŠ” ê²½ìš° ì¤‘ ê°€ì¥ ì¡°ê¸ˆì˜ ë³´ì„ì„ ê°€ì¥ ì•ì„  ë³´ì„ìƒì—ì„œ êµ¬ë§¤í•˜ëŠ” ê²½ìš°ë¥¼ êµ¬í•˜ê¸° ë¬¸ì œ ì ‘ê·¼ ìš°ì„  ë‹¨ìˆœí•˜ê²Œ ë¬¸ì œì˜ ì¡°ê±´ì„ ê·¸ë¦¼ìœ¼ë¡œ ë‚˜íƒ€ë‚´ë©´ ìœ„ì™€ ê°™ë‹¤. ê²°êµ­ 1ë²ˆ ìƒì ë¶€í„° ë°©ë¬¸í•˜ëŠ” ê²½ìš°, 2ë²ˆ ìƒì ë¶€í„° ë°©ë¬¸í•˜ëŠ” ê²½ìš°, \u0026hellip; ì´ëŸ° ì‹ìœ¼ë¡œ ì§„í–‰í•´ë‚˜ê°„ ë’¤ ê°€ì¥ ë³´ì„ì„ ì ê²Œ, ì•ì˜ ìƒì ì—ì„œ ì‚¬ëŠ” ê²½ìš°ë¥¼ êµ¬í•˜ë©´ ëœë‹¤.\nğŸ‘ ì²« ë²ˆì§¸ ì ‘ê·¼ \u0026lsquo;\u0026lsquo;ê° ê²½ìš°ë§ˆë‹¤ ì§ì ‘ êµ¬í•´ë³¼ê¹Œ?\u0026rsquo;\ní—ˆê±±.. ë³´ì„ìƒì€ ìµœëŒ€ 10ë§Œê°œë¥¼ ì…ë ¥ìœ¼ë¡œ ì¤€ë‹¤. ê° ê²½ìš°ë¥¼ ë§¤ë²ˆ ì§ì ‘ Në²ˆ ìƒì ë¶€í„° ì‹œì‘í•´ì„œ ëª¨ë“  ì¢…ë¥˜ì˜ ë³´ì„ì„ ì‚¬ëŠ” ê²½ìš°ë¥¼ êµ¬í•˜ëŠ” ê²ƒì€ ë„ˆë¬´ ë¹„íš¨ìœ¨ì ì¼ ê²ƒ ê°™ë‹¤.\nğŸ‘ ë‘ ë²ˆì§¸ ì ‘ê·¼ \u0026ldquo;ê·¸ëŸ¬ê³ ë³´ë‹ˆ ì•ì˜ ê²½ìš°ì™€ ë¹„êµí•˜ë©´ì„œ ë°©ê¸ˆ ì œì™¸ëœ ë³´ì„ë§Œ ì¶”ê°€ë˜ëŠ” ê²½ìš°ë¥¼ ì°¸ê³ í•˜ë©° êµ¬í•˜ë©´ ë˜ì§€ ì•Šì„ê¹Œ?\u0026rdquo;\nì¦‰ ê·¸ë¦¼ì„ ë³´ë©´ ë‘ ë²ˆì§¸ ê²½ìš°ëŠ” ì•ì˜ ê²½ìš°(ì²« ë²ˆì§¸ ê²½ìš°)ì™€ ë¹„êµí–ˆì„ ë•Œ Aê°€ ì¤„ì—ˆê³ , ë‚´ê°€ ë°©ë¬¸í•œ ë³´ì„ìƒ ì¤‘ Aê°€ ì—†ë‹¤ë©´ Aë¥¼ êµ¬ë§¤í•  ë•Œê¹Œì§€ ë³´ì„ìƒì„ ë°©ë¬¸í•˜ë©´ ëœë‹¤. ì„¸ ë²ˆì§¸ ê²½ìš°ëŠ” ê·¸ì™€ ë°˜ëŒ€ë¡œ ì•ì˜ ê²½ìš°(ë‘ ë²ˆì§¸ ê²½ìš°)ì™€ ë¹„êµí–ˆì„ ë•Œ Bê°€ ì¤„ì—ˆì§€ë§Œ ë‚´ê°€ ë°©ë¬¸í•œ ë³´ì„ìƒ ì¤‘ Bë¥¼ íŒë§¤í•˜ëŠ” ê³³ì´ ìˆê¸°ì— ìƒˆë¡œìš´ ë³´ì„ìƒì„ ë°©ë¬¸í•  í•„ìš”ê°€ ì—†ë‹¤.\n=\u0026gt; ì˜¤í˜¸ë¼\u0026hellip; ì¶”ìƒì ìœ¼ë¡œ ì ‘ê·¼ ë°©ì‹ì„ ë°”ë¼ë´¤ì„ ë•ŒëŠ” íš¨ìœ¨ì ì¸ ê²ƒ ê°™ë‹¤! ì´ì œ êµ¬í˜„ì—ì„œë§Œ ì˜ êµ¬í˜„í•˜ë©´ ë˜ê² ë‹¤.\nêµ¬í˜„ ğŸ‘ ì˜¬ë°”ë¥¸ êµ¬í˜„ # í’€ì´ë²•ì´ ë– ì˜¤ë¥´ì§€ ì•ŠëŠ”ë‹¤. ì²˜ìŒ ë³´ëŠ” ìœ í˜•ì´ë‹¤... # ê·¸ëƒ¥ 1ë²ˆì—ì„œ ì‹œì‘í•´ì„œ ë‹¤ í¬í•¨í•˜ëŠ” ê²½ìš° # 2ë²ˆì—ì„œ ì‹œì‘í•´ì„œ ë‹¤ í¬í•¨í•˜ëŠ” ê²½ìš° ì´ë ‡ê²Œ ë‹¤ ì„¸ë³´ë©´ íš¨ìœ¨ì„±ì´ ì˜¤ë°”ì¼ê¹Œ..? ìµœëŒ€ 10ë§Œì¹¸ì„... # ì•½ê°„ dpìŠ¤ëŸ½ê²Œ ì „êº¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìƒê°í•˜ëŠ” ê²Œ ì¢‹ê² ë‹¤. # ì „êº¼ë¥¼ ì—†ì•¤ ëŒ€ì‹  ê±”ê°€ í¬í•¨ë˜ì–´ìˆìœ¼ë©´ ã„±ã…Šì€ ê±°ë‹ˆê¹Œ. def solution(gems): end = -1 gems_set = set(gems) shopping_bag={} for gem in gems_set: shopping_bag[gem] = 0 for i in range(len(gems)): gem = gems[i] gems_set.discard(gem) shopping_bag[gem] += 1 if len(gems_set) == 0: end = i break answers = [(end+1, 0, end)] for i in range(1, len(gems)): found, end = shop(gems, i, end, shopping_bag) if not found: break length = end - i + 1 if length == answers[0][0]: answers.append((length, i, end)) elif length \u0026lt; answers[0][0]: answers = [(length, i, end)] # print(answers) answer = sorted(answers)[0] return [answer[1] + 1, answer[2] + 1] # end í¬í•¨ def shop(gems, start, end, shopping_bag): left_gem = gems[start-1] is_complete = False new_end = -1 shopping_bag[left_gem] -= 1 if shopping_bag[left_gem] == 0: for i in range(end+1, len(gems)): shopping_bag[gems[i]] += 1 # ì´ì „ì— ëº¸ ë…€ì„ì„ ì°¾ì€ ê²½ìš° if gems[i] == left_gem: is_complete = True new_end = i break else: is_complete = True new_end = end return is_complete, new_end ë‚´ê°€ ë°©ë¬¸í•˜ë©´ì„œ êµ¬ë§¤í•œ ë³´ì„ë“¤ì˜ ê°ê°ì˜ ê°œìˆ˜ë¥¼ ë”•ì…”ë„ˆë¦¬ë¥¼ í†µí•´ ê´€ë¦¬í–ˆë‹¤.\nì´ì „ ì‹œë„ ë•Œ êµ¬ë§¤í•œ ë³´ì„ë“¤ì˜ ê°ê°ì˜ ê°œìˆ˜ë¥¼ ì°¸ê³ í•´ ë§Œì•½ ì´ì „ì— 1ë²ˆ ë³´ì„ìƒì—ì„œ A ë³´ì„ì„ êµ¬ë§¤í•˜ëŠ” ê²ƒì„ ì‹œì‘ìœ¼ë¡œ í–ˆë‹¤ë©´ ì´ë²ˆ ì‹œë„ì—ëŠ” 2ë²ˆ ë³´ì„ìƒì—ì„œ ì–´ë–¤ ë³´ì„ì„ êµ¬ë§¤í•˜ê²Œ ë  ê²ƒì´ë‹¤. ì´ ê²½ìš° ì´ì   1ë²ˆ ë³´ì„ìƒì—ì„œ A ë³´ì„ì„ êµ¬ë§¤í•  ì¼ì´ ì—†ìœ¼ë‹ˆ ë”•ì…”ë„ˆë¦¬ì—ì„œ A ë³´ì„ì˜ ê°œìˆ˜ë¥¼ 1ê°œ ì¤„ì—¬ì£¼ê³  ì‹œì‘ì„ í•˜ëŠ” ê²ƒì´ë‹¤. ì´í›„ êµ¬ë§¤ ê°œìˆ˜ê°€ 0ê°œê°€ ë˜ëŠ” ë³´ì„ì´ ì—†ëŠ”ì§€ í™•ì¸í•˜ê³  ì¡´ì¬í•œë‹¤ë©´ í•´ë‹¹ ë³´ì„ì„ êµ¬ë§¤í•  ë•Œê¹Œì§€ ê³„ì†í•´ì„œ ë³´ì„ìƒì„ ë°©ë¬¸í•´ë‚˜ê°€ë©´ ëœë‹¤.\në³´ì„ì˜ ëª¨ë“  ì¢…ë¥˜ë¥¼ êµ¬í•˜ê¸° ìœ„í•´ì„œëŠ” Set ìë£Œ êµ¬ì¡°ë¥¼ ì´ìš©í–ˆë‹¤. êµ¬ë§¤í•œ ë³´ì„ì„ ìˆœì„œëŒ€ë¡œ ë¦¬ìŠ¤íŠ¸ë¡œ ê´€ë¦¬í•˜ë©° ë¦¬ìŠ¤íŠ¸ì— ë‚´ê°€ êµ¬ë§¤í•œ ë³´ì„ì´ ìˆëŠ”ì§€ ì°¾ëŠ” ë°©ì‹ì€ __contains__ ë¥¼ ì´ìš©í•˜ê²Œ ë˜ê³  ì´ ì‘ì—…ë§Œ ë†“ê³  ë³´ë©´ ì‹œê°„ ë³µì¡ë„ê°€ O(n)ì´ë‹¤. ë°˜ë©´ ë”•ì…”ë„ˆë¦¬ì— ê° ë³´ì„ì˜ êµ¬ë§¤ ê°œìˆ˜ë¥¼ ì´ìš©í•´ êµ¬ë§¤í•˜ì§€ ì•Šì€ ë³´ì„ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ì‘ì—…ì€ O(1)ì´ë‹¤. ë”°ë¼ì„œ ë”•ì…”ë„ˆë¦¬ë¥¼ ì´ìš©í•´ ë³´ì„ì„ êµ¬ë§¤í–ˆëŠ”ì§€ë¥¼ í™•ì¸í•˜ëŠ” ë°©ì‹ì„ ì´ìš©í–ˆë‹¤. ğŸ‘ ì‹¤íŒ¨í–ˆë˜ êµ¬í˜„ ì´ ë¶€ë¶„ì€ ê°œì¸ì ìœ¼ë¡œ ê¸°ì–µí•˜ë ¤ëŠ” ì˜ë„ë¡œ ì‘ì„±í•œ ê²ƒì´ê¸° ë•Œë¬¸ì— ì„¤ëª…ì´ ì´ìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nlistë¥¼ ì´ìš©í•´ ë‚´ê°€ êµ¬ë§¤í•œ ë³´ì„ì„ ìˆœì„œëŒ€ë¡œ ë‹´ì•˜ë˜ ë°©ì‹ ìœ„ì—ì„œë„ ì–¸ê¸‰ì€ í–ˆì§€ë§Œ listë¥¼ ì´ìš©í•´ ë‚´ê°€ êµ¬ë§¤í•œ ë³´ì„ì„ ìˆœì„œëŒ€ë¡œ ë‹´ì€ ë’¤ ì–´ë–¤ ë³´ì„ì„ ì ì–´ë„ í•œ ë²ˆ êµ¬ë§¤í•œ ì ì´ ìˆëŠ”ì§€ë¥¼ in ìœ¼ë¡œ ì°¾ëŠ” ë°©ì‹ì„ ì´ìš©í•œ ê²½ìš°ì´ë‹¤. ê²Œë‹¤ê°€ ì´ì „ ì‹œë„ì—ì„œ left_gemì„ ì œê±°í•œ ë’¤ ìƒˆë¡œìš´ shopping_bagì„ ëŒ€ì…í•˜ëŠ” ê³¼ì •ì—ì„œ ì•„ë˜ì™€ ê°™ì´ O(n)ì˜ ë³µì¡ë„ë¥¼ ê°–ëŠ” list slicingì„ ì´ìš©í•˜ë‹¤ë³´ë‹ˆ ë”ìš± ë¹„íš¨ìœ¨ì ì´ì—ˆë‹¤. í”„ë¡œê·¸ë˜ë¨¸ìŠ¤ì˜ íš¨ìœ¨ì„± í…ŒìŠ¤íŠ¸ë¥¼ 5ê°œ ì‹¤íŒ¨í–ˆë‹¤.\nshopping_bag = shopping_bag[1:] 1ë²ˆ ë°©ì‹ì„ ê°œì„ í•´ list slicingì´ ì•„ë‹Œ dequeue ìë£Œêµ¬ì¡° ì´ìš©í•˜ê¸° list slicing ì‹œ O(n)ì˜ ì‹œê°„ ë³µì¡ë„ë¥¼ ê°–ëŠ” listê°€ ì•„ë‹Œ ì•ì˜ ìš”ì†Œë¥¼ ì œê±°í•˜ë©´ì„œë„ O(1)ì˜ ì‹œê°„ ë³µì¡ë„ë¥¼ ê°–ëŠ” dequeue ìë£Œêµ¬ì¡°ë¥¼ ì´ìš©í–ˆë‹¤. í•˜ì§€ë§Œ í”„ë¡œê·¸ë˜ë¨¸ìŠ¤ íš¨ìœ¨ì„± í…ŒìŠ¤íŠ¸ë¥¼ 2ê°œ ì‹¤íŒ¨í–ˆë‹¤.\nì¦‰ ìš”ì ì€ listë“  dequeueë“  ë‘˜ ì¤‘ ë¬´ì—‡ì„ ì´ìš©í•˜ë”ë¼ë„ O(n)ì˜ ì‹œê°„ ë³µì¡ë„ë¥¼ ê°–ëŠ” inì„ í†µí•´ íŠ¹ì • ìš”ì†Œê°€ collection ë‚´ì— ì¡´ì¬í•˜ëŠ” ê²ƒì´ ë¹„íš¨ìœ¨ì ì´ë¯€ë¡œ ë”•ì…”ë„ˆë¦¬ë¥¼ ì´ìš©í•´ O(1)ì˜ ì‹œê°„ ë³µì¡ë„ë¥¼ ê°–ëŠ” ë°©ì‹ì„ ì´ìš©í•˜ëŠ” ê²ƒì´ë‹¤.\n","date":"2020-09-06T19:11:07+09:00","image":"https://umi0410.github.io/blog/algorithm/kakao-gem-shopping/illust_hucf6765420ea389d80eec71a13daa7cfd_88664_120x120_fill_q75_box_smart1.jpg","permalink":"https://umi0410.github.io/blog/algorithm/kakao-gem-shopping/","title":"2020 ì¹´ì¹´ì˜¤ ì¸í„´ì‰½ ì½”ë”© í…ŒìŠ¤íŠ¸ - ë³´ì„ ì‡¼í•‘ í’€ì´"},{"content":"Go ì–¸ì–´ë¡œ ì ìš©í•´ë³´ëŠ” Computer Scienceì˜ ì²« ë²ˆì§¸ ë‚´ìš©ìœ¼ë¡œ OS ê´€ë ¨ ë‚´ìš© ì¤‘ ì´ë¡ ì ìœ¼ë¡œëŠ” í”í•˜ê²Œ ì ‘í•  ìˆ˜ ìˆì§€ë§Œ ì‹¤ì œ ì ìš©ì— ëŒ€í•œ ë‚´ìš©ì€ ì°¾ì•„ë³´ê¸° í˜ë“¤ì—ˆë˜ Mutex, Semaphoreì— ëŒ€í•´ ì•Œì•„ë³´ë ¤í•œë‹¤.\nMutexì™€ Semaphoreì€ ê°ê°ì˜ ì¶”ìƒì ì¸ ê°œë…ì„ ë°”íƒ•ìœ¼ë¡œ OSë‚˜ Go ë“±ì—ì„œ ì‚¬ìš©ë  ìˆ˜ ìˆê¸°ì— ì„¸ë¶€ì ì¸ ë‚´ìš©ì€ ë¬¸ë§¥ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆë‹¤ê³  ìƒê°í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´ Goì—ì„œì˜ MutexëŠ” ì£¼ë¡œ sync.Mutexë¥¼ ì´ìš©í•œ ì„œë¡œ ë‹¤ë¥¸ Goroutineì˜ ë™ì‹œ ì ‘ê·¼ì— ëŒ€í•œ ì œì–´ë¥¼ ì˜ë¯¸í•˜ëŠ” ë°˜ë©´, ë‹¤ë¥¸ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë‚˜ OSì—ì„œëŠ” ì£¼ë¡œ ì„œë¡œ ë‹¤ë¥¸ Kernel threadë‚˜ Processì— ëŒ€í•œ ë™ì‹œ ì ‘ê·¼ ì œì–´ë¥¼ ì˜ë¯¸í•  ìˆ˜ ìˆë‹¤.\nMutex MutexëŠ” Mutual Exclusionì˜ ì¤„ì„ë§ë¡œ ìƒí˜¸ ë°°ì œë¥¼ ì˜ë¯¸í•œë‹¤. ì¦‰ ì„œë¡œ ë‹¤ë¥¸ ì›Œì»¤ê°€ ê³µìœ  ìì›ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì„ ì œí•œí•œë‹¤ëŠ” ë§ì´ë‹¤. Goì—ì„œëŠ” ì´ \u0026ldquo;ì›Œì»¤\u0026ldquo;ê°€ Goroutineì´ ë˜ê³ , ì»¨í…ìŠ¤íŠ¸ì— ë”°ë¼ í”„ë¡œì„¸ìŠ¤ê°€ ë  ìˆ˜ë„, ìŠ¤ë ˆë“œê°€ ë  ìˆ˜ë„ ê·¸ ì™¸ì˜ ë‹¤ë¥¸ ì¡´ì¬ê°€ ë  ìˆ˜ë„ ìˆë‹¤. ê³µìœ  ìì›ì´ë€ ì—¬ëŸ¬ ì›Œì»¤ê°€ ë™ì‹œì— ì ‘ê·¼í•˜ëŠ” ìì›ì„ ë§í•˜ê³  ì´ ê³µìœ  ìì›ì— ëŒ€í•œ ë™ì‹œ ì ‘ê·¼ì„ ì œí•œí•´ thread-safeí•˜ê²Œ ì‘ì—…í•˜ê³ ì í•˜ëŠ” ì˜ì—­ì„ Critical sectionì´ë¼ê³  í•œë‹¤. Cricical sectionì€ Mutexê°€ Lockì„ ìˆ˜í–‰í•œ ë’¤ Unlockë˜ê¸° ì „ê¹Œì§€ì˜ ì˜ì—­ì´ë©°, Lockê³¼ Unlockì€ Atomicí•œ ì‘ì—…ì´ê¸°ë•Œë¬¸ì— ì–´ë– í•œ ê²½ìš°ì—ë„ ë™ì‹œì ìœ¼ë¡œ ìˆ˜í–‰ë  ìˆ˜ ì—†ë‹¤.\nmutex-1.png ì´í•´í•˜ê¸° ì‰½ê²Œ ì˜ˆì‹œë¥¼ í†µí•´ ì ‘ê·¼í•´ë³´ê² ë‹¤. ì›ë˜ í™”ì¥ì‹¤ ì˜ˆì œë¥¼ ë³´ê³  êµ‰ì¥íˆ ì™€ë‹¿ì•˜ëŠ”ë°, í™”ì¥ì‹¤ë³´ë‹¤ëŠ” í”¼íŒ…ë£¸ì´ ì¢€ ë” ì²­ê²°í•œ ê²ƒ ê°™ì•„ì„œ í”¼íŒ…ë£¸ìœ¼ë¡œ ì˜ˆë¥¼ ë“¤ì–´ë³´ê² ë‹¤. ìš°ë¦¬ ê·€ì—¬ìš´ ê³ í¼ê°€ í”¼íŒ…ë£¸ì„ í•œ ê°œë§Œ ìš´ì˜í•˜ëŠ” ì˜·ê°€ê²Œì— ë°©ë¬¸í–ˆë‹¤ê³  ê°€ì •í•´ë³´ì.\nmutex-2.png í”¼íŒ…ë£¸ - Critical section ê³ í¼ê°€ í”¼íŒ…ë£¸ì— ë“¤ì–´ê°€ì„œ ì˜·ì„ ì…ëŠ” ì‘ì—…ì€ í•˜ë‚˜ì˜ Goroutine ë™ì‹œì— ì—¬ëŸ¬ ê³ í¼ê°€ í•˜ë‚˜ì˜ í”¼íŒ…ë£¸ì—ì„œ ì˜·ì„ ê°ˆì•„ì…ìœ¼ë ¤í•œë‹¤ë©´ ğŸ˜Ÿ ë‚œì²˜í•œ ìƒí™©ì´ ë°œìƒí•  ê²ƒì´ë‹¤. ê·¸ë ‡ê¸°ë•Œë¬¸ì— í”¼íŒ…ë£¸ì—ëŠ” Lock, Unlock ê¸°ëŠ¥ì´ ì¡´ì¬í•´ì•¼í•˜ëŠ”ë°, ì´ ê¸°ëŠ¥ì„ êµ¬í˜„í•œë‹¤í•´ë„ Atomicí•˜ê²Œ ë™ì‘í•  ìˆ˜ ìˆë„ë¡ ì œëŒ€ë¡œ êµ¬í˜„í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ í•œ ì›Œì»¤ê°€ Lockì„ í•˜ëŠ” ì‚¬ì´ì— ë‹¤ë¥¸ ì›Œì»¤ê°€ ë™ì‹œì— Lockì„ ê±¸ë ¤í•  ìˆ˜ ìˆê³ , ê·¸ ê²½ìš° ë‘ ì›Œì»¤ê°€ ë™ì‹œì— í•œ í”¼íŒ…ë£¸(Critical Section)ì—ì„œ ì‘ì—…ì„ í•˜ë ¤í•  ê²ƒì´ë‹¤. ê·¸ë ‡ê¸°ë•Œë¬¸ì— Lock, Unlockì€ Atomicí•´ì•¼í•˜ë©° ì´ë ‡ê²Œ ê° ì›Œì»¤ë¥¼ ìƒí˜¸ ë°°ì œì‹œì¼œ ë™ì‹œì— ì‘ì—…í•  ìˆ˜ ì—†ë„ë¡ í•˜ëŠ” ê²ƒì´ ë°”ë¡œ Mutexì´ë‹¤.\nMutexë¥¼ ì´ìš©í•œ Go program - Counter Count = 0ì—ì„œ ì‹œì‘í•´ ë™ì‹œì ìœ¼ë¡œ +1ì„ 10ë§Œ ë²ˆ, -1ì„ 10ë§Œ ë²ˆ ìˆ˜í–‰í•˜ëŠ” ì¹´ìš´í„° í”„ë¡œê·¸ë¨\nê·¸ëŸ¼ ì‹¤ìƒí™œì— ë¹„ìœ í•œ MutexëŠ” ì´ ì •ë„ë¡œ ë§ˆì¹˜ê³ , Mutexê°€ ì–´ë–»ê²Œ ì‚¬ìš©ë˜ëŠ”ì§€ Goë¡œ ì§  ê°„ë‹¨í•œ Counter í”„ë¡œê·¸ë¨ì„ í†µí•´ ì•Œì•„ë³´ì.\nMutexë¥¼ ì˜ ì ìš©í•œ ê²½ìš° - ëª‡ ë²ˆì„ ìˆ˜í–‰í•˜ë“  ê²°ê³¼ëŠ” 0. Mutexê°€ ì ìš©ë˜ì§€ ì•Šì€ safeí•˜ì§€ ì•Šì€ ê²½ìš° - ê²°ê³¼ê°€ 0ì´ ë‚˜ì˜¤ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤. íŠ¹íˆ Goì—ì„œëŠ” sync íŒ¨í‚¤ì§€ì˜ Mutexë¼ëŠ” typeì„ í†µí•´ ê°„ë‹¨í•˜ê²Œ Mutex ê¸°ëŠ¥ì„ ì´ìš©í•  ìˆ˜ ìˆë‹¤. ë™ì¼í•œ Mutex structë¥¼ ì°¸ì¡°í•œë‹¤ë©´ ê°™ì€ Keyë¥¼ ì´ìš©í•œë‹¤ëŠ” ê°œë…ì´ê³ , mutex.Lock()ì„ í˜¸ì¶œí•œ ë’¤ mutex.Unlock()ì´ í˜¸ì¶œë˜ê¸° ì´ì „ê¹Œì§€ê°€ Critical sectionì´ ë˜ë©° ë‹¤ë¥¸ goroutineë“¤ì€ ê°™ì€ Mutex(ì¦‰ í‚¤)ì— ì˜í•œ Critical sectionì— ì§„ì…í•  ìˆ˜ ì—†ë‹¤.\në‚´ê°€ ì²˜ìŒ Mutexë¥¼ ì²˜ìŒ ì ‘í–ˆì„ ë•Œ í•œ ê°€ì§€ í—·ê°ˆë ¸ë˜ ê²ƒì€ ë‹¹ì‹œ Critical sectionì´ë¼ëŠ” ê°œë…ì´ ì—†ì—ˆê¸° ë•Œë¬¸ì— Lockì„ í˜¸ì¶œí•˜ê¸°ë§Œ í•˜ë©´ ëŸ°íƒ€ì„ì— ì•Œì•„ì„œ ìŠ¤ë§ˆíŠ¸í•˜ê²Œ Lockê³¼ Unlockì‚¬ì´ì˜ ë³€ìˆ˜ë“¤ì— ëŒ€í•œ ì ‘ê·¼ ì¤‘ ë™ì‹œì ì¸ ì ‘ê·¼ë§Œì„ ì ì‹œ ë¸”ë½í•´ì£¼ëŠ” ì¤„ ì•Œì•˜ëŠ”ë°, ì‚¬ì‹¤ ê·¸ ì‚¬ì´ ë³€ìˆ˜ë“¤ì¤‘ ë™ì‹œì ìœ¼ë¡œ ì ‘ê·¼í•˜ë ¤ëŠ” ë³€ìˆ˜ì— ëŒ€í•´ì„œë§Œ ì ì‹œ ë¸”ë½í•´ì£¼ëŠ” ê²Œ ì•„ë‹ˆë¼ Lockê³¼ Unlock ì‚¬ì´ë¥¼ Critical sectionìœ¼ë¡œ ë§Œë“œëŠ” ê²ƒì´ì—ˆë‹¤.\nì ê·¸ëŸ¼ Countë¼ëŠ” í•˜ë‚˜ì˜ intí˜• ë³€ìˆ˜ì— ë™ì‹œì ìœ¼ë¡œ ì ‘ê·¼ì„ í•˜ëŠ” ìƒí™©ì„ ê·¹ëŒ€í™”í•˜ê¸° ìœ„í•´ ì—¬ëŸ¬ ê³ ë£¨í‹´ìœ¼ë¡œ ì‘ì—…í•´ë³´ê² ë‹¤. +1ì„ 1ë§Œ ë²ˆí•˜ëŠ” ê³ ë£¨í‹´ì„ 10ê°œ, -1ì„ 1ë§Œ ë²ˆí•˜ëŠ” ê³ ë£¨í‹´ì„ ë§ˆì°¬ê°€ì§€ë¡œ 10ê°œ ì´ìš©í•˜ê² ë‹¤.\nì „ì²´ ì½”ë“œ ì°¸ê³ : https://play.golang.org/p/xaLE1YkAdvd\noutput-1.png ìš°ë¦¬ê°€ ì¼ë°˜ì ìœ¼ë¡œ ìµìˆ™í•œ Sync ì¦‰ ë™ê¸°ì ì¸ ìˆœì°¨ì  ì§„í–‰ ì‹œì—ëŠ” ë‹¹ì—°íˆ 10ë§Œë²ˆ +1, 10ë§Œë²ˆ -1 í›„ì— ê²°ê³¼ê°€ 0ì´ì—ˆë‹¤. ë™ì‹œì  ì ‘ê·¼ì„ ìˆ˜í–‰í•˜ì 10ë§Œë²ˆ +1, 10ë§Œë²ˆ -1ì„ í–ˆì§€ë§Œ Count += 1 ì„ ìˆ˜í–‰í•˜ë˜ ì¤‘ ë˜ ë‹¤ë¥¸ Count += 1ì´ ìˆ˜í–‰ë˜ëŠ” ë“±ì˜ ì›ì¹˜ì•Šë˜ ìƒí™©ì´ ì•¼ê¸°ë  ìˆ˜ ìˆê¸°ì— ê²°ê³¼ê°’ì´ 0ì¸ ê²½ìš°ë¥¼ ì°¾ê¸° í˜ë“¤ë‹¤. ì—¬ëŸ¬ Goroutineì´ concurrentí•˜ê²Œ ì§„í–‰í•˜ë˜ Count += 1, Count -= 1 ê³¼ ê°™ì€ ë™ì‹œì  ì ‘ê·¼ì´ ìˆ˜í–‰ë˜ì–´ì„œëŠ” ì•ˆë˜ëŠ” ì˜ì—­ì€ Critical Areaë¡œ ì„¤ì •í•´ ìƒí˜¸ ë°°ì œì ìœ¼ë¡œ ì‘ì—…ë˜ê²Œ í•˜ê¸° ìœ„í•´ Critical sectionì˜ ì „/í›„ì— sync.Mutexë¥¼ ì´ìš©í•´ Lock, Unlock ê¸°ëŠ¥ì„ ë„£ì–´ì£¼ì ê¸°ëŒ€í–ˆë˜ ëŒ€ë¡œ 0ì˜ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆì—ˆë‹¤. ğŸ’¡ Mutex.. ê·¸ë˜ì„œ ì–¸ì œ ì¨ìš”? ì‚¬ì‹¤ Mutexë¼ëŠ” ê°œë…ì´ ê·¸ë ‡ê²Œ ì–´ë ¤ìš´ ê²ƒë„ ì•„ë‹ˆê³ , ì‚¬ìš©ë²• ìì²´ê°€ ì–´ë ¤ìš´ ê²ƒë„ ì•„ë‹ˆë‹¤. ë‚˜ëŠ” í•˜ì§€ë§Œ í•­ìƒ \u0026ldquo;ì–¸ì œ\u0026rdquo;, \u0026ldquo;ì™œ\u0026rdquo; ì¨ì•¼í•˜ëŠ”ì§€ë¥¼ ê¶ê¸ˆí•´í•˜ëŠ” í¸ì´ë‹¤.\nCritical sectionì—ì„œ ë§ì€ ì‹œê°„ì´ ì†Œìš”ë˜ëŠ” ê²½ìš°? â‡’ âŒ ìœ„ì˜ counterì™€ ê°™ì€ ì‘ì—…ì€ ëŒ€ë¶€ë¶„ì˜ ì‘ì—…ì´ critical section ì†ì— ìˆë‹¤ê³  ë³¼ ìˆ˜ ìˆë‹¤. ì´ ê²½ìš° ë™ì‹œì ì¸ ì‘ì—…ê³¼ í•¨ê»˜ Lock, Unlockì„ í•˜ë©° critical sectionì„ ê´€ë¦¬í•˜ëŠ” ê²ƒë³´ë‹¤ ì• ì´ˆì— ì‘ì—… ìì²´ë¥¼ ë™ê¸°ì ìœ¼ë¡œ ìˆ˜í–‰í•˜ëŠ” ê²Œ ë‚˜ì„ ìˆ˜ ìˆë‹¤. ì™œëƒí•˜ë©´ ë™ì‹œì  ì‘ì—… ì†ì—ì„œ Mutexë¥¼ í†µí•´ ë™ê¸°ì ìœ¼ë¡œ ì‘ì—…í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê²ƒì—ì„œ ì˜¤ëŠ” ì˜¤ë²„í—¤ë“œëŠ” ë¶„ëª…íˆ ì¡´ì¬í•˜ê³ , Critical section ë°–ì—ì„œ íš¨ìœ¨ì ìœ¼ë¡œ ë™ì‹œì ìœ¼ë¡œ ì‘ì—…ì„ ì§„í–‰í–ˆë‹¤í•˜ë”ë¼ë„ critical sectionì—ì„œ ë³‘ëª©ì´ ë°œìƒí•´ë²„ë ¤ ì „ì²´ì ì¸ Throughputì´ ì•ˆ ì¢‹ì•„ì§ˆ ê²ƒì´ë‹¤. Critical sectionì—ì„œëŠ” ì ì€ ì‹œê°„ì´ ì†Œìš”ë˜ê³ , ëŒ€ë¶€ë¶„ì€ ë™ì‹œì ìœ¼ë¡œ ì‘ì—…ì´ ê°€ëŠ¥í•œ ê²½ìš°? â‡’ â­• ì˜ˆë¥¼ ë“¤ì–´ ì–´ë–¤ APIë¥¼ ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œí•œ ë’¤ ê·¸ ì‘ë‹µ ì¤‘ ì¼ë¶€ë¥¼ ê³„ì†í•´ì„œ ë”í•´ ê²°ê³¼ë¥¼ ë‚´ëŠ” Reduce ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤ê³  ì¹˜ì. ìˆœì°¨ì ìœ¼ë¡œ ìˆ˜í–‰í•  ì‹œ ì˜¤ëœ ì‹œê°„ì´ ì†Œìš”ë  API í˜¸ì¶œì€ ë™ì‹œì ìœ¼ë¡œ ì§„í–‰í•˜ê³ , ê²°ê³¼ì— ëŒ€í•œ Reduce ì‘ì—…ë§Œ ì ì‹œ Critical sectionë‚´ì—ì„œ ì‘ì—…í•œë‹¤ë©´ ì•„ì£¼ ì¢‹ì€ ì„±ëŠ¥ê³¼ í•¨ê»˜ ì•ˆì „í•˜ê²Œ ì‘ì—…í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤! Semaphore semaphore.png Mutexì—ì„œ ëŒ€ë¶€ë¶„ì˜ Lockì´ë‚˜ Critical sectionì— ëŒ€í•œ ë‚´ìš©ì„ ì„¤ëª…í–ˆê¸° ë•Œë¬¸ì— Semaphoreì—ì„œ ë” ì„¤ëª…í•  ë‚´ìš©ì´ ë§ì§€ëŠ” ì•Šë‹¤. Semaphoreì˜ ë™ì‘ì— ëŒ€í•œ ê°„ë‹¨í•œ ì˜ˆì‹œëŠ” ìœ„ì˜ ê·¸ë¦¼ê³¼ ê°™ì€ë°, 5ë§ˆë¦¬ì˜ ê³ í¼ê°€ ì¡´ì¬í•œë‹¤í•´ë„ ë™ì‹œì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œí•˜ëŠ” ê³ í¼ë¥¼ 3ê°œë¡œ ì œí•œí•œë‹¤ë©´ 2ë§ˆë¦¬ì˜ ê³ í¼ëŠ” í”¼íŒ…ë£¸ì— ë“¤ì–´ê°€ì§€ ëª»í•˜ê³  ë¸”ë½ëœë‹¤. Lockedì™€ Unlocked ìƒíƒœ ë¿ì¸ Mutexì™€ ë‹¬ë¦¬ SemaphoreëŠ” ì„ì˜ì˜ ê°œìˆ˜ë¥¼ ì„¸ëŠ” Counterì²˜ëŸ¼ ë™ì‘í•´ ì„ì˜ì˜ ê°œìˆ˜ì˜ ì›Œì»¤ë§Œì´ Critical sectionì— ë™ì‹œì ìœ¼ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.\nCounterë¥¼ ì˜ˆë¡œ ë“¤ìë©´ 10ê°œì˜ ì›Œì»¤ê°€ ì¡´ì¬í•œë‹¤í•´ë„ \u0026ldquo;5\u0026quot;ë¥¼ ì„¸ëŠ” SemaphoreëŠ” í•œ ì›Œì»¤ê°€ Critical sectionì— ì§„ì…í•  ë•Œë§ˆë‹¤ Counter ê°’ì„ 1ì”© ë‚®ì¶”ê³ , Critical sectionì„ íƒˆì¶œí•  ë•Œë§ˆë‹¤ Counter ê°’ì„ ë‹¤ì‹œ 1ì”© ë†’ì¸ë‹¤. ë§Œì•½ ì–´ë–¤ ì›Œì»¤ê°€ Critical sectionì— ì§„ì…í•˜ë ¤ëŠ”ë° Count ê°’ì´ 0ì´ë¼ë©´ ì´ˆê¸°ì— ê³„íší–ˆë˜ ëŒ€ë¡œ 5ê°œì˜ ì›Œì»¤ê°€ ì´ë¯¸ ë™ì‹œì ìœ¼ë¡œ ì‘ì—…ì¤‘ì´ë¼ëŠ” ì˜ë¯¸ì´ë¯€ë¡œ ì´ ì›Œì»¤ëŠ” í•œ ì›Œì»¤ê°€ Critical sectionì„ ë‚˜ì˜¤ë©´ì„œ Counter ê°’ì„ ë‹¤ì‹œ 1 ì¦ê°€ì‹œí‚¬ ë•Œê¹Œì§€ Blockëœë‹¤.\nMutexì˜ Lockê³¼ Unlockì´ Atomicí•˜ê¸°ì— ì–´ë– í•œ ê²½ìš°ì—ë„ ë™ì‹œì ìœ¼ë¡œ ìˆ˜í–‰ë  ìˆ˜ ì—†ì—ˆë“¯ì´ Semaphoreì˜ Counting ì‘ì—… ë˜í•œ Atomicí•´ì•¼í•˜ê³  ê·¸ë˜ì•¼ë§Œ Thread-safeí•œ counterë¡œ ë™ì‘í•  ìˆ˜ ìˆë‹¤. Semaphoreê°€ ìˆ˜í–‰í•˜ëŠ” Counting ì‘ì—…ì€ ì£¼ë¡œ tryë¥¼ ëœ»í•˜ëŠ” ë„¤ëœë€ë“œì–´ Proberenì˜ ì• ê¸€ìë¥¼ ë”´ Pì™€ incrementë¥¼ ëœ»í•˜ëŠ” Verhogenì˜ ì• ê¸€ìë¥¼ ë”´ Vë¡œ ë‘ ê°€ì§€ê°€ í‘œí˜„í•˜ëŠ” ë“¯í•˜ë‹¤. PëŠ” Count ê°’ì´ 0ì´ ì•„ë‹ˆë©´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê² ë‹¤ëŠ” ì˜ë¯¸í•˜ë©° ë§Œì•½ Count ê°’ì´ 0ì´ë¼ë©´ 0ì´ ì•„ë‹Œ ê°’ì´ ë  ë•Œê¹Œì§€ waití–ˆë‹¤ê°€ 0 ì•„ë‹Œ ê°’ì´ ë˜ë©´ count ê°’ì„ 1 ê°ì†Œì‹œí‚¤ë©° ì‘ì—…ì„ ì‹œì‘í•œë‹¤. VëŠ” ì‘ì—…ì„ ë§ˆì¹˜ë©° count ê°’ì„ ë‹¤ì‹œ 1 ì¦ê°€ì‹œí‚¤ê² ë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.\nMutexì™€ Binary semaphoreì˜ ìœ ì‚¬í•œ ì  ë™ì‹œ ì ‘ê·¼ ì›Œì»¤ë¥¼ 1ê°œë¡œ ì œí•œí•˜ëŠ” Semaphoreì˜ ê²½ìš° Count ê°’ì´ 0ê³¼ 1 ë‘ ê°œë¡œë§Œ ì¡´ì¬í•  ìˆ˜ ìˆëŠ”ë° ì´ë¥¼ Binary semaphoreë¼ê³ í•œë‹¤. íŠ¹íˆ ì´ëŠ” Lockedì™€ Unlockedë¼ëŠ” ë‘ ê°€ì§€ì˜ ìƒíƒœë§Œì„ ê°–ëŠ” Mutexì™€ ìœ ì‚¬í•˜ë‹¤. í•˜ì§€ë§Œ Binary semaphoreëŠ” mutexê°€ ìœ ì‚¬í•œ ê¸°ëŠ¥ì„ í•  ë¿ ë™ì¼í•˜ì§€ëŠ” ì•Šë‹¤ëŠ” ì˜ê²¬ì´ ë§ë‹¤. ê·¸ ì´ìœ ëŠ” MutexëŠ” Lock ë°©ì‹ì„ ì´ìš©í•˜ê³  SemaphoreëŠ” Signal(ì‹ í˜¸) ë°©ì‹ì„ ì´ìš©í•˜ê¸° ë•Œë¬¸ì´ë‹¤. Lock ë°©ì‹ì˜ ê²½ìš° Lockì„ ìˆ˜í–‰í•œ ì›Œì»¤ë§Œì´ Unlockì„ í•  ìˆ˜ ìˆëŠ” ë°˜ë©´ Signal ë°©ì‹ì€ try(ì‘ì—… ì‹œë„)ë¥¼ ìˆ˜í–‰í•œ ì›Œì»¤ê°€ ì•„ë‹ˆë”ë¼ë„ increment(ì‘ì—… ì™„ë£Œ) ì‹ í˜¸ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆê¸°ì— ì„œë¡œ ëª…ë°±íˆ ë™ì‘ ë°©ì‹ì´ ë‹¤ë¥´ë‹¤ëŠ” ê²ƒì´ë‹¤. (í•˜ì§€ë§Œ ì´ ë¶€ë¶„ì— ëŒ€í•´ì„œëŠ” ì§ì ‘ ì‹¤ìŠµí•´ë³´ì§€ëŠ” ëª»í–ˆë‹¤.)\n*Semaphoreë¥¼ ì´í•´í•˜ëŠ” ë°ì— ìˆì–´ ë‚´ê°€ ì°©ê°í•´ì„œ í—¤ë§¸ë˜ ë¶€ë¶„ì€ ë°”ë¡œ Semaphoreì˜ ìš”ì ì´ thread-safeí•œ countë¼ê³  ì°©ê°*í–ˆë˜ ê²ƒì´ë‹¤. í•˜ì§€ë§Œ semaphoreì˜ ìš”ì ì€ ì—¬ëŸ¬ ì›Œì»¤ì— ëŒ€í•´ì„œ thread safeí•œ count ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì„ì˜ì˜ ìˆ«ìë§Œí¼ì˜ ë™ì‹œì  ì ‘ê·¼ì„ í—ˆìš©í•˜ê³ , ê·¸ ì´ìƒì€ Block ìƒíƒœë¡œ ëŒ€ê¸°ì‹œí‚¨ë‹¤ëŠ” ê²ƒì´ë‹¤.\nSemaphoreë¥¼ ì´ìš©í•œ Go Program 1 - Counter goì—ì„œ Semaphoreë¥¼ ì´ìš©í•˜ëŠ” ë°©ë²•ì€ í¬ê²Œ 2ê°€ì§€ê°€ ìˆëŠ” ê²ƒ ê°™ë‹¤. ì•„ë˜ ë‘ ê°€ì§€ ë°©ë²• ì¤‘ ì¢€ ë” GoìŠ¤ëŸ¬ìš´ channelì„ ì´ìš©í•´ë³´ê² ë‹¤.\nGo íŠ¹ìœ ì˜ ìë£Œí˜•ì¸ channelì„ ì´ìš©í•˜ê¸° - channelì€ ì—¬ëŸ¬ goroutineì˜ concurrentí•œ ì‘ì—…ê°„ ë°ì´í„° ì „ì†¡ì€ ë¬¼ë¡ ì´ê³  ë™ì‹œì ì¸ ì‘ì—… ì¤‘ ë°ì´í„°ë¥¼ í¸ë¦¬í•˜ê²Œ ë™ê¸°í™”í•´ì£¼ëŠ” ë…€ì„ì´ë‹¤. ë”°ë¼ì„œ ë™ê¸°ì ì¸ countì™€ ìœ ì‚¬í•œ ê¸°ëŠ¥ì„ ë‚´ì¬í•˜ê³ ìˆë‹¤. golang.org/x/sync/semaphoreì˜ Weightedë¥¼ ì´ìš©í•˜ê¸° - Semaphoreì˜ Pë¥¼ Acquire, Vë¥¼ Releaseë¡œ êµ¬í˜„í•´ ì´ìš©í•  ìˆ˜ ìˆê²Œ í–ˆë‹¤. ì „ì²´ ì½”ë“œëŠ” Mutexì™€ ë™ì¼í•˜ë©° ë§ˆì°¬ê°€ì§€ë¡œ ë‹¤ìŒ ë§í¬ë¡œ ì°¸ê³ í•´ë³¼ ìˆ˜ ìˆë‹¤: https://play.golang.org/p/xaLE1YkAdvd\nBuffered channelì„ ì´ìš©í•œ Semaphore in Go func DoSemaphore(maxConcurrent int64){ for i := 0; i \u0026lt; 5; i++{ Count = 0 wg := \u0026amp;sync.WaitGroup{} sem := make(chan struct{}, maxConcurrent) wg.Add(20) for i := 0; i \u0026lt; 10; i++{ go Add1Sem(wg, sem) go Sub1Sem(wg, sem) } wg.Wait() fmt.Println(\u0026#34;Concurrent goroutines + Semaphore\u0026#34;, maxConcurrent, \u0026#34;Result(Desired 0):\u0026#34;, Count, \u0026#34;\u0026#34;) } fmt.Println(\u0026#34;=====================================\u0026#34;) } func Sub1Sem(wg *sync.WaitGroup, sem chan struct{}){ defer wg.Done() for i := 0; i \u0026lt; 10000; i++{ sem \u0026lt;- struct{}{} Count -= 1 \u0026lt;-sem } } channelì„ ì´ìš©í•œ Semaphore ì½”ë“œë¥¼ ì„¤ëª…í•˜ê¸° ìœ„í•´ ì „ì²´ ì½”ë“œ ì¤‘ ì¼ë¶€ë¥¼ ê°€ì ¸ì™€ë³´ì•˜ë‹¤. Semaphoreë¥¼ ì´ìš©í•˜ê¸° ìœ„í•´ Unbuffered channelì´ ì•„ë‹Œ Buffered channelì„ ì´ìš©í•˜ëŠ” ì´ìœ ëŠ” ë‹¤ìŒê³¼ ê°™ì€ Unbuffered channelì˜ ë™ì‘ ë°©ì‹ì´ Semaphoreì˜ ë™ì‘ ë°©ì‹ê³¼ ë™ì¼í•˜ê¸° ë•Œë¬¸ì´ë‹¤.\nBufferì˜ í¬ê¸°ë§Œí¼ì€ ë™ì‹œì ìœ¼ë¡œ channelì— ê°’ì„ ë„£ìœ¼ë ¤ëŠ” ì‹œë„ê°€ í—ˆìš©ë¨. buffered channelì´ ê½‰ ì°¬ ê²½ìš° ì±„ë„ì—ì„œ ê°’ì„ êº¼ë‚´ì§€ ì•ŠëŠ” ì´ìƒì€ ì¶”ê°€ì ìœ¼ë¡œ Channelì— ê°’ì„ ë„£ìœ¼ë ¤ì‹œë„í•˜ëŠ” goroutineì€ Blockë¨. output-2.png (ì•ì„œ ì½”ë“œë¥¼ ë§í¬í•œ go playgroundì—ì„œ ì½”ë“œë¥¼ ë°”ë¡œ ì‹¤í–‰í•´ë³¼ ìˆ˜ ìˆë‹¤.)\në™ì‹œ ì ‘ê·¼ ì›Œì»¤ë¥¼ 1ê°œë¡œ ì œí•œí•˜ëŠ” SemaphoreëŠ” Binary Semaphoreë¡œì„œ Mutexë¥¼ ì´ìš©í–ˆì„ ë•Œì™€ ìœ ì‚¬í•˜ë‹¤ê³  ë§í–ˆë“¯ì´ thread-safeí•˜ê²Œ count ì‘ì—…ì´ ì´ë£¨ì–´ì ¸ ì˜ˆìƒë˜ëŠ” ê°’ì´ì—ˆë˜ 0ì´ ì¶œë ¥ë¨ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ ë™ì‹œì ‘ê·¼ì´ ê°€ëŠ¥í•œ ì›Œì»¤ê°€ 1ê°œ ì´ìƒì´ ë˜ë©´ thread-safeí•˜ì§€ ì•Šê²Œ ë˜ê³ , ë™ì‹œì ‘ê·¼ ì›Œì»¤ ê°œìˆ˜ê°€ ë§ì•„ì§ˆìˆ˜ë¡ ê²°ê³¼ê°€ ë” ë¶€ì •í™•í•œ ê²½í–¥ì´ ìˆëŠ” ê²ƒìœ¼ë¡œ ë‚˜íƒ€ë‚¬ë‹¤.\nğŸ’¡ Semaphore.. ê·¸ë˜ì„œ ì–¸ì œ ì“°ë‚˜ìš”? MutexëŠ” thread-safeí•œ ì‘ì—…ì„ í•  ë•Œ ì‚¬ìš©í•˜ë©´ ë˜ëŠ” ê²ƒ ê°™ì€ë° SemaphoreëŠ” ê°œë…ì€ ì•Œê² ëŠ”ë° ì–¸ì œ ì¨ì•¼í•  ì§€ë¥¼ ì˜ ëª¨ë¥´ê² ë„¤ìš”. ì¼ì • ê°œìˆ˜ë§Œí¼ë§Œ ë™ì‹œ ì ‘ê·¼ì„ í—ˆìš©í•˜ë ¤ëŠ” ê²½ìš°ê°€ ìˆì„ê¹Œìš”?\nSemaphoreì„ ì‚¬ìš©í•˜ê¸° ì¢‹ì€ ì¼€ì´ìŠ¤ëŠ” ë™ì‹œì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ì›Œì»¤ ìˆ˜ë¥¼ ì œí•œí•˜ëŠ” ê²½ìš°ì´ê³ , ì´ëŠ” ì£¼ë¡œ ì „ì²´ ì‘ì—…ì´ ëŠ˜ì–´ì§€ëŠ” ê²ƒì„ ë°©ì§€í•˜ê³ ì í•˜ëŠ” ê²½ìš°ì— ì´ìš©ëœë‹¤. ë§ì€ ì‘ì—…ì„ ë™ì‹œì— ìˆ˜í–‰í•˜ë ¤í•˜ë©´ ë¨¼ì € ìˆ˜í–‰ë  ìˆ˜ ìˆëŠ” ì‘ì—…ì€ ë¨¼ì € ìˆ˜í–‰ë˜ë„ë¡ í•˜ê¸°ë³´ë‹¤ëŠ” ì „ì²´ì ìœ¼ë¡œ ëª¨ë“  ì‘ì—…ì´ ëŠ˜ì–´ì§€ê²Œ ë˜ê³  CPUë‚˜ Memory ë¦¬ì†ŒìŠ¤ë¥¼ ë§ì´ ì†Œëª¨í•˜ê²Œ ë˜ê³  ì´ëŠ” ì„œë²„ì˜ ì•ˆì •ì„±ì—ë„ ì¢‹ì§€ ì•Šë‹¤. Semaphoreë¥¼ ì´ìš©í•´ ë™ì‹œ ì ‘ê·¼ ì›Œì»¤ ìˆ˜ë¥¼ ì œí•œí•˜ê³ ìí•˜ëŠ” ì¼€ì´ìŠ¤ëŠ” Goì˜ Worker pool íŒ¨í„´ì„ ì´ìš©í•˜ëŠ” ê²½ìš°ë‚˜ Pipeline patternì„ ì´ìš©í•˜ëŠ” ê²½ìš°ì™€ ìœ ì‚¬í•˜ë‹¤.(ì²˜ìŒì—” Goì˜ ëª¨ë“  Concurrent patternë“¤ì„ ê°œë³„ì ìœ¼ë¡œ êµ¬ë³„ì§€ìœ¼ë ¤í–ˆì—ˆëŠ”ë°, ê³µë¶€í•˜ë‹¤ë³´ë‹ˆ ì¼ì •í•œ ê°œìˆ˜ì˜ Workerë¥¼ ì´ìš©í•˜ëŠ” Worker Pool pattern, Channelì„ ê¸°ë°˜ìœ¼ë¡œ ì‘ì—… ë‚´ì—­ì„ ìª¼ê°œì–´ ì‹¤ì‹œê°„ ì²˜ë¦¬í•˜ëŠ” Pipeline, í•œ ì±„ë„, ì—¬ëŸ¬ Goroutineì„ ì´ìš©í•˜ëŠ” Fan-in Fan-out pattern ë“±ë“± ë‹¤ë“¤ ìœ ì‚¬í•˜ê³  ì—°ê´€ì´ ë˜ì–´ìˆë”ë¼.)\nSemaphoreë¡œ ë™ì‹œ ì ‘ê·¼ Worker ìˆ˜ë¥¼ ì œí•œí•˜ì§€ ì•Šê³  ëª¨ë“  Goroutineì„ ë™ì‹œì ìœ¼ë¡œ ìˆ˜í–‰í•˜ëŠ” ê²½ìš°ì—” ì–´ë–»ê²Œ ë ê¹Œ?\nLogical Processor ê°œìˆ˜ë¥¼ í›¨ì”¬ ë„˜ëŠ” ëª¨ë“  Goroutine ë™ì‹œì ìœ¼ë¡œ ì‘ì—…ì„ ì§„í–‰í•  ê²½ìš° ì•„ë¬´ë¦¬ Goroutineì´ concurrentí•œ ì‘ì—… ìˆ˜í–‰ì— ë›°ì–´ë‚œ ì„±ëŠ¥ì„ ë³´ì¸ë‹¤í• ì§€ë¼ë„ ê³¼í•˜ê²Œ ë§ì€ ìˆ˜ì˜ Goroutineì€ ì„±ëŠ¥ ì €í•˜ë¥¼ ì•¼ê¸°í•˜ì§€ ì•Šì„ê¹Œ ì˜ˆìƒí–ˆë‹¤. í•˜ì§€ë§Œ user-level thread í˜¹ì€ green level threadì˜ ì¼ì¢…ì¸ Goroutineì€ OS(í˜¹ì€ Kernel) threadì™€ ë‹¬ë¦¬ Context switchë¡œ ì¸í•œ penaltyê°€ ê±°ì˜ ì—†ì–´ì„œì¸ì§€ ê±°ì˜ Throughput ë©´ì—ì„œì˜ ì„±ëŠ¥ ì°¨ì´ê°€ ì—†ì—ˆë‹¤.\nKernel level threadëŠ” OSê°€ ìŠ¤ì¼€ì¥´ë§ì„ ë‹´ë‹¹í•˜ê¸° ë•Œë¬¸ì— Go í”„ë¡œê·¸ë¨ì´ ë­ ì–´ë–»ê²Œ í•  ìˆ˜ ìˆëŠ” ê²Œ ì•„ë‹ˆì§€ë§Œ Goroutineì€ í”„ë¡œê·¸ë¨ì´ ì‹¤í–‰ë˜ëŠ” ë™ì•ˆ Go ëŸ°íƒ€ì„ì´ ìŠ¤ì¼€ì¥´ë§ì„ ë‹´ë‹¹í•œë‹¤. ê°™ì€ Kernel level threadì— ì†í•œ User level threadì¸ goroutineê°„ì˜ switchëŠ” costê°€ ê±°ì˜ ì—†ë‹¤. ì¦‰ goroutineì´ ë§ë“  ì ë“  Kernel level threadê°„ì˜ context switch costëŠ” ë™ì¼í•˜ë‹¤ê³  ë³¼ ìˆ˜ ìˆê³ , í•´ë‹¹ Kernel level threadì— ì†í•œ goroutineê°„ì˜ context switch costëŠ” ê±°ì˜ ì—†ë‹¤.\nì°¸ê³ : Kernel level threadì— ëŒ€í•œ ìŠ¤ì¼€ì¥´ë§ì€ ì£¼ë¡œ Preemptive ë°©ì‹ì„, User level threadì— ëŒ€í•œ ìŠ¤ì¼€ì¥´ë§ì€ ì£¼ë¡œ Cooperativeí•œ ë°©ì‹ì„ ì´ìš©í•˜ì§€ë§Œ Goroutineì€ User level threadì„ì—ë„ Go 1.14 ë²„ì „ë¶€í„°ëŠ” 10nsë¥¼ ê¸°ì¤€ìœ¼ë¡œ goroutineì„ switch í•  ìˆ˜ ìˆëŠ” asynchronously preemptiveí•œ ìŠ¤ì¼€ì¥´ ë°©ì‹ì„ ì§€ì›í•œë‹¤ê³  í•œë‹¤. í•˜ì§€ë§Œ Go 1.14ê°€ ë¦´ë¦¬ì¦ˆëœ ì§€ ì–¼ë§ˆë˜ì§€ ì•Šì•„ì„œì¸ì§€, asynchorously preemptive schedulingì— ëŒ€í•´ì„œëŠ” ëª…í™•íˆ ì„¤ëª…ëœ ë¬¸ì„œë¥¼ ì°¾ê¸° í˜ë“¤ì—ˆë‹¤. User level threadì˜ ì˜ˆë¡œëŠ” RxJava in Java, Coroutine in Kotlin, Goroutine in Golangì´ ìˆë‹¤.\ní•˜ì§€ë§Œ Throughput ì ì¸ ì¸¡ë©´ë³´ë‹¤ëŠ” Machineì˜ Resource ì†Œëª¨ ì¸¡ë©´ì—ì„œëŠ” ëª¨ë“  Goroutineì´ ë™ì‹œì ìœ¼ë¡œ ìˆ˜í–‰ë˜ëŠ” êµ¬ì¡°ë³´ë‹¤ëŠ” Semaphoreì„ ë°”íƒ•ìœ¼ë¡œí•œ ë™ì‹œì— ì¼ì • ê°œìˆ˜ì˜ ì›Œì»¤ë§Œì´ ì‘ì—…í•˜ëŠ” Worker Pool êµ¬ì¡°ê°€ í›¨ì”¬ Memoryë‚˜ CPU ë¦¬ì†ŒìŠ¤ë¥¼ ì ê²Œ ì†Œëª¨í•˜ëŠ” ë“¯ í–ˆë‹¤. ë˜í•œ 100ê°œì˜ ë™ì‹œ ìš”ì²­ì„ ìˆ˜í–‰í•˜ëŠ”ë° ë™ì¼í•œ Throughputìœ¼ë¡œ ì•½ 10ì´ˆê°€ ê±¸ë¦°ë‹¤ê³  ì¹˜ë©´, ìš”ì²­ë‹¹ goroutineì„ ìƒì„±í•˜ëŠ” ê²½ìš°ëŠ” ì²« ë²ˆì§¸ ìš”ì²­ë„ ê±°ì˜ 10ì´ˆê°€ ê±¸ë¦° ë°˜ë©´ Semaphoreì„ ì´ìš©í•œ ê²½ìš°ëŠ” ë¨¼ì € ì˜¨ ìš”ì²­ì€ ëŒ€ì²´ë¡œ ë¹ ë¥´ê²Œ ë¨¼ì € ì²˜ë¦¬ë˜ëŠ” ê²½í–¥ì„ ë³´ì˜€ë‹¤. ì´ ì°¨ì´ëŠ” ì²˜ìŒ ìš”ì²­ì„ ë³´ë‚¸ ì‚¬ìš©ì ë§ˆì € 10ì´ˆë¥¼ ê¸°ë‹¤ë¦¬ê²Œ í•  ê²ƒì´ëƒ, 0.1ì´ˆë§Œì— ì‘ë‹µì„ ë°›ë„ë¡ í•  ê²ƒì´ëƒì˜ ì°¨ì´ì´ë‹¤. ë˜í•œ ì „ì²´ ì‘ì—…ì´ ëŠ˜ì–´ì§€ë©´ ê·¸ ì‘ì—…ì— ëŒ€í•œ ë©”ëª¨ë¦¬ ì ìœ ê°€ ì§€ì†ë˜ê¸°ì— ë©”ëª¨ë¦¬ ì¸¡ë©´ì—ì„œë„ ë¹„íš¨ìœ¨ì ì´ë‹¤.\nSemaphoreì„ ì´ìš©í•œ Go Program 2 - ì´ë¯¸ì§€ í¬ê¸° ë³€í™˜ê¸° ë§ˆì¹¨ ì´ë²ˆì— í”„ë¡œì íŠ¸ì—ì„œ thumbnail ìƒì„±, image í¬ê¸° ë³€í™˜, hashed uri ìƒì„± ì‘ì—… ë“±ì„ ë‹´ë‹¹í•˜ëŠ” image processing ì„œë²„ë¥¼ ê°œë°œí•˜ë ¤í–ˆëŠ”ë°, imageë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” I/O ì‘ì—… ì´í›„ì˜ image processingì€ CPU Bound í•œ ì‘ì—…ì´ê¸° ë•Œë¬¸ì— ë™ì‹œì ìœ¼ë¡œ ë™ì‘í•˜ëŠ” Goroutineì´ ì¼ì • ìˆ«ì(ëŒ€ê²Œ Logical Processor ê°œìˆ˜) ì´ìƒìœ¼ë¡œëŠ” ë§ì•„ì ¸ë´¤ì í¬ê²Œ íš¨ìœ¨ì´ ì—†ì„ ê²ƒì´ë¼ ì˜ˆìƒí–ˆê³ , ê·¸ì™€ ê´€ë ¨í•´ ê°„ë‹¨í•˜ê²Œ ì´ë¯¸ì§€ í¬ê¸° ë³€í™˜ í”„ë¡œê·¸ë¨ì„ í•˜ë‚˜ ë§Œë“¤ì–´ í…ŒìŠ¤íŠ¸ í•´ë³´ì•˜ë‹¤.\nì•½ 2MBì˜ ì´ë¯¸ì§€ì— ëŒ€í•œ í¬ê¸° ë³€í™˜ ì‘ì—… ìš”ì²­ì´ ë™ì‹œì— 30ê°œ ë“¤ì–´ì™”ë‹¤ëŠ” ê°€ì •ì„ í–ˆê³ , semaphoreì„ ì´ìš©í•œ ê²½ìš° ë™ì‹œì ìœ¼ë¡œ ìµœëŒ€ 4ê°œì˜ worker(goroutine)ì´ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆê²Œ, concurrentë¥¼ ì´ìš©í•œ ê²½ìš°ëŠ” 30ê°œì˜ ìš”ì²­ ëª¨ë‘ ë™ì‹œì ìœ¼ë¡œ ì‘ì—…ì„ í•˜ëŠ” ê²½ìš°ì´ë‹¤.\n(ì½”ë“œ ì°¸ê³ (ì¸í„°ë„· ì•¡ì„¸ìŠ¤ë¥¼ í•˜ëŠ” ê²½ìš° Playgroundì—ì„œ ë™ì‘í•˜ì§€ëŠ” ì•ŠëŠ”ë“¯í•˜ë‹¤): https://play.golang.org/p/Vfyw6uCOIuL)\nì‚¬ì‹¤ Logical Processor 8ê°œ, RAM 16GBì˜ ê°œì¸ ë…¸íŠ¸ë¶ìœ¼ë¡œëŠ” ê·¸ ì°¨ì´ê°€ ë§ì´ ë‚˜ì§€ëŠ” ì•Šì•„ì„œ AWS EC2 t2.micro instanceì—ì„œ ì„±ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•´ë´¤ë‹¤.\nubuntu@ip-172-31-12-2:~$ ./sem semaphore ë³€í™˜í•˜ê³ ìí•˜ëŠ” Imageë“¤ì„ ë©”ëª¨ë¦¬ì— Loadí–ˆìŠµë‹ˆë‹¤. 2021/01/18 20:28:13 Elapsed: 1.974380959s ... ìƒëµ 2021/01/18 20:28:26 Elapsed: 1.159552779s 2021/01/18 20:28:26 Elapsed: 1.016627316s 2021/01/18 20:28:26 Total elapsed: 14.959516003s ubuntu@ip-172-31-12-2:~$ ./sem concurrent ë³€í™˜í•˜ê³ ìí•˜ëŠ” Imageë“¤ì„ ë©”ëª¨ë¦¬ì— Loadí–ˆìŠµë‹ˆë‹¤. Killed ë†€ëê²Œë„ ë™ì‹œì ìœ¼ë¡œ 30ê°œì˜ ìš”ì²­ì„ ë³´ë‚´ëŠ” ê²½ìš°ì— 30ê°œì˜ ëª¨ë“  goroutineì´ ë™ì‹œì— ì‘ì—…ì„ ì‹œë„í•  ë•Œì—ëŠ” ê³¼ë„í•œ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ìœ¼ë¡œ ì¸í•´ ì•„ì˜ˆ OSê°€ í”„ë¡œì„¸ìŠ¤ë¥¼ Killí•´ë²„ë ¸ë‹¤. ì¦‰ Semaphoreë¡œ ë™ì‹œ ì ‘ê·¼ Worker ìˆ˜ë¥¼ ì œí•œí•˜ì§€ ì•ŠëŠ” ê²½ìš° t2.micro ì¸ìŠ¤í„´ìŠ¤ë¡œ ëŒë¦¬ëŠ” image ì„œë²„ì— ë™ì‹œì— 30ê°œì˜ image resizing ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ processê°€ ì£½ì–´ë²„ë¦°ë‹¤ëŠ” ë§ì´ë‹¤\u0026hellip;!\në˜í•œ ì•ì„œ ë§í–ˆë“¯ì´ ë™ì‹œì— ìš”ì²­í•˜ëŠ” ì‚¬ìš©ìê°€ ë§ì•„ì§€ë”ë¼ë„ Semaphoreì„ ì´ìš©í•œ ê²½ìš°ëŠ” ë‚˜ì¤‘ì— ë“¤ì–´ì˜¨ ìš”ì²­ì¼ ìˆ˜ë¡ ì²˜ë¦¬ê°€ ëŠ˜ì–´ì§€ì§€ë§Œ, Semaphoreë¥¼ í†µí•´ ë™ì‹œ ì‘ì—…ì„ ì œí•œí•˜ì§€ ì•ŠëŠ” ê²½ìš°ëŠ” ì „ì²´ ì‘ì—…ì´ ëŠ˜ì–´ì§„ë‹¤.\nì´ë ‡ê²Œ SemaphoreëŠ” ë™ì‹œ ì ‘ê·¼ ì›Œì»¤ ìˆ˜ë¥¼ ì œí•œí•˜ì—¬ ì „ì²´ì ì¸ Throughput ì¸¡ë©´ë³´ë‹¤ëŠ” ë¦¬ì†ŒìŠ¤ ì†Œëª¨ì ì¸ ì¸¡ë©´ê³¼ ë¨¼ì € ì²˜ë¦¬ë  ìˆ˜ ìˆëŠ” ì‘ì—…ì€ ë¨¼ì € ì²˜ë¦¬ë˜ë„ë¡ í•  ìˆ˜ ìˆë‹¤ëŠ” ë©´ì—ì„œ ì¥ì ì´ ìˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤.\në§ˆì¹˜ë©° Mutexë‚˜ Semaphoreì˜ ê°œë…ì´ë‚˜ ì„¤ëª…ê³¼ ê°™ì€ ì´ë¡ ì ì¸ ë‚´ìš©ì€ êµ¬ê¸€ë§ì„ í†µí•´ ì–´ë µì§€ ì•Šê²Œ ì–»ì„ ìˆ˜ ìˆëŠ” í”í•œ ì§€ì‹ì¸ ë°˜ë©´, ì •í™•íˆ ì–¸ì œ ì“°ë©´ ì¢‹ì„ì§€, ì–¸ì œ ì“°ì¼ ìˆ˜ ìˆì„ì§€ì™€ ê°™ì€ ì‹¤ìš©ì ì¸ ë‚´ìš©ì€ ì°¾ì•„ë³´ê¸° ì–´ë ¤ì› ê¸°ë•Œë¬¸ì— Goë¥¼ í†µí•´ Mutexì™€ Semaphoreì„ ì´ìš©í•´ë³´ëŠ” ê°„ë‹¨í•œ í”„ë¡œê·¸ë¨ì„ ë§Œë“¤ì–´ ì‹¤ìŠµí•´ë³´ì•˜ë‹¤.\nì˜ˆì œ í”„ë¡œê·¸ë¨ìœ¼ë¡œì„œ ì½”ë“œë¥¼ ê°„ê²°í•˜ê³  ì½ê¸° ì‰½ê²Œ ê¹”ë”í•˜ê²Œ ì œê³µí•´ë³´ê³ ìí–ˆëŠ”ë°, ê·¸ëŸ¬ê¸° ì‰½ì§€ ì•Šì•˜ë˜ ê²ƒ ê°™ì•„ ì•„ì‰½ë‹¤. ë‹¤ìŒì—” ê¸°íšŒê°€ ë˜ë©´ goì˜ benchmark testë¥¼ ì´ìš©í•´ë³´ë©´ ì–´ë–¨ê¹Œì‹¶ë‹¤.\nì°¸ê³  Goroutineê³¼ Goroutine schedulingì— ëŒ€í•´ - https://thegopher.tistory.com/3\ní™”ì¥ì‹¤ì— ë¹„ìœ í•œ ë®¤í…ìŠ¤ì™€ ì„¸ë§ˆí¬ì–´ - https://worthpreading.tistory.com/90\nsemaphore in Go https://medium.com/@deckarep/gos-extended-concurrency-semaphores-part-1-5eeabfa351ce\ncooperative vs preemptive - https://medium.com/traveloka-engineering/cooperative-vs-preemptive-a-quest-to-maximize-concurrency-power-3b10c5a920fe\npreemptive scheduling in go - https://blog.puppyloper.com/menus/Golang/articles/Goroutineê³¼ Go scheduler\n","date":"2021-01-20T15:25:54+09:00","image":"https://umi0410.github.io/blog/golang/go-mutex-semaphore/mutex-2_hu253887d6f424b5a6c4c14b3309becda5_68035_120x120_fill_box_smart1_3.png","permalink":"https://umi0410.github.io/blog/golang/go-mutex-semaphore/","title":"Go ì–¸ì–´ë¡œ ì ìš©í•´ë³´ëŠ” Computer Science - Mutexì™€ Semaphore"},{"content":"ì‹œì‘í•˜ë©° ìš”ì¦˜ Goì™€ Java ëª¨ë‘ë¥¼ ì´ìš©í•´ ê°œë°œì„ í•˜ë‹¤ë³´ë‹ˆ ê°ê°ì˜ ì¥ë‹¨ì ì— ëŒ€í•´ ëŠê»´ë³¼ ìˆ˜ ìˆì—ˆë‹¤. GoëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ ì ê²Œ ë¨¹ìœ¼ë©° ì½”ë“œê°€ ê°„ê²°í•˜ê³  ë¼ì´ë¸ŒëŸ¬ë¦¬ë‚˜ í”„ë ˆì„ì›Œí¬ ë˜í•œ ì‹¬í”Œí•´ì„œ ì ìš©í•˜ê¸° í¸í•˜ë‹¤. JavaëŠ” ì´ëŸ° ì €ëŸ° ê¸°ëŠ¥ì´ ë§ì€ ë°˜ë©´ ê·¸ëŸ° ê¸°ëŠ¥ì„ ì´ìš©í•˜ê¸° ìœ„í•´ ì´í•´í•´ì•¼í•˜ëŠ” ë‚´ìš©ë“¤ì´ ë§ê³ , ì½”ë“œê°€ íˆ¬ëª…í•˜ì§€ëŠ” ì•Šë‹¤(ë‹¤ì–‘í•œ Annotationì„ ì´ìš©í•˜ê²Œ ë˜ë©´ì„œ ì½”ë“œê°€ íˆ¬ëª…í•˜ê²Œ ê·¸ ë™ì‘ì„ ë‚˜íƒ€ë‚´ì§€ ì•ŠìŒ). Javaì˜ ì¥ì  ì¤‘ì—ì„œëŠ” íŠ¹íˆë‚˜ ê°ì²´ì§€í–¥ì˜ ëŒ€í‘œì ì¸ ì–¸ì–´ë‹µê²Œ ìƒì†ê³¼ ë‹¤í˜•ì„±ì„ ëŠ¥ë ¥ì— ë”°ë¼ ììœ ìì¬ë¡œ ì´ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ ë§¤ë ¥ì ì´ì—ˆë‹¤.\nGo ì–¸ì–´ë¥¼ ì¢‹ì•„í•˜ëŠ” ì…ì¥ì—ì„œ ê°œì¸ì ìœ¼ë¡œ ì´ëŸ° ê°ì²´ì§€í–¥ì ì¸ íŠ¹ì§•ì´ë‚˜ ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ ì œì™¸í•˜ê³ ëŠ” ë”±íˆ Javaê°€ Goì— ë¹„í•´ ê°–ëŠ” ì¥ì ì´ í¬ê²Œ ëŠê»´ì§€ì§€ ì•Šì•˜ë‹¤. ì˜ˆì™¸ ì²˜ë¦¬ëŠ” Goê°€ ë°”ë¼ë³´ëŠ” ë°©í–¥ì´ ì¼ë°˜ì ì¸ ì˜ˆì™¸ ì²˜ë¦¬ì™€ ë‹¤ë¥´ê¸°ì— ì–´ì©” ìˆ˜ ì—†ì§€ë§Œ, ê°ì²´ì§€í–¥ì ì˜ íŠ¹ì§•ë“¤ì€ ì–´ë–»ê²Œ ì ìš©í•´ë³¼ ìˆ˜ ìˆì„ê¹Œí•˜ëŠ” ìƒê°ì— ê³µë¶€ë¥¼ ì¢€ í•´ë´¤ê³  ê·¸ ë‚´ìš©ì„ ì •ë¦¬í•´ë³¸ë‹¤. (ê¸°íšŒê°€ ëœë‹¤ë©´ Goì—ì„œ errorë¥¼ ë‹¤ë£¨ëŠ” ì² í•™ì— ëŒ€í•´ ì¶”ê°€ì ìœ¼ë¡œ ê³µë¶€í•´ë³´ê³ ì‹¶ë‹¤.)\nâ—Goì— ëŒ€í•œ ê¸°ë³¸ì ì¸ ë‚´ìš©ì„ ì •ë¦¬í•´ë³´ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ê°ì²´ ì§€í–¥ ê´€ì ì—ì„œ ë°”ë¼ë³¸ Goì— ëŒ€í•œ ë‚´ìš©ì„ ì •ë¦¬í•´ë³´ëŠ” ê²ƒì´ë¯€ë¡œ Goì˜ ê¸°ì´ˆ ë‚´ìš©ì— ëŒ€í•œ ì„¤ëª…ì€ ìƒëµí•  ê²ƒì´ë¯€ë¡œ Goì— ëŒ€í•œ ê¸°ì´ˆ ì´í•´ê°€ ì—†ë‹¤ë©´, ê·¸ ë¶€ë¶„ì„ ë¨¼ì € ì•Œì•„ë³´ëŠ” ê²ƒì„ ì¶”ì²œí•œë‹¤!\nì˜ˆì‹œ ì½”ë“œ Goì—ì„œ ê°ì²´ ì§€í–¥ì„ ì ìš©í•œ ê°„ë‹¨í•œ ê³„ì‚°ê¸° í”„ë¡œê·¸ë¨ì„ ì˜ˆì‹œë¡œ ì‘ì„±í•´ë³´ì•˜ë‹¤. ì „ì²´ ì†ŒìŠ¤ì½”ë“œë¥¼ ë‹¤ ë³¼ í•„ìš”ëŠ” ì—†ê² ì§€ë§Œ í•„ìš”ì— ë”°ë¼ ì°¸ê³ í•  ìˆ˜ ìˆë„ë¡ ì•„ë˜ì™€ ê°™ì´ ì²¨ë¶€í•œë‹¤.\nmain íŒ¨í‚¤ì§€ - /main.go\npackage main import ( \u0026#34;bufio\u0026#34; \u0026#34;calculator/calc\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;os\u0026#34; \u0026#34;strconv\u0026#34; \u0026#34;strings\u0026#34; ) func main(){ var ( calculator *calc.Calculator = calc.NewCalculator() // ê³„ì‚°ê¸° struct operationUnit calc.OperationUnit // OperationUnitì´ë¼ëŠ” interface typeì„ í†µí•´ Polymorphism ì´ìš© operationResult float64 // ê³„ì‚° ê²°ê³¼ë¥¼ ë‹´ìŒ operationErr error // ê³„ì‚° ìˆ˜í–‰ì— ëŒ€í•œ errorì„ ë‹´ìŒ ) // main packageì—ì„œëŠ” calc packageì— ì •ì˜ëœ unexported nameì¸ idì— ì ‘ê·¼í•  ìˆ˜ ì—†ë‹¤. //calculator.id = \u0026#34;Jinsu Park\u0026#34; scanner := bufio.NewScanner(os.Stdin) // ì—°ì‚° optionì„ ìœ„í•´ ê°’ì„ ì…ë ¥ë°›ê¸° (e.g. 1) fmt.Printf(`A simple calculator program. ======================================================= Operation options 1. Mulitply a, b float 64 2. Sqaure val, square float64 Please input an int for your desired operation. \u0026gt;\u0026gt;\u0026gt; `) scanner.Scan() option, _ := strconv.Atoi(scanner.Text()) // argsë¥¼ ìœ„í•´ ì…ë ¥ë°›ê¸° (e.g. 10 20) fmt.Printf(\u0026#34;Please input floats as args.\\n\u0026gt;\u0026gt;\u0026gt; \u0026#34;) scanner.Scan() inputs := make([]float64, 0) for _, input := range strings.Split(scanner.Text(), \u0026#34; \u0026#34;){ f, _ := strconv.ParseFloat(input, 64) inputs = append(inputs, f) } // ì—°ì‚°ì— ëŒ€í•œ multiplexing. ì¦‰ optionì— ë”°ë¥¸ ì—°ì‚°ì„ ìˆ˜í–‰í•œë‹¤ëŠ” ì˜ë¯¸ // operationUnitì´ë¼ëŠ” OperationUnit interface typeì„ í†µí•´ Polymorphism ì´ìš© switch option{ case 1: operationUnit = calculator.Multiplier case 2: operationUnit = calculator.SquareMultiplier } // Operateë¼ëŠ” ê¸°ëŠ¥ì„ ë‹¤ì–‘í•œ ë™ì‘ìœ¼ë¡œ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤. operationResult, operationErr = operationUnit.Operate(inputs...) // result if operationErr != nil{ fmt.Println(\u0026#34;[Error]\u0026#34;, operationErr) } else{ fmt.Println(\u0026#34;Result:\u0026#34;, operationResult) } } calc íŒ¨í‚¤ì§€ - /calc/calc.go\npackage calc import ( \u0026#34;errors\u0026#34; ) var autoIncrementID int = 1 type Calculator struct{ id int // ì œì¡°ëœ Calculatorì„ ì‹ë³„í•˜ê¸° ìœ„í•œ ID. ë³€ìˆ˜ëª…ì´ ì†Œë¬¸ìë¡œ ì‹œì‘í•˜ë¯€ë¡œ export ë˜ì§€ ì•ŠëŠ”ë‹¤. Multiplier OperationUnit SquareMultiplier OperationUnit } type OperationUnit interface{ IsValidInput(args ...float64) bool Operate(args ...float64) (float64, error) } type MultiplyOperationUnit struct{} type SquareOperationUnit struct{ MultiplyOperationUnit // Embedì˜ ì˜ˆì‹œ } func NewCalculator() *Calculator{ c := \u0026amp;Calculator{ id: autoIncrementID, Multiplier: \u0026amp;MultiplyOperationUnit{}, SquareMultiplier: \u0026amp;SquareOperationUnit{MultiplyOperationUnit: MultiplyOperationUnit{}}, } autoIncrementID += 1 return c } func (unit *MultiplyOperationUnit) IsValidInput(args ...float64) bool{ if len(args) != 2{ return false } return true } func (unit *MultiplyOperationUnit) Operate(args ...float64) (float64, error){ if !unit.IsValidInput(args...){ return 0, errors.New(\u0026#34;MultiplyOperationUnitì˜ argsê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\u0026#34;) } return args[0] * args[1], nil } //func (unit *SquareOperationUnit) IsValidInput(args ...float64) bool{ // ... í•„ìš”ì— ë”°ë¼ ì •ì˜í•˜ë©´ Overrideì²˜ëŸ¼ ì´ìš© ê°€ëŠ¥ //} func (unit *SquareOperationUnit) Operate(args ...float64) (float64, error){ // *SquareOperationUnitì— ëŒ€í•œ IsValidInput ë©”ì†Œë“œëŠ” ì •ì˜í•œ ì  ì—†ì§€ë§Œ // Embeddingì„ í†µí•´ ì¼ë°˜ì ì¸ OOPì—ì„œ ë¶€ëª¨ì˜ ë©”ì†Œë“œë¥¼ ì´ìš©í•˜ë“¯ì´ ì´ìš© ê°€ëŠ¥. if !unit.IsValidInput(args...){ return 0, errors.New(\u0026#34;SquareOperationUnitì˜ argsê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\u0026#34;) } var ( // val^square ì¦‰ \u0026#34;valì˜ square ì œê³±\u0026#34;ì— ëŒ€í•œ ê³„ì‚° val = args[0] square = args[1] reduced float64 = val // ì œê³± ì—°ì‚° ì¤‘ ê°’ì„ ë‹´ì•„ ë†“ëŠ” ë³€ìˆ˜ cnt = float64(1) // ì œê³± ì—°ì‚° ë£¨í”„ë¥¼ ìœ„í•œ counter err error ) for ;cnt \u0026lt; square; cnt ++{ reduced, err = unit.MultiplyOperationUnit.Operate(reduced, val) if err != nil{ return 0, err } } return reduced, err } preview.png declaration.png Calculatorë¼ëŠ” ê³„ì‚°ê¸° structê°€ ì¡´ì¬ âœ¨ id fieldëŠ” ì†Œë¬¸ìë¡œ ì‹œì‘í•˜ê¸°ë•Œë¬¸ì— ì™¸ë¶€ì—ì„œ í•¨ë¶€ë¡œ ì ‘ê·¼í•  ìˆ˜ ì—†ë„ë¡ dataë¥¼ ìº¡ìŠí™” ê³„ì‚°ê¸°ì—ì„œ ê°ê°ì˜ ì—°ì‚°ì„ ë‹´ë‹¹í•˜ëŠ” OperationUnit interfaceì¡´ì¬ OperationUnit interfaceëŠ” Inputì˜ ìœ íš¨ì„±ì„ ê²€ì‚¬í•˜ëŠ” IsValidInput ë©”ì†Œë“œì™€ ì—°ì‚°ì„ ìˆ˜í–‰í•˜ëŠ” Operate ë©”ì†Œë“œ ì¡´ì¬ ê°ê°ì˜ ì—°ì‚°ì„ ë‹´ë‹¹í•˜ëŠ” Unitì€ OperationUnit interfaceê°€ ì •ì˜í•œ ë©”ì†Œë“œë“¤ì„ êµ¬í˜„í•¨ìœ¼ë¡œì¨ duck-typingì„ í†µí•´ OperationUnit interfaceë¡œ ì‚¬ìš©ëœë‹¤. â‡’ âœ¨ interfaceë¥¼ í†µí•œ ì¶”ìƒí™”ì™€ ë‹¤í˜•ì„± ì´ìš© ê°€ëŠ¥ OperationUnit interfaceë¡œ ì‚¬ìš©ì´ ê°€ëŠ¥í•œ structì˜ ì˜ˆì‹œ MultiplyOperationUnit struct - ê³±ì…ˆ ì—°ì‚°ì„ ë‹´ë‹¹ SquareOperationUnit struct - ì œê³±ì…ˆ ì—°ì‚°ì„ ë‹´ë‹¹ âœ¨ Embedë¥¼ í†µí•´ MultiplyOperationUnitì„ ìƒì†í•œ ê²ƒì²˜ëŸ¼ fieldì™€ methodë¥¼ ì‚¬ìš© ê°€ëŠ¥ ê°ì²´ì§€í–¥ì  ê´€ì ì—ì„œì˜ Goì— ëŒ€í•´ GoëŠ” ì•„ë¬´ë˜ë„ ê°ì²´ ì§€í–¥ ì–¸ì–´ë¼ê³  í•˜ì§€ëŠ” ì•ŠëŠ” ë“¯í•˜ë‹¤. ì´ì— ëŒ€í•´ì„  ë‹¤ì–‘í•œ ì˜ê²¬ì´ ìˆëŠ” ê²ƒ ê°™ì€ë° Post-OOP ì–¸ì–´ë¼ëŠ” ì‚¬ëŒë„ ìˆê³  OOP ì–¸ì–´ëŠ” ì•„ë‹ˆì§€ë§Œ Object-Orientedí•˜ê²Œ í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ OOP ì–¸ì–´ì´ë©´ì„œ OOPì–¸ì–´ê°€ ì•„ë‹ˆë¼ëŠ” ì‚¬ëŒë„ ìˆë‹¤.\nOOPì—ëŠ” í¬ê²Œ 4ê°€ì§€ ì›ì¹™ì´ ìˆë‹¤.\nì—°ê´€ëœ ë³€ìˆ˜ì™€ í•¨ìˆ˜ë¥¼ í´ë˜ìŠ¤ë¡œ ë¬¶ìœ¼ë©° ì™¸ë¶€ì—ì„œ íŠ¹ì • ë°ì´í„°ë‚˜ ê¸°ëŠ¥ì— ì ‘ê·¼í•˜ì§€ ëª»í•˜ë„ë¡ í•˜ëŠ” ì •ë³´ë¥¼ ì€ë‹‰í•´ì£¼ëŠ” ìº¡ìŠí™” ë¶€ëª¨ ê°ì²´ì˜ field, methodë¥¼ ìì‹ ê°ì²´ê°€ ì´ìš©í•  ìˆ˜ ìˆë„ë¡í•´ì£¼ê³ , Overrideí•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ìƒì† ì„¸ë¶€ ì‚¬í•­ì€ ì œì™¸í•˜ê³ , ì–´ë–¤ ê¸°ëŠ¥ì´ ì¡´ì¬í•˜ëŠ”ì§€ ë“±ì˜ ì¶”ìƒì ì¸ ì •ë³´ë§Œìœ¼ë¡œë„ ì´ìš©í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ì¶”ìƒí™” ì¦‰ í•˜ë‚˜ì˜ íƒ€ì…ì´ ì—¬ëŸ¬ íƒ€ì…ìœ¼ë¡œ ì´ìš©ë  ìˆ˜ ìˆìœ¼ë©°, ê°ê°ì´ ë‹¤ì–‘í•˜ê²Œ ë™ì‘í•  ìˆ˜ ìˆëŠ” ë‹¤í˜•ì„± ê·¸ë¦¬ê³  ëŒ€í‘œì ì¸ OOP ì–¸ì–´ì¸ JavaëŠ” ì´ëŸ¬í•œ ë‚´ìš©ë“¤ì„ ì•„ì£¼ ì˜ ì´ìš©í•  ìˆ˜ ìˆê²Œë” ë˜ì–´ìˆë‹¤. OOP ì–¸ì–´ê°€ ì•„ë‹Œ Goì—ì„œ ì´ëŸ¬í•œ OOPì˜ íŠ¹ì§•ì´ì ì¥ì ì¸ ìš”ì†Œë“¤ì„ ì–´ë–»ê²Œ ì ìš©í•  ìˆ˜ ìˆì„ì§€ ì•Œì•„ë³´ë„ë¡í•˜ê² ë‹¤.\nğŸ’Š Encapsulation(ìº¡ìŠí™”) Goì—ì„œëŠ” Exportë¥¼ í†µí•´ ìº¡ìŠí™”ë¥¼ ì´ìš©í•  ìˆ˜ ìˆë‹¤. Exportì— ëŒ€í•´ ê°„ë‹¨íˆ ì„¤ëª…í•˜ìë©´ private, public ì„ ì´ìš©í•´ ë³€ìˆ˜ë‚˜ í•¨ìˆ˜ì— ì ‘ê·¼ ì œí•œì„ ë‘ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì´ë¦„ì´ ëŒ€ë¬¸ìëƒ ì†Œë¬¸ìëƒì— ë”°ë¼ íŒ¨í‚¤ì§€ ì™¸ë¶€ì—ì„œ ì ‘ê·¼ì„ ì œì–´í•˜ëŠ” ê²ƒì„ ë§í•œë‹¤.\nGoì˜ Export ì´ìš© ë°©ë²•ì€ ë§ì´ ì°¾ì•„ë³¼ ìˆ˜ ìˆìœ¼ë‹ˆ ìº¡ìŠí™”ì— ì´ˆì ì„ ë§ì¶˜ ê·¸ ì“°ì„ì— ëŒ€í•´ ì•Œì•„ë³¸ë‹¤.\n// Calculatorì— ëŒ€í•œ ì •ì˜ì™€ êµ¬í˜„ì„ ë‹´ë‹¹í•˜ëŠ” calc íŒ¨í‚¤ì§€ package calc type Calculator struct{ ID int // ì œì¡°ëœ Calculatorì„ ì‹ë³„í•˜ê¸° ìœ„í•œ ID. ë³€ìˆ˜ëª…ì´ ì†Œë¬¸ìë¡œ ì‹œì‘í•˜ë¯€ë¡œ export ë˜ì§€ ì•ŠëŠ”ë‹¤. ... } ìœ„ì™€ ê°™ì´ Calculatorë¥¼ ì •ì˜í•˜ëŠ” calcë¼ëŠ” íŒ¨í‚¤ì§€ê°€ ìˆë‹¤ê³  ê°€ì •í•˜ë‹¤. Calculatorë¥¼ ì‹ë³„í•˜ëŠ” IDì— ëŒ€í•œ ì‘ì—…ì€ calc íŒ¨í‚¤ì§€ì—ì„œ ë‹´ë‹¹í•˜ê³  í•¨ë¶€ë¡œ ì™¸ë¶€ì—ì„œ ê°’ì„ ë°”ê¾¸ì§€ ëª»í•˜ë„ë¡í•˜ê³ ì‹¶ì€ ê²½ìš° fieldê°€ ì†Œë¬¸ìë¡œ ì‹œì‘í•˜ë„ë¡ í•¨ìœ¼ë¡œì¨ ì™¸ë¶€ íŒ¨í‚¤ì§€ì—ì„œ ì§ì ‘ ì ‘ê·¼í•˜ì§€ ëª»í•˜ë„ë¡í•  ìˆ˜ ìˆë‹¤.\ní•„ìš”ì— ë”°ë¼ Javaì—ì„œ ê·¸ëŸ¬í•˜ë“¯ getterì™€ setterë¥¼ ì •ì˜í•´ì¤„ ìˆ˜ë„ ìˆë‹¤.\npackage main ... func main(){ var ( calculator *calc.Calculator = calc.NewCalculator() ) // main packageì—ì„œëŠ” calc packageì— ì •ì˜ëœ unexported nameì¸ idì— ì ‘ê·¼í•  ìˆ˜ ì—†ë‹¤. //calculator.id = \u0026#34;Jinsu Park\u0026#34; } ì•ì„œ ë§í–ˆë“¯ì´ ì´ë ‡ê²Œ calc íŒ¨í‚¤ì§€ê°€ ì•„ë‹Œ ì™¸ë¶€ íŒ¨í‚¤ì§€(ì˜ˆë¥¼ ë“¤ì–´ main íŒ¨í‚¤ì§€)ì—ì„œëŠ” unexported nameì¸ idì— ì ‘ê·¼í•  ìˆ˜ ì—†ë‹¤.\nì£¼ë¡œ ìº¡ìŠí™”ì™€ Goì— ëŒ€í•´ì„  ì€ë‹‰ì„ ì–´ë–»ê²Œ í•˜ëŠ”ê°€ê°€ ìš”ì ì´ë¼ê³  ìƒê°í•´ ì´ ë¶€ë¶„ì— ëŒ€í•´ ë‹¤ë¤„ë³´ì•˜ë‹¤.\nìì„¸í•œ ë‚´ìš©ì€? - ì—°ê´€ëœ ë³€ìˆ˜ì™€ í•¨ìˆ˜ë¥¼ ë¬¶ì–´ì£¼ëŠ” ë‚´ìš©ì€ Goì˜ struct, receiverì™€ method ë“±ì— ëŒ€í•´ ê²€ìƒ‰í•´ë³´ë©´ ë” ê¹Šì´ ì•Œì•„ë³¼ ìˆ˜ ìˆë‹¤.\nğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Inheriatance(ìƒì†) GoëŠ” Compositionì„ ì´ìš©í•œ Embeddingì´ë¼ëŠ” ë°©ì‹ì„ í†µí•´ Inheritanceì™€ ê°™ì€ ê¸°ëŠ¥ì„ ì´ìš©í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤ëŠ” ì‹ìœ¼ë¡œ ë§ì´ë“¤ ì„¤ëª…ì„ í•˜ëŠ” ê²ƒ ê°™ì•˜ìœ¼ë‚˜ ì£¼ê´€ì ì¸ í•´ì„ì„ í•´ë³´ìë©´ Goì˜ Embeddingì€ Compositionì´ë©´ì„œ ìë™ìœ¼ë¡œ embedëœ fieldì˜ methodì™€ ë³¸ì¸ì˜ methodì¸ ê²ƒì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì£¼ê¸°ì— Inheritanceì²˜ëŸ¼ ì´ìš©í•  ìˆ˜ ìˆë‹¤ê³  ë³¼ ìˆ˜ ìˆê² ë‹¤.\nGoì˜ Embeddingì€ structì˜ fieldì— ë³„ë„ì˜ nameì´ ì•„ë‹Œ typeë§Œì„ ì ì–´ì¤Œìœ¼ë¡œì¨ ì´ìš©í•  ìˆ˜ ìˆë‹¤. Bë¼ëŠ” typeì´ ëŠ” ë©”ì†Œë“œ Say()ë¥¼ ê°€ì§€ê³  ìˆëŠ” ê²½ìš° struct Aê°€ type Bë¥¼ Embedí•œë‹¤ë©´ AëŠ” Bì˜ Say ë©”ì†Œë“œë¥¼ ë‘ ê°€ì§€ ë°©ë²•ìœ¼ë¡œ ì´ìš© ê°€ëŠ¥í•˜ë‹¤.\nA.Say() - ì´ê²½ìš° ì•”ë¬µì ìœ¼ë¡œ 2.ë¡œ ë³€í™˜ë˜ì–´ ìˆ˜í–‰ë˜ëŠ” ì…ˆ A.B.Say() - ì´ë ‡ê²Œ ëª…ì‹œì ìœ¼ë¡œ Selector(ì—¬ê¸°ì„  B)ë¥¼ ì ì–´ì¤„ ìˆ˜ë„ ìˆë‹¤. ì¼ë°˜ì ì¸ Compositionê³¼ ë™ì¼í•˜ë‹¤. Goì—ì„œ Embeddingì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²• ìì²´ ë˜í•œ ë§ì€ ë‚´ìš©ì„ ì¸í„°ë„·ì—ì„œ ì°¾ì•„ë³¼ ìˆ˜ ìˆìœ¼ë‹ˆ ìƒì†ê³¼ Embeddingì— ì´ˆì ì„ ë§ì¶° ì„¤ëª…í•´ë³´ë„ë¡í•˜ê² ë‹¤.\nì¼ë°˜ì ì¸ ê°ì²´ ì§€í–¥ì ì¸ ë°©ì‹ì—ì„œëŠ” type MultiplyOperationUnit struct ë¼ëŠ” typeì´ ì¡´ì¬í•˜ê³ \ntype SquareOperationUnit struct ê°€ MultiplyOperationUnit typeì„ ìƒì†ë°›ëŠ”ë‹¤ë©´ SquareOperationUnitì€ IsValidCheck ë©”ì†Œë“œë¥¼ ë¹„ë¡¯í•œ MultiplyOperationUnitì˜ ë©”ì†Œë“œì™€ ë©¤ë²„ ë³€ìˆ˜ë¥¼ ì´ìš©í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.\ntype MultiplyOperationUnit struct{} type SquareOperationUnit struct{ MultiplyOperationUnit // typeë§Œì„ ì „ë‹¬í•¨ìœ¼ë¡œì¨ Embed } // ê³±ì…ˆ ì—°ì‚°ì— ëŒ€í•œ Input validation func (unit *MultiplyOperationUnit) IsValidInput(args ...float64) bool{ fmt.Println(args) if len(args) != 2{ return false } return true } func (unit *MultiplyOperationUnit) Operate(args ...float64) (float64, error){ if !unit.IsValidInput(args...){ return 0, errors.New(\u0026#34;MultiplyOperationUnitì˜ argsê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\u0026#34;) } ... } func (unit *SquareOperationUnit) Operate(args ...float64) (float64, error){ // *SquareOperationUnitì— ëŒ€í•œ IsValidInput ë©”ì†Œë“œëŠ” ì •ì˜í•œ ì  ì—†ì§€ë§Œ // Embeddingì„ í†µí•´ ì¼ë°˜ì ì¸ OOPì—ì„œ ë¶€ëª¨ì˜ ë©”ì†Œë“œë¥¼ ì´ìš©í•˜ë“¯ì´ ì´ìš© ê°€ëŠ¥. if !unit.IsValidInput(args...){ return 0, errors.New(\u0026#34;SquareOperationUnitì˜ argsê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\u0026#34;) } ... } ì´ ê²½ìš° Goì—ì„œëŠ” SquareOperationUnitì´ MultiplyOperationUnitì„ Embedí•˜ë„ë¡ í•œë‹¤. í‰ë²”í•œ Compostion ë°©ì‹ìœ¼ë¡œ ì´ìš©í•  ìˆ˜ ìˆê² ì§€ë§Œ Goì˜ íŠ¹ì´í•œ Embed ë°©ì‹ì„ ì´ìš©í•¨ìœ¼ë¡œì¨ *SquareOperationUnit ì— ëŒ€í•œ IsValidInput ë©”ì†Œë“œë¥¼ ì •ì˜í•œ ì  ì—†ì§€ë§Œ ì¼ë°˜ OOPì—ì„œ ë¶€ëª¨ í´ë˜ìŠ¤ì— ì •ì˜ëœ ë©”ì†Œë“œë¥¼ ì´ìš©í•˜ë“¯unit *SquareOperationUnitê³¼ ê°™ì´ ì´ìš© ê°€ëŠ¥í•˜ë‹¤.\nfunc (unit *SquareOperationUnit) IsValidInput(args ...float64) (float64, error){ ... } OOPì—ì„œì˜ Method Overrideì™€ ê°™ì€ ì‘ì—…ì„ Goì—ì„œ í•˜ê³ ì‹¶ë‹¤ë©´ ìœ„ì™€ ê°™ì´ ì¶”ê°€ì ìœ¼ë¡œ ìì‹ ì˜ íƒ€ì…ì— ëŒ€í•œ methodë¥¼ ì •ì˜í•˜ë©´ëœë‹¤. ë©”ì†Œë“œë¥¼ ì¶”ê°€ì ìœ¼ë¡œ ì •ì˜í•´ì¤€ ë’¤ Selectorë¥¼ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ë‹¹ì—°íˆ ìš°ë¦¬ê°€ ë°”ë€ëŒ€ë¡œ Embedëœ typeì˜ methodê°€ ì•„ë‹Œ ìê¸° ìì‹ ì˜ methodë¥¼ í˜¸ì¶œí•˜ê²Œ ëœë‹¤.\nìì„¸í•œ ë‚´ìš©ì€? - ì•„ë¬´ë˜ë„ Goì˜ Embeddingê³¼ Compositionì— ëŒ€í•œ ì´í•´ê°€ ì—†ë‹¤ë©´ ë¬´ìŠ¨ ë§ì¸ì§€ ì´í•´í•˜ê¸° í˜ë“¤ ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ í•´ë‹¹ ë‚´ìš©ë“¤ì— ëŒ€í•´ ì•Œì•„ë³¼ ê²ƒì„ ì¶”ì²œ!\nAbstraction(ì¶”ìƒí™”) ì¶”ìƒí™”ëŠ” ê·¸ ê°ì²´ì˜ ì„¸ë¶€ ë‚´ìš©ì´ ì•„ë‹Œ ê³µí†µëœ ê¸°ëŠ¥ì„ ë°”íƒ•ìœ¼ë¡œ ì¶”ë ¤ë‚´ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.\nì¶”ìƒí™”ì— ìˆì–´ì„œëŠ” Javaì™€ Goê°€ interfaceë¥¼ ì´ìš©í•œë‹¤ëŠ” ì ì—ì„œ í¬ê²Œ ë‹¤ë¥´ì§„ ì•Šë‹¤.\ninterfaceì— ì¶”ìƒì ìœ¼ë¡œ í•´ë‹¹ interfaceë¥¼ êµ¬í˜„í•˜ëŠ” typeë“¤ì´ êµ¬í˜„í•˜ê¸°ë¥¼ ë°”ë¼ëŠ” methodë¥¼ ì •ì˜ë§Œí•œë‹¤.\ntype OperationUnit interface{ IsValidInput(args ...float64) bool Operate(args ...float64) (float64, error) } ì´ ê²½ìš° OperationUnitëŠ” \u0026ldquo;IsValidInputê³¼ Operate ê¸°ëŠ¥ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ë¬´ì–¸ê°€\u0026rdquo; ì´ë¼ê³  ì¶”ìƒí™”ëœ ê²ƒì´ë‹¤.\nìì„¸í•œ ë‚´ìš©ì€? - ì¶”ìƒí™”ì˜ ì“°ì„ì€ ë‹¤í˜•ì„±ì˜ ì“°ì„ê³¼ë„ ë°€ì ‘í•œ ì—°ê´€ì´ ìˆë‹¤. Goì—ì„œ interfaceë¥¼ ì‚¬ìš©í•˜ëŠ” íŒ¨í„´ê³¼ ì‚¬ìš©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ë©´ ì¢‹ì„ ê²ƒ ê°™ë‹¤.\nğŸŒ’ğŸŒ“ğŸŒ• Polymorphism(ë‹¤í˜•ì„±) ë‹¤í˜•ì„±ì´ë€ í•œ ê°€ì§€ íƒ€ì…ì´ ê²½ìš°ì— ë”°ë¼ ê°™ì€ ê¸°ëŠ¥ì— ëŒ€í•´ ë‹¤ì–‘í•œ ë™ì‘ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ê²ƒì„ ë§í•œë‹¤. ì¶”ìƒí™”ëŠ” interfaceì— ëŒ€í•œ ì •ì˜ì— í•´ë‹¹í•˜ê³  ë‹¤í˜•ì„±ì€ interface í™œìš©ì— í•´ë‹¹í•˜ëŠ” ë“¯í•˜ë‹¤.\nì¼ë°˜ì ì¸ OOP ì–¸ì–´ì—ì„œëŠ” interfaceê°€ ì•„ë‹Œ ìƒì† ê´€ê³„ì—ì„œë„ ë¶€ëª¨â‡’ìì‹ìœ¼ë¡œ íƒ€ì… ë³€í™˜ì„ í†µí•´ ë‹¤í˜•ì„± í™œìš©ì´ ê°€ëŠ¥í•˜ë‹¤. í•˜ì§€ë§Œ GoëŠ” ì´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤. ì´ìœ ëŠ” ëŸ°íƒ€ì„ì— ë™ì ìœ¼ë¡œ method dispatch(í•´ë‹¹ typeì˜ ê°ì²´ í˜¹ì€ valueê°€ ì–´ë–¤ í•¨ìˆ˜ë¥¼ ë©”ì†Œë“œë¡œ í•  ì§€ ê²°ì •í•˜ëŠ” ê²ƒ)ì„ ìˆ˜í–‰í•¨ìœ¼ë¡œ ì¸í•œ ì˜¤ë²„í—¤ë“œë¥¼ ì¤„ì´ê¸° ìœ„í•´ì„œ ì»´íŒŒì¼ íƒ€ì„ì— ì •ì ìœ¼ë¡œ method dispatchí•  ìˆ˜ ìˆê²Œ í•˜ê¸° ìœ„í•´ì„œë¼ê³ í•œë‹¤.\ntype OperationUnit interface{ IsValidInput(args ...float64) bool Operate(args ...float64) (float64, error) } type MultiplyOperationUnit struct{} type SquareOperationUnit struct{ MultiplyOperationUnit } ... ê°ì¢… ë©”ì†Œë“œ ì •ì˜ ìƒëµ func main(){ var ( calculator *calc.Calculator = calc.NewCalculator() operationUnit calc.OperationUnit operationResult float64 operationErr error ) // ì—°ì‚°ì— ëŒ€í•œ multiplexing. ì¦‰ optionì— ë”°ë¥¸ ì—°ì‚°ì„ ìˆ˜í–‰í•œë‹¤ëŠ” ì˜ë¯¸ switch option{ case 1: operationUnit = calculator.Multiplier case 2: operationUnit = calculator.SquareMultiplier } operationResult, operationErr = operationUnit.Operate(inputs...) // result if operationErr != nil{ fmt.Println(\u0026#34;[Error]\u0026#34;, operationErr) } else{ fmt.Println(\u0026#34;Result:\u0026#34;, operationResult) } } operationUnitì´ë¼ëŠ” Interfaceì— ë‹¤ë¥¸ typeì˜ structì¸ calculator.Multiplierì™€ calculator.SquareMultiplierê°€ ë‹´ê¸¸ ìˆ˜ ìˆë‹¤.\nì´ë¥¼ í†µí•´ operationUnit.Operate() ëŠ” ê²½ìš°ì— ë”°ë¼ \u0026ldquo;ì—°ì‚°\u0026ldquo;ì´ë¼ëŠ” ê¸°ëŠ¥ìœ¼ë¡œ Multipliy ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ë„ ìˆê³ , SqaureMultipliy ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ë„ ìˆëŠ”ë°, ì´ë¥¼ ë‹¤í˜•ì„±ì´ë¼ê³  í•œë‹¤.\nGoì—ì„œì˜ ê°ì²´ ì§€í–¥ì˜ í•œê³„ì ê³¼ ì¥ì  public class Example { public static void main(String[] args){ // Parent classì™€ Parentë¥¼ extendsí•œ Child classì— ëŒ€í•œ êµ¬í˜„ì€ ìƒëµí•œë‹¤. Parent parent = new Parent(); Parent child = new Child(); parent.ShowMetaData(); // parent.GetName() ì´ìš© /* Output ======================================= Name: Parent ======================================= */ child.ShowMetaData(); // child.GetName()ì´ìš©. // ì´ ë•Œì—ëŠ” .ShowMetaData()ê°€ Parent classê°€ ì•„ë‹Œ Child classê°€ Overrideí•œ GetName() ì´ìš© /* Output ======================================= Name: Child of Parent ======================================= */ } } ê°ì²´ ì§€í–¥ í”„ë¡œê·¸ë˜ë°ì—ì„  ë¶€ëª¨ í´ë˜ìŠ¤ì— ì •ì˜ëœ ë©”ì†Œë“œê°€ ë‚´ë¶€ì—ì„œ ìì‹ì´ Overrideí•œ ë©”ì†Œë“œë¥¼ ì´ìš©í•  ìˆ˜ë„ ìˆëŠ”ë°, GoëŠ” ê·¸ëŸ° ê¸°ëŠ¥ì€ ì´ìš©í•  ìˆ˜ ì—†ë‹¤ëŠ” ì ì´ ê°€ì¥ í° í•œê³„ì ì¸ ê²ƒ ê°™ë‹¤.\nì˜ˆë¥¼ ë“¤ì–´ Parent classì˜ .ShowMetaData()ë¼ëŠ” methodê°€ .GetName()ì´ë¼ëŠ” ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ê²½ìš°, javaì—ì„œëŠ” Childê°€ GetNameì„ Overrideí•˜ë©´ child.ShowMetaData() í˜¸ì¶œ ì‹œì— Childê°€ Overrideí•œ child.GetName()ì„ ì´ìš©í•˜ì§€ë§Œ, GoëŠ” ê·¸ëŸ´ ìˆ˜ ì—†ë‹¤. í•„ìš”í•œ ê²½ìš° í•¨ìˆ˜ë¥¼ ì¸ìë‚˜ fieldë¡œ ì „ë‹¬í•¨ìœ¼ë¡œì¨ ì‚¬ìš©í•  ìˆ˜ ìˆê² ì§€ë§Œ, ì‚¬ìš©ì„±ì´ ì œí•œì ì´ë‹¤. ì´ ë‚´ìš©ì— ëŒ€í•´ ì—¬ê¸°ì„œ ì„¤ëª…í•˜ë©´ ê¸€ì´ ê¸¸ì–´ì§ˆ ê²ƒ ê°™ì•„ ìì„¸í•œ ë¬˜ì‚¬ëŠ” ìƒëµí•˜ê² ë‹¤.\në°˜ë©´ Goì—ì„œì˜ ê°ì²´ ì§€í–¥ì€ ì¥ì ì€ ì´ ê¸€(https://www.toptal.com/go/golang-oop-tutorial)ì˜ í›„ë°˜ë¶€ì— ì˜ ë‚˜ì™€ìˆëŠ”ë°, êµ³ì´ Javaë¥¼ ì´ìš©í•˜ì§€ ì•Šì•„ë„ ì´ë ‡ê²Œ OOPê°€ ì¶©ë¶„íˆ ê°€ëŠ¥í•˜ë‹¤ëŠ” ê²ƒì´ í•µì‹¬ì´ë‹¤. Javaì˜ VM/JITìœ¼ë¡œ ì¸í•œ ë¦¬ì†ŒìŠ¤ ë¶€ì¡±, ììœ ë„ê°€ ë–¨ì–´ì§€ëŠ” í”„ë ˆì„ì›Œí¬, ë§ì€ annotation, \u0026hellip; ë“±ë“±ì˜ ë‹¨ì  ì—†ì´ë„ ì¶©ë¶„íˆ Goë¥¼ í†µí•´ ê°€ë³ê²Œ OOP í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ ì¥ì ì´ë‹¤.\në§ˆë¬´ë¦¬ ì•„ë¬´ë˜ë„ ê°ì²´ ì§€í–¥ì  ê°œë°œì„ í•˜ëŠ” ë°ì— ìˆì–´ì„œëŠ” Javaê°€ ì¢€ ë” ì§ê´€ì ìœ¼ë¡œ ê·¸ëŒ€ë¡œ ì„¤ê³„, êµ¬í˜„í•´ì„œ ì´ìš©ì´ ê°€ëŠ¥í•œ ê²ƒ ê°™ë‹¤. ì²˜ìŒ Javaë¥¼ ê³µë¶€í–ˆì„ ë•Œë¶€í„° JavaëŠ” ê°ì²´ì§€í–¥ì ìœ¼ë¡œ ê°œë°œí•˜ëŠ” íŒ¨í„´ì— ëŒ€í•´ ìˆ˜ì—†ì´ ë§ì€ ì˜ˆì œê°€ ì¡´ì¬í–ˆê³ , ê·¸ íŒ¨í„´ì´ ëª…í™•í–ˆë˜ ë°˜ë©´ GoëŠ” ëª…í™•í•œ íŒ¨í„´ì´ë‚˜ ê¹”ë”í•˜ê²Œ ì •ì˜ê°€ ì—†ë‹¤(ì´ëŸ° ì‹ìœ¼ë¡œ OOP ì›ì¹™ì„ ì´ìš©í•´ë³¼ ìˆ˜ ìˆì§€ ì•Šì„ê¹Œ~ ì •ë„). ì•„ë§ˆ ì• ì´ˆì— GoëŠ” ê°ì²´ ì§€í–¥ ì–¸ì–´ë¡œ ì„¤ê³„í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì´ ì•„ë‹ê¹Œì‹¶ë‹¤.\nì´ë¥¼ ê³„ê¸°ë¡œ Goì—ì„œëŠ” OOP ì›ì¹™ë“¤ì´ ì–´ë–»ê²Œ ë‹¤ì–‘í•˜ê²Œ ì ìš©í•  ìˆ˜ ìˆëŠ”ì§€ ì¢€ ë” ìì„¸íˆ ì•Œì•„ë³¼ ìˆ˜ ìˆì—ˆë‹¤.\nì°¸ê³  [ë²ˆì—­] Goì™€ OOP - https://mingrammer.com/translation-go-and-oop/ Golang OOP tutorial - https://www.toptal.com/go/golang-oop-tutorial go object-oriented - https://golangkorea.github.io/post/go-start/object-oriented/ ","date":"2021-01-09T12:46:54+09:00","image":"https://umi0410.github.io/blog/golang/go-vs-java-oop/declaration_hu2809de309117ad963d612eaa5a399aab_35836_120x120_fill_box_smart1_3.png","permalink":"https://umi0410.github.io/blog/golang/go-vs-java-oop/","title":"Go vs Java - Goì—ì„œì˜ ê°ì²´ ì§€í–¥"},{"content":"ì‹œì‘í•˜ë©° ê°œë°œ ê³µë¶€ë¥¼ ì‹œì‘í•˜ê³  ì—¬íƒœê¹Œì§€ ëª‡ ë…„ê°„ ë°ë“œë½ì„ ì‹¤ì œë¡œ ì ‘í•  ì¼ì€ ì—†ì—ˆë‹¤. ì‚¬ì‹¤ ë™ì‹œì„±ì„ ì£¼ì˜í•´ì•¼í•˜ëŠ” ì‘ì—…ì„ í•´ë³¸ ì ë„ ì—†ì—ˆê³ , íŠ¸ëœì­ì…˜ì— ëŒ€í•œ ê°œë…ë„ ì—†ì—ˆê¸° ë•Œë¬¸ì¼ ìˆ˜ë„ ìˆë‹¤. ì „ê³µ ê³¼ëª©ì—ì„œ ë°ë“œë½ì— ëŒ€í•œ ë‚´ìš©ì„ ë“£ê³ ì„œë„ \u0026lsquo;ì•„ ì´ëŸ° ê²Œ ìˆêµ¬ë‚˜\u0026rsquo; ì •ë„ë¡œë§Œ ìƒê°í•˜ê³  ë„˜ê²¼ì—ˆë‹¤. í•˜ì§€ë§Œ Go ì–¸ì–´ë¥¼ í†µí•´ ê°œë°œì„ í•˜ë˜ ë„ì¤‘ Channelì´ë‚˜ Mutexë¡œ ì¸í•´ ì¢…ì¢… ë°ë“œë½ì„ ê²½í—˜í•  ìˆ˜ ìˆì—ˆê³ , ì´ ê²½ìš° í”„ë¡œê·¸ë¨ì´ ì™„ì „íˆ ë©ˆì¶°ë²„ë¦¬ëŠ” í¬ë¦¬í‹°ì»¬í•œ ë¬¸ì œê°€ ë°œìƒí•˜ê¸°ë„ í–ˆê³ , ë””ë²„ê¹…í•˜ê¸° í˜ë“  ê²½ìš°ë„ ìˆì—ˆë‹¤. ê·¸ëŸ° ê²½í—˜ì„ í•˜ë©´ì„œ \u0026lsquo;ë°ë“œë½ ì´ ë…€ì„\u0026hellip; ë§Œë§Œì¹˜ ì•Šêµ¬ë‚˜\u0026lsquo;ë¼ëŠ” ìƒê°ì„ í•˜ê³¤ í–ˆë‹¤.\nì´ë²ˆ ê¸€ì—ì„œëŠ” Golang ì¦‰ Go ì–¸ì–´ë¥¼ í†µí•´ ì–´ë–¤ ê²½ìš°ì— Deadlockì´ ë°œìƒí•  ìˆ˜ ìˆëŠ”ì§€ ì‹¤ì œ í”„ë¡œê·¸ë¨ì„ í†µí•´ ì•Œì•„ë³´ë ¤í•œë‹¤. Mutexì— ëŒ€í•œ Lockê³¼ ê°™ì´ ì¼ë°˜ì ìœ¼ë¡œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë°ë“œë½ë¶€í„° channelì´ë‚˜ goroutineì— ëŒ€í•œ Cooperative schedulingê³¼ ê°™ì€ Go ì–¸ì–´ì— íŠ¹í™”ëœ ë‚´ìš©ê¹Œì§€ë¥¼ ì •ë¦¬í•´ë³´ì•˜ë‹¤.\nDeadlockì´ë€ Deadlockì´ë€ êµì°©ìƒíƒœë¥¼ ì˜ë¯¸í•˜ë©° ë‘ ê°œ ì´ìƒì˜ ì‘ì—…ì´ ì„œë¡œ ìƒëŒ€ë°©ì˜ ì‘ì—…ì´ ëë‚˜ê¸°ë§Œì„ ê¸°ë‹¤ë¦¬ê³  ìˆê¸° ë•Œë¬¸ì— ê²°ê³¼ì ìœ¼ë¡œ ì•„ë¬´ê²ƒë„ ì™„ë£Œë˜ì§€ ëª»í•˜ëŠ” ìƒíƒœë¥¼ ê°€ë¦¬í‚¨ë‹¤. - ìœ„í‚¤ë°±ê³¼ -\në°ë“œë½ì˜ ê°œë… ìì²´ëŠ” ê·¸ë¦¬ ì–´ë µì§€ ì•Šê³ , ì˜ˆì‹œë¥¼ í†µí•´ì„œ ì‰½ê²Œ ì´í•´ê°€ ê°€ëŠ¥í•˜ë‹¤. ìœ„í‚¤ ë°±ê³¼ì— ë‚˜ì˜¨ ì˜ˆì‹œë¥¼ ì¸ìš©í•˜ìë©´ í•˜ë‚˜ì˜ ì‚¬ë‹¤ë¦¬ì— ìœ„ì—ì„œ ë‚´ë ¤ì˜¤ë ¤ëŠ” ì‚¬ëŒ, ì•„ë˜ì—ì„œ ì˜¬ë¼ê°€ëŠ” ì‚¬ëŒì´ ë™ì‹œì— ì˜¬ë¼ê°€ìˆìœ¼ë©´ ì•„ë¬´ë„ ë‚´ë ¤ì˜¤ê±°ë‚˜ ì˜¬ë¼ê°€ì§€ ëª»í•˜ëŠ” ê²½ìš°ë¥¼ ì˜ˆë¡œ ë“¤ ìˆ˜ ìˆë‹¤.\nêµì°© ìƒíƒœì˜ ì¡°ê±´ ë” ìì„¸íˆ ì •ì˜ë‚˜ ì˜ë¯¸ì— ëŒ€í•´ ì„¤ëª…í•  ê²ƒì€ ì—†ì„ ë“¯í•˜ê³ , í•™ë¬¸ì ìœ¼ë¡œëŠ” ì£¼ë¡œ ì•„ë˜ì˜ 4ê°€ì§€ ì¡°ê±´ì„ í†µí•´ ë°œìƒí•œë‹¤ê³  ì„¤ëª…í•˜ëŠ” ê²ƒ ê°™ë‹¤.\nìƒí˜¸ ë°°ì œ (Mutual exclusion) - í•˜ë‚˜ì˜ ìì›ì„ ë™ì‹œì— ì‚¬ìš©í•˜ì§€ ëª»í•˜ë„ë¡ í•˜ëŠ” ê²ƒ ì ìœ  ìƒíƒœë¡œ ëŒ€ê¸° (Hold and wait) - í•˜ë‚˜ì˜ ìì›ì„ ì†Œìœ í•œ ìƒíƒœë¡œ ë‹¤ë¥¸ ìì›ì„ ê¸°ë‹¤ë¦¬ê³  ìˆëŠ” ìƒíƒœ ì„ ì  ë¶ˆê°€ (No preemption) - ì»´í“¨í„° ë¶„ì•¼ì—ì„œì˜ ì„ ì ì€ í•œêµ­ë§ì˜ ì„ ì ê³¼ ë‹¤ì†Œ ë‹¤ë¥¸ ì˜ë¯¸. process í˜¹ì€ goroutineì˜ ìì›ì„ ë¹¼ì•—ëŠ” ê²ƒì„ ì„ ì ì´ë¼ê³  í•¨. ì„ ì  ë¶ˆê°€ë€ ê·¸ëŸ´ ìˆ˜ ì—†ëŠ” ìƒíƒœ. ìˆœí™˜ì„± ëŒ€ê¸° (Circular wait) - ê° í”„ë¡œì„¸ìŠ¤ê°€ ìˆœí™˜ì ìœ¼ë¡œ ë‹¤ìŒ í”„ë¡œì„¸ìŠ¤ê°€ ìš”êµ¬í•˜ëŠ” ìì›ì„ ê°€ì§€ê³ ìˆë‹¤. ì‰½ê²Œ 2ê°œì˜ í”„ë¡œì„¸ìŠ¤ë¥¼ ì˜ˆë¡œ ë“¤ë©´ AëŠ” Bê°€ ì†Œìœ  ì¤‘ì¸ ìì›ì„, BëŠ” Aê°€ ì†Œìœ  ì¤‘ì¸ ìì›ì„ ì–»ìœ¼ë ¤ê³  ëŒ€ê¸° ì¤‘ì¸ ìƒí™©ì„ ë§í•¨. Deadlockì˜ ê°œë… ìì²´ê°€ ì–´ë µë‹¤ê±°ë‚˜ ìœ„ì˜ 4ê°€ì§€ ì¡°ê±´ì„ ì•”ê¸°í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•œ ê²ƒì€ ì•„ë‹ˆë¼ê³  ìƒê°í•œë‹¤. ì¤‘ìš”í•œ ê²ƒì€ ì‹¤ì œë¡œ ì–´ë–¤ ê²½ìš°ì— ë°ë“œë½ì´ ë°œìƒí•  ìˆ˜ ìˆì„ ì§€ íŒŒì•…í•˜ê³  ì£¼ì˜í•˜ëŠ” ê²ƒê³¼ ê·¸ ê²½ìš° ì–´ë–»ê²Œ í•´ê²°í•  ìˆ˜ ìˆì„ì§€ ì¸ì§€í•˜ëŠ” ê²ƒì´ë¼ê³  ìƒê°í•œë‹¤. ê·¸ëŸ¼ Go ì–¸ì–´ë¡œ ê°„ë‹¨í•œ í”„ë¡œê·¸ë¨ì„ ì§œë³´ë©° ì•Œì•„ë³´ì.\nGoì—ì„œ ë°œìƒí•  ìˆ˜ ìˆëŠ” Deadlock Channel ì£¼ë¡œ ì±„ë„ì„ ì ‘í•œ ì§€ ì–¼ë§ˆ ì•ˆ ë˜ì–´ ê·¸ ë™ì‘ ë°©ì‹ì„ ì˜ ì´í•´í•˜ì§€ ëª»í•œ ì±„ ì‚¬ìš©í•  ê²½ìš° ì±„ë„ë¡œ ì¸í•œ ë°ë“œë½ì´ ë°œìƒí•œë‹¤.\nUnbuffered channel unbuffered-channel-1.png íŠ¹íˆë‚˜ unbuffered channelì— ëŒ€í•œ ë¯¸ìˆ™í•œ ì‚¬ìš©ì€ ìì£¼ ë°ë“œë½ì„ ì•¼ê¸°í•œë‹¤. unbuffered channelì—ì„œ ë°œìƒí•˜ëŠ” ì¼ë°˜ì ì¸ ë°ë“œë½ì˜ ì˜ë¯¸ì¸ 2ê°œ ì´ìƒì˜ ì‘ì—… ì„œë¡œì˜ ì‘ì—…ì´ ì™„ë£Œë˜ê¸°ë¥¼ ëŒ€ê¸°í•˜ëŠ” êµì°© ìƒíƒœì™€ëŠ” ì•½ê°„ ë‹¤ë¥´ë‹¤ê³  ë³¼ ìˆ˜ë„ ìˆë‹¤. ì™œëƒí•˜ë©´ senderì™€ receiver ì¤‘ ëˆ„êµ°ê°€ê°€ ë¨¼ì € ì‘ì—…ì„ ëë‚´ì•¼ì§€ ê·¸ ë‹¤ìŒìœ¼ë¡œ ëˆ„êµ°ê°€ê°€ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì„œë¡œ ë™ì‹œì— í˜‘ë ¥í•´ì•¼ë§Œ unbuffered channelì— ëŒ€í•œ ëŒ€ê¸°ë¥¼ ëë‚¼ ìˆ˜ ìˆëŠ”ë° ì´ ê²½ìš°ëŠ” ë™ì‹œì— í˜‘ë ¥í•´ì¤„ ê·¸ ëˆ„êµ°ê°€(receiver)ê°€ ì—†ëŠ” ê²½ìš°ì´ê¸° ë•Œë¬¸ì´ë‹¤.\nunbuffered-channel-2.png ê·¸ë ‡ë‹¤ê³ í•´ì„œ ìœ„ì™€ ê°™ì´ ìê¸° í˜¼ì sendì™€ receiveë¥¼ í•˜ë ¤í•´ë´¤ì Unbuffered channelì€ senderì™€ receiverê°€ ëª¨ë‘ readyì—¬ì•¼ ì‘ì—…ì„ ì§„í–‰í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë¶ˆê°€ëŠ¥í•˜ë‹¤. (Unbuffered channelì˜ ë™ì‘ì— ëŒ€í•´ ì¢€ ë” ê¶ê¸ˆí•˜ì‹  ë¶„ë“¤ì€ ì œê°€ ë²ˆì—­ì— ì°¸ì—¬í•œ A Tour of Goë¥¼ ì°¸ê³ í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤!)\nunbuffered-channel-3.png ë”°ë¼ì„œ ë‹¤ë¥¸ goroutineì—ì„œ Aì— ëŒ€í•œ receiver ì—­í• ì„ í•´ì£¼ë©´ ëœë‹¤.\nBuffered channel Buffered channelì„ ì´ìš©í•˜ë©´ ì–´ë–¨ì§€ ì¢€ ë” ìì„¸íˆ ë“¤ì–´ê°€ë³´ì. ë…ìë¶„ê»˜ì„œ Goì˜ channelì— ëŒ€í•´ ë³„ ê´€ì‹¬ì´ ì—†ë‹¤ë©´ íŒ¨ìŠ¤~!\nbuffered-channel-1.png ë§¨ ì²˜ìŒì— Unbuffered channelì—ì„œëŠ” ìœ„ì™€ ê°™ì´ í•œ goroutineì—ì„œ senderì™€ receiver ì—­í•  ëª¨ë‘ë¥¼ ìˆ˜í–‰í•˜ë ¤í•´ë„ ì´ë¯¸ senderì—ì„œ blockì´ ê±¸ë ¤ë²„ë ¤ deadlockì„ ì•¼ê¸°í•œë‹¤ê³  í–ˆìœ¼ë‚˜ buffered channelì—ì„œëŠ” ê·¸ë ‡ì§€ ì•Šë‹¤! buffered channelì€ buffer sizeê¹Œì§€ëŠ” ì…ë ¥ ì‘ì—…ì´ ë¸”ë½ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì´ë‹¤.\nbuffered-channel-2.png í•˜ì§€ë§Œ buffer sizeë¥¼ ë„˜ì–´ì„œëŠ” ìˆœê°„ë¶€í„°ëŠ” receiverê°€ channel ë‚´ì˜ ì•„ì´í…œì„ êº¼ë‚´ì–´ ì¤„ ë•Œê¹Œì§€ blockë˜ì–´ë²„ë¦¬ë¯€ë¡œ ì£¼ì˜í•´ì•¼í•œë‹¤.\nMutex.Lockì˜ ì¤‘ì²© Mutexì˜ êµ¬í˜„ì— ë”°ë¼ ë‹¤ë¥´ê² ì§€ë§Œ Goì—ì„œëŠ” Lockì´ ê±¸ë¦° ìë¬¼ì‡ ì— ë‹¤ì‹œ ìê¸°ê°€ Lockì„ ê±¸ë ¤í•´ë„ Unlockì´ ë  ë•Œê¹Œì§€ëŠ” Lockì„ ê±¸ ìˆ˜ ì—†ë‹¤. ì¦‰ ì–´ë–¤ Mutexì— Lockì„ ê±´ ê²ƒì´ ìì‹ (Goroutine)ì´ë¼ í•´ë„ í•´ë‹¹ Mutexì— ë˜ ë‹¤ì‹œ Lockì„ ê±¸ë ¤í•˜ë©´ ê·¸ ì‘ì—…ì€ Mutexê°€ Unlock ë  ë•Œê¹Œì§€ ë¸”ë½ë˜ê³  ê²°ê³¼ì ìœ¼ë¡œëŠ” Deadlock ìƒíƒœê°€ ë˜ì–´ë²„ë¦°ë‹¤.\npackage main import ( \u0026#34;fmt\u0026#34; \u0026#34;sync\u0026#34; ) var ( scores = []int{10,30,20} Mutex = \u0026amp;sync.Mutex{} ) // Lockì„ ê±´ ë’¤ ì•ˆì „í•˜ê²Œ topScoreë¥¼ êµ¬í•¨. func GetTopScore() (playerIndex, topScore int){ Mutex.Lock() topScore = -1 for idx, score := range scores{ if topScore \u0026lt; score{ playerIndex = idx topScore = score } } Mutex.Unlock() return } // GetTopScoreëŠ” ì´ë¯¸ Lockì„ ì´ìš©í•´ thread safeí•˜ê²Œ ì‘ì—…í•˜ëŠ”ë° // ê·¸ê±¸ ì¸ì§€í•˜ì§€ ëª»í•˜ê³  ì‹¤ìˆ˜ë¡œ ê·¸ ë°–ì¸ Awardì—ì„œ Lockì„ ê±¸ì–´ë²„ë¦¼. func Award(){ Mutex.Lock() playerIdx, topScore := GetTopScore() Mutex.Unlock() fmt.Printf(\u0026#34;%dê°€ %dì˜ ì ìˆ˜ë¡œ ìš°ìŠ¹í–ˆìŠµë‹ˆë‹¤!\u0026#34;, playerIdx, topScore) } func main(){ Award() } // deadlock ë°œìƒ ìœ„ì˜ ì˜ˆì‹œì—ëŠ” thread-safeí•˜ê²Œ top scoreë¥¼ êµ¬í•˜ëŠ” GetTopScore í•¨ìˆ˜ê°€ ì„ ì–¸ë˜ì–´ìˆë‹¤. í•˜ì§€ë§Œ Award í•¨ìˆ˜ì—ì„œ ì´ë¯¸ GetTopScoreëŠ” scoresì— ëŒ€í•´ thread-safeí•¨ì—ë„ ë¶ˆêµ¬í•˜ê³  Lockì„ ê±¸ê³  GetTopScoreë¥¼ ìˆ˜í–‰í•˜ë ¤í•˜ê¸° ë•Œë¬¸ì— ë°ë“œë½ì´ ë°œìƒí•œë‹¤. ì´ ê²½ìš°ì—ëŠ” innerì¸ GetTopScore í˜¹ì€ outerì¸ Award ë‘˜ ì¤‘ í•œ ê³³ì—ì„œë§Œ Lock, Unlock ì‘ì—…ì„ ìˆ˜í–‰í•˜ë„ë¡ í•´ì£¼ì–´ì•¼í•œë‹¤.\ninnerì—ì„œ Lock/Unlockì„ ë‹´ë‹¹í•˜ëŠ” ê²Œ ì˜³ì„ ì§€ outerì—ì„œ Lock/Unlockì„ ë‹´ë‹¹í•˜ëŠ” ê²Œ ì˜³ì„ ì§€ëŠ” ì˜ ëª¨ë¥´ê² ë‹¤. innerì—ì„œ Lock/Unlockì„ ë‹´ë‹¹í•˜ë©´ outerì—ì„œëŠ” ë°ë“œë½ìœ¼ë¡œ ì¸í•´ ì ˆëŒ€ Lock/Unlockì„ ëª»í•œë‹¤ëŠ” ë‹¨ì ì´ ìˆì§€ë§Œ, í•´ë‹¹ ì‘ì—…ì€ ì–¸ì œë‚˜ Atomicí•˜ê²Œ thread-safeí•˜ë‹¤ëŠ” ê²ƒì´ ë³´ì¥ëœë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤. ë°˜ë©´ outerì—ì„œ Lock/Unlockì„ ë‹´ë‹¹í•˜ë„ë¡í•˜ë©´ ë¹„êµì  ììœ ìì¬ë¡œ Lock/Unlockì„ ëª…ë ¹í•  ìˆ˜ ìˆëŠ” ë°˜ë©´ thread-safeí•´ì•¼í•  ë‚´ë¶€ ì‘ì—…ì´ unsafeí•´ì§ˆ ìˆ˜ë„ ìˆë‹¤. ì‹¤ìˆ˜ë¡œ Lock/Unlock ì‘ì—…ì„ ìŠì–´ë²„ë¦´ ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤. í•˜ì§€ë§Œ ë¬´ì—‡ë³´ë‹¤ë„ innerì—ì„œ Lock/Unlockì„ ë‹´ë‹¹í•  ì§€ outerì—ì„œ ë‹´ë‹¹í•  ì§€ë¥¼ ì •í™•íˆ ì •í•  ìˆ˜ ì—†ëŠ” ì´ìœ ëŠ” outerë„ ê²°êµ­ì—” ë˜ ë‹¤ë¥¸ outerì˜ innerê°€ ë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë¼ê³  ìƒê°í•œë‹¤.\nCooperative scheduling ë°©ì‹ì—ì„œì˜ ë¬´í•œ Loop Goroutine schedulerê°€ Goroutineì„ ìŠ¤ì¼€ì¥´ë§ í•˜ëŠ” ë°©ì‹ì€ Go 1.14 ì´ì „ê¹Œì§€ëŠ” Cooperative ë°©ì‹ì´ì—ˆìœ¼ë‚˜, Go 1.14 ë¶€í„°ëŠ” Preemptiveí•œ ë°©ì‹ìœ¼ë¡œ ë°”ë€Œì—ˆë‹¤ê³  í•œë‹¤. OSê°€ Go processì˜ threadë¥¼ ìŠ¤ì¼€ì¥´ í•˜ëŠ” ë°©ì‹ì€ OS ë§ˆë‹¤ ë‹¤ë¥´ê² ì§€ë§Œ ëŒ€ì²´ë¡œ preemptiveí•  ê²ƒì´ê³  ì—¬ê¸°ì„œ ì–˜ê¸°í•˜ë ¤ëŠ” ìŠ¤ì¼€ì¥´ëŸ¬ëŠ” Goroutineì„ ìŠ¤ì¼€ì¥´ë§í•˜ëŠ” Goroutine schedulerì„ì„ ì£¼ì˜í•˜ì.\nGoroutineì€ syscallì™€ mutex, channel, í•¨ìˆ˜ ì½œ ë“±ìœ¼ë¡œ ì¸í•´ switch ë  ìˆ˜ ìˆëŠ”ë°, cooperative ë°©ì‹ì„ ì´ìš©í•˜ëŠ” ê²½ìš°ì—ëŠ” ì´ëŸ¬í•œ goroutine switch ì¡°ê±´ì— í•´ë‹¹í•˜ì§€ ì•ŠëŠ” ê²½ìš° ì„ì˜ë¡œ goroutine switch í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì§€ ì•ŠëŠ” í•œì€ ê°™ì€ ìŠ¤ë ˆë“œ ë‚´ì˜ ë‹¤ë¥¸ goroutineì€ ì ˆëŒ€ë¡œ ì‹¤í–‰ë  ìˆ˜ ì—†ë‹¤. preemption(ì„ ì ) ì¦‰ ë‹¤ë¥¸ goroutineì„ block ìƒíƒœë¡œ ë§Œë“¤ì–´ë²„ë¦¬ê³  ìì‹ ì´ CPUë¥¼ ì„ ì í•˜ëŠ” ê²ƒì´ ë¶ˆê°€ëŠ¥í–ˆê¸° ë•Œë¬¸ì´ë‹¤. í•˜ì§€ë§Œ Go 1.14ë¶€í„°ëŠ” ì•½ 10msë¥¼ ê¸°ì¤€ìœ¼ë¡œ preemptionì„ ìˆ˜í–‰í•˜ê³  ìˆë‹¤. Asynchronous preemptionì´ë¼ê³  ë¶€ë¥´ëŠ” ê²ƒ ê°™ì€ë°, ì •í™•íˆ ì™œ asynchronousì¸ì§€, ê¸°ì¡´ì˜ preemptive scheduleê³¼ëŠ” ë¬´ì—‡ì´ ë‹¤ë¥¸ì§€ëŠ” ì°¾ì•„ë´¤ìœ¼ë‚˜ ì œëŒ€ë¡œ ì„¤ëª…ë˜ì–´ìˆëŠ” ê³³ì„ ì°¾ì§€ ëª»í–ˆë‹¤.\nì•ìœ¼ë¡œ ì´ì–´ì§€ëŠ” ë‚´ìš©ì€ ë°ë“œë½ì— ëŒ€í•œ ì˜ˆì‹œë¼ê¸° ë³´ë‹¤ëŠ” \u0026lsquo;cooperative ìŠ¤ì¼€ì¥´ë§ê³¼ preemptive ìŠ¤ì¼€ì¥´ë§ì˜ ì°¨ì´ë¡œ ì¸í•´ ë°ë“œë½ì´ ë°œìƒí•  ìˆ˜ë„ ìˆê³  ë°œìƒí•˜ì§€ ì•Šì„ ìˆ˜ë„ ìˆêµ¬ë‚˜\u0026rsquo;ì— ëŒ€í•´ ì•Œì•„ë³´ëŠ” ì˜ˆì‹œì´ë‹¤.\npackage main import ( \u0026#34;fmt\u0026#34; ) func Foo(){ fmt.Println(\u0026#34;No Deadlock. ë‚˜ë„ ì‹¤í–‰ë  ìˆ˜ ìˆì–´!\u0026#34;) } func main(){ go Foo() dummy := 0 // ê·¸ëƒ¥ for ë¬¸ ì•ˆì—ì„œ dummy ì‘ì—…ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•œ ë³€ìˆ˜ for { dummy += 1 } } for ë¬¸ ì•ˆì—ì„œëŠ” í•¨ìˆ˜ì½œë„ syscallë„ channel/mutexë„ ì•„ë‹Œ goroutine swtichì™€ ê´€ë ¨ ì—†ëŠ” dummy += 1 ì‘ì—…ë§Œì„ ìˆ˜í–‰í•˜ê³  ìˆë‹¤. ì´ ê²½ìš° go Foo()ë¥¼ í†µí•´ goroutineì„ ìƒì„±í•˜ê¸´ í•˜ì§€ë§Œ ê·¸ goroutineì€ ë°”ë¡œ ì‹¤í–‰ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ëŒ€ê¸° ìƒíƒœì´ë©° ë§Œì•½ ìŠ¤ë ˆë“œê°€ í•˜ë‚˜ë¼ë©´ cooperative ìŠ¤ì¼€ì¥´ë§ìœ¼ë¡œëŠ” Fooë¼ëŠ” goroutineì´ ì‹¤í–‰ë  ìˆ˜ê°€ ì—†ì„ ê²ƒì´ë‹¤.\n# Go ë²„ì „ \u0026gt;= 1.14 ì¼ ë•Œì—ë„ Deadlock ë°œìƒ $ GOMAXPROCS=1 GODEBUG=asyncpreemptoff=1 go run main.go GOMAXPROCS=1 - Go í”„ë¡œê·¸ë¨ì´ ì‚¬ìš©í•  ìµœëŒ€ OS Thread ê°œìˆ˜ë¥¼ 1ê°œë¡œ ì œí•œí•¨ìœ¼ë¡œì¨ ì—¬ëŸ¬ ìŠ¤ë ˆë“œì—ì„œ Goroutineì´ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ ë°©ì§€. (ë°ë“œë½ì„ ì•¼ê¸°í•´ë³´ë ¤ëŠ” ì¡°ê±´) GODEBUG=asyncpreemptoff=1 - Go 1.14ë¶€í„° ì ìš©ëœ Asynchronous preemptive schedulingì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì˜µì…˜ ì´ ê²½ìš° Go ë²„ì „ì´ 1.14 ì´ìƒì´ë¼ë©´ FooëŠ” ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.\n# Go ë²„ì „ \u0026gt;= 1.14ì¸ ê²½ìš° async preemptionìœ¼ë¡œ ì¸í•´ Deadlock ë°œìƒ X $ GOMAXPROCS=1 go run main.go No Deadlock. ë‚˜ë„ ì‹¤í–‰ë  ìˆ˜ ìˆì–´! í•˜ì§€ë§Œ asyncpreemptoff ì˜µì…˜ì„ ìƒëµí•˜ë©´ ê¸°ë³¸ì ìœ¼ë¡œ ì„ ì í˜• ìŠ¤ì¼€ì¥´ë§ì´ ì§€ì›ë˜ë¯€ë¡œ ì´ ê²½ìš°ì—” Deadlockì´ ë°œìƒí•˜ì§€ ì•Šê³  Foo() í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ \u0026ldquo;No Deadlock. ë‚˜ë„ ì‹¤í–‰ë  ìˆ˜ ìˆì–´!\u0026rdquo; ë¼ëŠ” Stdoutì„ í†µí•´ ë³¼ ìˆ˜ ìˆë‹¤.\npprofë¥¼ ì´ìš©í•œ goroutine schedule ì‹œê°í™” í•˜ì§€ë§Œ ì •ë§ë¡œ async preemptionì´ ë™ì‘í–ˆê¸° ë•Œë¬¸ì— ë°ë“œë½ì— ë¹ ì§€ì§€ ì•Šì€ ê²ƒì¸ì§€ ë‹¤ë¥¸ ì´ìœ  ë•Œë¬¸ì¸ì§€ëŠ” ê·¸ë‹¥ ì§ê´€ì ìœ¼ë¡œ ì™€ë‹¿ì§€ ì•ŠëŠ”ë‹¤. ê·¸ë˜ì„œ ëª‡ëª‡ ì™¸êµ­ ë¸”ë¡œê·¸ì˜ ê¸€ì—ì„œ ë´¤ë˜ pprofë¼ëŠ” ë„êµ¬ë¥¼ ì‚¬ìš©í•´ë´¤ê³ , ì²˜ìŒì—” ì‚¬ìš©ë²•ì´ ë‹¤ì†Œ ì–´ë ¤ì› ì§€ë§Œ ì¡°ê¸ˆ ìµìˆ™í•´ì§€ë‹ˆ ë„ˆë¬´ë‚˜ë„ í¸ë¦¬í–ˆë‹¤. pprofëŠ” net/http íŒ¨í‚¤ì§€ í•˜ìœ„ì— ì¡´ì¬í•˜ê³ , Goroutine scheduling, syscall log, CPU ì‚¬ìš© ë“±ì„ ì‹œê°í™”í•´ì„œ ë³´ì—¬ì£¼ëŠ” ê°„í¸í•œ ë””ë²„ê¹… ë„êµ¬ì´ë‹¤. ìš”ì²­ì„ ë‚ ë¦¬ë©´ ìš”ì²­ ì´í›„ Nì´ˆ ê°„ì˜ goroutine schedulingì— ëŒ€í•œ ì •ë³´ë¥¼ ê¸°ë¡í•´ ë³´ì—¬ì£¼ëŠ” ê¸°ëŠ¥ì„ ì´ìš©í•´ë³´ì•˜ë‹¤.\npprof-debugging-1.png End Stack Traceë¥¼ í†µí•´ ì–´ë–¤ ì‘ì—…ìœ¼ë¡œ ì¸í•´ goroutineì´ ì ì‹œ ì¤‘ë‹¨ë˜ê³  CPUë¥¼ ë‹¤ë¥¸ goroutineì—ê²Œ ì–‘ë³´í•˜ê²Œ ë˜ëŠ”ì§€ ì•Œ ìˆ˜ ìˆë‹¤. ë†€ëê²Œë„ dummyì— ëŒ€í•œ ë¬´í•œ ë£¨í”„ ì§„í–‰ ë„ì¤‘ ì²˜ìŒìœ¼ë¡œ async preemptionì´ ë°œìƒí•œ ë’¤ ì´ì–´ì„œ Foo í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ëŠ” goroutineì´ CPUë¥¼ ì ìœ í•˜ê²Œ ëœë‹¤ëŠ” ê²ƒì„ ì‹œê°ì ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆë‹¤.\nWall Durationì€ í•´ë‹¹ ê³ ë£¨í‹´ ë¸”ëŸ­ì„ ìˆ˜í–‰í•œ ì‹œê°„ìœ¼ë¡œ ë³´ì—¬ì§€ê³  ì•½ 10msë¥¼ ê¸°ì¤€ìœ¼ë¡œ preemptiveí•˜ê²Œ switchê°€ ì¼ì–´ë‚  ìˆ˜ ìˆë‹¤ëŠ” ì—¬ëŸ¬ ë¸”ë¡œê·¸ì˜ ê¸€ë“¤ê³¼ ìœ ì‚¬í•˜ê²Œ 15,021,904ns, ì¦‰ ì•½ 15msë§Œì— asyncPreemptë¼ëŠ” ì´ë²¤íŠ¸ë¡œ ì¸í•´ goroutine switchê°€ ì¼ì–´ë‚¬ë‹¤. cooperative ìŠ¤ì¼€ì¥´ë§ë§Œì„ ì´ìš©í•˜ëŠ” ê²½ìš°ì—ëŠ” ë°ë“œë½ìœ¼ë¡œ ì¸í•´ í•œ ë²ˆë„ Fooë¥¼ ì‹¤í–‰í•˜ëŠ” goroutineì´ ìˆ˜í–‰ë˜ì§€ ëª»í•œë‹¤ëŠ” ê²ƒë„ ì‹œê°í™”í•´ì„œ ì œê³µí•´ë³´ê³ ì‹¶ì—ˆì§€ë§Œ, ë‹¹ì—°í•˜ê²Œë„ ê·¸ ë°ë“œë½ìœ¼ë¡œ ì¸í•´ ì¼ì • ê¸°ê°„ë™ì•ˆ runtimeì„ ê´€ì°°í•œ ë’¤ ê·¸ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” goroutine ì¡°ì°¨ ì‹¤í–‰í•  ìˆ˜ ì—†ì–´ ê·¸ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ì—†ì—ˆë‹¤!\n# Goì˜ ë²„ì „ì„ 1.13ìœ¼ë¡œ ì œí•œí•´ë³¸ë‹¤. FROM golang:1.13 WORKDIR /app COPY . . ENTRYPOINT [\u0026#34;go\u0026#34;] CMD [\u0026#34;run\u0026#34;, \u0026#34;main.go\u0026#34;] $ docker build . -t tmp \u0026amp;\u0026amp; \\ docker run -it --rm -e GOMAXPROCS=1 tmp ê·¸ë ‡ë‹¤ë©´ ì •ë§ Goì˜ 1.14 ì´ì „ ë²„ì „ì€ Preemptiveí•œ ë°©ì‹ì´ ì•„ë‹ˆë¼ Cooperativeí•œ ë°©ì‹ì„ ì´ìš©í•˜ê³ , ì´ ê²½ìš° ë°ë“œë½ì´ ë°œìƒí• ê¹Œ? ì´ì „ ê¸€ë“¤ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ Dockerë¥¼ ì´ìš©í•´ ê°„í¸í•˜ê²Œ Goì˜ ë²„ì „ì„ ë³€ê²½í•´ì„œ ì‹¤í–‰í•´ë³´ì. golang:1.13 ì´ë¯¸ì§€ë¥¼ ì´ìš©í•´ë³´ì•˜ë‹¤.\n1.13 ë²„ì „ ì´í•˜ë¡œëŠ” GODEBUG=asyncpreemptoff=1 ì˜µì…˜ì„ ì„¤ì •í•˜ì§€ ì•Šì•„ë„ cooperativeí•œ ìŠ¤ì¼€ì¥´ë§ë§Œì„ ì§€ì›í•˜ë¯€ë¡œ í”„ë¡œê·¸ë¨ì´ ë°ë“œë½ ìƒíƒœì— ë¹ ì ¸ Foo()ê°€ ì‹¤í–‰ë˜ì§€ ëª»í•¨ì„ ì•Œ ìˆ˜ ìˆë‹¤.\nì°¸ê³  ì‚¬í•­) GOMAXPROCS=1 ì˜µì…˜ì„ ì£¼ëŠ” ì´ìœ ëŠ”? The GOMAXPROCS variable limits the number of operating system threads that can execute user-level Go code simultaneously. - go rutime package ë¬¸ì„œ -\nGOMAXPROCSëŠ” Go í”„ë¡œê·¸ë¨ì´ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìµœëŒ€ì˜ OS ìŠ¤ë ˆë“œ ê°œìˆ˜ë¥¼ ì˜ë¯¸í•œë‹¤. ë§Œì•½ OS ìŠ¤ë ˆë“œê°€ 2ê°œ ì´ìƒìœ¼ë¡œ ìƒì„±ëœë‹¤ë©´ ìœ„ì˜ ê²½ìš° main goroutineê³¼ í•¨ìˆ˜ Fooë¥¼ ì‹¤í–‰í•˜ëŠ” Goroutineì´ ì„œë¡œ ë‹¤ë¥¸ ìŠ¤ë ˆë“œì— ë°°ì¹˜ë  ê²ƒì´ê³ , ê·¸ ê²½ìš° Goì˜ ìŠ¤ì¼€ì¥´ëŸ¬ê°€ Cooperativeí•œ ë°©ì‹ì„ ì´ìš©í•œë‹¤í•´ë„ OS ìŠ¤ì¼€ì¥´ëŸ¬ê°€ Preemptiveí•˜ê²Œ ê°ê°ì˜ Go ìŠ¤ë ˆë“œ(OS Level)ë¥¼ ìŠ¤ì¼€ì¥´í•˜ê¸° ë•Œë¬¸ì— Foo goroutineë„ ì‹¤í–‰ë  ìˆ˜ ìˆëŠ” ê¸°íšŒê°€ ì£¼ì–´ì§„ë‹¤. ì´ ê²½ìš°ì—ëŠ” ë°ë“œë½ì´ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤. ë”°ë¼ì„œ ìš°ë¦¬ëŠ” ë°ë“œë½ì„ ë°œìƒì‹œì¼œë³´ê³ ì GOMAXPROCSë¥¼ 1ë¡œ ì œí•œí•œë‹¤.\në§ˆì¹˜ë©° Goë¥¼ ì´ìš©í•´ ì‹¤ì œ í”„ë¡œê·¸ë¨ì„ ì§œë³´ë©° ì–´ë–¤ ê²½ìš°ì— Deadlockì´ ë°œìƒí•  ìˆ˜ ìˆëŠ”ì§€ ì•Œì•„ë³´ì•˜ë‹¤. ì´ ê¸€ì—ì„  ì„œë¡œ ê°™ì€ Mutexë¥¼ ì´ìš©í•˜ëŠ” ê²½ìš°ë¥¼ ì˜ˆì‹œë¡œ ë“¤ì—ˆì§€ë§Œ ì„œë¡œ ë‹¤ë¥¸ ë‘ Mutexë¥¼ í†µí•´ ì„œë¡œì˜ ì‘ì—…ì„ ê¸°ë‹¤ë¦¬ëŠ” ê²½ìš°ì˜ Deadlockë„ ê±°ì˜ ìœ ì‚¬í•˜ë©° ì¼ë°˜ì ìœ¼ë¡œ ë§í•˜ëŠ” Deadlockì— ê°€ì¥ ê°€ê¹Œìš´ ê²½ìš°ì´ê¸´í•  ê²ƒì´ë‹¤. ê·¸ë˜ë„ Goë¡œ ê°œë°œì„ í•˜ë©´ì„œ ì•„ì§ ì„œë¡œ ë‹¤ë¥¸ Mutexë¥¼ ì´ìš©í–ˆë˜ ê²½ìš°ê°€ ë”±íˆ ì—†ì—ˆê¸°ì— ê°™ì€ Mutexì— ì¤‘ì²©ìœ¼ë¡œ Lockì„ ê±¸ì—ˆë˜ ê²½ìš°ë¥¼ ì˜ˆì‹œë¡œ ë“¤ì–´ë³´ì•˜ë‹¤.\nChannelì´ë‚˜ Cooperative schedulingì˜ ê²½ìš°ëŠ” ì–´ëŠ ì •ë„ Goì— í•œì •ì ì¸ ë‚´ìš©ì´ê³  íŠ¹íˆë‚˜ ìŠ¤ì¼€ì¥´ë§ì€ ëŸ°íƒ€ì„ì´ë‚˜ ê³ ë£¨í‹´ ìŠ¤ì¼€ì¥´ ë°©ì‹ê¹Œì§€ ë‚´ë ¤ê°€ëŠ” ì„¸ë¶€ì ì¸ ë‚´ìš©ì´ê¸´í•˜ì§€ë§Œ Goì— íŠ¹íˆ ê´€ì‹¬ ìˆìœ¼ì‹  ë¶„ë“¤ê»˜ëŠ” ë‚˜ë¦„ ì¬ë¯¸ìˆëŠ” ë‚´ìš©ì´ ë˜ì§€ ì•Šì•˜ì„ê¹Œì‹¶ë‹¤.\nê·¸ë¦¬ê³  ì´ì „ ê¸€ì—ì„  testingì˜ benchmarkë¥¼ ì´ìš©í•´ ì¢€ ë” ì •í™•í•˜ê³  í¸ë¦¬í•œ ë²¤ì¹˜ë§ˆí‚¹ì„ ë„ì…í•´ë´¤ë‹¤ëŠ” ì ê³¼ ì´ë²ˆì—” ì¶”ê°€ì ìœ¼ë¡œ pprofë¥¼ ì´ìš©í•´ goroutine ìŠ¤ì¼€ì¥´ë§ì„ ì‹œê°í™”í•´ë´¤ë‹¤ëŠ” ì ì—ì„œ Golangìœ¼ë¡œ ì ìš©í•´ë³´ëŠ” ì»´í“¨í„° ì‚¬ì´ì–¸ìŠ¤ë¼ëŠ” ì´ ì‹œë¦¬ì¦ˆë¥¼ ì²˜ìŒ ì‹œì‘í–ˆì„ ë•Œì— ë¹„í•´ ì»´í“¨í„° ì‚¬ì´ì–¸ìŠ¤ ë¿ë§Œ ì•„ë‹ˆë¼ ë””ë²„ê¹… ê¸°ìˆ ì´ë‚˜ ìŠ¤ì¼€ì¥´ë§ ë°©ì‹ ë“±ë“± ë‹¤ì–‘í•œ ì£¼ì œì— ëŒ€í•´ì„œë„ ê³µë¶€í•´ë³´ê³  ì ìš©í•´ë³¼ ìˆ˜ ìˆì—ˆë˜ ê²ƒ ê°™ì•„ ë¿Œë“¯í•˜ë‹¤. ë‹¤ì†Œ Goë§Œì˜ ì§€ì—½ì ì¸ ë‚´ìš©ìœ¼ë¡œ ì—¬ê²¨ì§ˆ ìˆ˜ë„ ìˆê² ì§€ë§Œ ì¶”í›„ì— ë‚´ê°€ ì–´ë–¤ ì–¸ì–´ë¥¼ ê³µë¶€í•˜ë“  ì–´ë–¤ ê¸°ìˆ ì„ ê³µë¶€í•˜ë“  ì´ëŸ¬í•œ ê²½í—˜ë“¤ì„ ì–¼ë§ˆë“ ì§€ ë…¹ì—¬ë‚¼ ìˆ˜ ìˆì„ ê²ƒì´ë¼ ìƒê°í•œë‹¤!!\nì°¸ê³  Go: How are Deadlocks Triggered? https://medium.com/a-journey-with-go/go-how-are-deadlocks-triggered-2305504ac019\nGo: What Does a Goroutine Switch Actually Involve? https://medium.com/a-journey-with-go/go-what-does-a-goroutine-switch-actually-involve-394c202dddb7\nGoroutine and Preemption https://medium.com/a-journey-with-go/go-goroutine-and-preemption-d6bc2aa2f4b7\nGo: Asynchronous Preemption https://medium.com/a-journey-with-go/go-asynchronous-preemption-b5194227371c\në°ë“œë½ ì •ì˜\nhttps://namu.wiki/w/%EB%8D%B0%EB%93%9C%EB%9D%BD?from=Deadlock https://ko.wikipedia.org/wiki/%EA%B5%90%EC%B0%A9_%EC%83%81%ED%83%9C Go runtime documentation https://golang.org/pkg/runtime/\n","date":"2021-01-31T18:25:54+09:00","image":"https://umi0410.github.io/blog/golang/go-deadlock/pprof-debugging-1_hu27a13bf8dcdafb0aaff224765e3a83ab_59369_120x120_fill_box_smart1_3.png","permalink":"https://umi0410.github.io/blog/golang/go-deadlock/","title":"Go ì–¸ì–´ë¡œ ì ìš©í•´ë³´ëŠ” Computer Science - Deadlock"},{"content":"ì‹œì‘í•˜ë©° ì €ë²ˆ í•™ê¸°ì— ì»´í“¨í„° êµ¬ì¡°ë¥¼ ìˆ˜ê°•í•˜ë©´ì„œ ê°„ê³¼í•˜ê³  ìˆë˜ ë¡œìš° ë ˆë²¨ì˜ ì§€ì‹ì—ë„ í¥ë¯¸ê°€ ìƒê²¼ì—ˆë‹¤. ê·¸ ì¤‘ CPUì™€ Memory, Diskì˜ ì—­í• ì— ëŒ€í•´ ì•Œì•„ë³¼ ìˆ˜ ìˆì—ˆê³  ìºì‹œëŠ” CPUì™€ Memory ì‚¬ì´ì— ìœ„ì¹˜í•´ ë©”ëª¨ë¦¬ ëŒ€ì‹  ë¹ ë¥´ê²Œ CPUì—ê²Œ ë°ì´í„°ë¥¼ ì œê³µí•˜ëŠ” ë…€ì„ì´ë¼ê³  ë°°ì› ë‹¤.\nì´ì „ì—ëŠ” ì£¼ë¡œ ìºì‹œë¼ê³  í•˜ë©´ ì£¼ë¡œ CDNê³¼ ê°™ì€ ë„¤íŠ¸ì›Œí¬ì—ì„œ ì“°ì´ëŠ” ìºì‹œë“¤ë°–ì— ëª°ëë‹¤. ê·¸ë ‡ë‹¤ë³´ë‹ˆ L1 ìºì‹œ, L2 ìºì‹œ ê°™ì€ ì–˜ê¸°ë¥¼ ë“¤ìœ¼ë©´ OSI 7ê³„ì¸µê³¼ ì—°ê´€ ì§€ì–´ \u0026lsquo;ìŒ..? L2 ìºì‹œëŠ” ìŠ¤ìœ„ì¹˜ì—ì„œ ì“°ëŠ” ìºì‹œì¸ê°€..?\u0026rsquo; ë¼ëŠ” ìƒìƒì„ í•˜ê³¤í–ˆë‹¤.\nì´ë²ˆì—ëŠ” Goë¥¼ í†µí•´ ë°°ì—´ì— ì—¬ëŸ¬ ì°¨ë¡€ ì ‘ê·¼í•˜ëŠ” í”„ë¡œê·¸ë¨ì„ ë§Œë“¤ì–´ë³´ê³  ë²¤ì¹˜ë§ˆí‚¹ì„ í†µí•´ ìºì‹œë¼ëŠ” ë…€ì„ì´ ì–´ë–¤ íš¨ê³¼ë¥¼ ê°€ì ¸ë‹¤ì£¼ëŠ”ì§€ ì§ì ‘ í™•ì¸í•´ë³´ë ¤í•œë‹¤.\nìºì‹œë€ ìºì‹œëŠ” ì•„ì£¼ ë‹¤ì–‘í•œ ë¬¸ë§¥ì—ì„œ ì‚¬ìš©ëœë‹¤. ê³µí†µì ìœ¼ë¡œ \u0026ldquo;ì‚¬ìš©ìê°€ ìš”ì²­í•  ê²ƒ ê°™ì€ ë°ì´í„°ë¥¼ ì‘ê³  ë¹ ë¥¸ ì €ì¥ì†Œì— ì €ì¥í•´ë†“ìŒìœ¼ë¡œì¨ ì¢€ ë” ë¹¨ë¦¬ í•´ë‹¹ ë°ì´í„°ë¥¼ ì œê³µí•œë‹¤\u0026quot;ëŠ” ëª©ì ì„ ê°–ëŠ”ë‹¤. CDN, DB, REST API, Memory, CPU ë“±ë“± ë‹¤ì–‘í•œ ê³³ì—ì„œ ì“°ì¼ ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤. ê·¸ ì¤‘ ì´ë²ˆì—ëŠ” CPUì™€ ë©”ëª¨ë¦¬ ì‚¬ì´ì˜ ìºì‹œì— ëŒ€í•´ ì•Œì•„ë³´ê² ë‹¤.\nCPUì™€ ë©”ëª¨ë¦¬ ì‚¬ì´ì˜ ìºì‹œëŠ” ë©”ëª¨ë¦¬ì˜ ë°ì´í„°ë¥¼ ì–»ê¸° ìœ„í•´ ë©”ëª¨ë¦¬ì— ì§ì ‘ ì ‘ê·¼í•˜ì§€ ì•Šê³  ìºì‹œë¼ëŠ” ë¹ ë¥¸ ì €ì¥ì†Œë¥¼ ì´ìš©í•´ í•´ë‹¹ ë°ì´í„°ë¥¼ ì–»ê²Œë”í•´ì¤€ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ë³€ìˆ˜ a=10 ì´ë¼ëŠ” ë°ì´í„°ê°€ ë©”ëª¨ë¦¬ì— ì¡´ì¬í•œë‹¤í•´ë„ aì˜ ê°’ì„ ì–»ê¸° ìœ„í•´ ë©”ëª¨ë¦¬ì— ì§ì ‘ ì ‘ê·¼í•˜ê¸° ë³´ë‹¤ëŠ” ê°€ê¹Œìš°ë©´ì„œ ë¹ ë¥´ê²Œ ì´ìš© ê°€ëŠ¥í•œ ìºì‹œì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ë„ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤. ì‚¬ì‹¤ ìºì‹œì˜ ê°œë…ì ì¸ ì¸¡ë©´ì—ì„œ ë³´ë©´ ë©”ëª¨ë¦¬ ë˜í•œ ë””ìŠ¤í¬ ëŒ€ì‹  ë¹ ë¥´ê²Œ ê°’ì„ ì „ë‹¬í•´ì£¼ê¸° ìœ„í•œ ê²½ìš°ì¼ ìˆ˜ ìˆìœ¼ë‹ˆ ìºì‹œ ê¸°ëŠ¥ì„ í•œë‹¤ê³  ë³¼ ìˆ˜ ìˆë‹¤. ê·¸ë¦¬ê³  CPUì™€ ë©”ëª¨ë¦¬ ì‚¬ì´ì— ì •ë§ ìºì‹œë¼ëŠ” ì´ë¦„ì„ ê°–ëŠ” ë…€ì„ë“¤ì€ í”„ë¡œì„¸ì„œ ì†ì— ìˆëŠ” L1 ìºì‹œ, í”„ë¡œì„¸ì„œ ì˜†ì— ìˆëŠ” L2 ìºì‹œ, í”„ë¡œì„¸ì„œë“¤ì´ ê³µìœ í•˜ëŠ” L3 ìºì‹œê°€ ìˆê¸´ í•˜ì§€ë§Œ ì´ëŠ” ì‹œëŒ€ê°€ ì§€ë‚˜ë©´ì„œ ì–¼ë§ˆë“ ì§€ ë³€í•  ìˆ˜ ìˆëŠ” ë‚´ìš©ë“¤ì´ê¸° ë•Œë¬¸ì— ì–´ë–¤ ìºì‹œê°€ ì–´ë””ì— ìˆê³  ëˆ„êµ¬ë‘ ëˆ„ê°€ ê³µìœ í•˜ëŠ”ì§€ì™€ ê°™ì€ ì„¸ë¶€ ë‚´ìš©ì€ í¬ê²Œ ì¤‘ìš”í•˜ì§„ ì•Šì„ ê²ƒ ê°™ë‹¤.\në¬¼ë¦¬ì ì¸ í¬ê¸°ë‚˜ ê±°ë¦¬ëŠ” ì†ë„ì™€ ë°˜ë¹„ë¡€í•  ìˆ˜ ë°–ì— ì—†ë‹¤. ê±°ë¦¬ê°€ ë©€ë©´ ì •ë³´ê°€ ì „ë‹¬ë˜ëŠ” ì†ë„ê°€ ëŠë ¤ì§€ê³  í¬ê¸°ê°€ í¬ë©´ ì—¬ëŸ¬ Muxë‚˜ Gateë¥¼ ì´ìš©í•œë‹¤ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— ëŠë ¤ì§„ë‹¤. ê·¸ë ‡ê¸°ë•Œë¬¸ì— ìºì‹œëŠ” ì‘ê³  ê°€ê¹Œì›Œì•¼í•œë‹¤. ë°ì´í„°ë¥¼ ìš”ì²­í•˜ëŠ” ë…€ì„ì€ CPUì´ê¸° ë•Œë¬¸ì— ìºì‹œëŠ” CPU ì† í˜¹ì€ ê·¸ ê·¼ì²˜ì— ìœ„ì¹˜í•œë‹¤. ë˜í•œ ì‘ì•„ì•¼í•˜ê¸°ë•Œë¬¸ì— ëª¨ë“  ì •ë³´ë¥¼ ë‹´ì„ ìˆ˜ ì—†ê³ , ì‚¬ìš©ìê°€ ìš”ì²­í• ë²•í•œ ë°ì´í„°ë§Œì„ ë‹´ì•„ì•¼í•œë‹¤. ì´ ë•Œ ì–´ë–»ê²Œ ì‚¬ìš©ìê°€ ìš”ì²­í•  ë²•í•œ ë°ì´í„°ë¥¼ ì •í• ê¹Œ? ì´ëŠ” ê³µê°„ ì§€ì—­ì„±ê³¼ ì‹œê°„ ì§€ì—­ì„±ì´ë¼ëŠ” ì¤‘ìš”í•œ ë‘ ê°€ì§€ ì„±ì§ˆì„ ê¸°ë°˜ìœ¼ë¡œ í•œë‹¤.\nì´ì™¸ì—ë„ íƒœê·¸ë‚˜ ì¶©ëŒ ê°™ì€ ê°œë…ë“¤ì´ ìˆê¸´í•˜ì§€ë§Œ ì‹¤ì œë¡œ ë²¤ì¹˜ë§ˆí‚¹í•´ë³´ê¸°ë„ ì‰½ì§€ ì•Šê³  ë‹¤ì†Œ ì§€ì—½ì ì¸ ë‚´ìš©ì´ë¼ ê°„ë‹¨íˆë§Œ ì •ë¦¬í•´ë³´ë©´ íƒœê·¸ ì—†ì´ ì£¼ì†Œê°’ì„ ëª¨ë“ˆëŸ¬(ë‚˜ë¨¸ì§€)ì—°ì‚°í•´ì„œ cache line indexë¥¼ ê²°ì •í•˜ê³  ê·¸ê²ƒë§Œì„ ì´ìš©í•´ ë°ì´í„°ë¥¼ ì €ì¥í•˜ë©´ í•œ line ë‚´ì— ì €ì¥í•  ì›Œë“œ(Word)ì— ëŒ€í•œ ì¶©ëŒì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤. cache lineì´ 20ê°œì¸ ìºì‹œëŠ” 0ë²ˆì§€ì™€ 20ë²ˆì§€ê°€ ê°™ì€ lineì´ë¯€ë¡œ ì¶©ëŒì´ ë°œìƒí•´ ê³„ì†í•´ì„œ ê°™ì€ lineì— ì„œë¡œì˜ ë°ì´í„°ê°€ ë²ˆê°ˆì•„ ì €ì¥ë  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤. í•˜ì§€ë§Œ íƒœê·¸ë¥¼ ì´ìš©í•˜ë©´ cache line ìˆ˜ëŠ” ì¤„ì–´ë“¤ë”ë¼ë„ í•œ lineë‚´ì— ì—¬ëŸ¬ íƒœê·¸ì˜ ì •ë³´ë¥¼ ì €ì¥í•  ìˆ˜ ìˆê²Œë˜ì–´ cache lineì´ 10ê°œì¸ cacheì˜ í•œ lineì— 0ë²ˆì§€ì™€ 20ë²ˆì§€ì˜ ë°ì´í„°ê°€ ë‹¤ë¥¸ íƒœê·¸ë¡œ ì €ì¥ë˜ì–´ ë¶ˆí•„ìš”í•œ ì¶©ëŒì„ ë°©ì§€í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ìˆë‹¤. ê°„ë‹¨íˆ ì„¤ëª…í•˜ê¸°ëŠ” í˜ë“  ë‚´ìš©ì´ë¼ ì¢€ ë” ìì„¸íˆ ì•Œê³ ì‹¶ë‹¤ë©´ Direct mapped cacheë‚˜ Fully associative cache ë“±ìœ¼ë¡œ ê²€ìƒ‰í•´ë³´ê¸°ë¥¼ ê¶Œì¥í•œë‹¤.\nSpatial locality Spatial locality(ê³µê°„ ì§€ì—­ì„±)ì´ë€ ì§€ê¸ˆ ìš”ì²­ ë°›ì€ ë°ì´í„°ì™€ ê°€ê¹Œìš´ ê³³ì— ìœ„ì¹˜í•œ ë°ì´í„°ëŠ” ë†’ì€ í™•ë¥ ë¡œ ë‹¤ì‹œ ìš”ì²­ ë°›ê²Œ ëœë‹¤ëŠ” ì„±ì§ˆì´ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ 100ë²ˆì§€ì˜ a=10ê³¼ 108ë²ˆì§€ì˜ b=20ì´ ì¡´ì¬í•  ë•Œ ë³€ìˆ˜ aë¥¼ ìš”ì²­í•˜ë©´ ì´í›„ aì™€ ê°€ê¹Œìš´ ì£¼ì†Œì— ì €ì¥ëœ b ë˜í•œ ë†’ì€ í™•ë¥ ë¡œ ìš”ì²­ëœë‹¤ëŠ” ê²ƒì´ë‹¤.\npackage main import ( \u0026#34;fmt\u0026#34; ) func main() { var ( a int = 10 b int = 20 c int = 30 ) fmt.Printf(\u0026#34;a: %p\\nb: %p\\nc: %p\\n\u0026#34;, \u0026amp;a, \u0026amp;b, \u0026amp;c) } /* Output: a: 0xc000100010 b: 0xc000100018 c: 0xc000100020 */ a, b, cì˜ í¬ê¸°ëŠ” 8ë°”ì´íŠ¸ë¡œ ì£¼ì†Œê°’ ë˜í•œ 8ë°”ì´íŠ¸ê°€ ì°¨ì´ë‚œë‹¤. (16ì§„ë²•ì´ê¸°ì— 20ê³¼ 18ì˜ ì°¨ì´ëŠ” 8ì´ë‹¤.) ì¦‰ ëŒ€ì²´ë¡œ ë¹„ìŠ·í•œ ì‹œê¸°ì— í• ë‹¹ëœ ë³€ìˆ˜ëŠ” ê·¼ì ‘í•œ ë©”ëª¨ë¦¬ ì£¼ì†Œë¥¼ ê°–ê²Œ ëœë‹¤. ìš°ë¦¬ëŠ” ë¹„ìŠ·í•œ ì‹œê¸°ì— í• ë‹¹í•œ ë³€ìˆ˜ í˜¹ì€ ì—°ì†ëœ ë°°ì—´ ìš”ì†Œì— ìì£¼ ë¹ ë¥¸ ì‹œì¼ ë‚´ì— ì ‘ê·¼ì„ í•˜ì§€ ë§¨ ìœ„ì—ì„œ ì„ ì–¸í•œ ë³€ìˆ˜ì™€ ì € ë©€ë¦¬ ë§¨ ë°‘ì—ì„œ ì„ ì–¸í•œ ë³€ìˆ˜ë¥¼ ë§ˆêµ¬ì¡ì´ë¡œ ì™”ë‹¤ ê°”ë‹¤ í•˜ë©´ì„œ ì‘ì—…ì„ í•˜ì§€ ì•ŠëŠ” í¸ì´ê¸° ë•Œë¬¸ì— ê³µê°„ ì§€ì—­ì„±ì„ ê·¼ê±°ë¡œí•œ ìºì‹œê°€ íš¨ë ¥ì„ ê°–ê²Œ ëœë‹¤. ë§Œì•½ ê³µê°„ì ìœ¼ë¡œ ë¨¼ ë§¨ ìœ„ì˜ ë³€ìˆ˜ì™€ ë§¨ ì•„ë˜ì˜ ë³€ìˆ˜ë¥¼ ìì£¼ ë²ˆê°ˆì•„ê°€ë©° ì ‘ê·¼í•œë‹¤ë©´ ê·¸ê²ƒì€ ì‹œê°„ì§€ì—­ì„±ì„ ë„ëŠ” ê²½ìš°ì´ë‹¤.\nTemporal locality Temporal locality(ì‹œê°„ ì§€ì—­ì„±)ì´ë€ ìµœê·¼ì— ìš”ì²­í–ˆë˜ ë°ì´í„°ëŠ” ë†’ì€ í™•ë¥ ë¡œ ë‹¤ì‹œ ìš”ì²­ ë°›ê²Œ ëœë‹¤ëŠ” ì„±ì§ˆì´ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ 100ë²ˆì§€ì˜ a=10ê³¼ 9999ë²ˆì§€ì˜ b=20ì€ ì„œë¡œ ì£¼ì†Œì ì¸ ê±°ë¦¬ëŠ” ë©€ì§€ë§Œ ë‘˜ ë‹¤ ìµœê·¼ì— í˜¸ì¶œëë‹¤ë©´ ìºì‹œì— ì ì¬í•˜ê² ë‹¤ëŠ” ê²ƒì´ë‹¤. ìºì‹œëŠ” ì£¼ë¡œ ì§ì‚¬ê°í˜• í˜•íƒœë¡œ ìƒê²¼ìœ¼ë©° ê°€ë¡œ(í–‰)ëŠ” ì—°ì†ëœ ì£¼ì†Œì˜ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ê³µê°„ ì§€ì—­ì„±, ì„¸ë¡œ(ì—´)ëŠ” ìµœê·¼ì— í˜¸ì¶œëœ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ì‹œê°„ ì§€ì—­ì„±ì„ ë‹´ë‹¹í•œë‹¤.\në‘ ì§€ì—­ì„± ë¹„êµ 12ì¹¸ì˜ ìºì‹œê°€ ìˆë‹¤ê³  ê°€ì •í•˜ì. ê°€ë¡œë¡œ 4ì¹¸ ì„¸ë¡œë¡œ 3ì¹¸ ì¡´ì¬í•œë‹¤ë©´ ê³µê°„/ì‹œê°„ ì§€ì—­ì„±ì˜ ê· í˜•ì´ ì¡íŒ ìºì‹œë¼ê³  ë³¼ ìˆ˜ ìˆë‹¤.(ê²½ìš°ì— ë”°ë¼ ë‹¤ë¥´ê² ì§€ë§Œ)\nbalanced-cache.png ì‹œê°„ ì§€ì—­ì„±ì€ ìµœê·¼ ë¶ˆë¦° ë°ì´í„°ëŠ” ë‹¤ì‹œ ë¶ˆë¦´ í™•ë¥ ì´ ë†’ë‹¤ëŠ” ê²ƒì´ê³  ì´ëŠ” ì—°ì†ëœ ê³µê°„ì´ ì•„ë‹Œ ë‹¤ì–‘í•œ ê³µê°„(ì£¼ì†Œ)ì˜ ë°ì´í„°ë¥¼ ìºì‹œì— ì €ì¥í•œë‹¤ëŠ” ë§ì´ê¸°ë„ í•˜ë‹¤. 0ë²ˆì§€ ë¶€ê·¼, 16ë²ˆì§€ ë¶€ê·¼, 24ë²ˆì§€ ë¶€ê·¼ì˜ ë‹¤ì–‘í•œ ê³µê°„ì˜ ë°ì´í„°ë¥¼ ì €ì¥í•  ìˆ˜ ìˆìœ¼ë©´ì„œ ê·¸ ë…€ì„ë“¤ê°„ì˜ ì£¼ë³€ ë°ì´í„°ë„ ì œê³µí•˜ëŠ” ê³µê°„ì§€ì—­ì„±ë„ ë§Œì¡±í•œë‹¤.\në‘ ê°€ì§€ ì§€ì—­ì„±ì— ì˜í•´ ë‹¤ì–‘í•œ ìºì‹œë“¤ì´ ë°ì´í„°ë¥¼ ì ì¬í•˜ê³  ì œê³µí•œë‹¤. ìš”ì ì€ ìºì‹œëŠ” ë¹ ë¥´ê²Œ ë™ì‘í•´ì•¼í•˜ê³  ê·¸ëŸ¬ê¸° ìœ„í•´ì„  í¬ê¸°ê°€ ì‘ê³  ê°€ê¹Œì›Œì•¼í•˜ë©° í¬ê¸°ê°€ ì‘ê¸° ë•Œë¬¸ì— ëª¨ë“  ë°ì´í„°ë¥¼ ë‹´ì„ ìˆ˜ ì—†ìœ¼ë‹ˆ ì•Œì§œ ë°ì´í„°ë§Œì„ ë‹´ì•„ì•¼í•˜ëŠ”ë° ê·¸ ì•Œì§œëŠ” ì§€ì—­ì„±ì„ ê¸°ë°˜ìœ¼ë¡œ ì„ ë³„ëœë‹¤ëŠ” ê²ƒì´ë‹¤. í¬ê¸°ê°€ í•œì •ì ì´ê¸° ë•Œë¬¸ì— í•œ ì§€ì—­ì„±ì„ í‚¤ìš°ë©´ í•œ ì§€ì—­ì„±ì€ ì‘ì•„ì§ˆ ìˆ˜ë°–ì— ì—†ë‹¤.\nê³µê°„ ì§€ì—­ì„±ì— ì¹˜ìš°ì¹œ ìºì‹œ êµ¬ì¡° spatial-locality-biased-cache.png í•œì •ëœ í¬ê¸°ì˜ ìºì‹œ ì†ì—ì„œ ê³µê°„ì§€ì—­ì„±ì„ ê·¹ëŒ€í™”ì‹œì¼œë²„ë¦¬ë©´ ë‹¹ì—°íˆ ì¸ì ‘í•œ ê³µê°„ì˜ ìë£Œë§Œ ì´ìš©í•  ìˆ˜ ìˆê³ , ìµœê·¼ì— ë¶ˆë¦° ë°ì´í„°ë“¤ì€ ì•ˆì¤‘ì—ë„ ì—†ê³  ì¸ì ‘í•œ ê³µê°„ì˜ ë°ì´í„°ë§Œì„ ì €ì¥í•˜ê²Œ ëœë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ë‹¤ìŒê³¼ ê°™ì€ ì‹œê°„ ì§€ì—­ì„±ì´ í•„ìš”í•œ ê²½ìš°ì— ì œëŒ€ë¡œ ê¸°ëŠ¥ì„ í•  ìˆ˜ ì—†ë‹¤.\n0~11ë²ˆì§€ ì‚¬ì´ì˜ ë°ì´í„°ê°€ í•œ ë²ˆ ì ‘ê·¼ â‡’ ìºì‹œì— 0~11ë²ˆì§€ ì ì¬ ì´í›„ 12ë²ˆì§€ì˜ ë°ì´í„°ì— ì ‘ê·¼ â‡’ ìºì‹œì— ë°ì´í„°ê°€ ì—†ê¸°ë•Œë¬¸ì— 0~11ë²ˆì§€ì˜ ë°ì´í„° ëŒ€ì‹  12~23ë²ˆì§€ì˜ ë°ì´í„°ë¥¼ ìºì‹œì— ì ì¬ ë‹¤ì‹œ ìµœê·¼ì— ì ‘ê·¼í–ˆë˜ ë°ì´í„°ì¸ 0ë²ˆì§€ì˜ ë°ì´í„°ì— ì ‘ê·¼ ì‹œë„ â‡’ 0ë²ˆ ë°ì´í„°ëŠ” ìµœê·¼ì— ì ‘ê·¼í–ˆë˜ ë°ì´í„°ì„ì—ë„ ì‹œê°„ ì§€ì—­ì„±ì´ í™œìš©ë˜ì§€ ëª»í•¨ â‡’ ìºì‹œì—ì„œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ. ì‹œê°„ ì§€ì—­ì„±ì— ì¹˜ìš°ì¹œ ìºì‹œ êµ¬ì¡° temporal-locality-biased-cache.png ìœ„ì˜ ê²½ìš° ìµœê·¼ì— í˜¸ì¶œëœ ë‹¤ì–‘í•œ ì£¼ì†Œì˜ ë°ì´í„°ë“¤ì„ ìºì‹œì— ì €ì¥í•´ì¤€ë‹¤. í•˜ì§€ë§Œ ìºì‹œì˜ í¬ê¸°ëŠ” í•œì •ë˜ì–´ìˆê¸° ë•Œë¬¸ì— ì„¸ë¡œê°€ ê¸¸ì–´ì§€ë©´ ê°€ë¡œëŠ” ì§§ì•„ì§„ë‹¤. ì¦‰ ìµœê·¼ ì ‘ê·¼ì„ ì‹œë„í•œ ë‹¤ì–‘í•œ ì£¼ì†Œì˜ ë°ì´í„°ë¥¼ ì €ì¥í•  ìˆ˜ ìˆì§€ë§Œ ê·¸ ë°ì´í„°ì˜ ì¸ê·¼ ë°ì´í„°ì— ëŒ€í•œ ì €ì¥ì€ ë§ì´ í•  ìˆ˜ ì—†ë‹¤ëŠ” ê²ƒì´ë‹¤.\nì˜ˆë¥¼ ë“¤ì–´ ìœ„ì˜ ê·¸ë¦¼ê³¼ ê°™ì€ ê²½ìš° ìµœê·¼ 0, 3, 12, 18, 6, 20ë²ˆì§€ì˜ ë°ì´í„°ì— ì ‘ê·¼í–ˆê³  ì´í›„ì—ë„ í•´ë‹¹ ë²ˆì§€ì— ëŒ€í•œ ë°ì´í„°ë¥¼ ìºì‹œë¥¼ í†µí•´ ì´ìš©í•  ìˆ˜ ìˆë‹¤. ë°”ë¡œ ë‚´ê°€ ìµœê·¼ì— ì ‘ê·¼í–ˆë˜ ë°ì´í„°ì´ê¸°ë•Œë¬¸ì´ë‹¤. í•˜ì§€ë§Œ ë§Œì•½ 18ë²ˆì§€ì˜ ë°ì´í„°ì— ì ‘ê·¼í•œ ê²½ìš° ë†’ì€ í™•ë¥ ë¡œ ê³µê°„ì§€ì—­ì„±ì— ì˜ê±° 19, 20, 21, \u0026hellip; ë²ˆì§€ì˜ ë°ì´í„°ì— ì ‘ê·¼í•˜ê² ì§€ë§Œ, ì´ ì˜ˆì‹œëŠ” ì‹œê°„ì§€ì—­ì„±ì— ì¹˜ìš°ì³ì ¸ 19ë²ˆì§€ì˜ ë°ì´í„°ë§Œì„ ìºì‹œì—ì„œ ì œê³µë°›ì„ ìˆ˜ ìˆë‹¤.\ní”„ë¡œê·¸ë¨ì„ í†µí•œ ë²¤ì¹˜ë§ˆí‚¹ ì €ë²ˆì— Mutex, Semaphoreë¥¼ ì§ì ‘ ë²¤ì¹˜ë§ˆí‚¹í•´ë³´ë©´ì„œ Goì˜ ë‚´ì¥ ë²¤ì¹˜ë§ˆí¬ ê¸°ëŠ¥ì„ ì´ìš©í•˜ë©´ ì¢€ ë” í¸ë¦¬í•˜ê²Œ ê²°ê³¼ë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ìˆì„ ê²ƒ ê°™ì•˜ê¸°ì— ì´ë²ˆì— Goì˜ ë‚´ì¥ ë²¤ì¹˜ë§ˆí¬ ê¸°ëŠ¥ì„ ì´ìš©í•´ë´¤ë‹¤.\n1000í–‰ 1000ì—´ì˜ 2ì°¨ì› intí˜• ë°°ì—´ì˜ ì–´ë– í•œ ìš”ì†Œì— ì ‘ê·¼í•´ì„œ +1 í•˜ëŠ” ì‘ì—…ì„ 1000íšŒ ìˆ˜í–‰í•˜ëŠ” ê²ƒì„ í•˜ë‚˜ì˜ ì‹¸ì´í´ë¡œ í•˜ëŠ” ë²¤ì¹˜ë§ˆí¬ë¥¼ ì‘ì„±í–ˆë‹¤. 2ì°¨ì› ë°°ì—´ì€ ê°€ë¡œë¡œëŠ” ì—°ì†ì ì¸ ì£¼ì†Œê°’ì„ ê°–ê¸°ì— ê³µê°„ ì§€ì—­ì„±ì„ í™œìš©í•  ìˆ˜ ìˆì§€ë§Œ ì„¸ë¡œë¡œëŠ” N * (intí˜• ìë£Œí˜•ì˜ í¬ê¸°)ì”© ì°¨ì´ ë‚˜ëŠ” ì£¼ì†Œê°’ì„ ê°–ê¸° ë•Œë¬¸ì— ê³µê°„ ì§€ì—­ì„±ì„ í™œìš©í•˜ê¸° í˜ë“¤ê³ , ìµœê·¼ ì ‘ê·¼í–ˆë˜ ì£¼ì†Œë¼ë©´ ì‹œê°„ ì§€ì—­ì„±ì€ í™œìš©í•  ìˆ˜ ìˆë‹¤.\nê³µê°„ ì§€ì—­ì„± (ê°€ë¡œë¡œ ì—°ì†ì ì¸ ë°ì´í„°)\nê³µê°„ ì§€ì—­ì„±ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ê°€ë¡œë¡œ ì—°ì†ëœ ìš”ì†Œì— ì ‘ê·¼. ì¦‰ ì—°ì†ëœ ì£¼ì†Œë¥¼ ê°–ëŠ” 1000ê°œì˜ ìš”ì†Œì— ì ‘ê·¼ ê³µê°„ ì§€ì—­ì„±ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²½ìš°ì—ëŠ” ì„¸ë¡œë¡œ ìš”ì†Œì— ì ‘ê·¼. ì¦‰ 1000 * int ìë£Œí˜•ì˜ í¬ê¸°ë§Œí¼ ì°¨ì´ë‚˜ëŠ” ì—°ì†ë˜ì§€ ì•Šì€ ì£¼ì†Œì˜ 1000ê°œì˜ ìš”ì†Œì— ì ‘ê·¼ ì‹œê°„ ì§€ì—­ì„± (ì—°ì†ì  ì£¼ì†Œì™€ ìƒê´€ì—†ì´ ìµœê·¼ì— ë¶ˆë¦° ë°ì´í„°)\nì‹œê°„ ì§€ì—­ì„±ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ì£¼ì†Œê°’ì´ ê·¼ì ‘í•˜ì§„ ì•Šì§€ë§Œ 4ê°œ í˜¹ì€ 16ê°œì˜ ë°ì´í„°ì—ë§Œ ê³„ì†í•´ì„œ ì ‘ê·¼ ì‹œê°„ ì§€ì—­ì„±ì„ ì‚¬ìš©í•˜ì§€ ì•Šì€ ê²½ìš°ì—ëŠ” ê³„ì†í•´ì„œ ì²˜ìŒ ì ‘ê·¼í•˜ëŠ” ë°ì´í„°ì—ë§Œ ì ‘ê·¼ package main import ( \u0026#34;testing\u0026#34; ) var ( Size int = 1000 ) func generateArray() [][]int{ arr := make([][]int, Size) for i := 0; i \u0026lt; Size; i++{ arr[i] = make([]int, Size) for j := 0; j \u0026lt; Size; j++{ arr[i][j] = 0 } } return arr } func BenchmarkSpatialLocality(b *testing.B){ b.Run(\u0026#34;ê³µê°„ì§€ì—­ì„± ì‚¬ìš©\u0026#34;, func(b *testing.B) { arr := generateArray() b.ResetTimer() for n := 0; n \u0026lt; b.N; n++{ for i := 0; i \u0026lt; Size; i++{ arr[0][i] += 1 } } }) b.Run(\u0026#34;ê³µê°„ì§€ì—­ì„± X\u0026#34;, func(b *testing.B) { arr := generateArray() b.ResetTimer() for n := 0; n \u0026lt; b.N; n++{ for i := 0; i \u0026lt; Size; i++{ arr[i][0] += 1 } } }) } func BenchmarkTemporalLocality(b *testing.B){ b.Run(\u0026#34;ì‹œê°„ ì§€ì—­ì„± ì ê·¹ ì‚¬ìš©. ìµœê·¼ ì ‘ê·¼í•œ ë°ì´í„° 4ê°œ.\u0026#34;, func(b *testing.B) { arr := generateArray() b.ResetTimer() for n := 0; n \u0026lt; b.N; n++{ for i := 0; i \u0026lt; Size; i++{ arr[i%4][0] += 1 } } }) b.Run(\u0026#34;ì‹œê°„ ì§€ì—­ì„± ì¡°ê¸ˆ ì‚¬ìš©. ìµœê·¼ ì ‘ê·¼í•œ ë°ì´í„° 16ê°œ.\u0026#34;, func(b *testing.B) { arr := generateArray() b.ResetTimer() for n := 0; n \u0026lt; b.N; n++{ for i := 0; i \u0026lt; Size; i++{ arr[i%16][0] += 1 } } }) // ì‚¬ì‹¤ ì™„ë²½í•˜ê²Œ ìƒˆë¡œìš´ ë°ì´í„°ëŠ” ì•„ë‹˜. ë²¤ì¹˜ë§ˆí‚¹í•˜ëŠ” ë™ì•ˆ ê³„ì†í•´ì„œ ë°˜ë³µë˜ê¸° ë•Œë¬¸ì— b.Run(\u0026#34;ì‹œê°„ ì§€ì—­ì„± X. ìƒˆë¡œìš´ ë°ì´í„°ì—ë§Œ ì ‘ê·¼.\u0026#34;, func(b *testing.B) { arr := generateArray() b.ResetTimer() for n := 0; n \u0026lt; b.N; n++{ for i := 0; i \u0026lt; Size; i++{ arr[i][0] += 1 } } }) } goos: linux goarch: amd64 pkg: playground/unix-socket/cache BenchmarkSpatialLocality/ê³µê°„ì§€ì—­ì„±_ì‚¬ìš© 50000 894 ns/op BenchmarkSpatialLocality/ê³µê°„ì§€ì—­ì„±_X 50000 6561 ns/op BenchmarkTemporalLocality/ì‹œê°„_ì§€ì—­ì„±_ì ê·¹_ì‚¬ìš©._ìµœê·¼_ì ‘ê·¼í•œ_ë°ì´í„°_4ê°œ. 50000 1918 ns/op BenchmarkTemporalLocality/ì‹œê°„_ì§€ì—­ì„±_ì¡°ê¸ˆ_ì‚¬ìš©._ìµœê·¼_ì ‘ê·¼í•œ_ë°ì´í„°_16ê°œ. 50000 4153 ns/op BenchmarkTemporalLocality/ì‹œê°„_ì§€ì—­ì„±_X._ìƒˆë¡œìš´_ë°ì´í„°ì—ë§Œ_ì ‘ê·¼. 50000 6564 ns/op ê²°ê³¼ë¥¼ í™•ì¸í•´ë³´ë‹ˆ ê°„ë‹¨í•œ ë°°ì—´ ë‚´ì˜ ìš”ì†Œë“¤ì— ëŒ€í•œ ì—°ì‚°ì¸ë°ë„ ê½¤ë‚˜ ì°¨ì´ê°€ ì»¸ë‹¤.\në§ˆì¹˜ë©° ì €ë²ˆ í•™ê¸°ì— ì»´í“¨í„° êµ¬ì¡°ë¥¼ ìˆ˜ê°•í•˜ë©´ì„œ CPU-Memory ìºì‹œì˜ íš¨ê³¼ë¥¼ ì§ì ‘ ë°°ì—´ì— ëŒ€í•œ í”„ë¡œê·¸ë¨ì„ í†µí•´ ë³´ì—¬ì£¼ëŠ” ì˜ˆì‹œë¥¼ ë³´ê³  ì‹ ê¸°í–ˆë˜ ê¸°ì–µì´ ìˆì–´ì„œ ì´ë ‡ê²Œ ë²¤ì¹˜ë§ˆí‚¹ í”„ë¡œê·¸ë¨ì„ ì‘ì„±í•´ë´¤ë‹¤. ë‹¤ë¥¸ CS ì£¼ìš” ì§€ì‹ë“¤ì— ë¹„í•´ ì–´ë ¤ìš¸ ê²ƒì€ ì—†ëŠ” í¸ì´ê³  ìš°ë¦¬ê°€ ì‰½ê²Œ ì ‘í•´ì˜¤ë˜ ë‚´ìš©ì´ë¼ ë” ì´í•´í•˜ê¸° ì‰½ì§€ ì•Šì•˜ì„ê¹Œ ì‹¶ë‹¤.\nì°¸ê³  ìºì‹œë€ - https://ko.wikipedia.org/wiki/ìºì‹œ ìºì‹œê°€ ë™ì‘í•˜ëŠ” ì•„ì£¼ êµ¬ì²´ì ì¸ ì›ë¦¬ - https://parksb.github.io/article/29.html cache mapping - https://m.blog.naver.com/jkssleeky/220478400046 ","date":"2021-01-27T15:25:54+09:00","permalink":"https://umi0410.github.io/blog/golang/go-cpu-cache/","title":"Go ì–¸ì–´ë¡œ ì ìš©í•´ë³´ëŠ” Computer Science - Cache"},{"content":"ì‹œì‘í•˜ë©° Go ì–¸ì–´ë¥¼ ì²˜ìŒ ë°°ìš¸ ë•Œ channelì´ë‚˜ goroutineì— ëŒ€í•´ ë°°ìš°ë©´ì„œ Concurrency ì¦‰ ë™ì‹œì„±ìœ¼ë¡œ ì¸í•´ ë§ì´ í˜ë“¤ì—ˆë˜ ê¸°ì–µì´ ë‚œë‹¤. \u0026lsquo;ë™ì‹œì„±ê³¼ ë³‘ë ¬ì„±ì´ ë„ëŒ€ì²´ ë­ê°€ ë‹¤ë¥´ë‹¤ëŠ” ê²ƒì´ëƒ..!\u0026rsquo; Rob Pike ì•„ì €ì”¨ê°€ ë™ì‹œì„±ì— ê´€í•´ í–ˆë˜ ì„¸ë¯¸ë‚˜ ì˜ìƒë“¤ì„ ë³´ë©° ê°™ì´ ìŠ¤í„°ë”” í•˜ë˜ ë©¤ë²„ë“¤ê³¼ ë©˜ë¶•ì— ë¹ ì§€ê¸°ë„ í–ˆê³ , ì´ëŸ° ì €ëŸ° ì˜ê²¬ êµë¥˜ë„ í–ˆë‹¤ê°€ ë©°ì¹  ì§€ë‚˜ê³  ë³´ë©´ ë‹¤ì‹œ ë³‘ë ¬ì„±ê³¼ í—·ê°ˆë¦¬ê³ , ì œëŒ€ë¡œ ëœ í•œê¸€ ìë£ŒëŠ” ì°¾ê¸° í˜ë“¤ì—ˆë‹¤. \u0026lsquo;ë™ì‹œì„±ì€ ì‚¬ëŒì´ ëŠë¼ê¸°ì— ë™ì‹œì²˜ëŸ¼ ëŠê»´ì§€ëŠ” ê²ƒì´ê³  ë³‘ë ¬ì„±ì€ ì‹¤ì œë¡œ ë™ì‹œì ì¸ ì‹œì ì— ëŒ€í•œ ê²ƒì´ë‹¤.\u0026rsquo; ë¼ëŠ” ë‚´ìš©ì´ ë§ì•˜ì§€ë§Œ ì™€ë‹¿ì§€ëŠ” ì•Šì•˜ë‹¤.\nê·¸ë¦¬ê³  ì´ë²ˆì— ë‹¤ë¤„ë³¼ ë™ì‹œì„±ì€ ì£¼ë¡œ \u0026ldquo;ì œì–´\u0026ldquo;ë¼ëŠ” ë‹¨ì–´ì™€ í•¨ê»˜ ì–¸ê¸‰ë˜ëŠ” \u0026ldquo;ë™ì‹œì„± ì œì–´\u0026ldquo;ì—ì„œì˜ ë™ì‹œì„±ì´ë‚˜ Concurrencyì™€ëŠ” ì¡°ê¸ˆ ë‹¤ë¥¸ ì˜ë¯¸ë¥¼ ê°–ëŠ”ë‹¤ê³  ìƒê°í•œë‹¤. ë™ì‹œì„± ì œì–´ì—ì„œì˜ ë™ì‹œì„±ì€ ê·¸ëƒ¥ ë™ì‹œì— ë¬´ì–¸ê°€ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì„ ì–´ë–»ê²Œ ì œì–´í•˜ê±°ë‚˜ ë§‰ê² ëƒëŠ” ì˜ë¯¸ì¼ ë¿ì´ì§€ë§Œ ë™ì‹œì„±-ë³‘ë ¬ì„±ì—ì„œì˜ ë™ì‹œì„±ì€ ì–´ë–»ê²Œ ì‘ì—…ë“¤ì´ ë™ì‹œì— ìˆ˜í–‰ë˜ëŠëƒì— ì´ˆì ì„ ë§ì¶”ëŠ” ëŠë‚Œì´ê¸° ë•Œë¬¸ì´ë‹¤.\në™ì‹œì„± ì œì–´ì˜ ì˜ˆì‹œ - ì—¬ëŸ¬ clientê°€ í•˜ë‚˜ì˜ db rowì— accessí•  ë•Œ ì–´ë–»ê²Œ ì œì–´í•  ê²ƒì¸ê°€ ì´ë²ˆì— ë‹¤ë£° ë™ì‹œì„±ì˜ ì˜ˆì‹œ - ì–´ë–¤ ì‘ì—…ì„ ë™ì‹œì„±ì„ ì´ìš©í•´ ìˆ˜í–‰í•˜ëŠ” ê²ƒì´ ì¢‹ì„ê¹Œ ë³‘ë ¬ì„±ì„ ì´ìš©í•´ ìˆ˜í–‰í•˜ëŠ” ê²ƒì´ ì¢‹ì„ê¹Œ Golangì„ ì²˜ìŒ ì ‘í•œ ì§€ ë²Œ ì¨ ë°˜ë…„ì´ ë„˜ì€ ê²ƒ ê°™ë‹¤. ì²˜ìŒ í•œ 4ê°œì›” ê°€ëŸ‰ì€ ê±°ì˜ ë¨¸ë¦¿ ì†ì— ì•„ë¥¸ê±°ë¦¬ëŠ” ë¬¼ìŒí‘œ ê°™ì€ ë‚´ìš©ì´ì—ˆëŠ”ë°, ê¾¸ì¤€íˆ ê³µë¶€í•˜ë‹¤ë³´ë‹ˆ ì¡°ê¸ˆ ì•Œ ê²ƒ ê°™ë‹¤. ì´ë²ˆ ê¸€ì—ì„œëŠ” ê·¸ëŸ¬í•œ ë‚´ìš©ì„ ì¶”ìƒì ì¸ ë§ë³´ë‹¨ ì˜ˆì‹œì™€ ì½”ë“œë¡œ ëª…í™•íˆ ì •ë¦¬í•´ë³´ê³ ì í•œë‹¤.\nConcurrency is not parallelism ìœ„ì˜ ë¬¸ì¥ì€ ë™ì‹œì„±ê³¼ ë³‘ë ¬ì„±ì— ëŒ€í•´ ì•Œì•„ë³´ë ¤í•˜ë©´ ë§¤ë²ˆ ë³´ê²Œ ë˜ëŠ” ë¬¸ì¥ì¸ë‹¤. ê·¸ë ‡ë‹¤. ë™ì‹œì„±ì€ ë³‘ë ¬ì„±ê³¼ ë‹¤ë¥´ë‹¤. ì´ì— ëŒ€í•´ ì„¤ëª…í•  ë•Œ ì˜ì–´ê¶Œì—ì„œëŠ” ì•„ë˜ì˜ ë‘ ë¬¸ì¥ì´ ìì£¼ ë“±ì¥í•˜ëŠ” ë“¯ í•˜ë‹¤.\nConcurrency is about dealing with lots of things at once.\nParallelism is about doing lots of things at once.\ní•œ ë²ˆì— dealing withí•˜ëŠ” ê²ƒê³¼ í•œ ë²ˆì— doingí•˜ëŠ” ê²ƒì´ë¼ê³  í•œë‹¤. í•˜ì§€ë§Œ ì˜ ì™€ë‹¿ì§€ ì•ŠëŠ”ë‹¤\u0026hellip; ì•„ë§ˆ ì € ê¸€ì„ ë³´ê³  ì´í•´í•  ìˆ˜ ìˆëŠ” í•œêµ­ì¸ì€ ê·¹íˆ ë“œë¬¼ì§€ ì•Šì„ê¹Œ ì‹¶ë‹¤.\nì˜ˆì‹œë¡œ ë³´ëŠ” ë™ì‹œì„± vs ë³‘ë ¬ì„± ë”°ë¼ì„œ ì¢€ ë” ì‰½ê²Œ ì˜ˆì‹œë¡œ ì„¤ëª…í•´ë³´ë ¤ í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ì‚¬íšŒì  ê±°ë¦¬ ë‘ê¸°ë¡œ ì¸í•´ ìš°ë¦¬ Gopher(ê³ í¼)ê°€ ì¹œêµ¬ë“¤ê³¼ ë– ë‚˜ë ¤ëŠ” ì˜ˆì•½í–ˆë˜ ì—¬í–‰ì´ ì·¨ì†Œë˜ì—ˆê³ , í•­ê³µê¶Œ, í˜¸í…”, ë ŒíŠ¸ì¹´ ì˜ˆì•½ì„ ëª¨ë‘ ì·¨ì†Œí•´ì•¼í•˜ëŠ” ìƒí™©ì´ë¼ê³  í•´ë³´ì.\në™ì‹œì„±(Concurrent)ì˜ ì˜ˆì‹œ - ë§Œì•½ ëª¨ë“  ì·¨ì†Œ ì‘ì—…ì´ ê³ ê°ì„¼í„° 1ëŒ€1 ì±„íŒ…ìœ¼ë¡œ ì´ë£¨ì–´ì§€ëŠ” ê²½ìš°. Gopher1 í˜¼ì ëª¨ë“  ì·¨ì†Œ ì‘ì—…ì„ ë™ì‹œì ìœ¼ë¡œ ìˆ˜í–‰ ê°€ëŠ¥ Gopher1 í˜¼ì í•­ê³µê¶Œ ì·¨ì†Œ ì‹ ì²­, í˜¸í…”, ë ŒíŠ¸ì¹´ì˜ ê³ ê°ì„¼í„° 1ëŒ€1 ì±„íŒ…ì— ì˜ˆì•½ ì·¨ì†Œ ì‹ ì²­ì„ í•¨ ìƒë‹´ì‚¬ë¶„ì´ ë‹µì¥ì„ ì£¼ëŠ” ëŒ€ë¡œ ì‘ì—…ì„ ì§„í–‰ Gopher1 í˜¼ìì„œ ì„¸ ê°œì˜ ì·¨ì†Œ ì‘ì—…ì„ ë™ì‹œì— ì§„í–‰í•˜ëŠ” ì…ˆì´ë‹¤. ë³‘ë ¬ì„±(Parallelism)ì˜ ì˜ˆì‹œ - ë§Œì•½ ëª¨ë“  ì·¨ì†Œ ì‘ì—…ì´ ê³ ê°ì„¼í„° ì „í™” ìƒë‹´ìœ¼ë¡œ ì´ë£¨ì–´ ì§€ëŠ” ê²½ìš°. Gopher1 í˜¼ì ëª¨ë“  ì·¨ì†Œ ì‘ì—…ì„ ë™ì‹œì— ì§„í–‰í•  ìˆ˜ëŠ” ì—†ê³ , Gopher 1, 2, 3ì´ ë³‘ë ¬ì ìœ¼ë¡œ ì§„í–‰í•  ìˆœ ìˆìŒ. ë’¤ì—ì„œ ì„¤ëª…í•˜ê¸´ í•˜ê² ì§€ë§Œ ì „ìì˜ ê²½ìš°ì—ë§Œ ë™ì‹œì„±ì´ ì¼ì–´ë‚  ìˆ˜ ìˆëŠ” ì´ìœ ëŠ” Gopherê°€ 1ëŒ€1 ì±„íŒ…ìœ¼ë¡œ ì‘ì—…ì„ ì§„í–‰í•  ë•ŒëŠ” í•œê°€í•œ ë°˜ë©´(CPU ì ìœ ìœ¨ì´ ë‚®ê³ , ìƒë‹´ì‚¬ì˜ ë©”ì‹œì§€ë¥¼ ê¸°ë‹¤ë¦¬ëŠë¼ ë§ì€ ë¸”ë½í‚¹ì´ ì¡´ì¬) ì „í™”ë¡œ ì‘ì—…ì„ ì§„í–‰í•  ë•Œì—ëŠ” ì—¬ëŸ¬ ëª…ê³¼ ì „í™”í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì´ë‹¤.(CPU ì ìœ ìœ¨ì´ ë†’ìŒ.)\ní•­ê³µê¶Œ ì·¨ì†Œ ì „í™” ë„ì¤‘ ì ì‹œ ì§€ì—°ë˜ëŠ” ì‹œê°„ì— ì „í™”ë¥¼ ëŠê³  í˜¸í…” ê³ ê° ì„¼í„°ì— ì „í™”ë¥¼ ê±°ëŠ” ë°©ì‹ìœ¼ë¡œ Gopher1 í˜¼ì Concurrentí•˜ê²Œ ì‘ì—…ì„ ì§„í–‰í•  ìˆ˜ ìˆê² ì§€ë§Œ ì´ ê²½ìš° ê³„ì†í•´ì„œ ì „í™”ë¥¼ ëŠê³  ë‹¤ì‹œ ê±¸ê³  ìƒí™© ì„¤ëª…ì„ í•˜ëŠ” ë™ì•ˆì— ì§€ì—°ì‹œê°„ì´ ë°œìƒí•´ì„œ íš¨ìœ¨ì´ ì¢‹ì§€ ì•Šë‹¤. ì´ ì§€ì—° ì‹œê°„ì„ í•­ê³µê¶Œ ì·¨ì†Œ ì „í™” =\u0026gt; í˜¸í…” ì˜ˆì•½ ì·¨ì†Œ ì „í™”ë¡œì˜ context switch penaltyë¡œ ë³¼ ìˆ˜ ìˆë‹¤.\ní”„ë¡œê·¸ë¨ìœ¼ë¡œ ì•Œì•„ë³´ëŠ” Concurrency vs Parallelism ë™ì‹œì„±ê³¼ ë³‘ë ¬ì„±ì„ ë¹„êµí•˜ëŠ” í•œê¸€ ìë£ŒëŠ” ì°¾ê¸° í˜ë“  í¸ì´ê³ , ì˜ì–´ë¡œ ëœ ìë£ŒëŠ” ê½¤ë‚˜ ë§ì´ ì°¾ì•„ë³¼ ìˆ˜ ìˆì§€ë§Œ, ê·¸ë˜ì„œ \u0026ldquo;ì–¸ì œ\u0026rdquo;, \u0026ldquo;ë¬´ì—‡ì„\u0026rdquo;, \u0026ldquo;ì™œ\u0026rdquo; ì¨ì•¼í•˜ëŠ” ì§€ì— ëŒ€í•œ ë‚´ìš©ì€ ì˜ ì°¾ì•„ë³´ê¸° í˜ë“¤ë‹¤. ê²Œë‹¤ê°€ ê°„í˜¹ Concurrent programmingì˜ ì¥ì ì´ë¼ë©´ì„œ parallelismì„ ì„¤ëª…í•˜ëŠ” ê²½ìš°ë„ ìˆì–´ í˜¼ë€ìŠ¤ëŸ¬ì› ë‹¤.\nconcurrency-vs-parallelism.jpg ë™ì‹œì„±ì´ë€ í•œ ì‘ì—…ì´ ì™„ë£Œëœ ë’¤ ë‹¤ìŒ ì‘ì—…ì´ ìˆ˜í–‰ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ê³„ì†í•´ì„œ ì ì ˆíˆ switch ë˜ë©° ë™ì‹œì— ì§„í–‰ë˜ì–´ë‚˜ê°€ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤. ê·¸ ê²°ê³¼ ì¼ì • ê¸°ê°„ë™ì•ˆ ìˆ˜í–‰í•œ ì‘ì—…ë“¤ì— ëŒ€í•´ ë§í•  ë•Œ ê·¸ ì‘ì—…ë“¤ì€ ë™ì‹œì— ìˆ˜í–‰ëë‹¤ê³  í•  ìˆ˜ ìˆê²Œ ëœë‹¤. í•œ ìˆœê°„ì—ëŠ” ì—„ë°€íˆ ë”°ì§€ë©´ í•œ ì‘ì—…ì´ ìˆ˜í–‰ëœë‹¤.\në³‘ë ¬ì„±ì´ë€ ì—¬ëŸ¬ ì½”ì–´ì—ì„œ ì‘ì—…ì´ ë³‘ë ¬ì ìœ¼ë¡œ ì§„í–‰ë˜ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤. ê·¸ ê²°ê³¼ ì¼ì •í•œ ê¸°ê°„ì´ ì•„ë‹Œ ìˆœê°„ì„ ë†“ê³  ë´¤ì„ ë•Œì—ë„ ì—¬ëŸ¬ ì‘ì—…ì´ ë³‘ë ¬ì ìœ¼ë¡œ ë™ì‹œì— ìˆ˜í–‰ë˜ê²Œ ëœë‹¤.\nì½”ì–´ ìˆ˜ ë³´ë‹¤ ë§ì€ ìŠ¤ë ˆë“œê°€ ì´ìš©ë  ê²½ìš°ëŠ” ë™ì‹œì„±ê³¼ ë³‘ë ¬ì„±ì´ í•¨ê»˜ ì´ìš©ëœë‹¤ê³  ë³¼ ìˆ˜ ìˆë‹¤. ì¦‰ ì—¬ëŸ¬ ìŠ¤ë ˆë“œì— ê±¸ì³ ì—¬ëŸ¬ ì‘ì—…ì´ ì™„ë£Œ ë˜ì§€ ì•Šì•˜ì§€ë§Œ ì ì ˆíˆ switchë˜ë©° ì§„í–‰ëœë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.\ní”„ë¡œê·¸ë˜ë°ì ìœ¼ë¡œ ë´¤ì„ ë•Œ ê°™ì´ ë™ì‹œì„±ì€ ë¸”ë½ì´ ë§ì´ ê±¸ë¦¬ëŠ” ì‘ì—…ì— ìœ ë¦¬í•˜ê³ , ë³‘ë ¬ì„±ì€ CPU boundí•œ ì‘ì—…ì— ìœ ë¦¬í•˜ë‹¤ê³  ìƒê°ëœë‹¤. ê·¸ëŸ¼ ì¢€ ë” ìì„¸íˆ ë™ì‹œì„±ê³¼ ë³‘ë ¬ì„±ì´ \u0026ldquo;ì–¸ì œ\u0026rdquo; \u0026ldquo;ì™œ\u0026rdquo; ìœ ë¦¬í•œì§€ ì•Œì•„ë³´ì.\nConcurrency - Blockì´ ë§ì€ ì‘ì—…ì— ìœ ë¦¬ ì˜ˆìƒ: ë¸”ë½ì´ ë§ì€ ì‘ì—…ì˜ ê²½ìš° Core ìˆ«ìì— ìƒê´€ ì—†ì´ ëŒ€ì²´ë¡œ ë§ì€ thread(í˜¹ì€ goroutine)ì„ ìƒì„±í•  ìˆ˜ë¡ ì‘ì—…ì´ ë¹¨ë¼ì§ˆ ê²ƒì´ë‹¤.\nblockì´ ë§ì€ ì‘ì—…ì´ ë­ê°€ ìˆì„ê¹Œ? ë„¤íŠ¸ì›Œí¬ IO ë¸”ë½ì´ ë§ì´ ê±¸ë¦´ ì‘ì—…ìœ¼ë¡œì„œ https://example.com ì— ìš”ì²­/ì‘ë‹µì„ ì–»ëŠ” ì‘ì—…ì„ 64ë²ˆ ìˆ˜í–‰í•´ë³´ê² ë‹¤. coreì˜ ìˆ«ìë¥¼ 1ê°œë¡œ ì œí•œí•˜ì—¬ concurrencyì˜ íš¨ê³¼ë¥¼ ê´€ì°°í•´ë³´ê¸° ìœ„í•´ 4ê°œì˜ ì½”ì–´ë¡œ 8ê°œì˜ ìŠ¤ë ˆë“œë¥¼ í•˜ì´í¼ìŠ¤ë ˆë”©í•˜ëŠ” ë‚´ ë©íƒ‘ì´ ì•„ë‹Œ AWS EC2 t2.microì—ì„œ ë²¤ì¹˜ë§ˆí¬ë¥¼ ìˆ˜í–‰í–ˆë‹¤.\ní”„ë¡œê·¸ë¨ ì½”ë“œ package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/stretchr/testify/assert\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;sync\u0026#34; \u0026#34;testing\u0026#34; ) func Benchmarkë™ì‹œì„±(b *testing.B) { for _, goroutineNum := range []int{1,4,8,16,32,64}{ b.Run(fmt.Sprintf(\u0026#34;%dê°œì˜ goroutine\u0026#34;, goroutineNum), func(b *testing.B) { for i := 0; i \u0026lt; b.N; i++{ doë™ì‹œì„±(b, goroutineNum) } }) } } func doë™ì‹œì„±(b *testing.B, goroutineNum int){ wg := \u0026amp;sync.WaitGroup{} totalRep := 64 for n := 0; n \u0026lt; goroutineNum; n++{ wg.Add(1) go func(num int) { for j := 0; j \u0026lt; totalRep / goroutineNum; j++{ resp, err := http.Get(\u0026#34;https://example.com\u0026#34;) assert.NoError(b, err) assert.Equal(b, 200, resp.StatusCode) } wg.Done() }(n) } wg.Wait() } Core 1ê°œì˜ AWS EC2 t2.microì—ì„œì˜ ë²¤ì¹˜ë§ˆí‚¹ ubuntu@ip-172-31-12-2:~/concurrency$ CGO_ENABLED=0 go test ./concurrency_test.go -bench=. -benchtime=1x goos: linux goarch: amd64 Benchmarkë™ì‹œì„±/1ê°œì˜_goroutine 1 9426630119 ns/op Benchmarkë™ì‹œì„±/4ê°œì˜_goroutine 1 2354737545 ns/op Benchmarkë™ì‹œì„±/8ê°œì˜_goroutine 1 1192283559 ns/op Benchmarkë™ì‹œì„±/16ê°œì˜_goroutine 1 604589767 ns/op Benchmarkë™ì‹œì„±/32ê°œì˜_goroutine 1 313062480 ns/op Benchmarkë™ì‹œì„±/64ê°œì˜_goroutine 1 182304298 ns/op PASS ok command-line-arguments 28.809s 64ë²ˆ ìš”ì²­/ì‘ë‹µ ì‘ì—…ì„ ìˆ˜í–‰í•  ë•Œ ë§¨ ìœ„ì˜ ê²½ìš°ëŠ” 1ê°œì˜ goroutineì´ 64ë²ˆ, ë§¨ ë°‘ì˜ ê²½ìš°ì—ëŠ” 64ê°œì˜ goroutineì´ ê°ê° 1ë²ˆì”© ìˆ˜í–‰í•˜ëŠ” ì‹ìœ¼ë¡œ ì§„í–‰í–ˆë‹¤. 1ê°œì˜ ì½”ì–´ë¥¼ ê°–ëŠ” t2.microì—ì„œë„ 64ê°œì˜ goroutineìœ¼ë¡œ concurrentí•˜ê²Œ ì‘ì—…ì„ ì§„í–‰í•˜ëŠ” ê²ƒì´ ë” ì†ë„ê°€ ë¹¨ëë‹¤. ë„¤íŠ¸ì›Œí¬ IOë¡œ CPUê°€ ë†€ê³ ìˆëŠ” ì‹œê°„ì´ ë§ì•˜ê¸° ë•Œë¬¸ì— í•˜ë‚˜ì˜ ì½”ì–´ë¡œë„ concurrentí•˜ê²Œ ìˆ˜ ë§ì€ ì‘ì—…ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì§„í–‰í•  ìˆ˜ ìˆì—ˆë‹¤.\nParallelism - CPU boundí•œ ì‘ì—…ì— ìœ ë¦¬ ì˜ˆìƒ: CPU boundí•œ ì‘ì—…ì˜ ê²½ìš° ì½”ì–´ì˜ ê°œìˆ˜ê¹Œì§€ëŠ” goroutineì´ ëŠ˜ì–´ë‚  ìˆ˜ë¡ ì„±ëŠ¥ì´ ì¢‹ì„ ê²ƒì´ë‹¤.\n(ì•„ì§ ì½”ì–´ì™€ í”„ë¡œì„¸ì„œ, vCPUì˜ ì°¨ì´ëŠ” ëª…í™•íˆëŠ” ëª¨ë¥´ê² ë‹¤)\nCPU Boundí•œ ì‘ì—…ì˜ ê²½ìš°ëŠ” ì •ë§ ë™ì‹œì„±ë³´ë‹¨ ë³‘ë ¬ì„±ì„ ì´ìš©í•  ë•Œ ë” ì¢‹ì€ ì„±ëŠ¥ì„ ë³´ì¼ê¹Œ? ì¼ì¢…ì˜ ì œê³± ì—°ì‚°ìœ¼ë¡œ CPUë¥¼ í˜¹ì‚¬ì‹œí‚¤ëŠ” ì‘ì—…ì„ ì •ì˜í–ˆë‹¤. ë³‘ë ¬ì„±ì˜ ê²½ìš° ì–´ë–¤ ê²½ìš°ê¹Œì§€ê°€ ë³‘ë ¬ì„±ì´ê³ , ì–´ë–¤ ê²½ìš°ê¹Œì§€ê°€ ë™ì‹œì„± + ë³‘ë ¬ì„±ì¸ì§€ í—·ê°ˆë¦´ ìˆ˜ ìˆê¸°ì— ì •ë¦¬í•´ë³¸ë‹¤.\nì½”ì–´ 1ê°œì— ì—¬ëŸ¬ í˜¹ì€ goroutine =\u0026gt; ë‹¹ì—°íˆ ë³‘ë ¬ì„±ì´ ì¼ì–´ë‚  ì½”ì–´ë“¤ì´ ì—†ìœ¼ë‹ˆ ë™ì‹œì„± ì½”ì–´ Nê°œì— Nê°œ ì´í•˜ì˜ ì—¬ëŸ¬ goroutine =\u0026gt; ë³‘ë ¬ì„± ì½”ì–´ Nê°œì— Nê°œ ì´ìƒì˜ ì—¬ëŸ¬ goroutine =\u0026gt; ë™ì‹œì„± + ë³‘ë ¬ì„±. í•˜ì§€ë§Œ CPU Bound í•œ ì‘ì—…ì˜ ê²½ìš° ë™ì‹œì„±ì€ ë³„ ì´ì ì„ ê°€ì ¸ë‹¤ ì£¼ì§€ ì•ŠëŠ”ë‹¤. í”„ë¡œê·¸ë¨ ì½”ë“œ package main import ( \u0026#34;fmt\u0026#34; \u0026#34;sync\u0026#34; \u0026#34;testing\u0026#34; ) func Benchmarkë³‘ë ¬ì„±(b *testing.B) { for _, goroutineNum := range []int{1,4,8,16,32,64}{ b.Run(fmt.Sprintf(\u0026#34;%dê°œì˜ goroutine\u0026#34;, goroutineNum), func(b *testing.B) { for i := 0; i \u0026lt; b.N; i++{ doë³‘ë ¬ì„±(b, goroutineNum) } }) } } func doë³‘ë ¬ì„±(b *testing.B, goroutineNum int){ wg := \u0026amp;sync.WaitGroup{} totalRep := 1024 * 1024 dummyNumber := 12345 for n := 0; n \u0026lt; goroutineNum; n++{ wg.Add(1) go func(num int) { for j := 0; j \u0026lt; totalRep / goroutineNum; j++{ dummyNumber = (dummyNumber * dummyNumber) % 100000 } wg.Done() }(n) } wg.Wait() } Core 1ê°œì˜ AWS t2.microì—ì„œì˜ ë²¤ì¹˜ë§ˆí‚¹ ubuntu@ip-172-31-12-2:~/concurrency$ CGO_ENABLED=0 go test ./parallelism_test.go -bench=. -benchtime=10x goos: linux goarch: amd64 Benchmarkë³‘ë ¬ì„±/1ê°œì˜_goroutine 10 15228154 ns/op Benchmarkë³‘ë ¬ì„±/4ê°œì˜_goroutine 10 14048765 ns/op Benchmarkë³‘ë ¬ì„±/8ê°œì˜_goroutine 10 14038413 ns/op Benchmarkë³‘ë ¬ì„±/16ê°œì˜_goroutine 10 13916091 ns/op Benchmarkë³‘ë ¬ì„±/32ê°œì˜_goroutine 10 13877358 ns/op Benchmarkë³‘ë ¬ì„±/64ê°œì˜_goroutine 10 14082735 ns/op PASS ok command-line-arguments 0.946s t2.microì˜ ê²½ìš° ì½”ì–´ê°€ 1ê°œì´ê¸° ë•Œë¬¸ì— ë³‘ë ¬ì„±ì´ ì¡´ì¬í•  ê²ƒë„ ì—†ì´ ë™ì‹œì„±ë§Œì´ ì¡´ì¬í•œë‹¤ê³  í–ˆë“¯ì´ goroutineì´ ë§ì•„ì ¸ë„ ì„±ëŠ¥ì´ ì¢‹ì•„ì§€ì§€ ì•ŠëŠ”ë‹¤. ë˜ë ¤ ë¶ˆí•„ìš”í•œ goroutineì„ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ì½”ìŠ¤íŠ¸ì™€ ë¯¸ë¯¸í•˜ê² ì§€ë§Œ ì¡´ì¬í•  goroutineì— ëŒ€í•œ context switchë¡œ ì¸í•´ ì‘ì—…ì´ ë” ë”ëŒì§€ê¸°ë„ í•˜ëŠ” ê²°ê³¼ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤.\nCore 4ê°œë¡œ 8ê°œì˜ vCPUë¥¼ ê°€ì§„ ë‚˜ì˜ ë©íƒ‘ì—ì„œì˜ ë²¤ì¹˜ë§ˆí‚¹ $ go test ./parallelism_test.go -bench=. -benchtime=10x goos: linux goarch: amd64 Benchmarkë³‘ë ¬ì„±/1ê°œì˜_goroutine-8 10 10263785 ns/op Benchmarkë³‘ë ¬ì„±/4ê°œì˜_goroutine-8 10 7342331 ns/op Benchmarkë³‘ë ¬ì„±/8ê°œì˜_goroutine-8 10 4872064 ns/op Benchmarkë³‘ë ¬ì„±/16ê°œì˜_goroutine-8 10 5000452 ns/op Benchmarkë³‘ë ¬ì„±/32ê°œì˜_goroutine-8 10 4830541 ns/op Benchmarkë³‘ë ¬ì„±/64ê°œì˜_goroutine-8 10 4968710 ns/op PASS ok command-line-arguments 0.419s ë‚´ ë©íƒ‘ì€ ì‹¤ì œ coreëŠ” 4ê°œì§€ë§Œ 8ê°œì˜ ìŠ¤ë ˆë“œê¹Œì§€ ë³‘ë ¬ì ìœ¼ë¡œ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•˜ë¯€ë¡œ 8ê°œë¼ê³  ë³¼ ìˆ˜ ìˆë‹¤.\në”°ë¼ì„œ 8ê°œì˜ goroutineê¹Œì§€ëŠ” ë³‘ë ¬ì„±ì— ì˜í•´ ì„±ëŠ¥ì´ ì ì  ì¢‹ì•„ì§€ê³ , 8ê°œ ì´ˆê³¼ì˜ goroutineë¶€í„°ëŠ” ë³‘ë ¬ì„±ê³¼ ë™ì‹œì„±ì´ ëª¨ë‘ ì ìš©ë˜ê² ì§€ë§Œ í˜„ì¬ì˜ ì‘ì—…ì€ CPU boundí•˜ê¸° ë•Œë¬¸ì— ë™ì‹œì„±ì€ ê·¸ë‹¥ ì´ì ì„ ê°€ì ¸ë‹¤ì£¼ì§€ ëª»í•˜ê³  EC2ì˜ ê²½ìš°ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ê³¼ì‰ë˜ëŠ” goroutineìœ¼ë¡œ ì¸í•´ ì˜¤íˆë ¤ ì„±ëŠ¥ì„ ì €í•˜ì‹œí‚¬ ìˆ˜ ìˆë‹¤. ì½”ë“œì— ì²¨ë¶€ëŠ” í•˜ì§€ ì•Šì•˜ì§€ë§Œ ê·¹ë‹¨ì ìœ¼ë¡œ ê³¼ì‰ë˜ëŠ” goroutineì€ ì•„ë˜ì™€ ê°™ì€ ì„±ëŠ¥ ì €í•˜ë¥¼ ì•¼ê¸°í•˜ê¸°ë„ í–ˆë‹¤.\nBenchmarkë³‘ë ¬ì„±/8ê°œì˜_goroutine-8 10 580169905 ns/op Benchmarkë³‘ë ¬ì„±/16ê°œì˜_goroutine-8 10 602391376 ns/op Benchmarkë³‘ë ¬ì„±/1024*1024ê°œì˜_goroutine-8 10 879079810 ns/op (í•œí¸ìœ¼ë¡  1024*1024ê°œì˜ goroutineì„ ê´€ë¦¬í•˜ëŠ” ë°ì—ë„ ì„±ëŠ¥ ì €í•˜ê°€ ì €ì •ë„ ë¿ì´ë¼ë‹ˆ ëŒ€ë‹¨í•˜ë‹¨ ìƒê°ë„ ë“ ë‹¤\u0026hellip;!)\në§ˆì¹˜ë©° ë™ì‹œì„±ê³¼ ë³‘ë ¬ì„±ì€ Goë¥¼ ê³µë¶€í•˜ë©´ì„œ ì»´í“¨í„° êµ¬ì¡°ë¥¼ ê³µë¶€í•˜ë©´ì„œ ë„ˆë¬´ë„ ë§ì´ íŒŒê³ ë“¤ì—ˆë˜ ë‚´ìš©ì´ë¼ ìˆ ìˆ  ì í ì¤„ ì•Œì•˜ëŠ”ë° ì‹œê°„ì´ ì¢€ ì§€ë‚˜ì„œì¸ì§€ ê°€ë¬¼ê°€ë¬¼í•œ ë‚´ìš©ë„ ì¢€ ìˆì—ˆê³  ë‚´ìš©ë„ ì‰½ì§€ ì•Šì•˜ìœ¼ë©° ì¢‹ì€ ì˜ˆì‹œë¥¼ ì–´ë–»ê²Œ ë“¤ì–´ì•¼í•  ì§€ ë§ì´ ê³ ë¯¼ì´ ëë˜ ê²ƒ ê°™ë‹¤. ì´ëŸ° ì €ëŸ° ìƒê°ë“¤ë¡œ ì¸í•´ ì„¤ëª…ì´ë‚˜ ì§„í–‰ì´ ê·¸ë ‡ê²Œ ê¹”ë”íˆ ëœ ê²ƒ ê°™ì§„ ì•Šì§€ë§Œ ê·¸ë˜ë„ ê²°ë¡ ì´ ê¹”ë”í•˜ê²Œ ë‚˜ì™€ì„œ ë‹¤í–‰ì´ë‹¤. ì‚¬ì‹¤ ì´ëŸ° ì½”ì–´ë‚˜ ê³ ë£¨í‹´, ìŠ¤ë ˆë“œì˜ ê°œìˆ˜ì— ë”°ë¼ ë³‘ë ¬ì„±ì´ë‚˜ ë™ì‹œì„±ì„ êµ¬ë¶„ ì§“ê¸°ë³´ë‹¤ \u0026lsquo;ë™ì‹œì„±ì€ ì£¼ë¡œ êµ¬ì¡°ì™€ ê´€ë ¨ë˜ê³  ë³‘ë ¬ì„±ì€ ì‹¤í–‰ê³¼ ê´€ë ¨ëœë‹¤.\u0026lsquo;ì™€ ê°™ì€ ì² í•™ì ì¸ ë‚´ìš©ë„ ê°„ê°„íˆ ë‚˜ì˜¤ê¸´ í•˜ì§€ë§Œ ëª‡ ë‹¬ ì§¸ ê·¸ë‹¥ ì™€ë‹¿ì§€ ì•Šê³ , ê°„ê°„íˆ ë“±ì¥í•  ë¿ ì˜¤í”¼ì…œí•œ ë‚´ìš©ì€ ì•„ë‹Œ ë“¯í•˜ì—¬ ìƒëµí–ˆë‹¤.\nê·¸ë¦¬ê³  ì´ë²ˆì—” ë²¤ì¹˜ë§ˆí¬ í…ŒìŠ¤íŠ¸ì— í•œê¸€ ì´ë¦„ì„ ë„ì…í•´ë´¤ëŠ”ë° ì½ê¸°ë„ í¸í•˜ê³  ë‚˜ë¦„ ê·€ì—¬ìš´ ê²ƒ ê°™ë‹¤. ã…ã… ì¢…ì¢… ê°œë°œí•˜ë©´ì„œ í…ŒìŠ¤íŠ¸ ì½”ë“œ ì§¤ ë•Œì—ë„ í•œê¸€ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ì‚¬ìš©í•´ë³´ë ¤í•œë‹¤.\nì°¸ê³  Concurrency is not parallelism https://blog.golang.org/waza-talk\nConcurrency is not parallelism slide - Rob Pike https://talks.golang.org/2012/waza.slide#1\nBack to the Essence - Concurrency vs Parallelism https://homoefficio.github.io/2019/02/02/Back-to-the-Essence-Concurrency-vs-Parallelism/\n[ ì œ 4íšŒ íŒŒì´ì¬ ê²©ì›” ì„¸ë¯¸ë‚˜ ] ë™ì‹œì„±ê³¼ ë³‘ë ¬ì„± - ì´ì°¬í˜• https://youtu.be/Iv3e9Dxt9WY\n","date":"2021-02-04T12:46:54+09:00","image":"https://umi0410.github.io/blog/golang/go-concurrency-vs-parallelism/concurrency-vs-parallelism_hu86023f6654c19803b1eea4e88bc97fcd_191924_120x120_fill_q75_box_smart1.jpg","permalink":"https://umi0410.github.io/blog/golang/go-concurrency-vs-parallelism/","title":"Go ì–¸ì–´ë¡œ ì ìš©í•´ë³´ëŠ” Computer Science - Concurrency vs Parallelism"},{"content":"ì‹œì‘í•˜ë©° ê°œë°œ ê³µë¶€ë¥¼ ì²˜ìŒ ì‹œì‘í•œ ì§€ ì–¸ì œ ì•ˆ ëì„ ë¬´ë µ, ì˜ê²½ ë³µë¬´ë¥¼ í•˜ë©° ìë°”ë¡œ TCP Socketì„ ì´ìš©í•´ ì˜† ì»´í“¨í„°ì™€ ì±„íŒ…ì„ í•˜ëŠ” í”„ë¡œê·¸ë¨ì„ ë§Œë“¤ì–´ ë³´ëŠ” ê²ƒì„ ì‹œì‘ìœ¼ë¡œ dockerë‚˜ mysqlê³¼ ê°™ì€ ë‹¤ì–‘í•œ ì˜¤í”ˆì†ŒìŠ¤ë“¤ì„ ì´ìš©í•´ë³´ë©´ì„œë‚˜ ë„¤íŠ¸ì›Œí¬ë¥¼ ê³µë¶€í•˜ë©´ì„œ ë‹¤ì–‘í•˜ê²Œ ë“¤ì–´ì™”ë˜ ì†Œì¼“ì´ì§€ë§Œ ì •í™•íˆ ì–´ë–¤ ì—­í• ì„ í•˜ëŠ”ì§€ ì–´ë–¤ ì¢…ë¥˜ê°€ ìˆëŠ”ì§€ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ ì•Œì§€ ëª»í–ˆë‹¤.\nì˜¤ëŠ˜ì€ ê·¸ë ‡ê²Œ ì•Œì­ë‹¬ì­í•œ ì¡´ì¬ì˜€ë˜ ì†Œì¼“ì„ í¬ê²Œ Unix Domain Socketì™€ Network Socket ë‘ ê°€ì§€ë¡œ ë‚˜ëˆ  ì •ë¦¬í•´ë³´ê³  Unix Domain Socketê³¼ TCPë¥¼ ì‚¬ìš©í•˜ëŠ” Network Socketì„ ë²¤ì¹˜ë§ˆí¬í•´ë³´ê³  ì–´ë–¤ ì°¨ì´ê°€ ìˆëŠ”ì§€ í™•ì¸í•´ë³´ë„ë¡ í•˜ê² ë‹¤. ì£¼ë¡œ ë‚´ê°€ ì†Œì¼“ì„ ì ‘í–ˆë˜ ìë£Œë‚˜ ì´ìŠˆ ìƒí™©ì—ì„œëŠ” UDPë³´ë‹¤ëŠ” TCPê°€ ë§ì´ ë“±ì¥í–ˆì—ˆê¸° ë•Œë¬¸ì— UDPì— ëŒ€í•œ ë‚´ìš©ì€ ê±°ì˜ ì œì™¸í•  ê²ƒì´ë¯€ë¡œ ëŒ€ë¶€ë¶„ì´ Network socketê³¼ Unix domain socket ê°ê°ì˜ stream(network socketì—ì„  tcpë¥¼ ì´ìš©í•˜ëŠ” ê²½ìš°ì— í•´ë‹¹) type socketì— ê´€ë ¨í•œ ë‚´ìš©ì¼ ê²ƒì´ë‹¤.\nSocket ì´ë€ ì†Œì¼“ì€ ì–´ë– í•œ í†µì‹ ì—ì„œì˜ Endpoint(ëì ) ì—­í• ì„ í•œë‹¤. ëì ì´ ì—†ìœ¼ë©´ ì–´ë””ì™€ ì–´ë””ê°€ í†µì‹ í•˜ëŠ”ì§€ ì–´ë””ì— ë°ì´í„°ë¥¼ ì¨ì•¼í•˜ëŠ”ì§€ ì•Œ ìˆ˜ ì—†ë‹¤.\nì†Œì¼“ì„ ë§ˆì¹˜ ì „êµ¬ ì†Œì¼“ê³¼ ê°™ì´ ì†Œì¼“ì´ë¼ê³  ë¶€ë¥´ëŠ” ì´ìœ ëŠ” ì†Œì¼“ì— ì˜¬ë°”ë¥´ê²Œ ë°ì´í„°ë¥¼ ì ê¸°ë§Œ í•˜ë©´ í†µì‹ ì„ ìœ„í•œ ì„¸ë¶€ì ì¸ ë™ì‘ì€ ì†Œì¼“ì´ ì•Œì•„ì„œ ìˆ˜í–‰í•˜ê¸° ë•Œë¬¸ì´ë‹¤. ë”°ë¼ì„œ ìš°ë¦¬ëŠ” í†µì‹ ì„ í•˜ê¸° ìœ„í•œ Socketì„ ì˜¬ë°”ë¥´ê²Œ ìƒì„±í•˜ê³ , ê·¸ ê³³ì— ë°ì´í„°ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì ê±°ë‚˜ ê·¸ê³³ì˜ ë°ì´í„°ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì½ê¸°ë§Œ í•˜ë©´ ëœë‹¤. ì‹¤ì œ ë°ì´í„° ì „ì†¡ì€ ì†Œì¼“ì´ ì•Œì•„ì„œ ìˆ˜í–‰í•´ì¤€ë‹¤.\nì†Œì¼“ì€ ê°™ì€ í˜¸ìŠ¤íŠ¸ ë‚´ì—ì„œ IPCë¥¼ ìœ„í•´ ì‚¬ìš©ë˜ëŠ” Unix domain socketê³¼ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì„ í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” Network socketìœ¼ë¡œ ë¶„ë¥˜í•  ìˆ˜ ìˆë‹¤. ê°„í˜¹ unix domain socketê³¼ TCPë¥¼ ì´ìš©í•˜ëŠ” Network socket, UDPë¥¼ ì´ìš©í•˜ëŠ” Network socket ì´ë ‡ê²Œ ì„¸ ê°€ì§€ë¡œ ë¶„ë¥˜í•˜ëŠ” ê²½ìš°ë¥¼ ë³¸ ê²ƒ ê°™ì€ë° ì´ëŠ” ì˜ëª»ëœ ë¶„ë¥˜ë¼ê³  ìƒê°í•œë‹¤. Network socket ë¿ë§Œ ì•„ë‹ˆë¼ Unix domain socket ë˜í•œ stream(Network socketì˜ ê²½ìš° TCPë¥¼ ì´ìš©í•˜ëŠ” ê²½ìš°ì— í•´ë‹¹) íƒ€ì…ê³¼ datagram íƒ€ì…(Network socketì˜ ê²½ìš° UDPë¥¼ ì´ìš©í•˜ëŠ” ê²½ìš°ì— í•´ë‹¹)ìœ¼ë¡œ ì‚¬ìš©ë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.\nì„œë²„ ì†Œì¼“ê³¼ í´ë¼ì´ì–¸íŠ¸ ì†Œì¼“ server-client-socket.jpeg ì†Œì¼“ì„ ì—­í• ì˜ ì¸¡ë©´ì—ì„œ ë¶„ë¥˜í•œë‹¤ë©´ ì„œë²„ ì†Œì¼“ê³¼ í´ë¼ì´ì–¸íŠ¸ ì†Œì¼“ìœ¼ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆë‹¤. ë™ì¼í•œ êµ¬ì¡°ì˜ ì†Œì¼“ì´ì§€ë§Œ ìƒì„±ë˜ëŠ” ì‹œê¸°ë‚˜ ì—­í• ì´ ë‹¤ë¥¼ ë¿ì´ë‹¤.\nì„œë²„ ì†Œì¼“ - í´ë¼ì´ì–¸íŠ¸ ì†Œì¼“ì˜ ì—°ê²° ìš”ì²­ì„ ë°›ì•„ë“¤ì´ê¸°ë§Œ í•  ë¿. ì‹¤ì œ ì„œë²„ ì¸¡ì—ì„œì˜ ë°ì´í„°ì˜ ì†¡ìˆ˜ì‹ ì€ ì„œë²„ ì†Œì¼“ì´ í´ë¼ì´ì–¸íŠ¸ ì†Œì¼“ì˜ ì—°ê²° ìš”ì²­ì„ ìˆ˜ë½í•˜ë©´ì„œ ìƒˆë¡œ ë§Œë“¤ì–´ì§€ëŠ” ì†Œì¼“ì„ í†µí•´ ìˆ˜í–‰. í´ë¼ì´ì–¸íŠ¸ ì†Œì¼“ - í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ì™€ í†µì‹ í•˜ê³ ì í•  ë•Œ ìƒì„±í•˜ëŠ” ì†Œì¼“. í´ë¼ì´ì–¸íŠ¸ëŠ” ì‹¤ì œ ë°ì´í„° ì†¡ìˆ˜ì‹ ë„ ì´ ì†Œì¼“ì„ í†µí•´ ìˆ˜í–‰. ì„œë²„ ì†Œì¼“ê³¼ í´ë¼ì´ì–¸íŠ¸ ì†Œì¼“ì´ ë‹¨ìˆœí•œê²Œ 1:Nìœ¼ë¡œë§Œ í†µì‹ í•˜ë©´ ì´ë ‡ê²Œ ì„œë²„ ì†Œì¼“ì´ í´ë¼ì´ì–¸íŠ¸ ì†Œì¼“ì˜ ìš”ì²­ì„ ìˆ˜ë½í•œ ë’¤ ìƒˆë¡œ ì†Œì¼“ì„ ë§Œë“¤ í•„ìš” ì—†ì§€ ì•Šì„ê¹Œì‹¶ì§€ë§Œ ê·¸ë ‡ê²Œ ë˜ë©´ ì„œë²„ê°€ ê° í´ë¼ì´ì–¸íŠ¸ì™€ í†µì‹ í•  ë•Œ í•˜ë‚˜ì˜ ì†Œì¼“ì„ ì´ìš©í•˜ë¯€ë¡œ ì˜¬ë°”ë¥´ê²Œ ì›í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ì™€ í†µì‹ í•  ìˆ˜ ì—†ì„í…Œë‹ˆ ì¢‹ì€ ë°©ì‹ì´ ì•„ë‹ ê²ƒì´ë‹¤.\nê·¸ë ‡ë‹¤ë©´ ê³¼ì—° ì •ë§ ì„œë²„ì—ì„œëŠ” ì—°ê²°ì„ accept í•œ ë’¤ ì†Œì¼“ì„ ìƒˆë¡œ ìƒì„±í• ê¹Œ? í™•ì¸í•´ë³´ì.\npackage main import ( \u0026#34;log\u0026#34; \u0026#34;net\u0026#34; \u0026#34;os\u0026#34; \u0026#34;time\u0026#34; ) var ( network = \u0026#34;tcp\u0026#34; address = \u0026#34;0.0.0.0:8080\u0026#34; ) func main() { os.Remove(address) socket, err := net.Listen(network, address) if err != nil { log.Fatal(err) } for { connectedSocket, err := socket.Accept() if err != nil{ log.Fatal(err) } go func() { for i := 0; i \u0026lt;= 10; i++{ connectedSocket.Write([]byte(\u0026#34;pong\\n\u0026#34;)) time.Sleep(time.Second) } connectedSocket.Close() }() } } ê°„ë‹¨í•˜ê²Œ TCP í†µì‹ í”„ë¡œê·¸ë¨ì„ í•˜ë‚˜ ë§Œë“¤ì–´ë´¤ë‹¤. ë‹¨ìˆœíˆ 1ì´ˆ ê°„ê²©ìœ¼ë¡œ pongì„ 5ë²ˆ ì¶œë ¥í•œ ë’¤ ì—°ê²°ì„ ëŠëŠ” í”„ë¡œê·¸ë¨ì´ë‹¤.\nìš”ì²­ ì „\n$ netstat --tcp Active Internet connections (w/o servers) Proto Recv-Q Send-Q Local Address Foreign Address State tcp 0 0 ip-172-31-34-13.ap-:ssh 124.50.93.166:60082 ESTABLISHED tcp 0 0 ip-172-31-34-13.ap-:ssh 124.50.93.166:60084 ESTABLISHED tcp 0 0 ip-172-31-34-13.ap-:ssh 124.50.93.166:60078 ESTABLISHED ìš”ì²­ ìˆ˜ë½ í›„ í†µì‹  ì¤‘ - ì†Œì¼“ì´ í•˜ë‚˜ ìƒì„±ë˜ì–´ ESTABLISHED ìƒíƒœ\n$ netstat --tcp Active Internet connections (w/o servers) Proto Recv-Q Send-Q Local Address Foreign Address State tcp 0 0 ip-172-31-34-13.ap-:ssh 124.50.93.166:60082 ESTABLISHED tcp 0 0 ip-172-31-34-13.ap-:ssh 124.50.93.166:60084 ESTABLISHED tcp 0 0 ip-172-31-34-13.ap-:ssh 124.50.93.166:60078 ESTABLISHED tcp6 0 0 ip-172-31-34-1:http-alt 124.50.93.166:42434 ESTABLISHED í†µì‹  ì¢…ë£Œ - ìƒì„±ë˜ì—ˆë˜ ì†Œì¼“ì´ TIME_WAIT ìƒíƒœ. ì ì‹œ í›„ ì‚¬ë¼ì§„ë‹¤.\n$ netstat --tcp Active Internet connections (w/o servers) Proto Recv-Q Send-Q Local Address Foreign Address State tcp 0 0 ip-172-31-34-13.ap-:ssh 124.50.93.166:60082 ESTABLISHED tcp 0 0 ip-172-31-34-13.ap-:ssh 124.50.93.166:60084 ESTABLISHED tcp 0 0 ip-172-31-34-13.ap-:ssh 124.50.93.166:60078 ESTABLISHED tcp6 0 0 ip-172-31-34-1:http-alt 124.50.93.166:42434 TIME_WAIT ê¹”ë”í•œ ë„¤íŠ¸ì›Œí¬ ì •ë³´ë¥¼ ë³´ê¸° ìœ„í•´ ìˆœìˆ˜í•œ AWS EC2 t2.micro ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì‘ì—…í•´ë³´ì•˜ë‹¤. ë§¨ ìœ„ 3ì¤„ì— ë‚˜ì˜¨ ì†Œì¼“ ì •ë³´ëŠ” ssh ì ‘ì†ìœ¼ë¡œ ì¸í•œ ì†Œì¼“ ì •ë³´ì´ë‹¤.\në˜í•œ ì„œë²„ ì†Œì¼“ì€ ì¶œë ¥ë˜ì§€ ì•Šì•˜ëŠ”ë° ì´ëŠ” ìš°ë¦¬ëŠ” í‰ì†Œì— listen ì¤‘ì¸ í¬íŠ¸ë‚˜ ì„œë²„ ì†Œì¼“ì„ ë³´ê¸° ìœ„í•´ netstatì— -l ì˜µì…˜ì„ ì „ë‹¬í•œ ë°˜ë©´ ì´ë²ˆì—” \u0026ndash;tcp ì˜µì…˜ì„ í†µí•´ listen ì¤‘ì¸ ì„œë²„ ì†Œì¼“ì´ ì•„ë‹Œ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ìˆ˜ë½í•œ ë’¤ ìƒì„±ë˜ëŠ” ì†Œì¼“ì„ ë³´ë ¤í•˜ê³ ìˆê¸° ë•Œë¬¸ì´ë‹¤.\n4ë²ˆ ì§¸ ì¤„ì˜ ì†Œì¼“ ì •ë³´ê°€ ë°”ë¡œ ìš°ë¦¬ê°€ ìƒê°í•˜ëŠ” ì„œë²„ ì†Œì¼“ì´ clientì˜ ì—°ê²° ìš”ì²­ì„ accept í›„ ìƒì„±í•˜ëŠ” socketì´ë‹¤. í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ accept í›„ì— ìƒˆë¡œìš´ ì†Œì¼“ì´ ìƒì„±ë˜ë©° í†µì‹  ì¢…ë£Œ í›„ ì ì‹œ ê¸°ë‹¤ë¦° ë’¤ ì‚¬ë¼ì§„ë‹¤.\nNetwork Socket Network socketì€ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì´ í•„ìš”í•œ ì‘ì—…ì„ ìˆ˜í–‰í•  ë•Œ ì´ìš©í•˜ëŠ” ì†Œì¼“ì˜ í•œ ì¢…ë¥˜ë¡œ ë‹¤ì‹œ ë™ì‘ ë°©ì‹ì— ë”°ë¼ TCP í”„ë¡œí† ì½œì„ ì´ìš©í•˜ëŠ” stream socketê³¼ UDP í”„ë¡œí† ì½œì„ ì´ìš©í•˜ëŠ” datagram socketìœ¼ë¡œ êµ¬ë¶„í•  ìˆ˜ ìˆë‹¤. ì‚¬ìš©ìëŠ” socketì— ë°ì´í„°ë¥¼ ì ê¸°ë§Œ í•˜ë©´ ë„¤íŠ¸ì›Œí¬ì™€ ê´€ë ¨ëœ ì‘ì—…ì€ socketì´ ì•Œì•„ì„œ ìˆ˜í–‰í•´ì¤€ë‹¤. ì½ì„ ë•Œì—ë„ ë§ˆì°¬ê°€ì§€ì´ë‹¤.\nTCP socketì´ë¼ê³  ë¶€ë¥´ëŠ” ì‚¬ëŒë„ ìˆê³  stream socket, TCP/IP socketì´ë¼ ë¶€ë¥´ëŠ” ì‚¬ëŒë„ ìˆëŠ” ê²ƒ ê°™ë‹¤. ì •í™•í•œ ëª…ì¹­ì€ ëª¨ë¥´ê² ì§€ë§Œ ì‚¬ìš©í•˜ê±°ë‚˜ ì´í•´í•˜ëŠ” ë°ì—ëŠ” ë¬´ë¦¬ê°€ ì—†ì„ ê²ƒ ê°™ë‹¤. TCPë¥¼ ì´ìš©í•˜ëŠ” stream typeì˜ Network socketê³¼ stream typeì˜ Unix domain socketì€ ì‚¬ìš© ë°©ë²•ì´ ë§¤ìš° ìœ ì‚¬í•˜ë‹¤. ë‘˜ ë‹¤ stream typeì´ê³ , ì†Œì¼“ì— ë°ì´í„°ë¥¼ ì ì€ ë’¤ì˜ ì‘ì—…ì€ ì†Œì¼“ì´ ì•Œì•„ì„œ ìˆ˜í–‰í•´ì£¼ê¸° ë•Œë¬¸ì´ë‹¤. ê°ê°ì˜ ì†Œì¼“ì„ ì´ìš©í•´ ì„œë²„ë¥¼ ë„ìš°ëŠ” ì‘ì—…ì€ ì¸ìì˜ ê°’ë§Œ ì¡°ê¸ˆ ë‹¬ë¼ì§ˆ ë¿ì´ë‹¤. ì´ëŠ” ê¸€ì˜ í•˜ë¶€ì˜ ì½”ë“œì—ì„œ í™•ì¸í•´ë³¼ ìˆ˜ ìˆë‹¤.\nSocketê³¼ Port Network socketì— ëŒ€í•´ì„œëŠ” socketê³¼ portì˜ êµ¬ë¶„ì´ë‚˜ ì—­í• ì´ ì• ë§¤í•˜ê²Œ ëŠê»´ì§ˆ ìˆ˜ ìˆë‹¤. í†µì‹ ì„ í•  ë•Œ IP ì£¼ì†Œë¥¼ ì´ìš©í•´ ëª©ì ì§€ì¸ Hostë¥¼ ì°¾ì„ ìˆ˜ëŠ” ìˆì§€ë§Œ ê·¸ Hostì˜ ì–´ë–¤ í”„ë¡œì„¸ìŠ¤ê³¼ í†µì‹ í•˜ë ¤ëŠ” ê²ƒì¸ì§€ëŠ” ì•Œ ìˆ˜ ì—†ë‹¤. ì˜¬ë°”ë¥¸ í”„ë¡œì„¸ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ìˆë„ë¡ í”„ë¡œì„¸ìŠ¤ì™€ ì–´ë– í•œ ìˆ«ìë¥¼ ë§¤í•‘ì‹œí‚¤ëŠ”ë° ì´ ìˆ«ìë¥¼ Port ë²ˆí˜¸ë¼ê³  í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´ 123.123.123.123:8080ìœ¼ë¡œ ìš”ì²­ì„ ë³´ë‚´ëŠ” ê²ƒì€ 123.123.123.123ì˜ IP ì£¼ì†Œë¥¼ ê°–ëŠ” Hostì˜ 8080ë²ˆ í¬íŠ¸ì— ë§µí•‘ëœ í”„ë¡œì„¸ìŠ¤ì— ìš”ì²­ì„ ë³´ë‚´ëŠ” ê²ƒì´ë‹¤.\nì´ ë•Œ Portì™€ í”„ë¡œì„¸ìŠ¤ë¥¼ ê·¸ëƒ¥ ì—°ê²°í•  ìˆ˜ëŠ” ì—†ê³  Socketì´ë¼ëŠ” ë…€ì„ì´ í•„ìš”í•˜ë‹¤. Socketì€ ì‹¤ì§ˆì ìœ¼ë¡œ ì–´ë–¤ í”„ë¡œì„¸ìŠ¤ë¥¼ ì–´ë–¤ í¬íŠ¸ì— ë§µí•‘ì‹œí‚¬ì§€ì— ëŒ€í•œ ì •ë³´ê°€ í•„ìš”í•˜ê³  ë„¤íŠ¸ì›Œí¬ ì‘ì—…ì„ ì•Œì•„ì„œ ìˆ˜í–‰í•œë‹¤.\nì¡°ê¸ˆ ë¹„ìœ ë¥¼ í•´ë³´ìë©´ íšŒì‚¬ë‚´ì— ì–´ë–¤ ë¶€ì„œê°€ ìˆê³  ì™¸ë¶€ì—ì„œ í•´ë‹¹ ë¶€ì„œì™€ ì‘ì—…í•˜ê¸° ìœ„í•´ì„  ì–´ë– í•œ ê³ ìœ í•œ ë¶€ì„œ ë²ˆí˜¸ê°€ í•„ìš”í•˜ê³ , ì´ë•Œ ì™¸ë¶€ì™€ í•´ë‹¹ ë¶€ì„œê°„ì— ì˜¤ê°€ëŠ” í†µì‹ ì„ ë‹´ë‹¹í•˜ëŠ” ë‹´ë‹¹ìê°€ ìˆì–´ì•¼í•˜ëŠ” ê²½ìš°ì— ë¹„ìœ í•´ ë³¼ ìˆ˜ ìˆë‹¤. \u0026ldquo;ì–´ë–¤ ë¶€ì„œ\u0026quot;ëŠ” í”„ë¡œì„¸ìŠ¤ì´ê³  \u0026ldquo;ê³ ìœ í•œ ë¶€ì„œ ë²ˆí˜¸\u0026quot;ëŠ” í¬íŠ¸ ë²ˆí˜¸, í†µì‹ ì„ ë‹´ë‹¹í•˜ëŠ” ë‹´ë‹¹ìëŠ” ì†Œì¼“ì— í•´ë‹¹í•œë‹¤.\nUnix Domain Socket Unix Domain Socketì€ IPC(Inter-Process Communication, í”„ë¡œì„¸ìŠ¤ ê°„ í†µì‹ )ì˜ ì—¬ëŸ¬ ë°©ë²• ì¤‘ ê°€ì¥ ììœ ë¡œìš°ë©´ì„œ ì‚¬ìš©í•˜ëŠ” ë°ì— ìˆì–´ ì œí•œì´ ë³„ë¡œ ì—†ëŠ” ë°©ë²•ì´ë‹¤. ë„¤íŠ¸ì›Œí¬ ì†Œì¼“ê³¼ ë‹¬ë¦¬ ê°™ì€ í˜¸ìŠ¤íŠ¸ ë‚´ì˜ í”„ë¡œì„¸ìŠ¤ ê°„ í†µì‹ ì„ ë‹´ë‹¹í•˜ê¸° ë•Œë¬¸ì— ì•„ë¬´ëŸ° ë„¤íŠ¸ì›Œí¬ ì‘ì—…ì´ í•„ìš” ì—†ë‹¤. í•˜ì§€ë§Œ TCPë‚˜ UDPë¥¼ ì´ìš©í•˜ëŠ” Network socketì„ ì´ìš©í•  ë•Œì™€ ì¸ì ê°’ë§Œ ì¡°ê¸ˆ ë°”ê¾¸ì–´ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤.\nğŸŒˆ ìƒìƒì˜ ë‚˜ë˜ - ìš°ë¦¬ê°€ ì•Œê²Œ ëª¨ë¥´ê²Œ ê²ªì—ˆë˜ Unix domain socketì˜ Permissionì˜¤ë¥˜ì— ëŒ€í•´ $ mysql stat /var/lib/mysql/mysql.sock stat: cannot stat \u0026#39;/var/lib/mysql/mysql.sock\u0026#39;: Permission denied $ docker docker: Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock ì£¼ë¡œ ìš°ë¦¬ê°€ MySQLì´ë‚˜ Dockerë¥¼ localhostì—ì„œ ì‚¬ìš©í•  ë•Œ unix socketì— ëŒ€í•œ permission ì—ëŸ¬ë¥¼ ê²ªì€ ì ì´ ìˆì„ ê²ƒì´ë‹¤. MySQLì´ë‚˜ Dockerë¥¼ ë¹„ë¡¯í•œ ë§ì€ ì˜¤í”ˆì†ŒìŠ¤ë“¤ì´ ì•„ë§ˆ ì„±ëŠ¥ìƒì˜ ì´ì ì„ ìœ„í•´ localhostì—ì„œ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•  ê²½ìš° Network socketì´ ì•„ë‹Œ Unix domain socketì„ ë§ì´ë“¤ ì´ìš©í•˜ëŠ” ê²ƒìœ¼ë¡œ ì•Œê³ ìˆë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ì£¼ë¡œ MySQL ì„¤ì¹˜ ì´í›„ Remoteì—ì„œëŠ” ì ‘ì†ì´ ë˜ëŠ”ë° localhostì—ì„œëŠ” ê¶Œí•œ ë¬¸ì œë¡œ ì ‘ì†ì´ ì•ˆëœë‹¤ê±°ë‚˜ Docker ì„¤ì¹˜ ì´í›„ ì‚¬ìš©ìë¥¼ docker groupì— ë„£ì–´ì£¼ëŠ” ê²½ìš°ê°€ ë§ì´ ìˆë‹¤.\nì•„ë§ˆë„ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì„ í†µí•´ ì„œë²„ ì†Œì¼“ì— ì ‘ê·¼í•˜ëŠ” ë„¤íŠ¸ì›Œí¬ ì†Œì¼“ê³¼ ë‹¬ë¦¬ unix domain socketì€ client processê°€ ì§ì ‘ serverì˜ socket fileì— ì ‘ê·¼í•˜ê¸° ë•Œë¬¸ì— ì´ë•Œ ì“°ê¸° ê¶Œí•œ ë•Œë¬¸ì— ê·¸ëŸ° ê¶Œí•œ ì˜¤ë¥˜ê°€ ìƒê¸°ëŠ” ê²ƒì´ ì•„ë‹ê¹Œë¼ëŠ” ìƒìƒì˜ ë‚˜ë˜ë¥¼ í¼ì³ë³¸ë‹¤.\n# ubuntu ì‚¬ìš©ìë¡œ unix domain socket server í”„ë¡œì„¸ìŠ¤ë¥¼ ë„ìš´ ê²½ìš° # ubuntu ì‚¬ìš©ìë¡œëŠ” ì˜ ì ‘ì†ì´ ëœë‹¤. ubuntu@ec2 $ go test -v === RUN TestSocket === RUN TestSocket/tcp 2021/02/13 12:59:06 pong === RUN TestSocket/unix 2021/02/13 12:59:06 pong --- PASS: TestSocket (0.00s) --- PASS: TestSocket/tcp (0.00s) --- PASS: TestSocket/unix (0.00s) PASS ok uds\t0.004s # serverê°€ ìƒì„±í•œ unix domain socketì— write ê¶Œí•œì´ ì—†ëŠ” # guest1ì´ë¼ëŠ” ì‚¬ìš©ìë¡œëŠ” serverì™€ unix domain socketìœ¼ë¡œëŠ” í†µì‹ í•  ìˆ˜ ì—†ê³ , # ì•ì„œ ì˜¤í”ˆì†ŒìŠ¤ë¥¼ ì´ìš©í•˜ë©° ê²ªì—ˆë˜ ì—ëŸ¬ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ê¶Œí•œ ì´ìŠˆê°€ ë°œìƒí•œë‹¤. # í•˜ì§€ë§Œ TCP ì†Œì¼“ì„ ì´ìš©í•œ ê²½ìš°ëŠ” ì›í™œíˆ ping-pong testê°€ ì„±ê³µí•œ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤. guest1@ec2 $ go test -v === RUN TestSocket === RUN TestSocket/tcp 2021/02/13 12:59:01 pong === RUN TestSocket/unix main_test.go:21: Error Trace:\tmain_test.go:21 Error: Received unexpected error: dial unix jinsu.sock: connect: permission denied Test: TestSocket/unix --- FAIL: TestSocket (0.00s) --- PASS: TestSocket/tcp (0.00s) --- FAIL: TestSocket/unix (0.00s) # í•˜ì§€ë§Œ ì¬ë¯¸ìˆê²Œë„ guest1ë„ socketì— writeí•  ìˆ˜ ìˆë„ë¡ ê¶Œí•œì„ ìˆ˜ì •í•´ì£¼ë‹ˆ # guest1ë„ unix domain socketìœ¼ë¡œ ë¬´ë¦¬ ì—†ì´ í†µì‹ ì´ ê°€ëŠ¥í–ˆë‹¤! guest1@ec2 $ sudo chmod 777 jinsu.sock guest1@ec2 $ go test -v === RUN TestSocket === RUN TestSocket/tcp 2021/02/13 12:59:06 pong === RUN TestSocket/unix 2021/02/13 12:59:06 pong --- PASS: TestSocket (0.00s) --- PASS: TestSocket/tcp (0.00s) --- PASS: TestSocket/unix (0.00s) PASS ok uds\t0.004s ë”°ë¼ì„œ ubuntu ì‚¬ìš©ìë¡œ TCP socketê³¼ Unix domain socket ë‘ ê°€ì§€ ë°©ë²•ìœ¼ë¡œ ì„œë²„ ì—­í• ì„ í•  ìˆ˜ ìˆëŠ” í”„ë¡œì„¸ìŠ¤ë¥¼ ë„ìš´ ë’¤ ubuntu ì‚¬ìš©ìì™€ guest1 ì‚¬ìš©ìë¡œ í†µì‹  í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•´ë³´ì•˜ë‹¤.\nì„œë²„ê°€ ìƒì„±í•œ unix domain socketì€ srwxrwxr-x ì˜ í˜•ì‹ê³¼ ê¶Œí•œì„ ê°–ê³  ìˆê¸° ë•Œë¬¸ì— guest1ì€ ì´ ì†Œì¼“ì— ëŒ€í•´ readì™€ execute ê¶Œí•œ ë¿ì´ê³ , writeëŠ” ë¶ˆê°€ëŠ¥í•˜ê¸°ì— unix domain socketì„ ì´ìš©í•´ì„œëŠ” í†µì‹ í•  ìˆ˜ ì—†ë‹¤. ë”°ë¼ì„œ ìš°ë¦¬ê°€ í‰ì†Œì— ì˜¤í”ˆì†ŒìŠ¤ë¥¼ localhostì—ì„œ ì´ìš©í•˜ë©´ì„œ ì¢…ì¢… ë§ì´í–ˆë˜ ì†Œì¼“ì— ëŒ€í•œ permission errorì„ ë§Œë‚˜ë³¼ ìˆ˜ ìˆì—ˆë‹¤! ë°˜ë©´ socketì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œì´ í•„ìš” ì—†ëŠ” TCPë¡œëŠ” í†µì‹ ì´ ê°€ëŠ¥í–ˆê³ , ë†€ëê²Œë„ guest1ì—ê²Œ ì†Œì¼“ íŒŒì¼ì— ëŒ€í•œ write ê¶Œí•œì„ ë¶€ì—¬í•´ì£¼ì Unix domain socketìœ¼ë¡œë„ í†µì‹ ì´ ê°€ëŠ¥í•´ì§„ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.\nìƒìƒì˜ ë‚˜ë˜ ì •ë¦¬: unix domain socketì„ í†µí•´ ì ‘ì†ì„ ì‹œë„í•  ë•Œì—ëŠ” unix domain socket fileì— ëŒ€í•œ ì ‘ê·¼ì„ í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ê°€ í•´ë‹¹ socket fileì— ëŒ€í•œ ì ì ˆí•œ permissionì„ ê°–ê³  ìˆì–´ì•¼í•œë‹¤.\në˜í•œ êµ¬ê¸€ë§ ë„ì¤‘ ë³´ì•˜ë˜ ì¬ë¯¸ìˆëŠ” ì˜ˆì‹œëŠ” databaseë¥¼ í†µí•´ authentication/authorizationì„ ìˆ˜í–‰í•˜ëŠ” ì¼ë°˜ì ì¸ ì„œë¹„ìŠ¤ì™€ ë‹¬ë¦¬ Unix domain socketì„ ì´ìš©í•˜ëŠ” ê²½ìš°ì—ëŠ” linux user ì‹œìŠ¤í…œì„ ì´ìš©í•´ì„œë„ ê¶Œí•œ/ì¸ì¦ ê´€ë¦¬ë¥¼ ìˆ˜í–‰í•˜ëŠ” ê²½ìš°ë„ ì¡´ì¬í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ì—ˆë‹¤.\në²¤ì¹˜ë§ˆí‚¹ Unix domain socket vs Network socket Unix domain socketê³¼ Network socketì˜ ì„±ëŠ¥ì„ ë¹„êµí•˜ëŠ” ë²¤ì¹˜ë§ˆí¬ë¥¼ ì‘ì„±í–ˆë‹¤. ë‘ ê²½ìš° ëª¨ë‘ Stream typeì˜ socketì„ ì´ìš©í•˜ë„ë¡ í–ˆê³ , Network socketì˜ ê²½ìš°ëŠ” íŠ¹íˆë‚˜ ì´ ê²½ìš° TCP í”„ë¡œí† ì½œì„ ì´ìš©í•˜ê²Œ ëœë‹¤.\n// main.go // í•œ í”„ë¡œì„¸ìŠ¤ ë‚´ì—ì„œ TCP Socketê³¼ Unix Domain Socket ë‘ ê°€ì§€ë¥¼ ì´ìš©í•´ // í†µì‹ í•  ìˆ˜ ìˆëŠ” í”„ë¡œê·¸ë¨ package main import ( \u0026#34;errors\u0026#34; \u0026#34;io\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net\u0026#34; \u0026#34;os\u0026#34; \u0026#34;time\u0026#34; ) func main() { go RunTCPSocketServer() go RunUnixDomainSocketServer() for { log.Println(\u0026#34;Dummy waiting...\u0026#34;) time.Sleep(time.Minute) } } func RunTCPSocketServer(){ log.Println(\u0026#34;Run TCPSocketServer...\u0026#34;) run(\u0026#34;tcp\u0026#34;, \u0026#34;0.0.0.0:8080\u0026#34;) } func RunUnixDomainSocketServer(){ log.Println(\u0026#34;Run UnixDomainSocketServer...\u0026#34;) serverSocketName := \u0026#34;jinsu.sock\u0026#34; os.Remove(serverSocketName) run(\u0026#34;unix\u0026#34;, serverSocketName) } // TCP socketì„ ì´ìš©í•´ ì„œë²„ë¥¼ ë„ìš°ë“  Unix Domain Socketì„ ì´ìš©í•´ ì„œë²„ë¥¼ ë„ìš°ë“  // ê°„ë‹¨íˆ ì¸ì ê°’ë§Œ ë³€ê²½í•´ì„œ ì´ìš©í•  ìˆ˜ ìˆë‹¤! func run(network, address string){ buf := make([]byte, 1024) socket, err := net.Listen(network, address) if err != nil { log.Fatal(err) } for { connectedSocket, err := socket.Accept() if err != nil{ log.Fatal(err) } go func() { for{ n, err := connectedSocket.Read(buf) if err != nil{ if !errors.Is(io.EOF, err){ log.Fatal(err) } else{ log.Print(\u0026#34;[Error]\u0026#34;, err) break } } log.Println(network, \u0026#34;Client sent:\u0026#34;, n) connectedSocket.Write([]byte(\u0026#34;pong\u0026#34;)) } connectedSocket.Close() }() } } // main_test.go // tcp socketê³¼ unix domain socketì„ ì´ìš©í•´ ì„±ê³µì ìœ¼ë¡œ ì„œë²„ì™€ í†µì‹ ì´ // ì´ë£¨ì–´ì§€ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•˜ëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œ // tcpì™€ unix domain socketì˜ ì„±ëŠ¥ì„ ë¹„êµí•˜ëŠ” ë²¤ì¹˜ë§ˆí¬ ì½”ë“œ package main import ( \u0026#34;errors\u0026#34; \u0026#34;github.com/stretchr/testify/assert\u0026#34; \u0026#34;io\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net\u0026#34; \u0026#34;testing\u0026#34; ) func TestSocket(t *testing.T){ args := [][]string{ []string{\u0026#34;tcp\u0026#34;, \u0026#34;0.0.0.0:8080\u0026#34;}, []string{\u0026#34;unix\u0026#34;, \u0026#34;jinsu.sock\u0026#34;}, } for _, arg := range args{ t.Run(arg[0], func(t *testing.T) { conn, err := net.Dial(arg[0], arg[1]) assert.NoError(t, err) buf := make([]byte, 1024) _, err = conn.Write([]byte(\u0026#34;ping\u0026#34;)) if err != nil{ log.Fatal(err) } n, err := conn.Read(buf) if err != nil{ if ! errors.Is(io.EOF, err){ log.Println(err) } } log.Println(string(buf[:n])) }) } } func BenchmarkSocket(b *testing.B) { args := [][]string{ []string{\u0026#34;tcp\u0026#34;, \u0026#34;0.0.0.0:8080\u0026#34;}, []string{\u0026#34;unix\u0026#34;, \u0026#34;jinsu.sock\u0026#34;}, } for _, arg := range args{ b.Run(arg[0], func(b *testing.B) { //log.Println(\u0026#34;Out\u0026#34;) // b.Nê³¼ ìƒê´€ ì—†ì´ argsì˜ ê¸¸ì´ì— ë”°ë¼ ì¶œë ¥ë¨. conn, err := net.Dial(arg[0], arg[1]) assert.NoError(b, err) buf := make([]byte, 1024) for i := 0; i \u0026lt; b.N; i++{ //log.Println(\u0026#34;In\u0026#34;) // b.Në§Œí¼ ìˆ˜í–‰ë¨ _, err := conn.Write([]byte(\u0026#34;ping\u0026#34;)) assert.NoError(b, err) _, err = conn.Read(buf) if err != nil{ if !errors.Is(io.EOF, err){ b.Fail() } } } }) } } $ go test -bench=. -benchtime=100000x goos: linux goarch: amd64 pkg: uds BenchmarkSocket/tcp 100000\t104537 ns/op BenchmarkSocket/unix 100000\t83456 ns/op PASS ok uds\t18.808s 10000ë²ˆì˜ ping-pongì„ ìˆ˜í–‰í•˜ëŠ” ë²¤ì¹˜ë§ˆí¬ë¥¼ ìˆ˜í–‰í–ˆë‹¤. ê·¸ ê²°ê³¼ TCP socketì„ ì´ìš©í•  ê²½ìš°ëŠ” í•œ ë²ˆì˜ ping-pongì— ì•½ 104537ns, unix domain socketì„ ì´ìš©í•  ê²½ìš°ëŠ” í•œ ë²ˆì˜ ping-pongì— ì•½ 83456nsê°€ ì†Œìš”ëœ ê²ƒì„ ë³´ì•„ ì˜ˆìƒëŒ€ë¡œ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì´ ì¼ì ˆ í•„ìš”í•˜ì§€ ì•Šì€ unix domain socketì´ ì¢€ ë” ì„±ëŠ¥ì´ ì¢‹ì€ ê²ƒìœ¼ë¡œ ë³´ì—¬ì¡Œë‹¤. ì‚¬ì „ì— ìë£Œ ì¡°ì‚¬ë¥¼ í•  ë•Œì—ëŠ” unix domain socketì´ tcp socketì„ ì´ìš©í•  ë•Œë³´ë‹¤ ì•½ 2ë°°ê°€ëŸ‰ ì„±ëŠ¥ì´ ìš°ì›”í•  ê²ƒì´ë¼ê³  ë“¤ì—ˆëŠ”ë°, ê·¸ë ‡ê²Œ ë§ì€ ì°¨ì´ê°€ ë‚˜ëŠ” ê²ƒ ê°™ì§€ëŠ” ì•Šë‹¤. í•˜ì§€ë§Œ ì–´ëŠ ì •ë„ ë°ì´í„°ì˜ í¬ê¸°ë‚˜ ë²„í¼ì˜ í¬ê¸°ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ë„ ìˆì„ ê²ƒ ê°™ê³  ë” ê¹Šì€ ì›ë¦¬ë“¤ì´ ì¡´ì¬í•  ê²ƒ ê°™ì•„ ë” ìì„¸íˆëŠ” ì¸¡ì •í•´ë³´ì§€ ëª»í–ˆë‹¤.\në§ˆì¹˜ë©° ì‚¬ì‹¤ ì´ë²ˆì— ë‹¤ë£¬ ì†Œì¼“ì´ë¼ëŠ” ì£¼ì œëŠ” Goë¡œ ì ìš©í•´ë³´ëŠ” Computer Scienceë¼ëŠ” ì´ ì‹œë¦¬ì¦ˆë¥¼ ì •ë¦¬í•´ë‚˜ê°€ë˜ ì´ˆê¸°ì— 2ë²ˆ ì§¸ ê¸€ë¡œ ì‹œë„í–ˆë˜ ì£¼ì œì˜€ëŠ”ë° ë‹¹ì‹œì—” Go benchmarkë„ ì²˜ìŒ ì‚¬ìš©í•´ë´¤ì—ˆê³  ë‚´ìš©ì´ ì–´ë ¤ì› ë˜ í„°ë¼ ë²¤ì¹˜ë§ˆí¬ë„ ì œëŒ€ë¡œ ë˜ì§€ ì•Šê³  ì •ë¦¬ë„ í•˜ê¸° í˜ë“¤ì–´ì„œ ì¤‘ë‹¨í–ˆë˜ ì£¼ì œì´ë‹¤. í•˜ì§€ë§Œ ì´ë²ˆì—” ê°™ì€ ë‚´ìš©ì— ëŒ€í•´ ë‘ ë²ˆì§¸ ì •ë¦¬í•´ì„œì¸ì§€ ì „ë³´ë‹¤ ë‚´ìš©ë„ ì˜ ì´í•´ëê³ , ë²¤ì¹˜ë§ˆí‚¹ ì½”ë“œì™€ ê²°ê³¼ë„ ê¹”ë”í•˜ê²Œ ë‚˜ì™”ë˜ ê²ƒ ê°™ì•„ ë¿Œë“¯í•˜ë‹¤.\nê·¸ë¦¬ê³  ê·¸ ë™ì•ˆ ë„ì»¤ë‚˜ MySQL ê°™ì€ ì˜¤í”ˆì†ŒìŠ¤ë“¤ì„ ì‚¬ìš©í•˜ë©´ì„œ ê°„í˜¹ ì†Œì¼“ì— ëŒ€í•œ ì˜¤ë¥˜ë¥¼ ì ‘í•  ë•Œë‚˜ ì´ëŸ° ì €ëŸ° ê¸€ì—ì„œ ì†Œì¼“ ê´€ë ¨í•œ ë‚´ìš©ì´ ë“±ì¥í•  ë•Œ ì •í™•íˆ ì–´ë–¤ ì—­í• ì¸ì§€ ì´ìœ ê°€ ë­”ì§€ ìì„¸íˆ ì•Œì§€ ëª»í–ˆëŠ”ë° ì´ë²ˆ ê¸°íšŒë•ì— ì•ìœ¼ë¡œëŠ” ì¢€ ë” ì˜ ì´í•´í•´ë³¼ ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.\nì°¸ê³  ì†Œì¼“ http://www.ktword.co.kr/abbr_view.php?nav=\u0026m_temp1=280\u0026id=742\në„¤íŠ¸ì›Œí¬ ì†Œì¼“ https://ko.wikipedia.org/wiki/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC_%EC%86%8C%EC%BC%93\nì†Œì¼“ í”„ë¡œê·¸ë˜ë° https://recipes4dev.tistory.com/153\nUDS (Unix Domain Socket) http://www.dreamy.pe.kr/zbxe/CodeClip/119393\n[Linux/UDS/Unix Domain Socket] UDS https://yaaam.tistory.com/entry/LinuxUDSUnix-Domain-Socket-UDS\nUnix file type https://en.wikipedia.org/wiki/Unix_file_types\nC# - .NET Core Unix Domain Socket ì‚¬ìš© ì˜ˆì œ https://www.sysnet.pe.kr/2/0/11963\nUnix Domain Socket https://www.joinc.co.kr/w/Site/system_programing/IPC/Unix_Domain_Socket\nUnix Domain Socket - UDP https://www.joinc.co.kr/w/Site/system_programing/IPC/Unix_Domain_Socket_UDP\nWhat is the difference between Unix sockets and TCP/IP sockets? https://serverfault.com/questions/124517/what-is-the-difference-between-unix-sockets-and-tcp-ip-sockets\n","date":"2021-02-13T14:10:54+09:00","image":"https://umi0410.github.io/blog/golang/go-socket/server-client-socket_huc5be35f5857cc34672b838b13057c03e_282874_120x120_fill_q75_box_smart1.jpeg","permalink":"https://umi0410.github.io/blog/golang/go-socket/","title":"Go ì–¸ì–´ë¡œ ì ìš©í•´ë³´ëŠ” Computer Science - Socket (Unix Domain Socket, Network/TCP/UDP Socket)"},{"content":" preview.png ì‚¬ì§„ ì¶œì²˜: https://tv.naver.com/v/16972079\nì‹œì‘í•˜ë©° ì›ë˜ ê°„ê°„íˆ ì¬ë¯¸ì‚¼ì•„ ê°œë°œ ì»¨í¼ëŸ°ìŠ¤ë“¤ì„ ì°¾ì•„ë³´ê³¤ í•´ì™”ëŠ”ë° ê·¸ëƒ¥ ì“°ìœ½ ë“£ê¸°ë§Œ í•˜ë‹ˆê¹Œ ë¨¸ë¦¬ì— ë‚¨ëŠ” ê²Œ ë³„ë¡œ ì—†ëŠ” ê²ƒ ê°™ì•„ ê°€ë”ì€ ì´ë ‡ê²Œ ë‚´ìš©ì„ ì •ë¦¬í•´ë³´ëŠ” ê¸€ì„ ì¨ë³¼ê¹Œí•œë‹¤. ë‚˜ëŠ” í•™êµ ì‹œí—˜ê³¼ëŠ” ê·¸ë‹¥ ë§ì§€ ì•ŠëŠ” ìŠ¤íƒ€ì¼ ê°™ì•„ì„œ ì‹œí—˜ ê¸°ê°„ì´ ë˜ë©´ ë” ì´ëŸ° ì‹¤ë¬´ì ì¸ ë‚´ìš©ë“¤ì´ ê´œíˆ ë” ëŒë¦¬ëŠ” ê²ƒ ê°™ë‹¤. ì†Œí”„íŠ¸ì›¨ì–´ ê³µí•™ ìˆ˜ì—…ì„ ë“£ë‹¤ê°€ ì§€ë£¨í•´ì ¸ì„œ ë„¤ì´ë²„ d2ë¥¼ ëŒì•„ë‹¤ë‹ˆë˜ ì¤‘ ë„¤ì´ë²„ ë°ë·° 2020ì— Golang ê´€ë ¨ ì˜ìƒì´ ìˆê¸¸ë˜ \u0026ldquo;ì˜¤ì‰?! ë„¤ì´ë²„ ì±„ìš©ì— ê°€ë” Golangì´ ëœ¨ê¸´ í•˜ë˜ë° Golang ì–´ë–»ê²Œ ì“°ë ¤ë‚˜?!\u0026rdquo; ì‹¶ì€ ë§ˆìŒì— ì˜ìƒì„ ì‹œì²­í•´ë´¤ë‹¤.\në‚´ìš©ì„ ê°„ë‹¨íˆ ìš”ì•½í•˜ìë©´ ê¸°ì¡´ì—ëŠ” C++ë¡œ ê²€ìƒ‰ ì—”ì§„ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ê°œë°œí•´ì™”ê³  í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•˜ëŠ” C++ ê²€ìƒ‰ ì„œë¹„ìŠ¤ë¥¼ ê°œë°œí•´ì™”ë‹¤ê³  í•˜ëŠ”ë°, ì´ë¥¼ Golangìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ë©´ì„œ ì„±ëŠ¥ì€ ìœ ì§€í•˜ë©´ì„œ Golang íŠ¹ìœ ì˜ ê°„ê²°í•˜ê³  ê°•ë ¥í•œ ê¸°ëŠ¥ë“¤(unit test, benchmark, fmt, build ë“±ë“±)ê³¼ í•¨ê»˜ ë°ë¸Œì˜µìŠ¤ ë¬¸í™”ì— ì˜ ë…¹ì•„ë“¤ ìˆ˜ ìˆì—ˆê³  íŒ€ì›ë“¤ë„ í¸ë¦¬í•¨ì„ ëŠë¼ë©° ìƒì‚°ì„±ê¹Œì§€ ì¡ì„ ìˆ˜ ìˆì—ˆë‹¤ëŠ” ì´ì•¼ê¸°ì´ë‹¤.\në³¸ ê¸€ì€ https://tv.naver.com/v/16972079 ì˜ìƒì„ ë°”íƒ•ìœ¼ë¡œ í•´ë‹¹ ë‚´ìš©ì„ ì •ë¦¬í•´ë³¸ ê¸€ì…ë‹ˆë‹¤.\nê²€ìƒ‰ ì„œë¹„ìŠ¤ì˜ íŠ¹ì§• ìì„¸íˆ ê²€ìƒ‰ ì—”ì§„ì´ ì–´ë–»ê²Œ êµ¬ì„±ë˜ì–´ ìˆëŠ”ì§€, ë‚´ë¶€ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì–´ë–»ê²Œ ì €ì¥í•˜ê³  ì§ˆì˜í•˜ëŠ”ì§€, ê²€ìƒ‰ ì„œë¹„ìŠ¤ëŠ” ê²€ìƒ‰ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ”ì§€ ë“±ë“± ì´ëŸ° ë‚´ìš©ë“¤ì„ ì˜ ëª°ë¼ì„œì¸ì§€ ìì„¸íˆ ê²€ìƒ‰ ì—”ì§„ì´ë‚˜ ê²€ìƒ‰ ì„œë¹„ìŠ¤ê°€ ì–´ë–¤ ì‹ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€, ì–´ë–¤ í˜•íƒœë¡œ ê°œë°œë˜ëŠ”ì§€ì— ëŒ€í•´ì„œëŠ” ê°ì´ ì˜ ì¡íˆì§€ ì•ŠëŠ”ë‹¤. í˜¹ì‹œ ìì„¸íˆ ì½”ë“œë¥¼ ë³¼ ìˆ˜ ìˆì—ˆë‹¤ë©´ ì¢‹ì•˜ê² ì§€ë§Œ, ì•„ë¬´ë˜ë„ ê·¸ëŸ¬ê¸°ëŠ” í˜ë“¤ê² ì§€\u0026hellip;ã…œã…œ\nì•„ë¬´íŠ¼ ê²€ìƒ‰ ì„œë¹„ìŠ¤ëŠ” ë‹¨ì–¸ ì„±ëŠ¥ì´ ì¤‘ìš”í–ˆìœ¼ë©° ì£¼ë¡œ ì§ˆì˜ë¥¼ ë¶„ì„í•˜ê³ , ê²€ìƒ‰ ê²°ê³¼ë¥¼ ì •ë ¬í•˜ëŠ” ë°©ì‹, ë­í‚¹ì— ëŒ€í•œ ëª¨ë¸ë§ ë“±ì˜ ë¡œì§ì´ êµ¬í˜„ë˜ì–´ ìˆë‹¤ê³  í•œë‹¤.\nê° ì„œë¹„ìŠ¤ë“¤ì€ ìì‹ ë“¤ì˜ ê³ ìœ í•œ ê²€ìƒ‰ ë¡œì§ì„ êµ¬í˜„í•˜ê³ , ì‹¤ì œ ê²€ìƒ‰ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì€ ê²€ìƒ‰ ì—”ì§„ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¼ê³  í•œë‹¤. ì ì  ê²€ìƒ‰ ì—”ì§„ì˜ ê·œëª¨ì™€ ì‹ ê·œ ê²€ìƒ‰ ì„œë¹„ìŠ¤ë“¤ì´ ì¦ê°€í•˜ê²Œ ë˜ë©´ì„œ ê´€ë¦¬ê°€ ì–´ë ¤ì›Œì¡Œë‹¤. ì„œë¹„ìŠ¤ë“¤ì˜ í¬ê¸°ì™€ ìˆ˜ê°€ ì¦ê°€í•˜ë©´ì„œ ë†’ì€ ìƒì‚°ì„±ì„ ìœ ì§€í•˜ê¸° ìœ„í•´ ê°œë°œ í”„ë¡œì„¸ìŠ¤ë¥¼ í‘œì¤€í™”í•˜ê³  ìë™í™”í–ˆì§€ë§Œ ì¶”ê°€ì ìœ¼ë¡œ ê°œë°œ ì–¸ì–´ì ì¸ ê´€ì ì—ì„œì˜ ê³ ë¯¼ì´ ë“¤ê¸° ì‹œì‘í–ˆë‹¤ê³  í•œë‹¤.\nê°œì¸ì ìœ¼ë¡œëŠ” ì•„ë¬´ë˜ë„ ì„œë¹„ìŠ¤ê°€ ë§ì•„ì§ˆ ìˆ˜ë¡ ë°ë¸Œì˜µìŠ¤ ë¬¸í™”ê°€ ë§ì´ ë…¹ì•„ë“¤ì–´ì•¼í•œë‹¤ê³  ìƒê°í•˜ëŠ”ë° ì•„ë¬´ë˜ë„ ë§ì€ ê²ƒë“¤ì„ ìë™í™”í•˜ê¸° ìœ„í•´ì„œëŠ” ì–¸ì–´ ì°¨ì›ì—ì„œ ê°•ë ¥í•˜ê³  í¸ë¦¬í•œ CLI ê¸°ëŠ¥ë“¤ì¼ ì˜ ì§€ì›ë˜ì–´ì•¼í•œë‹¤ê³  ìƒê°í•˜ê³ , ì§€ì†ì ì¸ í†µí•©ì„ ìœ„í•´ì„œë„ í¸ë¦¬í•œ í…ŒìŠ¤íŠ¸ê°€ ì§€ì›ë˜ì–´ì•¼í•œë‹¤ê³  ìƒê°í•œë‹¤. C++ì„ ë§ì´ í•´ë³´ì§„ ì•Šì•„ ì˜ ëª¨ë¥´ê² ì§€ë§Œ, ì•„ë¬´ë˜ë„ Goê°€ ê°„ë‹¨í•œ ëª…ë ¹ì–´ë“¤ì„ í†µí•´ IaCë„ ê³ë“¤ì´ë©° ë§ì€ ì‘ì—…ë“¤ì„ ìë™í™”í•˜ê¸° ë” í¸ë¦¬í•˜ê³ , unit testë¥¼ ì‘ì„±í•´ê°€ë©° TDDì‹ìœ¼ë¡œ ê°œë°œí•˜ê¸°ì—ë„ í¸ë¦¬í•˜ì§€ ì•Šì„ê¹Œ ì‹¶ë‹¤.\nê°œì¸ì ì¸ ì˜ê²¬ì´ì—ˆê³ , ì–´ì¨Œë“  ì´ íŒ€ì—ì„œëŠ” ê²°êµ­ íš¨ìœ¨ì ìœ¼ë¡œ DevOps ë¬¸í™”ì— ë…¹ì¼ ìˆ˜ ìˆìœ¼ë©´ì„œ ì–´ëŠ ì •ë„ ë†’ì€ ì„±ëŠ¥ì´ ë³´ì¥ë˜ê³  ìƒì‚°ì„±ì„ ìœ ì§€í•˜ê¸°ë„ ì‰¬ìš´ ì–¸ì–´ë¥¼ ìƒê°í•˜ê²Œ ë˜ì—ˆê³  Goê°€ ì í•©í•˜ë‹¤ê³  íŒë‹¨í–ˆë‹¤ê³  í•œë‹¤.\nGoì˜ íŠ¹ì§• golang-features.png (ì´í•´ë¥¼ ë•ê³ ì ë°œí‘œ PPTì—ì„œ í•˜ë‚˜ ìº¡ì³í•´ì™”ìŠµë‹ˆë‹¤.)\nì„±ëŠ¥ì´ ë†’ìœ¼ë©´ì„œ GCë¥¼ ì§€ì›í•œë‹¤.\ndiscord-golang.png ì¶œì²˜ - ë””ìŠ¤ì½”ë“œ ë¸”ë¡œê·¸(https://blog.discord.com/why-discord-is-switching-from-go-to-rust-a190bbca2b1f)\nê³¼ê±° ë””ìŠ¤ì½”ë“œì—ì„œëŠ” Goì˜ GCë¡œ ì¸í•´ ê°„í˜¹ CPUê°€ Spikeì¹˜ëŠ” ê²½í—˜ì„ í–ˆê³  Rustë¡œ ì˜®ê²¨ê°”ë‹¤ëŠ” ì´ì•¼ê¸°ê°€ ìˆëŠ”ë°, ì´ì— ëŒ€í•´ì„œëŠ” Go communityì—ì„œë„ ë‹¤ì–‘í•œ ì˜ê²¬ì´ ìˆì—ˆë˜ ê²ƒ ê°™ë‹¤. ìµœê·¼ ë²„ì ¼ì˜ Goì—ì„œëŠ” í•´ë‹¹ ì´ìŠˆê°€ í”½ìŠ¤ë˜ì—ˆë‹¤ëŠ” ì˜ê²¬ë„ ìˆê³ , ê·¸ ì •ë„ Spikeê°€ ìˆì–´ë„ GCê°€ ê°€ì ¸ë‹¤ ì£¼ëŠ” ìƒì‚°ì„±ì´ ë” í¬ê¸° ë•Œë¬¸ì— ê°ìˆ˜í•´ì•¼í•œë‹¤ëŠ” ì˜ê²¬ë„ ìˆì—ˆë˜ ê²ƒ ê°™ë‹¤. í•˜ì§€ë§Œ ì—¬íƒœê¹Œì§€ëŠ” ë„¤ì´ë²„ì—ì„œ Golangì„ ì´ìš©í•˜ë©´ì„œ ëª¨ë‹ˆí„°ë§í•´ë´¤ì„ ë•ŒëŠ” GCë¡œ ì¸í•œ ë§ì½ì€ ì—†ì—ˆë‹¤ëŠ” ê²ƒ ê°™ë‹¤! Pointerì˜ ê°œë…ì´ ì—¬ì „íˆ ì¡´ì¬í•˜ì§€ë§Œ ë°°ìš°ê¸° ì‰½ë‹¤.\nì´ ë¶€ë¶„ ê°™ì€ ê²½ìš°ëŠ” ë‚´ê°€ Dockerë¥¼ ì²˜ìŒ ë°°ìš°ë˜ ì‹œì ˆì— ëŠê¼ˆë˜ ê²ƒê³¼ ìœ ì‚¬í•œ ê²ƒ ê°™ë‹¤. ì‚¬ìš©ë²•ì´ ì–´ë ¤ìš´ ê²Œ ì•„ë‹ˆë¼ ê·¸ê²Œ ì™œ í•„ìš”í•œ ì§€ ì´í•´í•˜ê³  ì˜ ì‚¬ìš©í•˜ëŠ” ê²Œ ì–´ë ¤ìš´ ëŠë‚Œì´ë‹¤. ê·¼ë° Goê°€ ì–´ë ¤ìš´ ê²ƒì€ ë³´í†µ \u0026ldquo;ì–´ë–»ê²Œ í•´ì•¼ Concurrency programmingì˜ ì¥ì ì„ ì˜ ì´ëŒì–´ ë‚¼ ìˆ˜ ìˆì„ê¹Œ?\u0026rdquo;, \u0026ldquo;channelì„ í†µí•œ communication, synchronizationì„ ì–´ë–»ê²Œ í•´ì•¼ ì˜ ì´ìš©í• ê¹Œ?\u0026rdquo; ì™€ ê°™ì€ ë‚´ìš©ë“¤ì¸ë° ë¬¼ë¡  Goê°€ ê·¸ëŸ° ë¶€ë¶„ì—ì„œ ì¥ì ì„ ê°€ì§„ ê²ƒì€ ë§ì§€ë§Œ ì´ëŸ° ë¶€ë¶„ì„ ê¼­ ì´ìš©í•˜ì§€ ì•Šë”ë¼ë„ ì´ì œëŠ” Goê°€ ì¶©ë¶„íˆ ê·¸ ì™¸ì˜ ë§¤ë ¥ë„ ë§ë‹¤ëŠ” ê²ƒì´ ì ì  ì¸ì •ë°›ê³  ìˆëŠ” ê²ƒ ê°™ì•„ ë‹¤ì–‘í•˜ê²Œ ì‚¬ìš©ë˜ê³  ìˆëŠ” ê²ƒ ê°™ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ prometheusë‚˜ docker cli ê°™ì€ Goë¡œ ì‘ì„±ëœ ìœ ëª…í•œ ì˜¤í”ˆì†ŒìŠ¤ë“¤ì˜ ì½”ë“œë¥¼ ê¹Œë´ë„ ê·¸ë‹¥ \u0026lsquo;ì™€ ì´ê±¸ ë™ì‹œì„±ì„ ì´ìš©í•´ì„œ í’€ì–´ëƒˆë„¤..!\u0026rsquo;, \u0026lsquo;ì™€ ì´ê±¸ channelë“¤ë¡œ pipelineì„ ë§Œë“¤ì–´ì„œ ì§„í–‰í•˜ë„¤?!\u0026rsquo; ì´ëŸ° ë¶€ë¶„ì€ ì°¾ê¸° í˜ë“¤ì—ˆë˜ ê²ƒ ê°™ë‹¤. íŒ¨í‚¤ì§€ ê´€ë¦¬ê°€ ì‰½ë‹¤.\në”°ë¡œ npmì´ë‚˜ pypi ê°™ì€ ê³³ì— ì—…ë¡œë“œ í•  í•„ìš”ë„ ì—†ê³  Gitì„ ê¸°ë°˜ìœ¼ë¡œ í•´ì„œ releaseë‚˜ commit ë‹¨ìœ„ë¡œë„ íŒ¨í‚¤ì§€ì˜ ë²„ì ¼ì„ ì§€ì •í•  ìˆ˜ ìˆì–´ ê°œì¸ì ìœ¼ë¡œë„ ì•„ì£¼ ë§˜ì— ë“ ë‹¤! íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•  ë•Œì—ë„ $ go get ... ëª…ë ¹ì–´ë¥¼ ì´ìš©í•˜ë©´ ë˜ì§€ë§Œ ë³´í†µì€ ê·¸ëƒ¥ Jetbrainsì‚¬ì˜ Goland IDEì—ì„œ ê·¸ëƒ¥ Alt + Enterë¥¼ ì—°íƒ€í•´ì„œ ì´ìš© ì¤‘ì´ë‹¤ ã…ã……ã… Unit testë¥¼ ê¸°ë³¸ì ìœ¼ë¡œ ì§€ì›í•´ì£¼ê³  í…ŒìŠ¤íŠ¸ í•˜ê¸°ê°€ ì•„ì£¼ í¸í•˜ë‹¤.\në‚´ê°€ ì²˜ìŒ TDDë¥¼ ì‹œì‘í•˜ê³  Unit test ì‘ì„±ì„ ì‹œì‘í–ˆë˜ ê²ƒë„ Goë¥¼ ê³µë¶€í•˜ë©´ì„œ ì˜€ë‹¤! ëª‡ ë…„ ì „ node.jsë¥¼ ë§‰ ê³µë¶€í–ˆì„ ë•Œ Test codeë¥¼ ì§œë³¼ê¹Œì‹¶ì–´ì„œ test frameworkë“¤ì— ëŒ€í•´ ì•Œì•„ë´¤ëŠ”ë° ê·¸ëƒ¥ í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ë¥¼ ê³ ë¥´ëŠ” ê²ƒë¶€í„°ê°€ í˜ë“¤ì–´ì„œ \u0026lsquo;ì—ì‡\u0026hellip;ã…ã… í…ŒìŠ¤íŠ¸ëŠ” ë‹¤ìŒì—..ã…ã…\u0026rsquo; í–ˆë˜ ê¸°ì–µì´ ë‚œë‹¤. ìš”ì¦˜ì€ ì£¼ë¡œ Springìœ¼ë¡œ Test codeë¥¼ ì§œê³  ìˆë‹¤. ë„ˆë¬´ë‚˜ë„ í¸ë¦¬í•˜ë‹¤. í•˜ì§€ë§Œ Springì€ ê·¸ëŸ° í¸ë¦¬í•¨ì„ ëˆ„ë¦¬ê¸° ìœ„í•´ ì•Œì•„ì•¼í•  ë‚´ìš©ì´ ë„ˆë¬´ë„ ë§ì€ ê²Œ ì‚¬ì‹¤ì´ë‹¤. testì‹œì—ëŠ” ì–´ë–¤ profileì„ ì´ìš©í• ì§€, Configurationì€ ì–´ë–¤ ê±¸ ì‚¬ìš©í•  ê²ƒì¸ì§€, Beanì„ ì–´ë–»ê²Œ ì´ˆê¸°í™” í•  ê²ƒì¸ì§€ ë“±ë“±ì„ ì„¤ì •í•´ì¤˜ì•¼í•˜ê³  ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ ì•Œì•„ì•¼í•œë‹¤. ê·¸ë¦¬ê³  ì†”ì§íˆ\u0026hellip; í•œ ë²ˆ ê·¸ë ‡ê²Œ ê³µë¶€í•˜ê³  ë‚œ ë’¤ì— í…ŒìŠ¤íŠ¸ë¥¼ ì§œë‹¤ê°€ ë‹¤ë¥¸ Layerì˜ ì½”ë“œì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ë ¤ë©´ ë‹¤ì‹œ \u0026lsquo;ìŒ..? ì–´ë–»ê²Œ ë™ì‘í•˜ë”ë¼\u0026hellip;..\u0026rsquo; í•˜ê³ ëŠ” ë‹¤ì‹œ ë‚´ìš©ë“¤ì„ ì°¾ì•„ë´ì•¼í•˜ëŠ” ê²½ìš°ë„ ë§ì•˜ë˜ ê²ƒ ê°™ë‹¤. ë°˜ë©´ GoëŠ” ê°„ê²°í•˜ê³  ì§ê´€ì ìœ¼ë¡œ ì‰½ê²Œ ì‰½ê²Œ í…ŒìŠ¤íŠ¸ í•  ìˆ˜ ìˆë‹¤. ë³„ë¡œ ê³ ë¯¼í•  ê²ƒë“¤ë„ ì—†ë‹¤. ë‹¤ë§Œ ì´ˆí¼ ì•„ì‰¬ìš´ ê±´ mockingì„ í•˜ë ¤ë©´ ë‹¤ interfaceë¡œ ì„ ì–¸í•´ì•¼í•œë‹¤ëŠ” ê²ƒê³¼ mocking typeì„ ìë™ìœ¼ë¡œ ê´€ë¦¬í•˜ê¸° í˜ë“¤ê³  mocking libraryë¥¼ ì„ íƒí•˜ê³  ìµí˜€ì•¼í•œë‹¤ëŠ” ê²ƒ..? SWIGë¥¼ ë„ì…í–ˆë‹¤. C/C++ ë“±ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ Go(í˜¹ì€ ê·¸ ì™¸ì˜ ë‹¤ì–‘í•œ ì–¸ì–´)ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì¶”ìƒí™” ì‹œì¼œì£¼ëŠ” ì˜¤í”ˆì†ŒìŠ¤\nSWIGì— ëŒ€í•œ ì„¤ëª…ì„ í•˜ê¸´ í•˜ì§€ë§Œ ê²°êµ­ ìš”ì ì€ C++ â‡’ Go ë¡œ ë„˜ì–´ê°ˆ ë•Œ ê¸°ì¡´ ì½”ë“œë¥¼ ëª¨ë‘ ë²„ë¦° ê²ƒì´ ì•„ë‹ˆë¼ ë‹¤ë¥¸ ë°©ë²•ì€ ì—†ì„ê¹Œ ì•Œì•„ë³´ê³  ì ì ˆí•œ ê¸°ìˆ ì„ ë¹ ë¥´ê²Œ ì±„íƒí–ˆë‹¤ëŠ” ì ì´ ì¤‘ìš”í•œ ì  ê°™ë‹¤.\në§Œì•½ C++â‡’ Golangì„ ê³ ë ¤ì¤‘ì¸ ê¸°ì—…ì´ë‚˜ ê°œë°œìë¶„ì´ ê³„ì‹œë‹¤ë©´ ì¢‹ì€ ì°¸ê³ ìë£Œê°€ ë  ê²ƒ ê°™ê¸´í•˜ë‹¤.\në‚˜ì—ê²ŒëŠ” ë³„ë¡œ í•„ìš” ì—†ìœ¼ë‹ˆ íŒ¨ìŠ¤í•˜ê² ë‹¤~!\nSWIGë¥¼ ì´ìš©í–ˆì§€ë§Œ ê·¸ëŸ¼ì—ë„ ì¡´ì¬í–ˆë˜ Goì™€ C++ì˜ ì–¸ì–´ì  ì°¨ì´ Goì—ì„œ C++ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ë©´ì„œ ëª©í‘œëŠ” \u0026ldquo;GoëŠ” Goë‹µê²Œ!\u0026rdquo; ì´ìš©í•˜ëŠ” ê²ƒìœ¼ë¡œ ì •í–ˆë‹¤ê³  í•œë‹¤. ì´ íŒŒíŠ¸ë„ ê±°ì˜ SWIG íŠ¹í™” ë‚´ìš©ì´ë¼ íŒ¨ìŠ¤í•˜ë„ë¡ í•˜ê² ë‹¤.\në‹¤ë§Œ ë¬´ìŠ¨ ì‘ì—…ì„ í•  ë•Œ ì €ëŸ° ì‹ìœ¼ë¡œ ìŠ¬ë¡œê±´ì´ë‚˜ ëª©í‘œë¥¼ ì •í•´ë†“ê³  ë‚˜ì•„ê°€ëŠ” ê²ƒì€ ì¢‹ì€ ë°©í–¥ì¸ ê²ƒ ê°™ì•˜ë‹¤.\nê°€ë” ì‘ì—…ì„ í•˜ê±°ë‚˜ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë‹¤ë³´ë©´ ì¼ê´€ì„±ì´ íë ¤ì§€ëŠ” ê²½ìš°ê°€ ìˆëŠ” ê²ƒ ê°™ë‹¤. ì˜ˆë¥¼ ë“¤ë©´ ì–¼ë§ˆì „ í† ìŠ¤ì˜ ì»¨í¼ëŸ°ìŠ¤ì—ì„œë„ ê²°ì œ SDK, APIë¥¼ ë§Œë“¤ë©´ì„œ API Naming ê°™ì€ ê²ƒì„ í•  ë•Œì˜ íŒ€ ë‚´ ë£°ì„ ì„¤ëª…í•´ì¤¬ë˜ ê²ƒ ê°™ë‹¤. ê·¸ ì •ë„ë¡œ í˜‘ì—…ì„ í•  ë•Œ ì¼ì •í•œ ë£°ì„ ì •í•´ë†“ê³  ê·¸ê²ƒì„ ì¤€ìˆ˜í•˜ëŠ” ê²ƒì€ ì°¸ ì¤‘ìš”í•  ê²ƒ ê°™ë‹¤ëŠ” ê²Œ ë‹¤ì‹œ í•œ ë²ˆ ì™€ë‹¿ì•˜ë‹¤!\nShared memoryë¥¼ ì´ìš©í•´ ë©€í‹° í”„ë¡œì„¸ìŠ¤ë¡œ ì‘ì—…í•˜ë˜ ê¸°ì¡´ ë°©ì‹ ê¸°ì¡´ì˜ Apache MPM Preforkë¥¼ ì´ìš©í•˜ë˜ ë°©ì‹ì—ì„œëŠ” ë©€í‹° í”„ë¡œì„¸ì‹±ì„ í†µí•´ ë³‘ë ¬ì„±, ë™ì‹œì„±ì„ ì´ìš©í–ˆë‹¤ê³ í•œë‹¤. ì´ë•Œ ì—¬ëŸ¬ í”„ë¡œì„¸ìŠ¤ê°€ ê³µìœ í•˜ëŠ” Shared cacheë¥¼ ì´ìš©í–ˆê³  ì´ ìºì‹œëŠ” Key-value í˜•ì‹ì˜ Mapì´ì—ˆë‹¤ê³  í•œë‹¤.\ní•˜ì§€ë§Œ GoëŠ” ë©€í‹°í”„ë¡œì„¸ì‹± ë°©ì‹ë³´ë‹¤ëŠ” Goroutineì„ ì´ìš©í•œ ë™ì‹œì„± í”„ë¡œê·¸ë˜ë°ê³¼ channelì„ ì´ìš©í•œ goroutineê°„ì˜ communicationì„ ê¶Œì¥í•œë‹¤.\nê¸°ì¡´ì—ëŠ” multi-processì—ì„œ shared memory í˜•íƒœì˜ shared cacheë¥¼ ì´ìš©í–ˆëŠ”ë° ì´ê²ƒì„ ìœ ì‚¬í•˜ê²Œ ì´ìš©í•  ë°©ë²•ì„ ì˜ ì°¾ì§€ ëª»í–ˆë‹¤ê³  í•œë‹¤. ê·¸ ì´ìœ ëŠ” Goroutineê°„ì˜ ë°ì´í„° ê³µìœ ëŠ” ì§ì ‘ ê³µìœ ê°€ ì•„ë‹Œ channelì„ ì´ìš©í•œ communication ë°©ì‹ì„ ì´ìš©í•  ê²ƒì´ ëŒ€ì²´ë¡œ ê¶Œì¥(ì¦‰ ê¸°ì¡´ì˜ ë°©ì‹ê³¼ ë„ˆë¬´ ë‹¤ë¥¸ ë°©ì‹)ë˜ì—ˆê³ , ê·¸ ì´ì™¸ì˜ ë°©ë²•ë“¤ì€ ì„œë²„/í´ë¼ì´ì–¸íŠ¸ ë°©ì‹ì´ë‚˜ gRPC ë°©ì‹ì´ì—ˆê¸° ë•Œë¬¸ì´ë¼ê³  í•œë‹¤. ê·¸ë¦¬ê³  ê²°ê³¼ì ìœ¼ë¡œëŠ” ì´ëŸ° ë°©ì‹ë“¤ë³´ë‹¤ëŠ” Memoryìƒì˜ SQLiteë¥¼ ì´ìš©í•˜ê¸°ë¡œ í–ˆë‹¤ê³  í•œë‹¤.\nì•„ë§ˆ ì—¬ëŸ¬ Goroutineì´ ë™ì‹œì ìœ¼ë¡œ ì ‘ê·¼í•´ë„ SQLiteë„ ë‚˜ë¦„ì˜ DBë¼ì„œ ì—¬ëŸ¬ goroutineì´ ë™ì‹œì ìœ¼ë¡œ ë™ì‘í•´ë„ ë™ì‹œì„± ë¬¸ì œê°€ ì—†ì„ ê²ƒì´ê³ , ë“œë¼ì´ë¸Œê°€ ì•„ë‹Œ ë©”ëª¨ë¦¬ë¥¼ ë°”íƒ•ìœ¼ë¡œ í•˜ë„ë¡ ì„¤ì •ë„ ê°€ëŠ¥í•´ ì†ë„ë„ ë¹ ë¥´ê¸° ë•Œë¬¸ì´ ì•„ë‹ê¹Œ ì‹¶ë‹¤. í•˜ì§€ë§Œ ê°œì¸ì ìœ¼ë¡œëŠ” ì—¬ê¸°ì„œ ì´í•´ë˜ì§€ ì•ŠëŠ” ë‚´ìš©ì´ ê½¤ ë§ì´ ì¡´ì¬í•œë‹¤. GoëŠ” goroutineê°„ì˜ ë°ì´í„° ê³µìœ ë¥¼ ì£¼ë¡œ communicationì„ ì´ìš©í•  ê²ƒì´ ê¶Œì¥ëœë‹¤ê³  í•˜ì…¨ëŠ”ë° ê·¸ëŸ° ê²½ìš°ëŠ” ë‹¤ìŒê³¼ ê°™ì§€ ì•Šì„ê¹Œ ì‹¶ë‹¤.\ngoroutineì´ ì„œë¡œê°„ì— ë°ì´í„°ë¥¼ ping pongí•˜ë©° ì£¼ê³  ë°›ìœ¼ë©° ë™ì‘í•˜ëŠ” ê²½ìš° ì—¬ëŸ¬ ìŠ¤ë ˆë“œ(í˜¹ì€ ê³ ë£¨í‹´ í˜¹ì€ í”„ë¡œì„¸ìŠ¤)ê°€ ë™ì‹œì— ì´ìš© ê°€ëŠ¥í•˜ë„ë¡ ë™ê¸°í™”ê°€ ì§€ì›ë˜ëŠ” íì²˜ëŸ¼ ì´ìš©í•  ê²½ìš° semaphoreì²˜ëŸ¼ ì‘ì—…ëŸ‰ì„ ì¡°ì ˆí•˜ë ¤ëŠ” ê²½ìš° í•˜ì§€ë§Œ ì´ëŸ° communicate ë°©ì‹ ë§ê³ ë„ Goì—ë„ ì¶©ë¶„íˆ Mutexê°€ ì œê³µë˜ê³  ê²Œë‹¤ê°€ Read/Writeì— ëŒ€í•´ ë‹¤ë¥´ê²Œ Lockì„ ê±¸ ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ë„ ìˆëŠ”ë°, êµ³ì´ SQLite3ë¥¼ ì‚¬ìš©í•  í•„ìš”ê°€ ìˆì—ˆì„ê¹Œ ì‹¶ê¸°ë„í•˜ë‹¤. ì•„ë‹ˆë©´ ë‹¤ë¥¸ ê´€ì ì—ì„œ ë´¤ì„ ë• Goì˜ Mutex ê¸°ëŠ¥ì„ ì´ìš©í•˜ëŠ” ê²ƒì´ ê·¸ë¦¬ ì‰¬ìš´ í¸ì€ ì•„ë‹ˆë¼ëŠ” ì ì—ì„œ ë„ˆë¬´ GoìŠ¤ëŸ¬ìš´ ë°©ì‹ì„ ì ê·¹ í™œìš©í•˜ëŠ” ìª½ ë³´ë‹¤ëŠ” ê·¸ëƒ¥ ì¼ë°˜ì ì¸ ê°œë°œìë“¤ì´ ì¹œìˆ™í•œ SQLiteì™€ Databaseì ì¸ íŠ¹ì§•ì„ ì´ìš©í•˜ëŠ” ìª½ì´ í˜‘ì—…í•˜ê¸°ì— ë” ì¢‹ì„ ìˆ˜ë„ ìˆì„ ê²ƒ ê°™ë‹¤.\nì„±ëŠ¥ Goê°€ C++ ë³´ë‹¤ ë‚˜ì€ ì„±ëŠ¥ì„ ë³´ì—¬ì£¼ëƒë³´ë‹¤ëŠ” Goê°€ C++ë§Œí¼ì˜ ì„±ëŠ¥ì„ ë‚¼ ìˆ˜ ìˆëŠ”ê°€ì˜ ê´€ì ì—ì„œ í‰ê°€í–ˆë‹¤ê³ í•œë‹¤. ê·¸ë¦¬ê³  GoëŠ” ê¸°ì¡´ì˜ C++ ê²€ìƒ‰ì—”ì§„ ë§Œí¼ì˜ ì‘ì—… ì²˜ë¦¬ëŸ‰ì„ ë³´ì—¬ì¤¬ë‹¤ê³ í•œë‹¤.\nê¸°ë³¸ì ìœ¼ë¡œ Go Binaryê°€ í° í¸ì´ê³  Shared memoryë¥¼ ì´ìš©í•˜ë˜ ê²ƒì„ SQLite3ë¥¼ ì“´ ì ì—ì„œ ë©”ëª¨ë¦¬ì˜ ì°¨ê°€ ì¢€ í¬ê²Œ ë‚œ ê²ƒ ê°™ë‹¤ê³  í•œë‹¤.\nìƒì‚°ì„±ì´ ì •ë§ ì¢‹ì•„ì¡ŒëŠ”ê°€? 4ëª…ì´ì„œ ì‹œì‘í•œ í‚¥ì˜¤í”„, 5ê°œì›”ë§Œì— ê²€ìƒ‰ì—”ì§„ì„ Goê¸°ë°˜ì˜ ëª¨ë“ˆë¡œ ì „í™˜ ì™„ë£Œ\nGoëŠ” C++ì— ë¹„í•´ ëŸ¬ë‹ ì»¤ë¸Œê°€ ë‚®ë‹¤ê³  ìƒê° í…ŒìŠ¤íŠ¸ë¥¼ ì§œëŠ” ê²ƒë„ ëŒë¦¬ëŠ” ê²ƒë„ ì‰¬ì›€ go build, go test, go test -bench, godoc ë“±ì˜ ê¸°ë³¸ ëª…ë ¹ì–´ë¥¼ í†µí•´ ë¹Œë“œ, í…ŒìŠ¤íŠ¸, ë²¤ì¹˜ë§ˆí¬, ë¬¸ì„œí™”ë“±ì„ ì´ìš©ê°€ëŠ¥ gofmtë‚˜ goimport í†µì¼ëœ ê¸°ëŠ¥ê³¼ ê°™ì€ ê¹ê¹í•œ Compilerë¡œ ì¸í•´ ê¹”ë”í•œ ì½”ë“œ ìœ ì§€ ê°€ëŠ¥. íŒ¨í‚¤ì§•ì´ ì•„ì£¼ ê°„ë‹¨í•˜ë‹¤. go.modì— í•œ ì¤„ë§Œ ì¶”ê°€í•˜ë©´ ë¨. ì†ŒìŠ¤ë„ ê¹Œë³´ê¸° ì‰¬ì›€. C++ â‡’ Golangìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ í•œ ë’¤ ê³ ê°ì˜ ì†Œë¦¬ (ê²€ìƒ‰ ì—”ì§„ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•œ íƒ€ ë¶€ì„œ ì‚¬ëŒë“¤ì˜ ì˜ê²¬) ë¡œì§ íŒŒì•…ì´ ì‰½ê³ , ë‹¤ë¥¸ ê°œë°œìì˜ ì½”ë“œë¥¼ Import í•˜ê¸° ì‰¬ì› ë‹¤. TDDë¥¼ ì ìš©í•´ë³¼ ìˆ˜ ìˆì—ˆë‹¤. í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬(marshaling ë“±ë“±)ì´ íŒŒì›Œí’€í–ˆë‹¤. ë‹¨ìˆœí•˜ê³  ëŸ¬ë‹ ì»¤ë¸Œê°€ ì ì–´ì„œ ì¢‹ì•˜ë‹¤. ê°œì¸ì ìœ¼ë¡œëŠ” í™•ì‹¤íˆ Go ì½”ë“œê°€ê°€ ì—„ì²­ ì½ê¸° ì‰½ê¸´í•˜ë‹¤. ë¶ˆí•„ìš”í•œ ì½”ë“œëŠ” ì• ì´ˆì— ì»´íŒŒì¼ëŸ¬ê°€ í—ˆê°€í•´ì£¼ì§€ ì•Šìœ¼ë‹ˆ ì½ëŠ” ì‚¬ëŒ ì…ì¥ì—ì„œëŠ” ëª¨ë“  ì½”ë“œê°€ í•„ìš”í•œ ë‚´ìš©ë“¤ë¡œ êµ¬ì„±ë˜ì–´ìˆìœ¼ë‹ˆ ê°„ê²°í•˜ë‹¤. ë˜í•œ ê°•í•œ Type ê°•ì œ ì–¸ì–´ë‹µê²Œ ì–´ë–¤ ë©”ì†Œê°€ë“œê°€ ì–´ë–¤ ê²ƒì„ ë¦¬í„´í•˜ëŠ”ì§€, ì–´ë–¤ ì¸ìë¥¼ í•„ìš”ë¡œ í•˜ëŠ”ì§€ê°€ ë¶„ëª…í•˜ë‹¤. ê²Œë‹¤ê°€ Type ì–¸ì–´ì´ë©´ì„œë„ Javaì™€ ë‹¬ë¦¬ ì•ì„œ ë§í–ˆë“¯ì´ ê°„ê²°í•˜ë©´ì„œë„ ê°•ë ¥í•˜ê³  í†µì¼ëœ ê¸°ëŠ¥ë“¤ì„ ì œê³µí•œë‹¤. ì•½ê°„ ìë°”ëŠ” ê¸°ëŠ¥ë„ ì—„ì²­ ë§ì€ ëŒ€ì‹  ì„¤ì •í•´ì•¼í•˜ëŠ” ê²ƒë„ ë„ˆë¬´ ë§ì•„ ë²ˆê±°ë¡œìš¸ ë•Œê°€ ìˆëŠ” ë°˜ë©´ GoëŠ” \u0026ldquo;ìš°ë¦¬ê°€ í‘œì¤€ìœ¼ë¡œ ì •ì˜í•œ ëŒ€ë¡œ í•´!\u0026ldquo;ë¼ê³  ê°•ì œí•˜ëŠ” ëŠë‚Œì´ ìˆëŠ”ë° ê·¸ í‘œì¤€ì´ ê½¤ë‚˜ ê¹”ë”í•´ì„œ ë°˜ë°•ì˜ ì—¬ì§€ê°€ ì ì€ ê²ƒ ê°™ë‹¤. ë§ˆì¹˜ CISC(Complex Instruction Set Architecture)ì˜ í˜•íƒœë¡œ ë°œì „í•˜ë‹¤ \u0026ldquo;ì•„ ëª°ë¼! ë„ˆë¬´ ë³µì¡í•´. ë‹¤ì‹œ ê°„ë‹¨í•˜ê²Œ í•´!!!\u0026rdquo; ë¼ë©° RISCì˜ í˜•íƒœë¡œ ë°œì „ëœ ëŠë‚Œì´ë„ê¹Œ\u0026hellip;ã…ã…\nì´í‰ ë° ì˜ê²¬ ì‹¤ì œë¡œ ê¸°ì¡´ C++ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ Goë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ í•´ë³´ì•˜ìœ¼ë©°, Goë¥¼ ëª¨ë¥´ë˜ íƒ€ë¶€ì„œ ê°œë°œìë“¤ë„ Goë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¬´ë¦¬ ì—†ì´ ì´ìš©í–ˆë‹¤ëŠ” ì°ì´ í¥ë¯¸ë¡œì› ê³ , ë‹¹ê·¼ë§ˆì¼“ì´ ê·¸ëŸ¬í–ˆë“¯ ë„¤ì´ë²„ì—ë„ ì–´ì©Œë©´ Go ë¶ì´ ì´ë¥¼ ìˆ˜ ìˆì§€ ì•Šì„ê¹Œì‹¶ë‹¤. ë§Œì•½ ê·¸ë ‡ê²Œ ëœë‹¤ë©´ ë‚˜ì¤‘ì— ë„¤ì´ë²„ì— ì§€ì›í•˜ëŠ” ì‹ ì… ì¤‘ì—” ê½¤ Goë¥¼ ì˜ ì´í•´í•˜ê³  ì˜ ì‚¬ìš©í•  ìì‹ ì´ ìˆì„ ë“¯ í•˜ë‹¤..!\nì„±ëŠ¥ì´ C++ë³´ë‹¤ ì˜ ë‚˜ì˜¤ëŠëƒì˜ ê´€ì ë³´ë‹¤ëŠ” C++ë§Œí¼ì˜ ì‘ì—… ì²˜ë¦¬ëŸ‰ì„ ë‚¼ ìˆ˜ ìˆëŠëƒëŠ” ì ë„ ì¢€ ì¬ë¯¸ìˆì—ˆë‹¤. ì´ì œëŠ” Goë„ ê·¸ ë§¤ë ¥ì„ ì¸ì •ë°›ìœ¼ë©° ì ì  ëŒ€ì¤‘í™”ë˜ê³  ìˆê¸° ë•Œë¬¸ì— \u0026ldquo;ê¼­ Goë¥¼ ì¨ì•¼í•  ì ˆëŒ€ì ì¸ ì´ìœ ê°€ ìˆì–´? ë‹¤ë¥¸ ì–¸ì–´ë“¤ë„ ê·¸ëŸ° ì´ìœ ëŠ” ì–´ë–»ê²Œë“  ì»¤ë²„ ê°€ëŠ¥í•˜ì–ì•„.\u0026rdquo; ì˜ ê´€ì ì—ì„œ ë°”ë¼ë³´ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒì´ë‹¤. Goê°€ ë‹¤ë°©ë©´ì—ì„œ ì¢‹ì€ ì¥ì ì´ ìˆê¸° ë•Œë¬¸ì— \u0026ldquo;ê¼­ Goë§Œì˜ ì ˆëŒ€ì ì¸, ìœ ì¼í•œ ì¥ì , ê¸°ëŠ¥ì„ ì¨ë¨¹ëŠ” ì¼€ì´ìŠ¤ê°€ ì•„ë‹ˆë”ë¼ë„ ê¸°ì¡´ ì‘ì—…ëŸ‰ì„ ë”°ë¼ ê°ˆ ìˆ˜ë§Œ ìˆìœ¼ë©´ ì„±ëŠ¥ë„ ê´œì°®ê³ , ê´€ë¦¬ë„ í¸ë¦¬í•˜ê³ , ëŸ¬ë‹ ì»¤ë¸Œë„ ì ê³ , í…ŒìŠ¤íŠ¸ë„ ì‰¬ìš´ ì¢‹ì€ ì–¸ì–´ì¸ë° ë„ì…í•´ë³¼ë§Œí•˜ì§€ ì•Šì•„?\u0026rdquo; ë¼ëŠ” ê´€ì ì—ì„œ ì ‘ê·¼í•˜ê²Œ ëœ ê²ƒì´ë‹¤.\nì‹¤ì œë¡œ Goë¥¼ ì ìš©í•´ë´¤ëŠ”ë° ë°œí‘œìë¶„ì´ ì†í•œ íŒ€ì—ì„œë„ ë˜ ê·¸ ì™¸ì˜ ë¶€ì„œì—ì„œë„ ì‚¬ëŒë“¤ì´ ì˜ ë”°ë¼ì˜¨ë‹¤ê³ í•˜ë‹ˆ ì—­ì‹œ Goê°€ ëŸ¬ë‹ ì»¤ë¸ŒëŠ” ë†’ì§€ ì•Šê³  ê°„ê²°í•œ ì–¸ì–´ì¸ ê²ƒ ê°™êµ¬ë‚˜ ì‹¶ê¸°ë„ í•˜ê³ , ì‚¬ì‹¤ í•œ ì–¸ì–´ë¥¼ ì˜ í•˜ëŠ” ê²ƒë„ í˜ë“¤ ìˆ˜ ìˆëŠ”ë° ê³§ì˜ ë‹¤ë“¤ Goë¼ëŠ” ì–¸ì–´ë¥¼ ìµíˆì‹ ë‹¤ë‹ˆ ì—­ì‹œ Naverì˜ ê°œë°œìë“¤ì´êµ¬ë‚˜ ì‹¶ì€ ìƒê°ë„ ë“¤ì—ˆë‹¤.\n","date":"2021-06-03T15:46:54+09:00","image":"https://umi0410.github.io/blog/conferences/naver-deview-2020-cpp-to-golang/preview_hu5e425158693deacd0d5ef6841733ed22_379145_120x120_fill_box_smart1_3.png","permalink":"https://umi0410.github.io/blog/conferences/naver-deview-2020-cpp-to-golang/","title":"Naver Deview 2020 C++ to Golang ë¦¬ë·°"},{"content":"ì‹œì‘í•˜ë©° ì´ ê¸€ì€ Go 1.15 ë²„ì „ì„ ë°”íƒ•ìœ¼ë¡œ ê°œë°œí•˜ë©° ê²ªì€ ì´ìŠˆì— ëŒ€í•´ ì„¤ëª…í•˜ê³  ìˆìœ¼ë©° Go 1.16ì—ì„œëŠ” í•´ë‹¹ ì´ìŠˆê°€ ê°œì„ ë  ê²ƒì´ë¼ê³  í•©ë‹ˆë‹¤.\nmemory-leak-graph.png ì§„í–‰ ì¤‘ì¸ ì¿ ë®¤ë¼ëŠ” í”„ë¡œì íŠ¸ì—ì„œ Goë¥¼ ì´ìš©í•´ ì´ë¯¸ì§€ì— ëŒ€í•œ url í•´ì‹±, ë¦¬ì‚¬ì´ì§•, ì„¬ë„¤ì¼, ì„¼í„° í¬ë¡­ ì‘ì—…ì„ í•˜ëŠ” ì´ë¯¸ì§€ í”„ë¡œì„¸ì‹± ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¥¼ ê°œë°œí•˜ê³ ìˆì—ˆë‹¤. 1ì°¨ì ìœ¼ë¡œ ì–´ëŠ ì •ë„ ê°œë°œì´ ëë‚œ ë’¤ ë²¤ì¹˜ë§ˆí¬ ê²¸ ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê²¸í•´ì„œ ì–¼ë§ˆë‚˜ í•´ë‹¹ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ê°€ ì˜ ë²„í‹°ë©´ì„œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ”ì§€ í™•ì¸í•´ë³´ë ¤ í–ˆìœ¼ë‚˜ Memoryê°€ í•œ ë²ˆ ì¹˜ì†Ÿê²Œë˜ë©´ ì–´ëŠ ì •ë„ ì´í•˜ë¡œ ë–¨ì–´ì§€ì§€ ì•ŠëŠ” ì´ìŠˆê°€ ë°œê²¬ë˜ì—ˆë‹¤.\ní—ˆìš©í•  ìˆ˜ ìˆëŠ” ì–‘ë³´ë‹¤ ë§ì€ ìš”ì²­ì„ ë³´ë‚¼ ê²½ìš° ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ ì´ì „ì—ì„œ ìš”ì²­ì„ ì°¨ë‹¨í•´ì£¼ì§€ ì•Šìœ¼ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜ ë‹¨ì—ì„œëŠ” í„°ì§€ê±°ë‚˜ ë¬¸ì œê°€ ìƒê¸°ëŠ” ê²ƒì€ ë‹¹ì—°í•˜ê² ì§€ë§Œ ì‚¬ì§„ì²˜ëŸ¼ ì‘ì—…ì„ ë‹¤ ìˆ˜í–‰í•œ ë’¤ì—ë„ ë©”ëª¨ë¦¬ê°€ ì œëŒ€ë¡œ í•´ì œë˜ì§€ ì•ŠëŠ” ê²ƒì´ ì´ìŠˆì˜€ë‹¤.\nì´ìŠˆì˜ ì›ì¸ì„ íŒŒí—¤ì¹˜ê¸° ìœ„í•´ í–ˆë˜ ë…¸ë ¥ë“¤\u0026hellip; ì´ ì´ìŠˆë¥¼ ì¡ì•„ë³´ë ¤ ì—¬ëŸ¬ ê°€ì§€ ë””ë²„ê¹… ì‘ì—…ì„ í•´ë´¤ìœ¼ë‚˜ ê³„ì†í•´ì„œ ë©”ëª¨ë¦¬ ì´ìŠˆê°€ ë°œìƒí–ˆê³ , ê°ì¢… ì»¤ë®¤ë‹ˆí‹°ì—ì„œ ë„ì›€ì„ êµ¬í•´ë³´ê³ ìí–ˆë‹¤. Go ì˜¤í”ˆ ì¹´í†¡ë°©, Reddit, Slack ë“±ì—ì„œ ì˜ê²¬ì„ êµ¬í•´ë³´ì•˜ë‹¤. ì¬ë¯¸ìˆëŠ” ê²½í—˜ì´ì—ˆìœ¼ë©° ë•ë¶„ì— ì›ì¸ì„ íŒŒì•…í•  ìˆ˜ ìˆë˜ ê²ƒ ê°™ë‹¤.\nslack-thread.png reddit.png ì–´ë–¤ ìƒí™©ì— Memory Leakì´ ë°œìƒí•œ ê²ƒì¼ê¹Œ? ê·¸ëŸ¼ ìì„¸íˆ ì–´ë–¤ ì´ìŠˆê°€ ìˆì—ˆê³ , ì–´ë–»ê²Œ ê·¸ ìƒí™©ì„ ë¶„ì„í•  ìˆ˜ ìˆì—ˆìœ¼ë©° ì–´ë–»ê²Œ í•´ê²°í•  ìˆ˜ ìˆì„ì§€ ì•Œì•„ë³´ë„ë¡í•˜ê² ë‹¤.\ntl;dr - ìì„¸í•œ ë¬˜ì‚¬ë³´ë‹¤ëŠ” ê·¸ëƒ¥ ë”± ì›ì¸/ê²°ê³¼ë§Œ ê¶ê¸ˆí•˜ì‹  ë¶„ë“¤ì„ ìœ„í•œ ìš”ì•½\nì›ì¸ - í™ ë©”ëª¨ë¦¬ì— ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹ë°›ì•˜ëŠ”ë° í˜¹ì‹œ ì¬ì‚¬ìš©í•  ìˆ˜ë„ ìˆì–´ OSì—ê²Œ ë°”ë¡œ ë©”ëª¨ë¦¬ë¥¼ ë°˜í™˜í•˜ì§€ ì•ŠìŒ. ê²°ê³¼ - OSê°€ ë©”ëª¨ë¦¬ ë¶€ì¡±í•˜ë‹ˆ ë‹¬ë¼ê³  í•˜ë©´ ê·¸ë•Œ í™ ë©”ëª¨ë¦¬ ì‚¬ì´ì¦ˆë¥¼ ì‹¤ì œë¡œ ì¤„ì¸ë‹¤. (í•˜ì§€ë§Œ go 1.16 ë²„ì „ë¶€í„°ëŠ” ê°œì„ ë  ì˜ˆì •ì´ë‹¤.) ì •í™•íˆ ì´ëŸ¬í•œ ê²ƒì„ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¼ê³  í•˜ëŠ”ì§€ëŠ” ëª…í™•í•˜ì§€ ì•Šë‹¤. Go ëŸ°íƒ€ì„ì´ ë†€ê³  ìˆëŠ” ë©”ëª¨ë¦¬ë¥¼ ê°–ê³ ëŠ” ìˆì§€ë§Œ ì–¸ì œë“  OSì—ê²Œ ë°˜í™˜í•´ì¤„ ìˆ˜ëŠ” ìˆê¸° ë•Œë¬¸ì´ë‹¤. (í•˜ì§€ë§Œ ë§¤ë„ëŸ½ê²Œ OSì—ê²Œ ë°˜í™˜í•´ì£¼ëŠ” ëŠë‚Œì€ ì•„ë‹ˆê¸´í–ˆë‹¤.) package main import ( \u0026#34;time\u0026#34; ) func main(){ for routine := 0; routine \u0026lt; 10; routine ++{ DoFloat() } for { // dummy waiting.. time.Sleep(3*time.Second) } } func DoFloat(){ var tmp [400000000]float64 tmp[0] = 0 // tmpì— ì ‘ê·¼í•˜ì§€ ì•Šìœ¼ë©´ unused variableì´ ë˜ê¸° ë•Œë¬¸ì— dummyí•œ access ì‘ì—… ìˆ˜í–‰ } ì²˜ìŒì—” ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì§• ì‹œ ë©”ëª¨ë¦¬ê°€ ì œëŒ€ë¡œ í•´ì œë˜ì§€ì•ŠëŠ” ê²ƒì„ ë³´ê³  ì´ìŠˆë¥¼ ë°œê²¬í–ˆì§€ë§Œ, ì‚¬ëŒë“¤ì—ê²Œ ë„ì›€ì„ êµ¬í•˜ê³ ì í•  ë•Œ, ì´ìŠˆì— ëŒ€í•´ ì„¤ëª…í•  ë•Œ ì „ì²´ í”„ë¡œê·¸ë¨ ì½”ë“œë¥¼ ì²¨ë¶€í•  ìˆ˜ëŠ” ì—†ì—ˆê¸°ì— ë¬¸ì œ ìƒí™©ì„ ê°„ë‹¨í•˜ê²Œ í‘œí˜„í•  ìˆ˜ ìˆëŠ” ì½”ë“œë¥¼ ì§œë³´ê³ ìí–ˆë‹¤. ì´ë¦¬ ì €ë¦¬ í”„ë¡œê·¸ë¨ì„ ê°„ì†Œí™”í•˜ë©´ì„œ ì»¤ë‹¤ë€ ë°°ì—´ ìƒì„±ì‹œì—ë„ ê°™ì€ ë©”ëª¨ë¦¬ ì´ìŠˆê°€ ë°œìƒí•œë‹¤ëŠ” ê²ƒì„ ì•Œê²Œë˜ì—ˆë‹¤.\nê·¸ë˜ì„œ ì•„ì£¼ ê°„ë‹¨í•œ ë°°ì—´ ìƒì„± ì˜ˆì‹œë¥¼ í†µí•´ ì‚¬ëŒë“¤ì—ê²Œ ì´ ì´ìŠˆì— ëŒ€í•´ ì„¤ëª…í•´ë³´ê³ ìí–ˆë‹¤. ì´ ì˜ˆì‹œì—ì„œëŠ” 8ë°”ì´íŠ¸ì˜ float64ë¡œ ì´ë£¨ì–´ì§„ 400000000ì¹¸ì˜ ë°°ì—´ tmpë¥¼ ì„ ì–¸í•œë‹¤.\nunit-conversion.png 8ë°”ì´íŠ¸ê°€ 400000000ì¹¸ì´ë©´ 400000000 * 8 / 1024(KB) / 1024(MB) / 1024(GB) = ì•½ 2.9GB í˜¹ì€ ê·¸ëŒ€ë¡œ 1000ë‹¨ìœ„ ì”©ìœ¼ë¡œ ë‚˜ëˆ  3.2GBì„ í• ë‹¹í•˜ëŠ” ê²ƒì´ë‹¤.\nì›ë˜ëŠ” ìŠ¤íƒ ë©”ëª¨ë¦¬ì— í• ë‹¹ëœ ë’¤ ë‹¤ë¥¸ ê³³ì—ì„œ ì´ ë…€ì„ì„ ì°¸ì¡°í•˜ëŠ” ì¼ì´ ì—†ê¸° ë•Œë¬¸ì— ë°”ë¡œ releaseë˜ì–´ ìŠ¤íƒ ë©”ëª¨ë¦¬ì—ì„œ ì ìœ ê°€ í•´ì œë˜ì–´ì•¼í•œë‹¤. í•˜ì§€ë§Œ ëª‡ëª‡ ê²½ìš°ì— ìŠ¤íƒì´ ì•„ë‹Œ í™ì— ë°ì´í„°ê°€ ì €ì¥ë  ìˆ˜ ìˆë‹¤ê³  í•˜ëŠ”ë°, ì´ ê²½ìš°ì—ëŠ” ë„ˆë¬´ í° ê°’ì„ ì„ ì–¸í•˜ì—¬ ìŠ¤íƒì´ ì•„ë‹Œ í™ì— ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆê³ , í™ì´ í• ë‹¹ë°›ì€ ë©”ëª¨ë¦¬ë¥¼ í•´ì œí•´ì£¼ì§€ ì•Šì•„ ìƒê¸°ëŠ” ë¬¸ì œì˜€ë‹¤. ì‚¬ì‹¤ ì´ëŸ° í˜„ìƒë„ ì •í™•íˆ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ í˜¹ì€ Memory Leakë¼ê³  í•˜ëŠ”ì§€ëŠ” ì˜ ëª¨ë¥´ê² ë‹¤. ì™œëƒí•˜ë©´ ë©”ëª¨ë¦¬ì—ì„œ í•´ì œí•  ìˆ˜ ì—†ëŠ” ìˆ˜ì¤€ìœ¼ë¡œ ê·¸ ê°’ì˜ ì£¼ì†Œë¥¼ ìƒì–´ë²„ë ¤ ì‹¤ì œë¡œ ê·¸ ê³µê°„ì´ ëˆ„ìˆ˜ê°€ ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì•„ì§ ë”±íˆ OSê°€ ë¶€ë‹´ì„ ëŠë¼ì§€ ì•Šê¸° ë•Œë¬¸ì— Go Runtimeì˜ Heapì—ì„œ í•´ë‹¹ ì£¼ì†ŒëŠ” ë¹„ì›Œë’€ì§€ë§Œ OSì—ê²Œ ë°˜ë‚©ì€ ì•ˆ í•œ ìƒíƒœì¸ ê²ƒì´ê¸° ë•Œë¬¸ì´ë‹¤.\ntop-memory-leak.png ì‹¤í–‰í•´ë³´ë©´ 10ë²ˆì˜ DoFloat() í›„ì— ê·¸ëƒ¥ for loopì—ì„œ time.Sleep ì¤‘ì´ê¸°ì— CPUë¥¼ ê±°ì˜ ì‚¬ìš©í•˜ì§€ ì•Šê³  ìˆëŠ” ë°˜ë©´ ë‚´ Laptopì˜ 16GBì˜ Memory ì¤‘ 20.5%ì¸ 3.2GBë¥¼ ì‚¬ìš© ì¤‘ì¸ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤.\ní•´ê²° í•´ë³´ê¸° Go runtimeì€ OSì—ê²Œ ë” ì´ìƒ ì´ ë©”ëª¨ë¦¬ê°€ í•„ìš”í•˜ì§€ ì•Šë‹¤ê³  ì•Œë ¤ì£¼ê¸°ë§Œ í•˜ì§€ ê·¸ Memoryë¥¼ ì‹¤ì œë¡œ íšŒìˆ˜í•  ì§€ ë§ì§€ëŠ” OSì—ê²Œ ë‹¬ë ¤ìˆë‹¤. The Go runtime only advises the OS when it no longer needs memory and it is up to the OS to reclaim it - @justinisrael\në‚´ê°€ Redditì—ì„œ ì‚¬ëŒë“¤ê»˜ ì—¬ì­¤ë´¤ë˜ ê¸€ì— ë‹´ê¸´ í•œ ëŒ“ê¸€ì„ ì¸ìš©í•´ë³´ì•˜ë‹¤. ê³¼ì—° ì € ë§ì´ ì‚¬ì‹¤ì¼ê¹Œ? í”„ë¡œì„¸ìŠ¤ë¥¼ ì—¬ëŸ¬ë²ˆ ë„ì›Œë³´ì•˜ë‹¤.\ntop-multiple-process.png í”„ë¡œì„¸ìŠ¤ë¥¼ í•˜ë‚˜ ë„ì› ì„ ë•Œì—ëŠ” ì•„ê¹ŒëŠ” Dummy waiting ì¤‘ì´ë©´ì„œë„ Memoryë¥¼ 20% ê°€ê¹Œì´ ì ìœ í•˜ê³  ìˆì—ˆëŠ”ë° ì—¬ëŸ¬ í”„ë¡œì„¸ìŠ¤ë¥¼ ë„ìš°ë©´ì„œ ë©”ëª¨ë¦¬ê°€ ë¶€ì¡±í•´ì§€ì ë†€ê³ ìˆë˜ Heap memoryë¥¼ ë°˜í™˜í•˜ì—¬ ê±°ì˜ ì•½ 0.6%ì˜ ë©”ëª¨ë¦¬ë§Œ ì ìœ  ì¤‘ì¸ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.\në§ˆì§€ë§‰ í”„ë¡œì„¸ìŠ¤ëŠ” ì•„ì§ DoFloat() ì‘ì—…ì„ ì§„í–‰ ì¤‘ì´ë¯€ë¡œ ì—¬ì „íˆ 19.8%ì˜ ë©”ëª¨ë¦¬ë¥¼ ì ìœ  ì¤‘ì´ê³ , ì‘ì—…ì´ ì™„ë£Œëœ ë’¤ì—ë„ OSê°€ Reclaim(ë‹¤ì‹œ ë©”ëª¨ë¦¬ë¥¼ ê°€ì ¸ê°€ëŠ” ê²ƒ)í•˜ê¸° ì „ê¹Œì§€ëŠ” ì•½ 20%ëŒ€ë¥¼ ìœ ì§€í•˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ì—¬ì¡Œë‹¤.\ní•˜ì§€ë§Œ ì¢€ ë” ìì„¸íˆ ê¸°ë¡í•´ë³´ê³ ì‹¶ì—ˆë‹¤. Goì˜ ë‚´ì¥ íŒ¨í‚¤ì§€ runtimeì˜ Memory ê´€ë ¨ ê¸°ëŠ¥ì„ ì´ìš©í•˜ë©´ ë  ê²ƒ ê°™ì•˜ë‹¤. runtime.ReadMemStats(*runtime.MemStats)ë¥¼ ì´ìš©í•˜ë©´ ëŸ°íƒ€ì„ ë„ì¤‘ ìì‹ ì˜ ëŸ°íƒ€ì„ ìƒí™©ì„ ì•Œì•„ë³¼ ìˆ˜ ìˆë‹¤. ìì„¸í•œ ì‚¬ìš©ë²•ì€ êµ¬ê¸€ë§ì„ í†µí•´ ì‰½ê²Œ ì–»ì„ ìˆ˜ ìˆìœ¼ë‹ˆ ì§€ë©´ ê´€ê³„ìƒ ìƒëµí•œë‹¤.\nruntime-memory-leak.png ì¦‰ í™ ë©”ëª¨ë¦¬ê°€ í™•ë³´ê°„ ê³µê°„ì€ ê±°ëŒ€í•œ ë°°ì—´ì„ ìƒì„±í•˜ëŠ” í•¨ìˆ˜ì¸ DoFloatì„ ì§„í–‰í•˜ëŠ” ë™ì•ˆì€ ì‹¤ì œë¡œ Allocate í• ë‹¹í•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ë°˜ë©´ DoFloatì„ ëª¨ë‘ ë§ˆì¹œ ë’¤ì—ëŠ” í™ ë©”ëª¨ë¦¬ëŠ” ê³µê°„ì„ í™•ë³´í•˜ê³ ëŠ” ìˆì§€ë§Œ Idle(ë†€ê³  ìˆëŠ”) ìƒíƒœë¡œ ì¡´ì¬í•˜ëŠ” ê²ƒì´ì—ˆë‹¤.\në‚˜ëŠ” ì´ëŸ¬í•œ ê²½ìš°ë¥¼ ì²˜ìŒ ë§ì´í–ˆì§€ë§Œ, ê°ì¢… ê°€ë¹„ì§€ ì»¬ë ‰í„°ê°€ ìˆëŠ” ì–¸ì–´ì—ì„œ ê°ê°ì˜ ê°€ë¹„ì§€ ì»¬ë ‰í„°ë‚˜ ëŸ°íƒ€ì„ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì— ë”°ë¼ ì´ëŸ° ì‹ìœ¼ë¡œ í™ ë©”ëª¨ë¦¬ë¥¼ ì¬ì‚¬ìš©í•˜ëŠ” ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ í•œ ë²ˆ í• ë‹¹ë°›ì€ ë©”ëª¨ë¦¬ë¥¼ ì™„ì „íˆ OSì—ê²Œ ë°˜í™˜í•˜ì§€ ì•ŠëŠ” ê²½ìš°ê°€ ìˆë‹¤ê³  í•œë‹¤.\nGo 1.16 ë²„ì „ë¶€í„°ëŠ” ë©”ëª¨ë¦¬ ê³„ì‚° ë°©ì‹ì´ ë°”ë€” ê²ƒì´ë‹¤. (ê·¸ë˜ì„œ ê´œì°®ì„ ê²ƒì´ë‹¤.) \u0026ldquo;There was a change to how memory is calculated on 1.16\u0026rdquo; - @gopj\nê³¼ì—° ì‚¬ì‹¤ì¼ì§€ í™•ì¸í•´ë³´ì. ê°„ë‹¨íˆ Dockerë¥¼ í†µí•´ ë‚˜ì˜ Local í™˜ê²½ì—ì„œ ë³„ ë‹¤ë¥¸ ì„¸íŒ… ì—†ì´ Go ë²„ì „ì„ ë‹¤ë¥´ê²Œ í•˜ì—¬ ì‹¤í–‰í•  ìˆ˜ ìˆì—ˆë‹¤. ì‹¤ì œë¡œ ì´ ì´ìŠˆë¥¼ ì»¤ë®¤ë‹ˆí‹°ì— ì œê¸°í•˜ê¸° ì „ì—ë„ Dockerë¥¼ ì´ìš©í•´ 1.2, 1.3, 1.4 ë“±ì˜ ë²„ì „ì—ì„œë„ ì‹¤í–‰í•´ë³´ì•˜ë‹¤. ë‚˜ì˜ ë©íƒ‘ì€ 1.5 ë²„ì „ì„ ì‚¬ìš© ì¤‘ì´ì—ˆë‹¤. 1.16 ë²„ì „ì€ ì•„ì§ rcëŠ” Release Candidateì˜ ì¤„ì„ë§ë¡œ ë³´í†µ ë°°í¬ í›„ë³´ ë²„ì „ì„ ì˜ë¯¸í•œë‹¤.\n# Dockerfile FROM golang:1.16-rc WORKDIR /app COPY main.go main.go ENTRYPOINT [\u0026#34;go\u0026#34;] CMD [\u0026#34;run\u0026#34;, \u0026#34;./main.go\u0026#34;] # ì´ë¯¸ì§€ ë¹Œë“œ í›„ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ $ docker build . -t tmp \u0026amp;\u0026amp; docker run --rm --it tmp go-1.16-memory-not-leaking.png 1.16-rc ë²„ì „ì„ ì‚¬ìš©í•˜ì ê²°ê³¼ì ìœ¼ë¡œ ë‹¤ë¥¸ ë©”ëª¨ë¦¬ ë¶€í•˜ê°€ ì‹¬í•œ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹¤í–‰ì‹œí‚¤ì§€ ì•Šì•˜ì§€ë§Œ ìˆ˜ì‹­ ì´ˆ ì´ë‚´ì— ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” í™ ë©”ëª¨ë¦¬ê°€ OSì—ê²Œ ë°˜í™˜ë˜ì—ˆë‹¤!!!\ní•˜ì§€ë§Œ ì—¬ì „íˆ runtime.MemStatsì—ì„œëŠ” HeapMemoryì— Idleí•œ ë©”ëª¨ë¦¬ í¬ê¸°ê°€ í¬ê²Œ ì¡í˜€ìˆì—ˆëŠ”ë°, ì´ ë¶€ë¶„ì€ rc ë²„ì „ì´ê¸° ë•Œë¬¸ì— runtimeê¹Œì§€ ì™„ì „íˆ ê¸°ëŠ¥ì´ ê°œë°œë˜ì§€ ì•Šì•„ì„œì¸ì§€ ì´ì „ì—ë„ ë©”ëª¨ë¦¬ëŠ” ë°˜í™˜í–ˆì§€ë§Œ ë©”ëª¨ë¦¬ë¥¼ í‘œì‹œí•˜ê¸° ìœ„í•œ ê³„ì‚°ì˜ ë¬¸ì œë§Œ ê°œì„ ì´ ëœ ê²ƒì¸ì§€ëŠ” í™•ì‹¤í•˜ì§„ ì•Šì§€ë§Œ ì—¬íŠ¼ ì´ìŠˆì— ëŒ€í•´ì„œëŠ” íŒŒì•…í•  ìˆ˜ ìˆì—ˆë‹¤!\në§ˆì¹˜ë©° ê°œë°œì´ë‚˜ ìš´ì˜ì„ í•˜ë©´ì„œ ì´ëŸ° ì €ëŸ° ì´ìŠˆë“¤ì´ ìˆì—ˆì§€ë§Œ ì´ë²ˆ ê²½ìš°ì²˜ëŸ¼ ë¡œìš° ë ˆë²¨ìŠ¤ëŸ½ê²Œ ë“¤ì–´ê°€ì„œ ëŸ°íƒ€ì„ ë™ì•ˆ ë©”ëª¨ë¦¬ ê´€ë¦¬ê°€ ì–´ë–»ê²Œ ë˜ëŠ”ì§€ê¹Œì§€ íƒêµ¬í•´ë³¸ ì ì€ ë“œë¬¼ì—ˆë˜ ê²ƒ ê°™ë‹¤. ë„ì €íˆ ì›ì¸ì„ ëª¨ë¥´ê² ì–´ì„œ \u0026lsquo;í•˜ ê²°êµ­ í¬ê¸°í•˜ê³  ì´ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ëŠ” Lambdaë¡œ ëŒë ¤ì•¼í•˜ë‚˜\u0026hellip;\u0026rsquo; ì‹¶ì—ˆë‹¤. í•˜ì§€ë§Œ ëª‡ ì‹œê°„ì„ ê³ ìƒí•˜ê³  ì§ì ‘ ì˜ê²¬ì„ êµ¬í•˜ëŸ¬ ë‹¤ë‹ˆë©´ì„œ ìƒˆë¡œ ë°°ìš°ê²Œ ëœ ë‚´ìš©ë„ ë§ì•˜ê³ , ì™¸êµ­ì— ê³„ì‹  ëª‡ëª‡ ê°œë°œì ë¶„ë“¤ê³¼ë„ ì´ë ‡ê²Œ ì†Œí†µí•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ ì‹ ê¸°í–ˆë‹¤. (ê·¸ë¦¬ê³  ì°¸ ì„¸ì„¸í•œ ì§€ì‹ê¹Œì§€ ê²¸ë¹„í•œ ë¶„ë“¤ì´ ë§ë‹¤ëŠ” ê²ƒì´ ë†€ë¼ì› ë‹¤\u0026hellip;)\nê²°ê³¼ì ìœ¼ë¡œ í•´ë‹¹ ì´ìŠˆëŠ” ì•„ë§ˆ Goì˜ 1.16 ë²„ì „ì´ íŒ¨ì¹˜ë˜ë©´ ì™„ì „íˆ í•´ê²° ê°€ëŠ¥í•  ê²ƒ ê°™ê³  ê·¸ ì´ì „ì—ë„ ì‚¬ì‹¤ Hostì—ì„œ ë©”ëª¨ë¦¬ ë¶€ë‹´ì„ ëŠë¼ë©´ Go runtimeì´ ì•ˆ ì“°ê³  ìˆëŠ” í™ ë©”ëª¨ë¦¬ë¥¼ ë°˜í™˜í•´ì¤€ë‹¤ê³  í•˜ë‹ˆ í° ë¬¸ì œëŠ” ì—†ì„ ê²ƒ ê°™ë‹¤. í•˜ì§€ë§Œ ì‹¤ì œë¡œ Hostê°€ ë¶€ë‹´ì„ ëŠë¼ëŠ” ì„  ì´ì „ì— ë©”ëª¨ë¦¬ë¥¼ ë°˜í™˜ë°›ê³  ì‹¶ë‹¤ë©´ Pod levelì—ì„œ ë©”ëª¨ë¦¬ ë¦¬ì†ŒìŠ¤ë¥¼ ì œí•œí•´ë³¼ ìˆ˜ëŠ” ìˆì„ ê²ƒ ê°™ë‹¤.\ní˜¹ì‹œ ë‹¤ìŒì—ë„ ì´ëŸ° í”ì¹˜ ì•Šì€ ê³ ëœ ì´ìŠˆë¥¼ ë§ì´í•œë‹¤ë©´ ê·¸ ì›ì¸ê³¼ í•´ë²•ì„ ì´ë ‡ê²Œ ë˜ ê¸°ë¡í•  ìˆ˜ ìˆê¸°ë¥¼ ë°”ë˜ë³¸ë‹¤.\n","date":"2021-01-27T15:25:54+09:00","image":"https://umi0410.github.io/blog/golang/go-memory-leak-issue/memory-leak-graph_hu1f014e9e399a42abc11cd4e02aac56df_8940_120x120_fill_box_smart1_3.png","permalink":"https://umi0410.github.io/blog/golang/go-memory-leak-issue/","title":"ê°œë°œ ì° - Go Memory Leak(ë©”ëª¨ë¦¬ ëˆ„ìˆ˜) ê´€ë ¨ ì´ìŠˆ"},{"content":" mzc_logo ì•ˆë…•í•˜ì„¸ìš”. ì´ë²ˆì— ë©”ê°€ì¡´ í´ë¼ìš°ë“œì˜ í´ë¼ìš°ë“œ ì› íŒ€ì—ì„œ ë°ë¸Œì˜µìŠ¤ ì¸í„´ìœ¼ë¡œ ê·¼ë¬´ë¥¼ í•˜ê²Œë˜ì—ˆë˜ ë°•ì§„ìˆ˜ì…ë‹ˆë‹¤. ë„ˆë¬´ ì¢‹ì€ íŒ€ì›ë“¤ê³¼ ë§ì€ ê²½í—˜ì„ í•˜ë©° ë‹¨ì‹œê°„ì— ì„±ì¥í•  ìˆ˜ ìˆì—ˆê³ , ì¼í•˜ëŠ” ë™ì•ˆ ë§¤ ìˆœê°„ ìˆœê°„ì´ ë„ˆë¬´ í–‰ë³µí–ˆì—ˆê¸°ì— ì´ë ‡ê²Œ ì¸í„´ í›„ê¸°ë¥¼ ì‘ì„±í•´ë´…ë‹ˆë‹¤. í•œ í•™ê¸°ë¥¼ ì‰¬ê³  2020.04.13~2020.08.31 ê¹Œì§€ ì¸í„´ìœ¼ë¡œ ê·¼ë¬´ í–ˆê³ , ë‹¤ì‹œ 2020-2í•™ê¸°ë¶€í„°ëŠ” í•™êµ ë³µí•™ì„ í•˜ê²Œë˜ì—ˆìŠµë‹ˆë‹¤. ê¸°ìˆ ì ì¸ ì–˜ê¸°ëŠ” ì´ê³³ ì €ê³³ì— ë§ìœ¼ë‹ˆ í•­ìƒ ì œê°€ ê°€ì¥ ì¤‘ìš”ì‹œí•˜ëŠ” \u0026ldquo;ëŠë‚€ ì \u0026rdquo; ê³¼ \u0026ldquo;ë°°ìš´ ì \u0026rdquo; ì„ ìœ„ì£¼ë¡œ ì ì–´ë³´ê² ìŠµë‹ˆë‹¤!! ê¸€ì€ ìœ„ì˜ ëª©ë¡ì˜ ìˆœì„œë¡œ ì§„í–‰í•´ë³´ê² ìŠµë‹ˆë‹¤.\nì§€ì›ë™ê¸° ì €ëŠ” AWSì™€ ë°°í¬ì— ê´€í•´ í¥ë¯¸ê°€ ìˆì–´ ì¢…ì¢… AWSKRUG ë¼ëŠ” ê·¸ë£¹ì˜ ì†Œëª¨ì„ì— ê°€ì„œ í•¸ì¦ˆì˜¨ì´ë‚˜ ì„¸ë¯¸ë‚˜ì— ì°¸ì—¬í•˜ê³¤ í–ˆëŠ”ë°ìš”. ê·¸ê³³ì—ì„œ ì €í¬ íŒ€ì›ë“¤ì„ ë§Œë‚˜ê²Œ ë˜ì—ˆê³ , ê·¸ê²ƒì´ ì¸ì—°ì´ ë˜ì–´ ì±„ìš©ìœ¼ë¡œê¹Œì§€ ì´ì–´ì§ˆ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.\ní‰ì†Œ AUSG ë¼ëŠ” ëŒ€í•™ìƒ AWS ì‚¬ìš©ì ëª¨ì„ì˜ ì¼ì›ìœ¼ë¡œì„œ ì°¸ì—¬í•˜ë©° AWS ë¥¼ ì´ìš©í•œ í´ë¼ìš°ë“œ ì¸í”„ë¼, CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶•ì„ í†µí•œ ìë™í™”, ì»¨í…Œì´ë„ˆ ë“±ì— ê´€ì‹¬ì´ ë§ì•˜ëŠ”ë°, ë§ˆì¹¨ ë©”ê°€ì¡´ í´ë¼ìš°ë“œì˜ ì €í¬ CloudOne íŒ€ì—ì„œëŠ” íŒ€ì˜ ëª¨ë“  ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ë° ê¸°íƒ€ ì„œë¹„ìŠ¤ë“¤ì„ EKSë¼ëŠ” AWSì˜ Managed Kubernetes Cluster Service ìœ„ì— ìë™í™”ì‹œì¼œ ë°°í¬ë¥¼ í•˜ê³ ìˆì—ˆê³ , ê°œë°œ ì¸í”„ë¼ë¥¼ ì´ì „í•˜ë ¤ë˜ ì°¸ì´ì—ˆê¸°ì— ì €ì˜ ê´€ì‹¬ì‚¬ì™€ í–¥í›„ ëª©ì ì— ì˜ ë¶€í•©í–ˆìŠµë‹ˆë‹¤.\nMegazone Cloud: CloudOne Team? Megazone Cloud: êµ­ë‚´ ìµœì´ˆ \u0026amp; ìµœëŒ€ AWS í”„ë¦¬ë¯¸ì–´ ì»¨ì„¤íŒ… íŒŒíŠ¸ë„ˆ, AWS ì»¨ì„¤íŒ…, êµ¬ì¶•, ìš´ì˜ ë° ë¹Œë§ ì„œë¹„ìŠ¤ ì œê³µ. ë©”ê°€ì¡´í´ë¼ìš°ë“œëŠ” 2009ë…„ë¶€í„° í´ë¼ìš°ë“œë¥¼ ì°¨ì„¸ëŒ€ í•µì‹¬ ì‚¬ì—…ìœ¼ë¡œ ì„±ì¥ì‹œí‚¤ë©° â€˜í´ë¼ìš°ë“œ ì´ë…¸ë² ì´í„°(Cloud Innovator)â€™ë¡œì„œ ê³ ê°ë‹˜ë“¤ì˜ í´ë¼ìš°ë“œ ì „í™˜ì˜ ê³¼ì •ë§ˆë‹¤ ìµœì„ ì˜ ì„ íƒì„ í•˜ì‹¤ ìˆ˜ ìˆë„ë¡ ë‹¤ì–‘í•œ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤. - ì¶œì²˜(https://www.megazone.com/)\nspaceone_preview_2 AWS EKSë¥¼ ì´ìš©í•œ Kubernetes í™˜ê²½, ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì³ Composition APIë¥¼ ì´ìš©í•˜ëŠ” ìµœì‹  Vue ê¸°ìˆ  Terraformì„ í†µí•œ IaC ìë™í™”ëœ CI/CD, ë‹¤ì–‘í•œ ë°°í¬ ì „ëµ, ì¸í”„ë¼ ëª¨ë‹ˆí„°ë§ HTTP2ë¥¼ ì´ìš©í•œ gRPC API ì§„í–‰í–ˆë˜ ì—…ë¬´ë“¤ ë§í¬ í˜•ì‹ì´ë¯€ë¡œ ë§í¬ë¥¼ ëˆŒëŸ¬ ì½ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.\n2020.04: Stargate ë¼ëŠ” ê°œë°œ ì¸í”„ë¼ë¥¼ êµ¬ì¶• terraform ì„ í†µí•œ ê°œë°œ ì¸í”„ë¼ êµ¬ì¶• EKS í´ëŸ¬ìŠ¤í„°ì— jenkins, spinnaker, grafana ë“±ë“±ì˜ ê°œë°œ ë„êµ¬ë“¤ì„ ë°°í¬í•¨ ì¢…ì¢… ë°œìƒí•˜ëŠ” ì¥ì•  ìƒí™©ì„ ë©˜í† ë‹˜ê³¼ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…í•¨ 2020.05: ê°œë°œ CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶• Experiment í™˜ê²½ì— ë°°í¬ =\u0026gt; Test, CI =\u0026gt; Development í™˜ê²½ì— ë°°í¬ë¥¼ ìë™í™” Spinnakerì™€ Jenkins, Github Actionì„ ì´ìš©í•œ ìë™í™” íŒŒì´í”„ë¼ì¸ êµ¬ì¶• 2020.06: Argo Projectë“¤ì„ PoC argo cd, argo(workflow), argo-event ë“±ì˜ ë‹¤ì–‘í•œ í”„ë¡œì íŠ¸ì— ëŒ€í•œ PoCë¥¼ ì§„í–‰ 2020.07: spaceone-helm Helm3 Chart ê°œë°œ ê°œë³„ë¡œ ë°°í¬ë˜ê³  ìš´ì˜ë˜ë˜ ìš°ë¦¬ íŒ€ì˜ ì„œë¹„ìŠ¤ì¸ SpaceONEì„ íŒ¨í‚¤ì§€ë¡œ ë°°í¬í•  ìˆ˜ ìˆê²Œí•´ì£¼ëŠ” Helm Chartë¥¼ ê°œë°œ 2020.08: spacectl ì„¤ê³„, ê°œë°œ ì°¸ì—¬ ìš°ë¦¬ íŒ€ì˜ ì„œë¹„ìŠ¤ì¸ SpaceONEì— ëŒ€í•œ API ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” CLI ë„êµ¬ì— ëŒ€í•œ ì„¤ê³„ì™€ ê°œë°œì— ì°¸ì—¬í•¨. ëŠë‚€ ì  ê·¸ ë™ì•ˆ í˜¼ì ê°œë°œ ë° í‰ì†Œ ê´€ì‹¬ë¶„ì•¼ì˜€ë˜ í´ë¼ìš°ë“œ, ì»¨í…Œì´ë„ˆ ë“±ë“±ì˜ ì£¼ì œë¡œ ê³µë¶€í•´ì™”ì—ˆëŠ”ë°, ê³¼ì—° ì´ ë‚´ìš©ë“¤ì´ ì •ë§ ì‹¤ë¬´ì— ë„ì›€ì´ ë  ì§€, ì œê°€ ì˜ ë‚˜ì•„ê°€ê³  ìˆëŠ” ê±´ì§€ í™•ì‹ ì´ ë“¤ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ CloudOneíŒ€ì—ì„œ ë‹¤ì–‘í•œ ê²½í—˜ì„ í•˜ë©´ì„œ \u0026lsquo;ì œê°€ ê³µë¶€í•´ì˜¨ ê¸¸ì´ í‹€ë¦¬ì§€ë§Œì€ ì•Šì•˜êµ¬ë‚˜\u0026rsquo;ë¼ëŠ” ëŠë‚Œì„ ë°›ì„ ìˆ˜ ìˆì—ˆê³ , ë³´ì™„í•´ì•¼í•  ë¶€ë¶„ë“¤ì€ ë³´ì™„í•˜ë©´ì„œ ë¶ˆí™•ì‹¤í•œ ìì„¸ê°€ ì•„ë‹Œ í™•ì‹ ê³¼ ì—´ì •ì„ ê°€ì§„ ìì„¸ë¡œ ì¢€ ë” ëª°ë‘í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤!\në°°ìš°ê³  ëŠë‚€ ë‚´ìš©ì´ ë„ˆë¬´ ë§ì•„ ê¸€ì´ ë‹¤ì†Œ ê¸¸ì–´ì¡ŒìŠµë‹ˆë‹¤. ê¸°ìˆ ì„ ê±°ë¶€ê° ì—†ì´ ì ‘í•˜ë˜ ê¸°ìˆ ì´ ë‹¤ê°€ ì•„ë‹Œ, íŒ€ì›ë“¤ì„ ìœ„í•´ ì†”ì„ ìˆ˜ë²”í•˜ëŠ” ê°œë°œì, íŒ€ì›ë“¤ì˜ ìƒê°ì„ ì½ì–´ì¤„ ìˆ˜ ìˆê³ , ì˜ ì´í•´í•´ì¤„ ìˆ˜ ìˆëŠ” ê°œë°œìê°€ ë˜ê¸° ìœ„í•´ ë…¸ë ¥í•´ì•¼ê² ë‹¨ ìƒê°ì´ ë“­ë‹ˆë‹¤. ì‰½ì§„ ì•Šê² ì§€ë§Œ, ë‚˜ì•„ê°€ê³  ì‹¶ì€ ë°©í–¥ì€ ì •í•´ì§„ ê²ƒ ê°™ì•„ ë‹¤í–‰ì…ë‹ˆë‹¤!\n","date":"2020-09-04T12:46:54+09:00","image":"https://umi0410.github.io/blog/megazone-cloud/index/mzcloud-logo_huaed2850ad2750bd21c0ea378f4b3d958_6575_120x120_fill_box_smart1_3.png","permalink":"https://umi0410.github.io/blog/megazone-cloud/index/","title":"ë©”ê°€ì¡´ í´ë¼ìš°ë“œ ë°ë¸Œì˜µìŠ¤ ì¸í„´ í›„ê¸°"},{"content":"Stargateë¼ëŠ” ê°œë°œ ì¸í”„ë¼ êµ¬ì¶•ê¸° ì €í¬ íŒ€ì˜ ê°œë°œ ì¸í”„ë¼ëŠ” ìœ„ì™€ ê°™ìŠµë‹ˆë‹¤. ë§ˆì¹¨ ì œê°€ ì…ì‚¬í•  ì¯¤ì´ ê¸°ì¡´ì— ì¡´ì¬í•˜ë˜ ì¸í”„ë¼ë¥¼ ìƒˆë¡œìš´ í™˜ê²½ìœ¼ë¡œ ì´ì „í•´ì•¼í•  ì‹œì ì´ì—ˆìŠµë‹ˆë‹¤. ë•ë¶„ì— ì €ëŠ” ì €í¬ ê°œë°œ í™˜ê²½ì„ ì²˜ìŒë¶€í„° êµ¬ì¶•í•˜ê³ , ìš°ë¦¬ì˜ ì„œë¹„ìŠ¤ë¥¼ ë°°í¬í•´ë³´ê³ , ê·¸ í›„ ìš´ì˜í•˜ë©´ì„œ ì—¬ëŸ¬ ê²½í—˜ë“¤ì„ í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.\nTerraformìœ¼ë¡œ ì²˜ìŒ ì ‘í•´ ë³¸ IaC ì¹œêµ¬: IaCê°€ ë­” ì§€ ì•Œì•„? ì¨ë´¤ì–´?\në³¸ì¸: ë­ ì¸í”„ë¼ë¥¼ ì½”ë“œë¡œ ê´€ë¦¬í•œë‹¤ëŠ” ê±´ë°, ë‚˜ë„ ëª°ë¼ ã…‹ã…‹\në³¸ì¸: ì•„ë§ˆ ë„ˆë¬´ ê³ ê¸‰ ê¸°ìˆ ì´ë¼ ëŒ€í•™ ì¡¸ì—…í•  ë•Œ ê¹Œì§„ ëª» ì¨ë³¼ ë“¯?\nìœ„ì˜ ëŒ€í™”ëŠ” ì œê°€ ì…ì‚¬í•˜ê¸° ì•½ ì¼ì£¼ì¼ ì „ì— ë‚˜ëˆ´ë˜ ëŒ€í™”ì¸ë°, ì…ì‚¬ í›„ì—ëŠ” ì–´ëŠ ë§ IaCì™€ ê½¤ë‚˜ ì¹œê·¼í•´ì§„ ê²ƒ ê°™ì•„ ìœ ë¨¸ì‚¼ì•„ ìœ ë¨¸ë¡œ ê°€ì ¸ì™€ë´¤ìŠµë‹ˆë‹¤. ë©”ê°€ì¡´ í´ë¼ìš°ë“œì˜ í´ë¼ìš°ë“œ ì›íŒ€ì—ì„œ ì¼í•˜ê¸° ì „ê¹Œì§€ëŠ” IaCëŠ” ì €ì™€ëŠ” ê±°ë¦¬ê°€ ë¨¼ í† í”½ì´ì—ˆê³ , Kubernetes ë˜í•œ minikubeë¡œ ëª‡ ê°€ì§€ Objectë“¤ì„ ë°°í¬í•´ë³¸ ê²ƒì´ ë‹¤ì˜€ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ, ì €ëŠ” ì €í¬ íŒ€ì—ì„œ ê·¼ë¬´í•˜ê²Œ ë˜ë©´ì„œ terraformì„ í†µí•´ ìœ„ì˜ ì°¨íŠ¸ì— ê·¸ë ¤ì§„ ëª¨ë“  ì¸í”„ë¼ë¥¼ êµ¬ì¶•í•˜ê³  íŒŒì´í”„ë¼ì¸ì„ êµ¬ì¶•í•˜ê²Œ ë©ë‹ˆë‹¤.\nterraformì„ ì‚¬ìš©í•˜ë©° ëŠê¼ˆë˜ ì ì€ \u0026lsquo;ì¥ì ë§Œ ì¡´ì¬í•˜ëŠ” ê¸°ìˆ ì€ ë“œë¬¼ ê²ƒì´ë‹¤\u0026rsquo;ë¼ëŠ” ì ì…ë‹ˆë‹¤. ë¶„ëª… ëŒ€ë¶€ë¶„ì€ ì¥ì ì´ ìˆìœ¼ë©´ ê·¸ì— ë”°ë¥¸ ë‹¨ì ì´ ì¡´ì¬í•  ê²ƒì´ê³ , ê°œì¸ì ìœ¼ë¡œëŠ” í…Œë¼í¼ë„ ì¥ë‹¨ì ì´ ê³µì¡´í•˜ê³ ìˆë‹¤ëŠ” ëŠë‚Œì„ ë°›ì•˜ìŠµë‹ˆë‹¤. ì €ì˜ ì£¼ê´€ì ì¸ ëŠë‚Œì— ë”°ë¥¸ ê°€ì¥ í° ì¥ì ê³¼ ë‹¨ì ì„ ëª‡ ê°œë§Œ ì„¤ëª…í•´ë³´ê² ìŠµë‹ˆë‹¤.\nTerraform ë‹¨ì  ìš°ì„  ë‹¨ì ë¶€í„°. \u0026ldquo;ì‚¬ì†Œí•œ ì¸í”„ë¼ ë³€ê²½ë„ ì½”ë“œì— ë°˜ì˜í•˜ë ¤ë©´ ë¬¸ì„œë¥¼ ì°¾ì•„ë´ì•¼í•˜ê³ , plan ë‚´ìš©ì„ ê²€í† í•´ì•¼í•œë‹¤\u0026rdquo;.\nì €í¬ëŠ” í‰ì†Œì—ëŠ” EKSì˜ ë¡œê·¸ë¥¼ ì¼œë†“ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê·¸ëŸ°ë° ì–¸ì  ê°€ EKS ë¡œê·¸ë¥¼ CloudWatchë¥¼ ì´ìš©í•´ ë¶„ì„í•´ì•¼í•œ ì ì´ ìˆëŠ”ë°, AWS ì½˜ì†”ì—ì„œ ë°”ë¡œ ëˆˆ ì•ì— ë¡œê·¸ ì„¤ì • ì¹¸ì´ ìˆì—ˆìŒì—ë„ EKS ë¡œê·¸ë¥¼ ì„¤ì •í•˜ëŠ” terraform Docsë¥¼ ì°¾ì•„ë³¸ ë’¤ planì„ ë¶„ì„í•œ ë’¤ apply í–ˆì–´ì•¼í•©ë‹ˆë‹¤. ë¬¼ë¡  ì•„ë§ˆë„ ë¡œê·¸ ì„¤ì • ì¯¤ì´ì•¼ ì ê¹ ì½˜ì†”ë¡œ ì„¤ì •í–ˆë‹¤ê°€ ì½˜ì†”ë¡œ í•´ì œí•˜ë©´ ê·¸ í•œ ë²ˆì¯¤ì€ ë¬¸ì œê°€ ì—†ì—ˆê² ì§€ë§Œ, ê·¸ëŸ° ì‹ìœ¼ë¡œ ì´ë²ˆ í•œ ë²ˆë§Œ, ì´ê²ƒì¯¤ì´ì•¼ í•˜ë©´ì„œ ì½”ë“œê°€ ì•„ë‹Œ ë§¤ë‰´ì–¼ë¡œ ì§ì ‘ ì¸í”„ë¼ í˜•ìƒì„ ì œì–´í•˜ëŠ” ê²½í—˜ì´ ìŒ“ì´ê²Œë˜ë©´ í˜•ìƒì´ ê¹¨ì ¸ì„œ ë‹¤ì‹œ í˜•ìƒì„ ë§ì¶”ê¸° í˜ë“¤ìˆ˜ë„ ìˆê³ , ì• ì´ˆì— ê·¸ëŸ° ìˆ˜ì‘ì—…ì´ ë§ì´ ë“¤ì–´ê°€ì•¼í•˜ëŠ” ê²½ìš°ê°€ ìˆë‹¤ë©´ ì˜¤íˆë ¤ IaCë¥¼ ì´ìš©í•  í•„ìš”ê°€ ì—†ë‹¤ê³  ìƒê°í–ˆê¸° ë•Œë¬¸ì— ìµœëŒ€í•œ ì¸í”„ë¼ëŠ” terraform codeë¡œë§Œ ì‘ì—…í•œë‹¤ëŠ” ì €ì˜ ì›ì¹™ì„ ì§€í‚¤ê¸° ìœ„í•¨ì´ì—ˆìŠµë‹ˆë‹¤.\nì¦‰ ìë™í™”ë³´ë‹¤ëŠ” ìˆ˜ì‘ì—…ì´ í¸í•œ ê²½ìš°ëŠ” êµ³ì´ IaCë¼ëŠ” ì»¨ì…‰ì„ ì´ìš©í•˜ëŠ” ê²ƒì´ ë” ë¶ˆí¸í•œ ê²½ìš°ë„ ì¡´ì¬í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤.\nTerraform ì¥ì  \u0026ldquo;ë‚´ê°€ ì‚¬ìš©í•˜ê³  ìˆëŠ” ì¸í”„ë¼ ì „ì²´ë¥¼ í•œ ëˆˆì— ë³´ê¸° ì‰½ë‹¤\u0026rdquo;\në¬¼ë¡  í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ í•˜ë‚˜ì— ëŒ€í•œ ì •ë³´ë¥¼ ë³´ê³ ì‹¶ìœ¼ë©´, ì›¹ ì½˜ì†”ì— ë“¤ì–´ê°€ì„œ í™•ì¸í•˜ëŠ” ê²ƒì´ í¸í•˜ê² ì§€ë§Œ, ë‚´ê°€ ì´ìš©í•˜ê³  ìˆëŠ” AWSë‚´ì˜ ëª¨ë“  í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ì— ëŒ€í•œ ì •ë³´ë‚˜ ì„¤ì •ì„ ë³´ê¸°ì—ëŠ” terraform ì½”ë“œë‚˜ output, state ë“±ì´ ë” ì•Œì•„ë³´ê¸° í¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\u0026ldquo;í˜¹ì‹œ ì¥ì• ê°€ ìƒê¸´ ê²½ìš° ê·¸ ì›ì¸ì„ ì¶”ì í•˜ê¸° ì‰½ë‹¤.\u0026rdquo;\nìˆ˜ì‘ì—…ìœ¼ë¡œ í´ë¼ìš°ë“œ ì¸í”„ë¼ë¥¼ ê´€ë¦¬í•˜ëŠ” ê²½ìš°ì— ìì‹ ì´ ëª¨ë¥´ëŠ” ì–´ë–¤ ë³€ë™ì‚¬í•­ì´ ìˆê³ , ê·¸ ë³€ë™ì‚¬í•­ì´ ì–´ë–¤ ë²„ê·¸ë¥¼ ì•¼ê¸°í•˜ê³  ìˆë‹¤ë©´, ìˆ˜ì‘ì—…ìœ¼ë¡œ ì‘ì—…ì„ ì§„í–‰í•˜ëŠ” ê²½ìš°ì—ëŠ” ê·¸ ë³€ë™ì‚¬í•­ì„ ì•Œì•„ì±„ê³  íŠ¸ëŸ¬ë¸”ìŠˆíŒ…í•˜ê¸° ì‰½ì§€ ì•Šì„ ê²ƒì…ë‹ˆë‹¤.\ní•˜ì§€ë§Œ í…Œë¼í¼ ì½”ë“œë¥¼ í†µí•´ ì¸í”„ë¼ë¥¼ ê´€ë¦¬í•˜ë©´ ë³€ë™ì‚¬í•­ì„ í…Œë¼í¼ì´ ì•Œì•„ì„œ ì¡ì•„ì£¼ê³ , í˜¹ì€ ì½”ë“œì— ëŒ€í•œ ì»¤ë°‹ ë‚´ì—­ ë“±ì„ í†µí•´ ë³€ë™ ì‚¬í•­ì„ ì²´í¬í•´ ë³¼ ìˆ˜ë„ ìˆì„ ê²ƒì…ë‹ˆë‹¤. ë”°ë¼ì„œ ê·¸ ë³€ë™ì‚¬í•­ì— ë§ëŠ” íŠ¸ëŸ¬ë¸” ìŠˆíŒ…ì„ í•˜ê¸° ì‰¬ìš¸ ê²ƒ ì…ë‹ˆë‹¤.\nê°œë°œ ê´€ë ¨ ë‹¤ì–‘í•œ ì„œë¹„ìŠ¤ ë°°í¬ í…Œë¼í¼ìœ¼ë¡œ ì¸í”„ë¼ë¥¼ êµ¬ì¶•í•œ ë’¤ì—ëŠ” ìœ„ì˜ ì°¨íŠ¸ì—ì„œ ì˜¤ë¥¸ìª½ì— ì‘ê²Œ Stargate ë¼ëŠ” ê³³ì— ì íŒ ì„œë¹„ìŠ¤ë“¤ì„ ë°°í¬í–ˆìŠµë‹ˆë‹¤. ì´ ë¶€ë¶„ì— ëŒ€í•´ì„œëŠ” ë„ˆë¬´ë‚˜ë„ í•˜ê³ ì‹¶ì€ ì–˜ê¸°ê°€ ë§ì§€ë§Œ, ì§€ë£¨í•´ì§ˆ ìˆ˜ ìˆìœ¼ë‹ˆ ê·¸ ì¤‘ ê¸°ì–µì— ë§ì´ ë‚¨ê±°ë‚˜ ì• ì°©ì´ ê°€ëŠ” ì„œë¹„ìŠ¤ë“¤ì— ëŒ€í•œ ë¦¬ë·°ë¥¼ ê°„ë‹¨íˆ ì ì–´ë³´ê² ìŠµë‹ˆë‹¤.\nNginx Ingress Controller ë¡œì»¬ì—ì„œ minikubeë¡œë§Œ ê°œë°œí•˜ë‹¤ê°€ ì²˜ìŒìœ¼ë¡œ Ingressë¥¼ ì‚¬ìš©í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. helmì„ ì´ìš©í•œ ê²Œ ì•„ë‹ˆë¼, helmìœ¼ë¡œ ë§Œë“¤ì–´ì§„ manifestë¥¼ ìˆ˜ë™ìœ¼ë¡œ í•˜ë‚˜í•˜ë‚˜ ì„¤ì •í•´ì„œ ì„¤ì¹˜í•˜ê³  ê´€ë¦¬í–ˆìŠµë‹ˆë‹¤. ì„¤ì •ì´ ê½¤ë‚˜ ë³µì¡í–ˆì—ˆê¸°ì— ì„¤ì •ì„ ë§ì´ ë³€ê²½í•˜ëŠ” ê²½ìš° helmìœ¼ë¡œ ì„¤ì¹˜í•˜ëŠ” ê±´ ì–´ë–¨ê¹Œì‹¶ìŠµë‹ˆë‹¤\u0026hellip; ì¼í•˜ë©´ì„œ Nginxë¡œ L7 ë¡œë“œë°¸ëŸ°ì‹± ë¿ë§Œ ì•„ë‹ˆë¼ L4 ë¡œë“œë°¸ëŸ°ì‹±ë„ ëª‡ ë²ˆ ë‹¤ë£° ì¼ì´ ìˆì—ˆê³ , ì—¬ëŸ¬ Nginx Ingress Controllerì„ ë°°í¬í•  ì¼ë„ ìˆì—ˆê³ , gRPC í†µì‹ ì„ ìœ„í•œ ì„¤ì •ì„ í•´ì•¼í•  ì¼ë„ ìˆì—ˆëŠ”ë°, ì ì  ìˆ˜ì‘ì—…ìœ¼ë¡œ í•˜ë‹¤ë³´ë‹ˆ ì„¤ì •ì´ ë„ˆë¬´ ë³µì¡í•´ì ¸ì„œ í—·ê°ˆë ¸ë˜ ì ì´ ìˆìŠµë‹ˆë‹¤. ë­”ê°€ ë‹¨ì ë§Œ ì ì€ ê²ƒ ê°™ì€ë°, K8sì˜ Ingress Controllerë¡œì„œ ì„±ëŠ¥ì ì¸ ë¶€ë¶„ì€ ì œê°€ ì˜ ëª¨ë¥´ê² ì§€ë§Œ, í¬ê²Œ ë¶ˆí¸í•¨ ì—†ì´ ì˜ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. ALB Ingress Controller ì„œë¹„ìŠ¤ì— ëŒ€í•´ ì§ì ‘ L7 ë¡œë“œë°¸ëŸ°ì‹±ì„ ìˆ˜í–‰í•  ê²½ìš° ì´ìš©í•©ë‹ˆë‹¤. í—·ê°ˆë ¸ë˜ ì ì€ ë³´í†µì€ Nginx Ingress ControllerëŠ” ì‚¬ì‹¤ IngressëŠ” ì„¤ì •ì´ê³ , ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì‹¤ì œë¡œ ë¡œë“œë°¸ëŸ°ì‹±ì„ ìˆ˜í–‰í•˜ëŠ”ë°, ALBëŠ” ALB Ingress Controllerê°€ Ingressë¥¼ í†µí•´ ALBë¥¼ ë§Œë“¤ê³  ì‹¤ì œ ë¡œë“œë°¸ëŸ°ì‹±ì€ ALB Ingress Controllerê°€ ì•„ë‹ˆë¼ ALBê°€ í•œë‹¤ëŠ” ì ì´ì—ˆìŠµë‹ˆë‹¤. ì„¤ì •ì— ë”°ë¼ ë‹¤ë¥´ì§€ë§Œ ê¸°ë³¸ì ìœ¼ë¡œëŠ” ë…¸ì¶œì‹œí‚¤ê³ ì í•˜ëŠ” ì„œë¹„ìŠ¤ëŠ” NodePortê¸‰ ì´ìƒìœ¼ë¡œ ì„œë¹„ìŠ¤ê°€ ì—´ë ¤ìˆì–´ì•¼í•˜ëŠ”ë°, ì‹¤ìˆ˜ë¡œ ClusterIPë¡œ ë…¸ì¶œì‹œì¼œ ALBê°€ ì„œë¹„ìŠ¤ë¥¼ ì œëŒ€ë¡œ ì°¾ì§€ ëª»í•œ ì ì´ ì¢…ì¢… ìˆì—ˆìŠµë‹ˆë‹¤. ì£¼ì˜..! Cert Manager ìë™ìœ¼ë¡œ certë¥¼ ë°œê¸‰í•´ì£¼ê³  ê°±ì‹ í•´ì£¼ëŠ” ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. Let\u0026rsquo;s Encryptë¥¼ ì´ìš©í–ˆê³  ë¬´ë£Œì…ë‹ˆë‹¤. ì •ë§ ì •ë§ í¸ë¦¬í–ˆìŠµë‹ˆë‹¤! DNS, HTTP Challenge, TLSì— ëŒ€í•´ ë§ì´ ë°°ìš¸ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. TLS í†µì‹  ê³¼ì •ì€ ê³µë¶€í•´ë„í•´ë„ ì •í™•í•œ ìˆœì„œëŠ” ê¹Œë¨¹ê²Œ ë¼ì„œ\u0026hellip; ë‹¤ì‹œ ê³µë¶€í•´ë´ì•¼ê² ìŠµë‹ˆë‹¤. Jenkins í¸í•œë°, ê´€ë¦¬í•˜ê¸° ê·€ì°®ì„ ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ê²°ì •ì ìœ¼ë¡œ ì½”ë“œë¡œ ê´€ë¦¬í•  ìˆ˜ë„ ì—†ëŠ”ë°, UIë„ ê·¸ë ‡ê²Œ ì§ê´€ì ì¸ì§€ëŠ” ì˜ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤. Spinnaker ì •ë§ í¸ë¦¬í•©ë‹ˆë‹¤. Jenkins test ê²°ê³¼ë¥¼ CDì— ì´ìš©í•  ìˆ˜ë„ ìˆê³ , í¸ë¦¬í•˜ê³  ë‹¤ì–‘í•œ ë¬¸ë²•, íŒŒì´í”„ë¼ì¸ ì¢…ë¥˜, ì§ê´€ì ì¸ UI/UX. ì‚¬ì‹¤ Argoë¥¼ ë„ì…í•˜ê³  ì‹¶ì—ˆì§€ë§Œ, ArgoëŠ” ì•½ê°„ ê°€ë²¼ìš´ ì¿ ë²„ í™˜ê²½ì— ëŒ€í•œ ë°°í¬ìš© ê°™ì€ ëŠë‚Œ, IaCëŠ” ì ê·¹ ë„ì…ë˜ì—ˆìœ¼ë‚˜ í˜„ì‹¤ì— ë„ì…ì€ ì‰½ì§€ ì•Šì€ ê¸°ìˆ ì  ì´ìƒí–¥ ê°™ì€ ëŠë‚Œì´ ì»¸ê³ , í˜„ì‹¤ì ìœ¼ë¡œëŠ” ì¢€ ë” ì•ˆì •ì ì¸ Spinnakerë¥¼ ìœ ì§€í•˜ê²Œ ëìŠµë‹ˆë‹¤. ì¢€ ëŠë¦¬ë‹¤ê³  ìƒê°í–ˆëŠ”ë°, ì´ ê¸€ì„ ì“°ë©´ì„œ ìƒê°í•´ë³´ë‹ˆ ê°œë°œì—ì„œëŠ” K8s Deploymentì˜ Grace Period ë•Œë¬¸ì¸ ê²ƒ ê°™ì•„ ê·¸ê±¸ ì¢€ ì¤„ì—¬ë³¼ ê»„ ì‹¶ìŠµë‹ˆë‹¤. ì¦‰ ë‹¤ì‹œ ìƒê°í•´ë³´ë‹ˆ ë³„ë¡œ ëŠë¦¬ì§€ ì•Šì€ ë“¯í•©ë‹ˆë‹¤. ë°°í¬ ìì²´ëŠ” ì•ˆì •ì ì´ê³  ì¢‹ì€ë°, ì„¤ì •í•  ë•Œ ë²„ê·¸ê°€ ì¢…ì¢… ìˆìŠµë‹ˆë‹¤. ë²„ê·¸ì¸ì§€ ì œ ì‹¤ìˆ˜ì¸ì§€ëŠ” ëª¨ë¥´ê² ì§€ë§Œ Pipeline stage ì—ì„œ Bakeë¼ëŠ” ëª¨ë“œê°€ \u0026ldquo;ìš°ì™€ ì‹ ë°•í•˜ë‹¤!\u0026rdquo; ë¼ê³  ìƒê°í–ˆì§€ë§Œ, ì„¤ì •ì´ ì œëŒ€ë¡œ ë˜ì§€ ì•Šê±°ë‚˜, OAuth login ì‹¤íŒ¨ì— ëŒ€í•œ ì²˜ë¦¬, Artifact ê²½ë¡œ ì„¤ì •ì´ ë„ˆë¬´ ë²ˆê±°ë¡œìš´ ì  ë“±ì˜ ë‹¨ì ì´ ìˆì—ˆìŠµë‹ˆë‹¤. Keycloak ìš°ë¦¬ì˜ ê°œë°œíˆ´ë“¤ì— ëŒ€í•œ ì¸ì¦ì„ ì‚¬ë‚´ ê³„ì •ìœ¼ë¡œ ì—°ë™ì‹œì¼œì£¼ëŠ” Single Sign On ê¸°ëŠ¥ì„ ì§€ì›í–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ íŒ€ì›ì€ ê° ì„œë¹„ìŠ¤ì— ë³„ë„ì˜ ê°€ì… ê³¼ì • ì—†ì´, ì•± ë ˆë²¨ì—ì„œ ë”°ë¡œ ê¶Œí•œ ë¶€ì—¬ê°€ í•„ìš”í•œ ê²ƒì´ ì•„ë‹ˆë¼ë©´ ì‚¬ë‚´ ê³„ì •ìœ¼ë¡œ ë°”ë¡œ ì´ìš©ì´ ê°€ëŠ¥í–ˆìŠµë‹ˆë‹¤. ë¬¸ì„œê°€ ì œëŒ€ë¡œ ì •ë¦¬ëœ ê²Œ ë‹¤ì†Œ ë¶€ì¡±í•œ ëŠë‚Œì´ì—ˆì–´ì„œ ì„¸ë°€í•œ ì„¤ì •ì´ë‚˜ ì •í™•í•œ ì‘ë™ì›ë¦¬ë¥¼ íŒŒì•…í•˜ê¸°ëŠ” ì‰½ì§€ ì•Šì•˜ë˜ ì ì´ ì¡°ê¸ˆ ì•„ì‰½ìŠµë‹ˆë‹¤. ì¸í”„ë¼ êµ¬ì¶•ì— ëŒ€í•œ ì •ë¦¬ ë‚´ìš©ì´ ë„ˆë¬´ ê¸¸ì–´ì§€ë©´ ì½ê¸° í˜ë“¤ ê²ƒ ê°™ì•„ ìµœëŒ€í•œ ëŠë‚€ ì  ìœ„ì£¼ë¡œ ê°„ë‹¨íˆ ì •ë¦¬í•´ë³´ë ¤ê³  ë…¸ë ¥í•´ë³´ì•˜ìŠµë‹ˆë‹¤. ì¸í„´ìœ¼ë¡œ ì¼ì„ í•˜ê¸° ì „ì— ê°€ë²¼ìš´ ë§ˆìŒ ì† ëª©í‘œê°€ í•˜ë‚˜ ìˆì—ˆìŠµë‹ˆë‹¤.\n\u0026lsquo;ì–´ë–¤ ê±¸ ì–´ëŠì •ë„ ì‚¬ìš©í•´ë³´ë©´ ê·¸ê²ƒì— ëŒ€í•œ ì£¼ê´€ì ì¸ í‰ê°€ë¥¼ ë‚´ë¦´ ìˆ˜ ìˆëŠ” ì‚¬ëŒì´ ë˜ê³ ì‹¶ë‹¤.\u0026rsquo;\nëˆ„êµ°ê°€ \u0026ldquo;ë„ì»¤ê°€ ì„¤ì¹˜í•˜ê¸° ì •ë§ ì‰½ë”ë¼êµ¬ìš”.\u0026rdquo;, \u0026ldquo;minikube ì¨ë³´ë‹ˆ ì •ë§ í¸ë¦¬í•˜ë”ë¼êµ¬ìš”.\u0026rdquo;, \u0026ldquo;Jenkins ë³´ë‹¤ëŠ” travisê°€ í¸ë¦¬ë”ë¼êµ¬ìš”.(í˜¹ì€ ê·¸ ë°˜ëŒ€)\u0026rdquo; ì´ëŸ° ì–˜ê¸°ê°€ ë‚˜ì™€ë„ ê³¼ê±°ì—ëŠ” ê³µê°í•  ìˆ˜ë„, ì œ ì£¼ê´€ì ì¸ í‰ê°€ë¥¼ ë‚´ë¦´ ìˆ˜ë„ ì—†ì—ˆìŠµë‹ˆë‹¤. ì €ì˜ ê²½í—˜ìœ¼ë¡œ êµ¬ì„±ëœ ëª¨ì§‘ë‹¨ì´ ì—†ì—ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ì €í¬ í´ë¼ìš°ë“œ ì› íŒ€ì—ì„œ ê·¼ë¬´í•˜ë©´ì„œ ì–´ë–»ê²Œ ë³´ë©´ ê¹Šì´ëŠ” ë‹¤ì†Œ ì–•ì•˜ì„ ì§€ ëª°ë¼ë„ ì •ë§ ë‹¤ì–‘í•œ ì„œë¹„ìŠ¤ë¥¼ ì ‘í•˜ê³  ë‹¤ì±„ë¡œìš´ ê²½í—˜ì„ í•  ìˆ˜ ìˆì—ˆë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤! ë•ë¶„ì— ì´ì œëŠ” ì–´ë–¤ ì„œë¹„ìŠ¤ë¥¼ ì ‘í•˜ë“ , ìƒˆë¡œìš´ ì–¸ì–´ë¥¼ ì ‘í•˜ëŠ” ì €ë§Œì˜ ëŠë‚Œì„ ê°€ì§ˆ ìˆ˜ ìˆê³ , ì˜ê²¬ì„ ë§í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤!\n","date":"2020-09-04T12:46:54+09:00","image":"https://umi0410.github.io/blog/megazone-cloud/stargate-infra/dev-architecture.svg","permalink":"https://umi0410.github.io/blog/megazone-cloud/stargate-infra/","title":"1. Stargateë¼ëŠ” ì¸í”„ë¼ êµ¬ì¶•ê¸°"},{"content":"Github Actionì„ ì‚¬ìš©í•˜ê²Œ ëœ ë°°ê²½ ì €í¬ íŒ€ì€ ì›ë˜ CIìš©ìœ¼ë¡œ Jenkinsë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤ë§Œ íŒ€ì´ ê°œë°œ ì¤‘ì´ë˜ ì„œë¹„ìŠ¤ê°€ ì˜¤í”ˆì†ŒìŠ¤ê°€ ëª©í‘œì¸ í”„ë¡œì íŠ¸ì˜€ê³ , Github Actionì´ ë¹ ë¥´ê²Œ ë°œì „í•´ë‚˜ê°€ë©´ì„œ ë¹„ìš©ë„ ë¬´ë£Œê°€ ë˜ì—ˆê³ , ì¢‹ì€ Actionë“¤ì´ ë§ì´ ìƒê²¨ë‚˜ê³  ìˆì—ˆê¸°ì— ì–´ëŠ ì •ë„ í”„ë¡œì íŠ¸ êµ¬ì¡°ê°€ ì¡íŒ ë’¤ì—ëŠ” Githubì˜ Public Repositoryë¡œ í”„ë¡œì íŠ¸ë¥¼ ê´€ë¦¬í•˜ê³  Github Actionì„ CI ë„êµ¬ë¡œ ì±„íƒí•˜ê²Œë˜ì—ˆìŠµë‹ˆë‹¤. Integration Testë¥¼ ì œì™¸í•œ ëª¨ë“  ë¹Œë“œ ë° ì¼ë¶€ ë°°í¬ë¥¼ Github Actionì„ ì´ìš©í•˜ê²Œë˜ì—ˆê³ , ëŒ€ë¶€ë¶„ì˜ ë°°í¬ì—ëŠ” ì‚¬ìš©í•˜ë˜ëŒ€ë¡œ Spinnakerì„ ì´ìš©í–ˆìŠµë‹ˆë‹¤.\nGithub Action vs Jenkins ì´ ë¶€ë¶„ ì—­ì‹œ ëŠë‚€ ì  ìœ„ì£¼ë¡œ ìš”ì•½í•´ë³´ê² ìŠµë‹ˆë‹¤.\nGithub Action Jenkins ë‚´ê°€ ì„œë²„ë¥¼ ê´€ë¦¬í•  í•„ìš”ê°€ ì—†ë‹¤. ë‚´ê°€ ì§ì ‘ masterì„ ë„ìš°ê³ , slaveë¥¼ ë„ì›Œìš°ê³ , ê´€ë¦¬í•´ì¤˜ì•¼í•œë‹¤. VMì´ ë°°ì¹˜ë˜ì–´ ì œê³µë˜ëŠ” ë°ì— ì¢€ ì‹œê°„ì´ ë“ ë‹¤. ë‚´ ì»¤ìŠ¤í…€ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•  ìˆ˜ê°€ ì—†ë‹¤ë³´ë‹ˆ ë°˜ë³µë˜ëŠ” íŒ¨í‚¤ì§€ ì„¤ì¹˜ë‚˜ í™˜ê²½ ì„¤ì •ì„ ë§¤ë²ˆ í•´ì•¼í•´ì„œ ì¢€ ëŠë¦¬ë‹¤. ë‚´ê°€ í•„ìš”í•œ Pluginì„ ì„¤ì¹˜í•´ë†“ê±°ë‚˜ ì„¤ì •ì„ ì…ë ¥í•´ ë†“ìœ¼ë©´ ë§¤ë²ˆ ë¹Œë“œí•  ë•Œ ë”°ë¡œ ì œê³µí•  í•„ìš” ì—†ë‹¤. Codeë¡œ ê´€ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤! ì²˜ìŒì—” ì¡°ê¸ˆ ì–´ë ¤ìš¸ ìˆ˜ ìˆì§€ë§Œ, ì•Œê³  ë‚˜ë©´ ì“°ê¸° ë„ˆë¬´ ì‰½ë‹¤. ì²˜ìŒ ì ‘í•œ ì‚¬ëŒì´ ì‚¬ìš©í•˜ê¸°ì—ëŠ” Github Actionë³´ë‹¤ í¸ë¦¬í•  ìˆ˜ ìˆì§€ë§Œ, ê·¸ë ‡ë‹¤ê³  í›Œë¥­í•œ UI/UXëŠ” ì•„ë‹Œ ë“¯ í•˜ë‹¤. ìš”ì¦˜ í•«í•˜ê³ , ë¹ ë¥´ê²Œ ë°œì „ ì¤‘ì´ë‹¤. êµ¬ì‹ì´ë‹¤. ë¹„ìš©ì´ ì €ë ´í•˜ê²Œ í’€ë¦¬ê³  ìˆê³ (í¼ë¸”ë¦­ì˜ ê²½ìš° ì•„ë§ˆ ë¬´ì¡°ê±´ ë¬´ì œí•œ ê³µì§œ), ì›ë˜ ì§€ì›í•˜ì§€ ì•Šë˜ ë§¤ë‰´ì–¼ íŠ¸ë¦¬ê±°ê°€ 2020.07ë¶€í„° ì œê³µë˜ê¸° ì‹œì‘í–ˆë‹¤ëŠ” ì , ëˆ„êµ¬ë“  ì˜¤í”ˆì†ŒìŠ¤ë¡œ Github Actionì—ì„œ ë‚¨ë“¤ì´ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” action ì„ ë§Œë“¤ ìˆ˜ ìˆë‹¤ëŠ” ì ë“±ì„ ë³´ê³  Github Actionì´ ë¹ ë¥´ê²Œ ë°œì „ ì¤‘ì´ë¼ëŠ” ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤.\nê·¸ë˜ì„œ ì–´ë–¤ CI/CDë¥¼ ìë™í™”í•˜ì˜€ë‚˜ìš”? ci-cd-pipeline.png ì„¸ë¡œë¡œ ê¸¸ì–´ì„œ ì¢€ ë³´ê¸° ë¶ˆí¸í•˜ì‹¤ ìˆ˜ë„ ìˆëŠ”ë°, ìœ„ì˜ ì°¨íŠ¸ê°€ ì €í¬ì˜ ê¹ƒí—™ì•¡ì…˜ì— ëŒ€í•œ ì°¨íŠ¸ì…ë‹ˆë‹¤. ë ˆí¬ì§€í† ë¦¬ë§ˆë‹¤ ì¡°ê¸ˆì”© ë‹¤ë¥¸ ë¶€ë¶„ì´ ìˆê³ , í”„ë¡ íŠ¸ì—”ë“œì˜ ê²½ìš° íŒŒì´í”„ë¼ì¸ì´ ë‹¤ì–‘í–ˆëŠ”ë°, ìš°ì„  ë°±ì—”ë“œì˜ ê¹ƒí—™ì•¡ì…˜ ë° CI/CD ì§„í–‰ ë°©ì‹ì— ëŒ€í•´ ìš”ì•½í•´ë³´ê² ìŠµë‹ˆë‹¤. (Chartë¥¼ ì‘ì„±í•œ ì§€ê°€ ì¢€ ë¼ì„œ ì„¤ëª…ê³¼ ì¡°ê¸ˆ ë‹¤ë¥¸ ë¶€ë¶„ì´ ìˆì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.)\nê°œë°œ ìŠ¤í”„ë¦°íŠ¸ ì§„í–‰ ì‹œì—ëŠ” ì•„ë˜ì™€ ê°™ì´ ì§„í–‰ë˜ì—ˆìŠµë‹ˆë‹¤. (\u0026lt;ìƒí™© ì„¤ëª…\u0026gt; =\u0026gt; \u0026lt;Github Action ìˆ˜í–‰ ë‚´ìš©\u0026gt; í˜•ì‹ìœ¼ë¡œ ë‚˜í–ˆìŠµë‹ˆë‹¤.)\nê°œë³„ Fork í›„ Master Branchì— Pull Request =\u0026gt; lint, basic unit test ì§„í–‰. í†µê³¼ëœ PRë§Œ Mergeì—´ Masterì— Merge í˜¹ì€ Commitì´ Pushë¨ =\u0026gt; CI Actionì´ ì‹¤í–‰ë©ë‹ˆë‹¤. ê°œë°œìš© docker registry ì— ì—…ë¡œë“œ í•´ë‹¹ registryì— ì—…ë¡œë“œ ëœ ê²ƒì„ ê°ì§€í•˜ê³  Spinnakerê°€ Experiment í™˜ê²½ì— ë°°í¬ Experimental í™˜ê²½ì„ ì´ìš©í•´ Jenkinsê°€ Integration Testë¥¼ ì§„í–‰ Integration Test ì„±ê³µ ì‹œì— Dev í™˜ê²½ì— ë°°í¬. ì´í›„ ìŠ¤í”„ë¦°íŠ¸ ë§‰ë°”ì§€ QA ê¸°ê°„ì—ëŠ” Experiment, Dev í™˜ê²½ì´ ì£¼ë¡œ QA í™˜ê²½ìœ¼ë¡œ ì‚¬ìš©ë˜ì—ˆê³ , íŒŒì´í”„ë¼ì¸ì€ ë‹¤ìŒê³¼ ê°™ì•˜ìŠµë‹ˆë‹¤.\nê²€ì¦ì´ ì–´ëŠ ì •ë„ ëë‚œ ì»¤ë°‹ì— ëŒ€í•´ Git Tagë¥¼ {{VERSION}}-rc{{RC_NUMBER}} í˜•íƒœë¡œ ë‹¬ì•„ í‘¸ì‹œ - Github Releaseê°€ ìƒê¹€ =\u0026gt; ë„ì»¤ ì´ë¯¸ì§€ ë¹Œë“œ í›„ Production Docker Registryì— ì´ë¯¸ì§€ ì—…ë¡œë“œ =\u0026gt; tagê°€ ë‹¬ë¦° ì»¤ë°‹ì„ ê¸°ì ìœ¼ë¡œ ìë™ìœ¼ë¡œ ë²„ì „ ëª…ì˜ ë¸Œëœì¹˜ë¥¼ ë§Œë“¦. Production Docker Registryì˜ ì—…ë¡œë“œë¥¼ ê°ì§€í•˜ê³  Devì—ì„œ ì†ìˆ˜ QA ì§„í–‰ ë¬¸ì œê°€ ìˆì„ ê²½ìš° rc numberë¥¼ ì˜¬ë ¤ì„œ ë‹¤ì‹œ íƒœê·¸ë¥¼ ë‹¬ê³  ì—…ë¡œë“œ í›„ ì¬ì°¨ QA ë¬¸ì œê°€ ì—†ì„ ê²½ìš° í•´ë‹¹ íƒœê·¸ë¥¼ ë°”íƒ•ìœ¼ë¡œ rcë¥¼ ì§€ìš°ê³  ì‹¤ì œ ë²„ì „ìœ¼ë¡œì„œ íƒœê·¸ë¥¼ ë‹¬ì•„ í‘¸ì‹œ =\u0026gt; ë‹¤ì‹œ ì—…ë¡œë“œ Productionì€ ë§¤ë‰´ì–¼ ë°°í¬. Github Actionì„ ë‹¤ë¤„ë³´ë©´ì„œ ëŠë‚€ ì  ì²˜ìŒì—ëŠ” Github Actionì— ê·¸ë ‡ê²Œ ë§Œì¡±ì„ í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì´ˆê¸°ì—ëŠ” Manual Triggerê°€ ì§€ì›ë˜ì§€ ì•Šì•˜ë˜ ë°ë‹¤ê°€, ê°€ëœ©ì´ë‚˜ Github Actionì„ ì˜ ëª°ëê¸°ì— í•œ ë²ˆ Github Actionì„ ìˆ˜ì •í•˜ì—¬ í…ŒìŠ¤íŠ¸ í•˜ê³ ì‹¶ì„ ë•Œ ë§ˆë‹¤ ì»¤ë°‹ì„ í•˜ë‚˜ì”© ë‚ ë ¤ì•¼í–ˆë˜ ê²Œ ë¶ˆí¸í–ˆê³ , ë¸Œëœì¹˜ë¥¼ ë”°ë¡œ ë§Œë“¤ê±°ë‚˜ forkë¥¼ ë– ì„œ Github Action í…ŒìŠ¤íŠ¸ í›„ í•´ë‹¹ workflowë§Œ ë§ˆìŠ¤í„°ì— ë¨¸ì§€í•˜ëŠ” ë°©ì‹ ë“±ë“± ë‹¤ì–‘í•œ ë°©ì‹ì„ ì‚¬ìš©í–ˆì—ˆëŠ”ë°, ì–´ëŠ ì •ë„ ìµìˆ™í•´ì§€ê³  Github Actionì— Manual Triggerë„ ë“±ì¥í•˜ê²Œ ë˜ë©´ì„œ ê½¤ë‚˜ ë§Œì¡±ë„ê°€ ë†’ì•„ì¡ŒìŠµë‹ˆë‹¤.\nJenkinsì™€ ë‹¬ë¦¬ ì œê°€ ì„œë²„ë¥¼ ì´ìš©í•˜ì§€ ì•Šì•„ë„ ëœë‹¤ëŠ” ì ë„ ë§˜ì— ë“¤ê¸´í–ˆëŠ”ë°, ì¢…ì¢… Github ì„œë²„ê°€ ì£½ëŠ” ì¼ì´ ë°œìƒí•´ì„œ ë‚œê°í–ˆë˜ ì ì´ ìˆê¸´í•©ë‹ˆë‹¤.\ní•˜ë‚˜ ì¬ë¯¸ìˆì—ˆë˜ ì ì€ Github Actionì„ ì´ìš©í•˜ë©´ì„œ ì €í¬ì˜ CI/CD ì „ëµì´ ê½¤ë‚˜ ê³ ë„í™”ë˜ì—ˆëŠ”ë°, ê·¸ ê³¼ì •ì—ì„œ íŒ€ì›ë“¤ê³¼ ììœ ë¡­ê²Œ ì˜ì‚¬ì†Œí†µí•˜ëŠ” ê³¼ì •ì´ ì¬ë¯¸ìˆì—ˆê³ , ì € ë˜í•œ ììœ ë¡­ê²Œ ì˜ê²¬ì„ ë‚˜ëˆŒ ìˆ˜ ìˆì—ˆë˜ ê²½í—˜ì„ í•  ìˆ˜ ìˆì—ˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.\ní›„ì— ì €í¬ SpaceONEì˜ CLI API í´ë¼ì´ì–¸íŠ¸ì¸ spacectlì˜ ì„¤ê³„ì—ë„ Github Actionì˜ êµ¬ì¡°ë¥¼ ëª¨í‹°ë¸Œì‚¼ì•˜ëŠ”ë° ì´ë•Œì—ë„ Github Actionì— ëŒ€í•œ ì§€ì‹ì´ ë§ì€ ë„ì›€ì´ ë˜ì—ˆê³ , í‡´ì‚¬ í›„ì—ë„ ê°œì¸ì ì¸ Github í™œë™ì„ í•˜ë©´ì„œ ììœ ë¡­ê²Œ Github Actionì„ ì‚¬ìš©í•  ìˆ˜ ìˆì—ˆê¸°ì— ë“ ë“ í•œ ê°œë°œ ë„êµ¬ë¥¼ ì–»ì€ ëŠë‚Œì…ë‹ˆë‹¤. ì½”ë“œë¡œ ì œê°€ í•˜ê³ ì‹¶ì€ ê²ƒì„ ë­ë“  ì •ì˜í•  ìˆ˜ ìˆê³ , ë§Œë“¤ì–´ì ¸ ìˆëŠ” ì‘ì—…ì€ í¸í•˜ê²Œ ê°€ì ¸ë‹¤ ì“°ë©´ ë˜ê¸° ë•Œë¬¸ì— ë¹Œë“œë‚˜ ë°°í¬ì— ê´€í•´ ì¬ë¯¸ìˆëŠ” ë²ˆëœ©ì´ëŠ” ì•„ì´ë””ì–´ê°€ ìˆì„ ë•Œ ë°”ë¡œ ë°”ë¡œ ì ìš©í•  ìˆ˜ ìˆê³ , ì‹¤ì œë¡œ í˜„ì¬ì˜ Github Pageë„ Github Actionì„ í†µí•´ ë‹¤ì–‘í•œ íŠ¸ë¦­ì„ ì´ìš©í•  ìˆ˜ë„ ìˆì—ˆê³ , ë¹Œë“œ í›„ ë°°í¬ ë˜í•œ ìë™í™” ë˜ì–´ìˆìŠµë‹ˆë‹¤!\n","date":"2020-09-04T12:46:54+09:00","image":"https://umi0410.github.io/blog/megazone-cloud/ci-cd-pipeline/ci-cd-pipeline_hu2d78a6f76281dd93e8329c8b5a44cef9_282268_120x120_fill_box_smart1_3.png","permalink":"https://umi0410.github.io/blog/megazone-cloud/ci-cd-pipeline/","title":"2. Github Action, Spinnakerì„ ì´ìš©í•œ CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶•ê¸°"},{"content":"Argo PoCë¥¼ ì§„í–‰í•˜ê²Œ ëœ ë°°ê²½ ì…ì‚¬ ì´ˆê¸°ë¶€í„° Argoì— ëŒ€í•´ ê°„ê°„íˆ ì´ì•¼ê¸°ë¥¼ ë“¤ì–´ì™”ìŠµë‹ˆë‹¤. ì €í¬ëŠ” ì›ë˜ Spinnakerì„ ì‚¬ìš©í–ˆëŠ”ë°, ì¿ ë²„ë„¤í‹°ìŠ¤ í™˜ê²½ì— ì¢€ ë” ì¹œí™”ì ì´ë¼ëŠ” Argoë¥¼ ë„ì…í•´ë³´ëŠ” ê²ƒì€ ì–´ë–¨ê¹Œì— ëŒ€í•œ ì–˜ê¸°ì˜€ëŠ”ë°ìš”. ì–´ëŠì •ë„ ê°œë°œ ì¸í”„ë¼ êµ¬ì¶•ì´ ì™„ë£Œë˜ê³  í•œê°€í•´ì§€ì ì ê¹ì´ë‚˜ë§ˆ Argoë¥¼ ì‚¬ìš©í•´ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ê²°ê³¼ì ìœ¼ë¡œ Argo ë„ì…ì€ ì í•©í•˜ì§€ ì•Šë‹¤ê³  íŒë‹¨ì´ ë˜ì—ˆê³  ë”°ë¼ì„œ ì¶©ë¶„íˆ ì¨ë³¼ ìˆ˜ëŠ” ì—†ì—ˆê¸°ì— ê¸°ë¡ìš©ìœ¼ë¡œë§Œ ê°„ë‹¨íˆ ì ì–´ë³´ê² ìŠµë‹ˆë‹¤.\nArgo Project êµ¬ì¡° Argoê°€ ì›Œë‚™ ë¹ ë¥´ê²Œ ë³€í™”í•˜ëŠ” ì„œë¹„ìŠ¤ë‹¤ë³´ë‹ˆ ì§€ê¸ˆì€ êµ¬ì¡°ê°€ ë§ì´ ë³€ê²½ë˜ì—ˆì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤!\nargo_1 argo_2 ê°„í¸í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìˆœì„œëŠ” argo, argo(workflow), argo event ìˆœì´ë¼ê³  ìƒê°ë˜ëŠ”ë°, ì‹¤ì§ˆì ì¸ íŒŒì´í”„ë¼ì¸ êµ¬ì¶•ì€ argo event, argo (workflow), argo ìˆœìœ¼ë¡œ ì´ë¤„ì§€ëŠ” ì…ˆì´ë¼ í›„ìì˜ ìˆœì„œì— ë§ì¶° ì„¤ëª…í•´ë³´ê² ìŠµë‹ˆë‹¤.\nArgo Event (Official site) argo-events-top-level.png ì…‹ ì¤‘ ê°€ì¥ ë² ì´ë¹„ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤. ë¹ ë¥´ê²Œ ê°œë°œë˜ê³  ìˆê³ , ë³€í™”í•˜ê³ ìˆê¸°ì— ì œê°€ argo projectë“¤ì„ ë§Œë‚¬ë˜ ì‹œì ˆê³¼ ë§ì´ êµ¬ì¡°ê°€ ë‹¬ë¼ì ¸ìˆìŠµë‹ˆë‹¤. ê°„ë‹¨í•˜ê²Œ ë§í•˜ìë©´ ì´ë²¤íŠ¸ë¥¼ ê°ì§€í•˜ì—¬ ì–´ë–¤ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. argo-eventsì˜ ê³µì‹ í™ˆí˜ì´ì§€ì—ì„œ ì œê³µë˜ëŠ” ìœ„ì˜ ì´ë¯¸ì§€ì™€ ê°™ì´ ë‹¤ì–‘í•œ ì´ë²¤íŠ¸ ì†ŒìŠ¤ë¥¼ ì´ìš©í•´ ë‹¤ì–‘í•œ ì´ë²¤íŠ¸ë¥¼ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ AWS SQSì— ë©”ì‹œì§€ê°€ ìƒê¸°ë©´, ê·¸ ë©”ì‹œì§€ë¥¼ ê°€ì ¸ì™€ì„œ ì–´ë–¤ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í˜¹ì€ ì›¹í›… ì„œë²„ë¥¼ ëŒë ¤ì„œ ì›¹í›… ìš”ì²­ì´ ì˜¤ë©´, ì–´ë–¤ ì‘ì—…ì„ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nì œê°€ êµ¬ìƒí•œ íŒŒì´í”„ë¼ì¸ì—ì„œëŠ” ì´ë²¤íŠ¸ë¥¼ ê°ì§€í•˜ëŠ” ì—­í• ë¡œì„œ Argo Eventsë¥¼ ì•ì— ë‘ê³ , Argo Eventsê°€ Workflowë¥¼ ìƒì„±ëŠ” ì‘ì—…ì„ íŠ¸ë¦¬ê±°í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ CI/CDì— ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nArgo, Argo Workflow (Official site) ì…‹ ì¤‘ ê°€ì¥ ì˜¤ë˜ëœ í”„ë¡œì íŠ¸ì´ê³ , ë³„ë„ ë§ìŠµë‹ˆë‹¤. Argo ë¼ëŠ” ì´ë¦„ì„ ê°€ì¡Œê³  ì‹¤ì§ˆì ìœ¼ë¡œëŠ” Workflow ê´€ë ¨ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤. Workflowë€ ì»¨í…Œì´ë„ˆë¥¼ ì´ìš©í•´ ì§„í–‰ë˜ëŠ” ì¼ë ¨ì˜ stepë“¤ì„ ì •ì˜í•˜ëŠ” CRD(K8s Custom Resource Definition ì…ë‹ˆë‹¤.)\nì²˜ìŒì—” \u0026lsquo;êµ³ì´ Workflowê°€ í•„ìš”í• ê¹Œ\u0026rsquo; ì‹¶ì—ˆì§€ë§Œ, ì¿ ë²„ë„¤í‹°ìŠ¤ ìƒì—ì„œ ì¼ë ¨ì˜ Jobì„ ì—°ì†ì ìœ¼ë¡œ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ í˜„ì¬ê¹Œì§€ëŠ” ì—†ëŠ” ê²ƒìœ¼ë¡œ ì•Œê³  ìˆìŠµë‹ˆë‹¤. K8s Jobì˜ Containerì— ëŒ€í•œ InitContainerì„ ì§€ì •í•¨ìœ¼ë¡œì¨ í•œ Jobì— ëŒ€í•œ ë‘ Containerì˜ ìˆœì„œë¥¼ ëª…ì‹œí•  ìˆ˜ëŠ” ìˆì§€ë§Œ, Workflowì²˜ëŸ¼ ë‹¤ì–‘í•˜ê²Œ ì¼ë ¨ì˜ Jobì„ ì—°ì†ì ìœ¼ë¡œ ìˆ˜í–‰í•˜ê¸°ëŠ” í˜ë“  ê²ƒìœ¼ë¡œ ì•Œê³  ìˆìŠµë‹ˆë‹¤.\nArgoCD (Official site) ArgoCDë§Œ ë³´ë©´ ê°€ì¥ ê°„ë‹¨í•˜ê²Œ ì‹¤ì œ CDì— ì ìš©í•  ìˆ˜ ìˆëŠ” í”„ë¡œì íŠ¸ ì¤‘ í•˜ë‚˜ê°€ ì•„ë‹ê¹Œì‹¶ìŠµë‹ˆë‹¤. ArgoCD ìì²´ì— ëŒ€í•œ ì„¤ì •, ì†ŒìŠ¤ê°€ ë  Repositoryì— ëŒ€í•œ ì„¤ì •, Project, Applicationì— ëŒ€í•œ ì„¤ì • ë“±ë“± ëª¨ë“  ê²ƒì´ Code IaCì— íŠ¹í™”ëœ ë…íŠ¹í•œ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.\nUIê°€ ì§ê´€ì ì´ê³  ì•Œì•„ë³´ê¸° ì‰½ì§€ë§Œ, ë°˜ëŒ€ë¡œ ëŒ€ê·œëª¨ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë  ê²½ìš° ë„ˆë¬´ë„ ë°°í¬ í˜„í™©ì„ ë³´ì—¬ì£¼ëŠ” ë§µì´ ì»¤ì§€ê¸° ë•Œë¬¸ì— ì•Œì•„ë³´ê¸° ì‰½ì§€ ì•Šì„ ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤. GitOps(\u0026ldquo;GitOpsì˜ í•µì‹¬ì€ Git ì €ì¥ì†Œì— ì €ì¥ëœ ì¿ ë²„ë„¤í‹°ìŠ¤ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ê°™ì€ íŒŒì¼ì„ ì´ìš©í•˜ì—¬, ë°°í¬ë¥¼ ì„ ì–¸ì ìœ¼ë¡œ í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ì¶œì²˜\u0026rdquo;) ë¼ëŠ” ë§ì— ì•„ë§ˆ ë¹ ì§€ì§€ ì•Šê³  ë“±ì¥í•˜ëŠ” CD ë„êµ¬ì¸ë“¯í•©ë‹ˆë‹¤. Gitì— ì˜¬ë¼ê°€ëŠ” Manifestê°€ ê·¸ëŒ€ë¡œ K8s í´ëŸ¬ìŠ¤í„°ì— ì ìš©ë©ë‹ˆë‹¤. ë§ˆì¹˜ Github Pageë‚˜ S3(ì›¹í˜¸ìŠ¤íŒ… ì„¤ì •ì´ ëœ S3 Bucket)ì— ì˜¬ë¦° íŒŒì¼ë“¤ì´ ë°”ë¡œ í•˜ë‚˜ì˜ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì²˜ëŸ¼ ë™ì‘í•˜ëŠ” ê²ƒê³¼ ë¹„ìŠ·í•œ ëŠë‚Œì…ë‹ˆë‹¤. ê°„ë‹¨í•˜ê²Œ ì‚¬ìš©í•˜ê¸°ì—ëŠ” ArgoCDê°€ ì°¸ ì¢‹ì•„ë³´ì˜€ì§€ë§Œ, ì‹¤ì œë¡œ ì—…ë¬´ì ìœ¼ë¡œ ì‚¬ìš©í•˜ì§€ëŠ” ëª»í•˜ê² ë‹¤ê³  íŒë‹¨í•œ ì´ìœ ê°€ ëª‡ ê°€ì§€ ìˆìŠµë‹ˆë‹¤.\nì• í”Œë¦¬ì¼€ì´ì…˜ í•˜ë‚˜ì— ëŒ€í•œ ë°°í¬ëŠ” ì‰½ì§€ë§Œ, ì—°ì†ì ì¸ ë°°í¬ë‚˜ ë‹¤ì–‘í•œ ë°°í¬ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ê¸°ëŠ” ì–´ë ¤ì› ë‹¤. Github Push ì‹œì— webhookì„ ì„¤ì •í•´ì„œ ArgoCDì˜ ë°°í¬ë¥¼ íŠ¸ë¦¬ê±°í•˜ë„ë¡ í–ˆëŠ”ë° ì´ ë¶€ë¶„ì´ ìµœì í™”ê°€ ëœ ë˜ì—ˆëŠ”ì§€ ì–´ë–¤ repositoryë“  í•˜ë‚˜ì˜ ArgoCD í™˜ê²½ì—ì„œëŠ” Git platform ë‹¹ í•˜ë‚˜ì˜ secretë§Œ ì„¤ì •ì´ ê°€ëŠ¥í–ˆê³ , í•œ repositoryê°€ pushë˜ë©´ ë‹¤ë¥¸ repositoryë„ ë°°í¬ê°€ ë‹¤ ê°™ì´ ì´ë£¨ì–´ì ¸ë²„ë ¸ìŠµë‹ˆë‹¤. (ì´ ë¶€ë¶„ì€ íŒ¨ì¹˜ëì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.) ì†Œê·œëª¨ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ë°°í¬ ìƒí™©ì„ í•œ ëˆˆì— ë³´ê¸° ì‰½ì§€ë§Œ, K8s Objectê°€ ë§ì•„ì§€ë©´ ë§ì•„ì§ˆìˆ˜ë¡ ì ì  í•˜ë‚˜í•˜ë‚˜ ëˆˆì— ë³´ì´ì§€ ì•Šê³ , ì¡ë‹¤í•œ Objectë“¤(ConfigMap, Secret, \u0026hellip;)ë¡œ ì¸í•´ ì¸ì‹í•˜ê¸° í˜ë“­ë‹ˆë‹¤. Argo Projectë¥¼ ì¡°í•©í•œ CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶•ê¸° íŒŒì´í”„ë¼ì¸ ìˆ˜í–‰ ê³¼ì • (Argo Event) Github Pushë¥¼ ê°ì§€í•˜ê³  Argo Workflow CRDë¥¼ ìƒì„± Argo workflowë¥¼ í†µí•´ ë‹¤ì–‘í•œ stepë“¤ì„ ì´ìš©í•˜ê¸° ìœ„í•´ ë°”ë¡œ ArgoCDê°€ Github Pushë¥¼ ë°›ì§€ ì•Šê³ , Argo Eventê°€ ë°›ë„ë¡ í–ˆìŠµë‹ˆë‹¤. Argo Workflowì˜ stepë“¤ ìˆ˜í–‰ Slackì— workflow ì‹œì‘ ì•Œë¦¼ Experiment í™˜ê²½ì— ë°°í¬ (Argo CD ì´ìš©) Interation Test ì‹¤í–‰ íŠ¸ë¦¬ê±° (Jenkins ì´ìš©) Integration Test ê²°ê³¼ê°€ ì„±ê³µì´ë©´ Dev í™˜ê²½ì— ë°°í¬ (Argo CD ì´ìš©) ì–´ëŠ stepì—ì„œë“  ì‹¤íŒ¨ ì‹œ Slackì— ì‹¤íŒ¨ ì•Œë¦¼ ì´ ì •ë„ Pipelineì„ ì§œë©´ ì‚¬ì‹¤ ì‚¬ìš©í•  ì •ë„ëŠ” ë  ìˆ˜ ìˆê² ì§€ë§Œ, \u0026ldquo;ì¼\u0026quot;ë¡œì„œ ë³¸ë‹¤ë©´ êµ³ì´ í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ Spinnakerì— ë¹„í•´ ì¥ì ì´ ëšœë ·í•˜ê²Œ ëŠê»´ì§€ì§€ ì•ŠëŠ” Argoë¥¼ ìœ„í•´ íŒŒì´í”„ë¼ì¸ì„ ì´ì „í•˜ê¸°ì—ëŠ” ì—­ë¶€ì¡±ì´ë¼ëŠ” íŒë‹¨ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ê³¼ì • ëª©ë¡ì—ì„œëŠ” ê°„ë‹¨íˆ ë¬˜ì‚¬í–ˆì§€ë§Œ, Spinnakerì—ì„œëŠ” UIì—ì„œ ì•Œì•„ì„œ ì²˜ë¦¬ë˜ë˜ ë¶€ë¶„ë“¤ì„ í•˜ë‚˜ í•˜ë‚˜ webhookì„ ê±¸ì–´ì£¼ê±°ë‚˜, ë”°ë¡œ bash scriptë¥¼ ì§œì•¼í•˜ëŠ” ê²½ìš°ë“¤ì´ ë§ì•˜ìŠµë‹ˆë‹¤.\nArgo Projectë“¤ì— ëŒ€í•œ PoCë¥¼ ì§„í–‰í•˜ë©° ëŠë‚€ ì  ê°œì¸ì ìœ¼ë¡œëŠ” ë§ì´ ì• ì •ì´ ê°”ë˜ í”„ë¡œì íŠ¸ë“¤ì´ê³  ì‹ ê¸°í–ˆë˜ ë°°í¬ë°©ì‹ì— ëŒ€í•œ ì†Œê°œì˜€ìœ¼ë©°, ì´ í”„ë¡œì íŠ¸ë“¤ì„ ê³µë¶€í•´ë³´ë©´ì„œ ë‹¤ì–‘í•œ ì•„í‚¤í…ì³ì— ëŒ€í•´ ê²½í—˜í•´ë³¼ ìˆ˜ ìˆì—ˆë˜ ê²ƒ ê°™ì§€ë§Œ, í˜„ì‹¤ì ì¸ ë²½ì— ë¶€ë”ªí˜€ ë„ì…ì„ í•  ìˆ˜ ì—†ì—ˆë˜ ì•„ì‰¬ì›€ ì»¸ìŠµë‹ˆë‹¤. ë§ˆì¹˜ ì¢‹ì•„í•˜ëŠ” ë¶„ì•¼ê°€ ìˆì—ˆì§€ë§Œ, í˜„ì‹¤ì˜ ë²½ì— ë¶€ë”ªí˜€ ê¿ˆì„ ì ‘ê³ , ì–´ë– í•œ í˜„ì‹¤ì ì¸ ì§„ë¡œ ë‚˜ì•„ê°€ëŠ” ê²ƒê³¼ ê°™ì•˜ë‹¬ê¹Œìš”?\nê·¸ë¦¬ê³  ê°œì¸ì ì¸ ì•„ì‰¬ì›€ì€ ìœ„ì˜ ì°¨íŠ¸ë¥¼ ì†ìˆ˜ ê·¸ë¦¬ë©° PoC ë¬¸ì„œë¥¼ ì‘ì„±í–ˆì—ˆì§€ë§Œ, ê²°êµ­ì€ PoCë¥¼ ì§„í–‰í•œ ë‹´ë‹¹ìì¸ ì €ì¡°ì°¨ \u0026ldquo;ìŒ\u0026hellip; ì‹¤ì‚¬ìš©ì€ í˜ë“¤ ê²ƒ ê°™ì€ë°ìš”\u0026quot;ë¼ëŠ” ì˜ê²¬ì„ ëƒˆë˜ í„°ë¼ ë°”ìœ ì¼ì • ì†ì—ì„œ rejectí•  ê°œë… ì¦ëª… ë¦¬ë·°ì— ë§ì€ ì‹œê°„ì„ í• ì• í•  ìˆ˜ ì—†ì—ˆê¸°ì—, íŒ€ì›ë“¤ê³¼ ì´ ë‚´ìš©ì„ ê³µìœ í•  ìˆ˜ ì—†ì—ˆë˜ ì ì— ì¡°ê¸ˆ ì•„ì‰¬ì›€ì´ ë‚¨ìŠµë‹ˆë‹¤..! ë§Œì•½ ì •ë§ Argoë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì´ ë›°ì–´ë‚œ ë°©ì‹ì´ì—ˆë‹¤ë©´, ì €ë„ ì ê·¹ ì¶”ì²œí•˜ë©° í•¨ê»˜ ë¦¬ë·°í•´ì£¼ê¸¸ ê¸°ëŒ€í–ˆê² ì§€ë§Œ, í˜„ì‹¤ì ìœ¼ë¡œ ì €í¬ íŒ€ì˜ ë°°í¬ ë°©ì‹ê³¼ëŠ” ë§ì§€ ì•Šì•˜ë‹¤ê³  íŒë‹¨í•´ì„œ ê·¸ë¬ë˜ ê²ƒì´ê¸°ì— ê´œì°®ìŠµë‹ˆë‹¤~!\n","date":"2020-09-04T12:46:54+09:00","image":"https://umi0410.github.io/blog/megazone-cloud/argo-poc/argo-events-top-level_hu911ca173f7b6efecb06ab37a91a70151_401443_120x120_fill_box_smart1_3.png","permalink":"https://umi0410.github.io/blog/megazone-cloud/argo-poc/","title":"3. Argo Projectë“¤ì— ëŒ€í•œ PoC(ê°œë… ì¦ëª…) ì§„í–‰"},{"content":" spaceone-helm-preivew.png SpaceONE Helm Chartë€? spaceone-helm ì€ ì €í¬ CloudOne íŒ€ì´ ê°œë°œí•˜ëŠ” ì„œë¹„ìŠ¤ì¸ SpaceONEì„ helm chartë¥¼ ì´ìš©í•´ íŒ¨í‚¤ì§€í™”í•˜ëŠ” í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤. ì›ë˜ì˜ ì €í¬ í™˜ê²½ì€ MicroServiceë“¤ì„ ê°œë³„ ë°°í¬í•˜ê³ ìˆì—ˆì§€ë§Œ ì˜¤í”ˆì†ŒìŠ¤ë¡œ ê°œë°œë˜ëŠ” ì €í¬ ì„œë¹„ìŠ¤ë¥¼ ì €í¬ íŒ€ì›ë“¤ ë¿ë§Œì•„ë‹ˆë¼ ë‹¤ë¥¸ ê°œë°œìë“¤ì´ ì‰½ê²Œ ê°œë°œí•  ìˆ˜ ìˆê³ , SpaceONEì„ ëª¨ë¥´ë˜ ì‚¬ìš©ìë“¤ë„ ì‰½ê²Œ SpaceONEì„ êµ¬ì¶•í•´ë³¼ ìˆ˜ ìˆë„ë¡ í•˜ê¸° ìœ„í•´ íŒ¨í‚¤ì§€í™”ë„ ì§„í–‰í•˜ê²Œë˜ì—ˆìŠµë‹ˆë‹¤.\nì¼ë°˜ì ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ Helm Chartë¥¼ ì´ìš©í•´ë³´ê¸°ë§Œí–ˆì§€ ì§ì ‘ Chartë¥¼ ë§Œë“œëŠ” ê²ƒì€ ì²˜ìŒ í•´ë³¸ ì¼ì´ê¸°ë„ í–ˆê³ , Chartë¥¼ ê°œë°œí•˜ë©´ì„œ ìƒˆë¡œìš´ í™˜ê²½ì— ì €í¬ ì„œë¹„ìŠ¤ë¥¼ ë°°í¬í•´ë³´ë‹¤ë³´ë‹ˆ ì‚½ì§ˆí•˜ë©° ê³ ìƒë„ ê½¤ í–ˆê³ , ë¬´ì—‡ë³´ë‹¤ í”„ë¡œì íŠ¸ì˜ ì‹œì‘ë¶€í„° í‡´ì‚¬ ì „ê¹Œì§€ì˜ ì‘ì—…ë“¤ì„ ê±°ì˜ ì œê°€ ë„ë§¡ì•„í•œ í”„ë¡œì íŠ¸ì˜€ê¸°ì— ê°œì¸ì ìœ¼ë¡œ ì• ì •ì´ ë§ì´ ê°”ìŠµë‹ˆë‹¤ ^_^! ê·¸ë¦¬ê³  ì €ë„ ì´ì œëŠ” ì €í¬ Chartë¥¼ ì´ìš©í•´ SpaceONEì„ êµ¬ì¶•í˜•ìœ¼ë¡œ ì†ì‰½ê²Œ ì´ìš©í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.\nspaceone-helm ì„¤ê³„ ì¼ë‹¨ì€ ì‹¬í”Œí•˜ê²Œ ì‚¬ì´ë“œì¹´ ì—†ì´ ì €í¬ì˜ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë“¤ë§Œì„ ë°°í¬í•˜ê³ , ê·¸ ì™¸ì— í•„ìš”í•œ ì„œë¹„ìŠ¤ë“¤ë„ ìµœëŒ€í•œ Cloud Serviceì— ì˜ì¡´í•˜ì§€ ì•Šê³  ê·¸ë•Œ ê·¸ë•Œ ì†ì‰½ê²Œ ì„œë¹„ìŠ¤ë¥¼ ë‚´ë ¸ë‹¤ ì˜¬ë ¸ë‹¤ í•  ìˆ˜ ìˆë„ë¡ K8s í´ëŸ¬ìŠ¤í„° ìœ„ì— í•¨ê»˜ ë°°í¬í•˜ëŠ” í˜•ì‹ìœ¼ë¡œ Chartë¥¼ ì„¤ê³„í–ˆìŠµë‹ˆë‹¤.\në¬´ì—‡ë³´ë‹¤ chart ê°œë°œì˜ ëª©ì ì€ ì•„ë˜ ë‘ ê°€ì§€ ì‚¬í•­ì´ ì»¸ê¸° ë•Œë¬¸ì—, minikube í˜¹ì€ EKS ë„ìš´ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë“¤ê³¼ ë¡œì»¬ì—ì„œ í†µì‹ ì´ ê°€ëŠ¥í•˜ë„ë¡ í•´ì•¼í–ˆê³ , ì‚¬ìš©í•˜ê¸° í¸ë¦¬í•œ êµ¬ì¡°ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ ê³ ì‹¬í–ˆìŠµë‹ˆë‹¤.\níŒ€ì›ì´ ì•„ë‹Œ ê°œë°œìë“¤ë„ ìì‹ ì˜ ë¶€ê°€ì ì¸ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¥¼ ë¡œì»¬ì— ë„ì›Œ ê°œë°œí•  ìˆ˜ ìˆë„ë¡ ì§€ì›. ë¡œì»¬ì—ì„œë„ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ë‚´ì˜ ì„œë¹„ìŠ¤ì— ì ‘ì†ì´ ê°€ëŠ¥í•´ì•¼í•˜ê³ , ê²½ìš°ì— ë”°ë¼ í´ëŸ¬ìŠ¤í„°ì—ì„œë„ ë³¸ì¸ì˜ ë¡œì»¬ ì„œë¹„ìŠ¤ë¡œ ì ‘ì†ì„ í•  ìˆ˜ ìˆì–´ì•¼í•¨. ì˜¤í”ˆì†ŒìŠ¤ë¡œì„œ ì„ì˜ì˜ ì‚¬ìš©ìê°€ ì„œë¹„ìŠ¤ë¥¼ êµ¬ì¶•í•´ë³´ê³ ì ì‹œë„í•  ë•Œ ì† ì‰½ê²Œ êµ¬ì¶•í•  ìˆ˜ ìˆë„ë¡ ì§€ì›. ë§ˆì¹˜ ìœ ì €ë“¤ì˜ ì‚¬ìš©ì ê²½í—˜ì„ ì¤‘ìš”ì‹œí•´ì„œ ë””ìì¸, ê¸°íšì„ í•˜ë“¯ Chartì˜ ì‚¬ìš©ìë“¤ì´ ì§ê´€ì ì´ê³  í¸ë¦¬í•˜ê²Œ êµ¬ì¶•í•  ìˆ˜ ìˆë„ë¡ Configuration values(values.yaml in Helm Chart)ë¥¼ ì„¤ê³„í•¨. spaceone-helm chart êµ¬ì¡° templates/ â”œâ”€â”€ backend â”‚Â â”œâ”€â”€ config â”‚Â â”‚Â â”œâ”€â”€ config-conf.yml â”‚Â â”‚Â â”œâ”€â”€ config-deployment.yml â”‚Â â”‚Â â””â”€â”€ config-svc.yml â”‚Â â”œâ”€â”€ identity â”‚Â â”‚Â â”œâ”€â”€ identity-conf.yml â”‚Â â”‚Â â”œâ”€â”€ identity-deployment.yml â”‚Â â”‚Â â””â”€â”€ identity-svc.yml â”‚Â â”œâ”€â”€ inventory â”‚Â â”‚Â â”œâ”€â”€ inventory-conf.yml â”‚Â â”‚Â â”œâ”€â”€ inventory-deployment.yml â”‚Â â”‚Â â””â”€â”€ inventory-svc.yml â”‚Â â”œâ”€â”€ inventory-scheduler â”‚Â â”‚Â â”œâ”€â”€ inventory-scheduler-conf.yml â”‚Â â”‚Â â”œâ”€â”€ inventory-scheduler-deployment.yml â”‚Â â”‚Â â””â”€â”€ inventory-scheduler-svc.yml â”‚Â â”œâ”€â”€ inventory-worker â”‚Â â”‚Â â”œâ”€â”€ inventory-worker-conf.yml â”‚Â â”‚Â â”œâ”€â”€ inventory-worker-deployment.yml â”‚Â â”‚Â â””â”€â”€ inventory-worker-svc.yml #... Backend ìƒëµ â”œâ”€â”€ consul, mongo, redis # ë””í…Œì¼í•œ íŒŒì¼êµ¬ì¡°ëŠ” ìƒëµ â”œâ”€â”€ frontend â”‚Â â”œâ”€â”€ console # ë””í…Œì¼í•œ íŒŒì¼êµ¬ì¡°ëŠ” ìƒëµ â”‚Â â””â”€â”€ console-api # ë””í…Œì¼í•œ íŒŒì¼êµ¬ì¡°ëŠ” ìƒëµ â”œâ”€â”€ ingress â”‚Â â””â”€â”€ ingress.yaml â”œâ”€â”€ initializer â”‚Â â”œâ”€â”€ initialize-spaceone-conf.yml â”‚Â â”œâ”€â”€ initialize-spaceone-job.yml â”‚Â â”œâ”€â”€ spacectl-apply-conf.yml â”‚Â â””â”€â”€ spacectl-conf.yml â””â”€â”€ supervisor â””â”€â”€ supervisor â”œâ”€â”€ supervisor-conf.yml â”œâ”€â”€ supervisor-deployment.yml â””â”€â”€ supervisor-roles.yml ì €í¬ spaceone-helm chartëŠ” ê½¤ë‚˜ êµ¬ì¡°ê°€ ê°„ë‹¨í•œ í¸ì€ ì•„ë‹ˆë¼ê³  ìƒê°ë©ë‹ˆë‹¤. ì›¹í˜ì´ì§€ í™˜ê²½ìƒ ë„ˆë¬´ ë¶€ìˆ˜ì ì¸ ë¶€ë¶„ì€ treeì—ì„œ ìƒëµí•˜ê¸°ë„ í–ˆìŠµë‹ˆë‹¤. ê½¤ë‚˜ ë³µì¡í•œ êµ¬ì¡°ë¥¼ ê°€ì¡Œê¸°ì— íŒ¨í‚¤ì§€í™”í•˜ëŠ” ë¶€ë¶„ì´ ì‰½ì§€ ì•Šì•˜ì§€ë§Œ, ê·¸ëŸ° ê³¼ì • ì†ì—ì„œ ë§ì´ íŠ¸ëŸ¬ë¸” ìŠˆíŒ…ì„ ê²½í—˜í•˜ê³  ì„±ì¥í•  ìˆ˜ ìˆì—ˆë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤.\nê·¸ë¦¬ê³  ë°˜ëŒ€ë¡œ ìƒê°í•˜ë©´, ì„œë¹„ìŠ¤ê°€ íŒ¨í‚¤ì§€í™”í•˜ê¸°ë„ ì‰½ì§€ ì•Šì„ë§Œí¼ ë³µì¡í•œ êµ¬ì¡°ë¥¼ ê°€ì¡Œë‹¤ë©´, ë‹¹ì—°íˆ ì†ìˆ˜ ë°°í¬í•˜ëŠ” ê²ƒì€ ê·¸ê²ƒë³´ë‹¤ ëª‡ ë°°ëŠ” ì–´ë ¤ìš¸ ê²ƒì´ë¯€ë¡œ ëˆ„êµ°ê°€ê°€ ì €í¬ ì„œë¹„ìŠ¤ë¥¼ êµ¬ì¶•í˜•ìœ¼ë¡œ ì´ìš©í•´ì£¼ê¸° ìœ„í•´ì„œëŠ” íŒ¨í‚¤ì§€í™”ê°€ í•„ìˆ˜ë¼ëŠ” ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤.\në§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë“¤ì˜ ë²„ì „ ê´€ë¦¬ë¥¼ ì‹œì‘ Helm Chartë¥¼ ê°œë°œí•˜ê³ , CIê°€ ê³ ë„í™”ë˜ê¸° ì „ê¹Œì§€ëŠ” ë‹¨ìˆœíˆ íŒ€ ë‚´ì—ì„œ ê°œë°œì„ ì§„í–‰í•˜ë©´ì„œ ê°œë°œí™˜ê²½ì— ëŒ€í•œ ë°°í¬ëŠ” latest tagë§Œì„ ì´ìš©í•´ ìë™ìœ¼ë¡œ ì§„í–‰í•˜ê³ , QAë¥¼ ì§„í–‰í•˜ë©´ì„œ ì»¤ë°‹ì„ ë©ˆì¶”ê³ , ê·¸ ì‹œì ì— ë¹Œë“œëœ Docker imageì˜ Tagë¥¼ ë°”íƒ•ìœ¼ë¡œ ìƒìš© í™˜ê²½ì—ë„ ë°°í¬ë¥¼ í•˜ê³¤í–ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ, Chartì—ì„œë„ tagë¥¼ latestë¡œ ìœ ì§€í•˜ê±°ë‚˜ ê°€ë…ì„±ì´ ì¢‹ì§€ ì•Šì€ ì„ì˜ì˜ tagë¥¼ ì´ìš©í•´ ì´ë¯¸ì§€ë¥¼ ì œê³µí•˜ê¸°ëŠ” í˜ë“¤ì—ˆê³ , ë§ëŠ” ë°©í–¥ì´ ì•„ë‹ˆë¼ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤.\në”°ë¼ì„œ ì €í¬ëŠ” ê¼­ Helmì„ í†µí•œ íŒ¨í‚¤ì§€ ë¿ë§Œ ì•„ë‹ˆë¼ ë¡¤ë°±ì— ëŒ€í•œ ì•ˆì •ì„±, ë²„ì „ ê°„ì˜ Update ë‚´ì—­ ê´€ë¦¬ ë“±ì„ ìœ„í•´ {{MAJOR}}.{{MINOR}}.{{SPRINT_NUMBER}}-{{EXTRA_TAGS}} í˜•íƒœë¥¼ í†µí•´ ë²„ì „ì„ ê´€ë¦¬í•˜ê³ ìí–ˆìŠµë‹ˆë‹¤.\nHelm Chartë¥¼ í†µí•´ íŒ¨í‚¤ì§€í™”í•˜ë©° ëŠë‚€ ì  Helm Chartë¥¼ í†µí•´ ì €í¬ ì„œë¹„ìŠ¤ë¥¼ íŒ¨í‚¤ì§€í™”í•˜ê¸° ì „ê¹Œì§€ëŠ” ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ í˜•íƒœë¡œ ê´€ë¦¬ë˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ ìƒˆë¡œìš´ í™˜ê²½ì— ì™„ì „í•˜ê²Œ êµ¬ì¶•í•œë‹¤ëŠ” ê²ƒì€ ì‰½ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. Containerë¼ëŠ” ê²ƒì´ ReadOnly ë ˆì´ì–´ë¡œ ì´ë¯¸ êµ¬ì„±ì´ ì™„ë£Œëœ ì´ë¯¸ì§€ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìƒì„±ë˜ê¸° ë•Œë¬¸ì— ì–¸ì œ ì–´ë””ì„œë“  êµ¬ë™ì´ ê°€ëŠ¥í•˜ë‹¤ëŠ” ê²ƒì´ ì¥ì ì´ê² ì§€ë§Œ, í˜„ì‹¤ì ìœ¼ë¡œëŠ” í™˜ê²½ì— ë”°ë¼ ì´ê²ƒ ì €ê²ƒ ì„¤ì •í•´ì¤˜ì•¼í•˜ëŠ” ê²ƒì´ ìˆì—ˆê¸°ë•Œë¬¸ì…ë‹ˆë‹¤.\nì´ëŸ¬í•œ ë‚œê´€ë“¤ì€ ì–´ë– í•œ ë³€ìˆ˜ì²˜ë¦¬ì™€ ìë™í™”ë¥¼ í†µí•´ í•´ê²°í•  ìˆ˜ ìˆì„í…ë°, ê·¸ëŸ¬í•œ ì‘ì—…ì„ í•´ì¤€ ë…€ì„ì´ ë°”ë¡œ Helmì´ì—ˆê³ , ê·¸ë•Œ ê·¸ë•Œ ì„¤ì •ì„ ë°”ê¿ˆìœ¼ë¡œì¨ ì»¤ìŠ¤í„°ë§ˆì´ì§•í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ ì•Œê³ ëŠ” ìˆì—ˆìŠµë‹ˆë‹¤ë§Œ ë§‰ìƒ ì €í¬ ì„œë¹„ìŠ¤ì— ë„ì…í•´ë³´ë‹ˆ ê½¤ë‚˜ ë§Œì¡±ìŠ¤ëŸ¬ì› ìŠµë‹ˆë‹¤.\nì¼í™”ë¡œ ì‚¬ë‚´ ë„¤íŠ¸ì›Œí¬ê°€ ë§‰íŒ ìƒí™©ì—ì„œë„ ë°›ì•„ë†“ì€ ì´ë¯¸ì§€ë“¤ë§Œ ìˆìœ¼ë©´ ë„¤íŠ¸ì›Œí¬ ì ‘ì†ì„ í•  í•„ìš” ì—†ì´ minikubeì™€ ë¡œì»¬ ì„œë²„ë¥¼ ì´ìš©í•´ minikubeì˜ í´ëŸ¬ìŠ¤í„°ì™€ í†µì‹ í•˜ë©´ì„œ ê°œë°œì„ ì§„í–‰í•  ìˆ˜ë„ ìˆì—ˆìŠµë‹ˆë‹¤.\nëˆ„êµ°ê°€ ì œê°€ ë§Œë“  ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•´ì¤€ë‹¤ëŠ” ê²ƒì€ ì°¸ ë¿Œë“¯í•œ ì¼ì´ì—ˆê³ , ì•ìœ¼ë¡œë„ ì €í¬ helm chartê°€ ì˜ ë°œì „ë˜ì–´ ë”ìš± ë” í¸ë¦¬í•˜ê²Œ êµ¬ì¶•í•  ìˆ˜ ìˆëŠ” í˜•íƒœë¡œ ì œê³µë  ìˆ˜ ìˆê¸°ë¥¼ ê¸°ëŒ€í•´ë´…ë‹ˆë‹¤!\n","date":"2020-09-04T12:46:54+09:00","permalink":"https://umi0410.github.io/blog/megazone-cloud/spaceone-helm/","title":"4. SpaceONE Helm Chart ê°œë°œ"},{"content":"spacectlì´ë€? ì†Œê°œ spacectl ì€ ì €í¬íŒ€ì´ ê°œë°œí•˜ëŠ” ì„œë¹„ìŠ¤ì¸ SpaceONEì˜ gRPC API requestë¥¼ CLIë¡œ ì†ì‰½ê²Œ ìˆ˜í–‰í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” ë„êµ¬ì…ë‹ˆë‹¤. íŒŒì´ì¬ì„ í†µí•´ ê°œë°œí–ˆê³  Click ì´ë¼ëŠ” ëª¨ë“ˆë¡œ CLI í™˜ê²½ì„ ì†ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆì—ˆê³ , Jinja2ë¥¼ í†µí•´ ìƒì„¸í•œ Manifest ë“¤ì—ì„œ ë³€ìˆ˜ ì¹˜í™˜, ë¶„ê¸° ë“±ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.\nì‚¬ìš© ì˜ˆì‹œ A simple example ê°„ë‹¨í•˜ê²Œ spacectlì´ ì–´ë–¤ ì‹ìœ¼ë¡œ ì´ìš©ë˜ëŠ” ë„êµ¬ì¸ì§€ ì˜ˆì‹œë¥¼ ë³´ì—¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤. ì•„ë˜ì˜ ì»¤ë§¨ë“œë¥¼ ì´ìš©í•´ ì†ì‰½ê²Œ SpaceONEì˜ ë‹¤ì–‘í•œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë“¤ì˜ APIë¥¼ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n$ spacectl list domain domain_id | name | state | plugin_id ... domain-abc123abc | umi0410| ENABLED | ... $ spacectl list server -p domain_id=domain-abc123abc server_id | name | provider ... server-abc123abc | foo | aws ... apply command spacectl apply commandëŠ” kubectlì˜ applyì™€ ìœ ì‚¬í•˜ê²Œ ì—†ìœ¼ë©´ ë§Œë“¤ê³ , ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸í•˜ê³  í˜¹ì€ ë‹¨ìˆœíˆ ì–´ë–¤ APIë¥¼ Executeí•˜ëŠ” Taskë“¤ì˜ í”Œë¡œìš°ë¥¼ ê´€ë¦¬í•´ì£¼ëŠ” ì»¤ë§¨ë“œ ì…ë‹ˆë‹¤.\nì•„ì‰½ê²Œë„ í‡´ì‚¬ ì „ì— ë§ˆë¬´ë¦¬ë¥¼ ì§“ì§€ëŠ” ëª»í–ˆìŠµë‹ˆë‹¤. ã…œ.ã…œ í‡´ì‚¬ ì „ê¹Œì§€ ì§„í–‰í•œ ì‘ì—…ì€ ì¼ë¶€ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ CRU(create, read, update), ëŒ€ë¶€ë¶„ì˜ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ Excute(executeí•  APIë¥¼ ì„¤ì •)ê¹Œì§€ì…ë‹ˆë‹¤.\n# main.yaml import: - mongo.yaml # ê°œë³„ yaml fileì—ì„œëŠ” terraform/ansibleê³¼ ê°™ì´ ìˆ˜í–‰í•  Taskë“¤ì„ ì •ì˜ - root_domain.yaml - repository.yaml var: domain_name: root domain_owner: admin admin_username: admin admin_password: admin $ spacectl apply main.yaml ì„¤ê³„ë¥¼ í•˜ë©° ëŠë‚€ ì  ì´ í”„ë¡œì íŠ¸ì— ëŒ€í•œ ì‹¤ì œ ê°œë°œ ì—…ë¬´ ì´ì „ì—ëŠ” ê½¤ë‚˜ ì„¤ê³„ ì—…ë¬´ê°€ ë§ì•˜ìŠµë‹ˆë‹¤. ì €ëŠ” ê·¸ ë™ì•ˆì€ í˜¼ì ì£¼ë¡œ ê°œë°œì„ í•´ì™”ê³ , ì‹¤í–‰ë ¥ ì¢‹ê²Œ ì‹œì‘ì€ í•˜ì§€ë§Œ ì„¤ê³„ëŠ” ì¶©ë¶„í•˜ì§€ ì•Šì€ ì±„ ì„±ê¸‰í•˜ê²Œ ì‹¤í–‰ì— ì˜®ê²¼ë˜ ê²½í—˜ì´ ë§ìŠµë‹ˆë‹¤. ë˜í•œ í•™ìƒì´ì—ˆê³ , ê°œë°œ ê²½ë ¥ì´ ê¸¸ì§€ ì•Šì•˜ê¸°ì— ì‚¬ì‹¤ìƒ \u0026ldquo;ê°œë°œ = ê·¸ë•Œ ê·¸ë•Œ ìƒˆë¡œìš´ ë‚´ìš© ê³µë¶€\u0026quot;ì™€ ê°™ì€ ëŠë‚Œì´ì—ˆê¸°ì— ì• ì´ˆì— ì„¤ê³„ë¥¼ í•˜ë ¤í•´ë„ \u0026lsquo;ë­ê°€ í•„ìš”í•˜ê³  ë­ê°€ ê°€ëŠ¥í•  ê²ƒì´ê³  ë­ê°€ í˜ë“¤ ê²ƒì¸ê°€\u0026rsquo; ë¥¼ íŒë‹¨í•˜ê¸° ì–´ë ¤ì› ìŠµë‹ˆë‹¤.\ní•˜ì§€ë§Œ íŒ€ì›ë“¤ê³¼ í•¨ê»˜ ê°œë°œí•˜ë©´ì„œ ë°¥ ë¨¹ì„ ë•Œ, íšŒì˜ í•  ë•Œ í‹ˆí‹ˆíˆ ì„¤ê³„ ë°©ì‹ê³¼ ìš”ë ¹ì— ëŒ€í•´ ìƒì˜í–ˆê³ , ì²˜ìŒìœ¼ë¡œ ì„¤ê³„ë¥¼ ì–´ëŠ ì •ë„ êµ³íŒ ë’¤ ê°œë°œì— ë“¤ì–´ë“¤ì–´ê°”ë˜ ê²½í—˜ì´ì—ˆìŠµë‹ˆë‹¤.\nì¸í„´ ê¸°ê°„ ë§‰ë°”ì§€ì— ì´ ì„¤ê³„ì— ì°¸ì—¬í•˜ê²Œ ëœ ê²ƒì€ ì •ë§ ê°’ì§„ ê²½í—˜ì´ì—ˆë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤. ì‚¬ì‹¤ ë‹¨ìˆœíˆ ë°ë¸Œì˜µìŠ¤ë¡œì„œ ì¼í•  ë•ŒëŠ” ë‚¨ë“¤ê³¼ ì˜ì‚¬ì†Œí†µí•  ì¼ì´ ê·¸ë¦¬ ë§ì§„ ì•Šì•˜ëŠ”ë°, ì´ ì„¤ê³„ë¥¼ ë§¡ê²Œ ë˜ë©´ì„œ ë§ì€ íšŒì˜ì™€ ëŒ€í™”ë¥¼ í•˜ê²Œë˜ì—ˆìŠµë‹ˆë‹¤. ì„ ë°° ê°œë°œìë¶„ë“¤ê³¼ ì„¤ê³„ì— ëŒ€í•´ ì¦ì€ íšŒì˜ë¥¼ í•˜ë©´ì„œ ì œê°€ ì–´ë–¤ ê°œë°œìê°€ ë˜ê³ ì‹¶ì€ì§€ ì§ì ‘ ëŠë‚„ ìˆ˜ ìˆì—ˆë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ê·¸ ë°°ê²½ì—ëŠ” ë‘ ê°€ì§€ ì¶©ê²©ì´ ìˆì—ˆìŠµë‹ˆë‹¤.\n\u0026lsquo;ë‚´ê°€ ë‚¨ì˜ ìƒê°ì„ ì˜ ì½ëŠ” í¸ì€ ì•„ë‹ˆì—ˆë‚˜ë³´êµ°\u0026hellip;?\u0026rsquo; \u0026lsquo;ì„ ë°° ê°œë°œìë¶„ì€ ë‚´ê°€ ê°œíŒìœ¼ë¡œ ì„¤ëª…í•´ë„ ì–´ë–»ê²Œ ê·€ì‹ ê°™ì´ ë‚˜ë³´ë‹¤ ë‚´ ìƒê°ì„ ì˜ ì½ìœ¼ì‹œì§€?\u0026rsquo; =\u0026gt; ë§ˆì¹˜ ì¶•êµ¬í•  ë•Œ ë…¸ë ¨í•œ ì¶•êµ¬ì„ ìˆ˜ì™€ í•¨ê»˜ ë›°ë©´ì„œ ì € í–‰ë™ì„ ê·€ì‹ ê°™ì´ ì˜ˆì¸¡í•˜ê³ ì„œëŠ” ë„ˆë¬´ë‚˜ë„ ì˜ ë°€ì–´ì£¼ëŠ” ëŠë‚Œì„ ë°›ì•˜ìŠµë‹ˆë‹¤\u0026hellip; ì œê°€ í‰ì†Œì— ë§ì„ ì˜í•˜ëŠ” í¸ì´ë¼ê³  ìƒê°í–ˆëŠ”ë°, ë‚¨ì˜ ìƒê°ì„ ì´í•´í•˜ê³  ì½ì–´ë‚´ëŠ” ëŠ¥ë ¥ì€ ê·¸ë¦¬ ë›°ì–´ë‚˜ì§€ë§ì€ ì•Šêµ¬ë‚˜ë¼ëŠ” ìƒê°ì„ í•˜ê²ŒëìŠµë‹ˆë‹¤. ì„¤ê³„ ë‚´ìš©ì´ ê½¤ë‚˜ ì¶”ìƒì ìœ¼ë¡œ êµ¬ë‘ë¡œ ì§„í–‰ë˜ì—ˆê¸°ì— ê·¸ë¬ì„ ìˆ˜ë„ ìˆê² ì§€ë§Œ, í° ì¶©ê²©ì€ ì„ ë°° ê°œë°œìë¶„ì˜ ë…¸ë ¨í•¨ì´ì—ˆìŠµë‹ˆë‹¤.\ní›„ì— ëˆ„êµ°ê°€ ì–´ë–¤ ê°œë°œìê°€ ë˜ê³ ì‹¶ëƒ, í˜‘ì—…í•  ë•Œ ì–´ë–¤ ë…¸í•˜ìš°ê°€ ìˆëŠëƒ ì´ëŸ° ë‚´ìš©ì„ ë¬¼ì–´ë³´ë©´ ìì‹ ìˆê²Œ ë‚¨ì˜ ìƒê°ì„ ì˜ ì´í•´í•˜ê³ , ì•Œì•„ì£¼ëŠ” ì‚¬ëŒê³¼ ê´€ë ¨í•´ ëŒ€ë‹µí•  ìˆ˜ ìˆëŠ” ì‚¬ëŒì´ ë  ìˆ˜ ìˆì—ˆìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.\në˜í•œ ì„¤ê³„ ê¹Šê²Œ ì§„í–‰í•˜ê¸° ì „ì— ì¹¨ì°©í•˜ê²Œ ìë£Œ ì¡°ì‚¬ë¥¼ ì˜ í•´ì•¼í•œë‹¤ëŠ” ê²ƒì„ ëŠê¼ˆìŠµë‹ˆë‹¤.\ní•˜ë‚˜ ì¼í™”ë¡œ ì›ë˜ëŠ” ì„¤ì • íŒŒì¼ì—ì„œ ${{ tasks.umi0410.output }} ì´ëŸ° ì‹ì˜ ë³€ìˆ˜ë¥¼ ì´ìš©í•œ ì„¤ì •ì„ ì¹˜í™˜í•œ ë’¤ APIë¥¼ ìˆ˜í–‰í•´ì•¼í•  ë•Œ, ì•„ë§ˆ template ì–¸ì–´ë“¤ì„ ì œê°€ ì›í•˜ëŠ” ëŒ€ë¡œ ì‚¬ìš©í•˜ê¸° í˜ë“¤ ê²ƒì´ë¼ ìƒê°í•˜ê³ , í•˜ë‚˜í•˜ë‚˜ í•¨ìˆ˜ì™€ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ê°€ê³¤í–ˆëŠ”ë°, ê°œë°œì´ ê±°ì˜ ì™„ë£Œë˜ì–´ê°ˆì¯¤ Jinja2ì˜ ì‚¬ìš©ë²•ì„ ë‹¤ì‹œ ì½ë‹¤ë³´ë‹ˆ spacectlì— Jinja2ë¥¼ ì ì ˆíˆ ì‚¬ìš©í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ì•˜ê³ , ì •ì‹ ì´ ë²ˆëœ© ë“¤ì–´ ëª‡ ì‹œê°„ë§Œì— ìˆ˜ì‘ì—…ìœ¼ë¡œ ì§  ì½”ë“œë“¤ì„ ëœì–´ë‚´ê³  Jinja2ë¥¼ ì´ìš©í•´ ì¢€ ë” ê¹”ë”í•˜ê²Œ ë³€ìˆ˜ ì¹˜í™˜ ë° ì¶”ê°€ë¡œ Jinja2ì˜ built-in filterë“¤ì„ ì´ìš©í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤!\nê°œë°œí•˜ë©´ì„œ ëŠë‚€ ì  ì—­ì‹œ ê°œë°œì€ ë‚¨ì´ ë§Œë“  íŒ¨í‚¤ì§€ë¥¼ ì˜ ì‚¬ìš©í•´ì•¼í•œë‹¤ëŠ” ê²ƒì„ ëŠê¼ˆê³ , ê·¸ëƒ¥ ë³µì‚¬ ë¶™ì—¬ë„£ê¸°ë§Œ ì˜í•˜ë©´ ëœë‹¤ëŠ” ì˜ë¯¸ê°€ ì•„ë‹ˆë¼, ê·¸ëŸ° ê²ƒë“¤ì„ ë¹ ë¥´ê²Œ ê°€ì ¸ì™€ì„œ ì ìš©ì‹œí‚¤ê³  ë¶€ë¶„ ë¶€ë¶„ ì»¤ìŠ¤í„°ë§ˆì´ì§•í•˜ê¸° ìœ„í•´ì„œëŠ” ê¸°ë³¸ê¸°ê°€ íƒ„íƒ„í•´ì•¼í•œë‹¤ê³  ëŠê¼ˆìŠµë‹ˆë‹¤. ë¬¼ë¡  ìˆ˜ì‘ì—…ìœ¼ë¡œ ë§Œë“œëŠ” ê²ƒë„ ì¢‹ì„ ìˆ˜ ìˆê² ì§€ë§Œ, ë‹¤ì–‘í•œ ì—£ì§€ì¼€ì´ìŠ¤ê°€ ì¡´ì¬í•  ìˆ˜ ìˆê³ , ê·¸ ëª¨ë“  ì‘ì—…ë“¤ì„ ë¬¸ì„œë¡œ ìƒì„¸íˆ ì„¤ëª…í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ë©´, ì œì‘ìì¸ ì œê°€ ì•„ë‹Œ ëˆ„êµ°ê°€ê°€ ê·¸ ê¸°ëŠ¥ì„ ì´ìš©í•˜ê¸°ëŠ” í˜ë“¤ ê²ƒì…ë‹ˆë‹¤. Jinja2ë¥¼ ì´ìš©í•œ í…œí”Œë¦¿ ê¸°ëŠ¥ ì œê³µì´ ì´ì™€ ê´€ë ¨ëœ ê²½í—˜ì´ ë  ìˆ˜ ìˆê² ìŠµë‹ˆë‹¤.\në˜í•œ ë‚¨ì˜ ì½”ë“œë¥¼ ìì„¸íˆ ì½ì–´ë³´ëŠ” ê²Œ ì²˜ìŒì´ì—ˆëŠ”ë°, ë•ë¶„ì— íŒŒì´ì¬ í”„ë¡œì íŠ¸ë¥¼ ìˆ˜í–‰í•  ë•Œ ì–´ë–¤ ì‹ìœ¼ë¡œ ë””ë ‰í† ë¦¬ ìŠ¤íŠ¸ëŸ­ì³ë¥¼ ì§œë©´ ì¢‹ì„ ì§€ ìƒê°í•´ë³¼ ìˆ˜ ìˆì—ˆë˜ ê³„ê¸°ì˜€ë˜ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì œê°€ ì„¤ê³„í•˜ê³ , ê°œë°œí•œ ë‚´ìš©ì„ ì§§ê²Œë‚˜ë§ˆ ë°œí‘œí•œ ë’¤ ë¦¬ë·°ë¥¼ ë°›ê³  ìˆ˜ì •ì„ í•˜ë©´ í•œì¸µ ë” ì½”ë“œì˜ êµ¬ì¡°ì™€ ì‚¬ìš©ì´ ê°„ê²°í•˜ê³  ì§ê´€ì ìœ¼ë¡œ ë³´ì¸ë‹¤ëŠ” ëŠë‚Œì„ ë°›ì„ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ ë‹¤ì–‘í•œ ê°€ë¥´ì¹¨ì„ ì£¼ì‹  ì €í¬ íŒ€ì˜ ì„ ë°° ê°œë°œìë¶„ë“¤ê»˜ í•­ìƒ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤.\nMegazone CloudOne íŒ€ì˜ DevOps ì¸í„´ìœ¼ë¡œì„œ ê·¼ë¬´í–ˆë˜ ë‚´ìš©ì— ëŒ€í•œ í›„ê¸°ê°€ ê±°ì˜ ëë‚¬ìŠµë‹ˆë‹¤. ëìœ¼ë¡œ ì¸í„´ í™œë™ì— ëŒ€í•œ ì¢…í•©ì ì¸ ëŠë‚€ì ì„ ì´ì–´ì„œ ë³´ì‹œê±°ë‚˜ ë‹¤ì‹œ ëª©ì°¨ë¥¼ ë³´ê³ ì‹¶ìœ¼ì‹  ë¶„ì€ ì—¬ê¸°ë¥¼ í´ë¦­í•´ì£¼ì„¸ìš”.\n","date":"2020-09-04T12:46:54+09:00","permalink":"https://umi0410.github.io/blog/megazone-cloud/spacectl/","title":"5. SpaceONE CLI Clientì¸ spacectl ì„¤ê³„ ë° ê°œë°œ"},{"content":"ğŸ¶ ì‹œì‘í•˜ë©° ë³¸ ê²Œì‹œê¸€ì€ AWS ëŒ€í•™ìƒ ìœ ì €ê·¸ë£¹ì¸ AUSGì˜ í™œë™ ì¤‘ í•˜ë‚˜ë¡œì„œ ë³¸ì¸(ë°•ì§„ìˆ˜)ì´ ì‘ì„±í•œ ê²Œì‹œë¬¼ì„ í¬ì›Œë”©í•œ ê²ƒì…ë‹ˆë‹¤.\npreview.png ë°ë¸Œì˜µìŠ¤ ì¸í„´ìœ¼ë¡œ ê·¼ë¬´í•œ ì§€ê°€ ë²Œì¨ ë‘ ë‹¬ì´ ë˜ì–´ê°‘ë‹ˆë‹¤. ì´ê²ƒ ì €ê²ƒ ë°°ìš´ ê²ƒì´ ë§ì•˜ë˜ ì‹œê°„ì´ì—ˆëŠ”ë°, ê·¸ ì¤‘ ê½¤ë‚˜ ì‚½ì§ˆì„ í–ˆë˜ Kubernetes ì™€ ELBë¥¼ ì´ìš©í•˜ëŠ” ë¶€ë¶„ì— ëŒ€í•´ ì •ë¦¬ë¥¼ í•´ë³¼ê¹Œí•©ë‹ˆë‹¤. jenkins, spinnaker, argo, terraform, ansible, github action, \u0026hellip; ë“±ë“± ë‹¤ì–‘í•œ ë‚´ìš©ì„ ê²½í—˜í•  ìˆ˜ ìˆë˜ ì‹œê°„ì´ì—ˆì§€ë§Œ, ê·¸ ì¤‘ kubernetesì—ì„œ ë¬´ìŠ¨ ì‘ì—…ì„ í•˜ë˜ ë¹¼ë†“ì„ ìˆ˜ ì—†ìœ¼ë©´ì„œ ì–´ë”˜ê°€ ê¹”ë”íˆ ê·¸ íë¦„ì´ ì •ë¦¬ëœ ê³³ì„ ë³´ê¸° í˜ë“¤ì—ˆë˜ serviceë¥¼ ELBì— ì—°ê²°í•˜ê¸°ì— ëŒ€í•œ ë‚´ìš©ì„ ì •ë¦¬í•´ë³´ê² ìŠµë‹ˆë‹¤.\në³¸ í¬ìŠ¤íŠ¸ëŠ” EKSë¥¼ í†µí•´ K8së¥¼ ì´ìš©í•  ë•Œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì„¤ëª…í•©ë‹ˆë‹¤.\nğŸ’ğŸ»â€â™‚ï¸ EKS ì—ì„œ ELBë¥¼ ì‚¬ìš©í•´ ì„œë¹„ìŠ¤ë¥¼ ë…¸ì¶œí‚¬ ë•Œ ìœ ì˜ì‚¬í•­ë“¤ ğŸ§ : \u0026quot; ELB, NLB, ALB ëŒ€ì²´ ë­ê°€ ë‹¤ë¥¸ ê±°ì•¼..?ã…œã…œ ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ ì“¸ ë•ŒëŠ” ì–´ë–»ê²Œ ì–˜ë„¤ë¥¼ ì§€ì •í•˜ëŠ” ê±°ì§€..? kubectl expose deploy {{deployment_name}} --type=LoadBalancer í•˜ë©´ ê·¸ëƒ¥ ì‘ë™ì€ í•˜ë˜ë°\u0026hellip;\u0026quot;\nEKSì—ì„œ ì£¼ë¡œ ì‚¬ìš©í•˜ëŠ” ELBëŠ” L4ì˜ NLBì™€ L7ì˜ ALB ì…ë‹ˆë‹¤. ALBê°€ L7ì— ëŒ€í•œ ì¢€ ë” ë‹¤ì–‘í•œ ì„¤ì •ì´ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì— ì¡°ê±´ì´ ë§ê¸°ë„ í•˜ê³ , AWSì˜ ALBë§Œì„ ìœ„í•œ alb-ingress-controllerë¼ëŠ” ë…€ì„ì´ ì§ì ‘ Ingressì˜ ì„¤ì •ë“¤ì„ ê´€ë¦¬í•´ì£¼ê¸° ë•Œë¬¸ì— ì„¤ì •í•  ìˆ˜ ìˆëŠ” ì˜µì…˜ë„ ë§ìŠµë‹ˆë‹¤. ì¢‹ê²Œ ë³´ë©´ ë§ì€ ì„¤ì •ì„ í•  ìˆ˜ ìˆê³ , ë‚˜ì˜ê²Œ ë³´ë©´ ì´ˆë³´ìì—ê² ê·€ì°®ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. NLBëŠ” ë¹„êµì  ì„¤ì •ì´ ì ê³  ë”°ë¼ì„œ ì„¤ì •í•´ì¤„ ìˆ˜ ìˆëŠ” í•­ëª©ë„ ì ìŠµë‹ˆë‹¤.\nì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ë‹¤ì–‘í•œ ì‘ì—…ì„ í•˜ë©´ì„œ ë‹¤ì–‘í•œ controllerì„ ì ‘í•˜ê²Œ ë˜ê³ , ê·¸ë ‡ê²Œ ë  ìˆ˜ë¡ annotationìœ¼ë¡œ ë§ì€ ì„¤ì •ì„ í•˜ê²Œ ë©ë‹ˆë‹¤. k8së¥¼ ì²˜ìŒ ì ‘í•  ë•Œì—ëŠ” annotationì— ëŒ€í•œ ì •ì˜ë¡œì„œ ì•„ë˜ì™€ ê°™ì€ ë¬¸ì¥ì„ ì ‘í•  ìˆ˜ ìˆê³ , ë§ˆì¹˜ ê¸°ëŠ¥ê³¼ í¬ê²Œ ìƒê´€ì´ ì—†ì„ ê²ƒì²˜ëŸ¼ ëŠê»´ì§€ê¸°ë„ í•˜ì§€ë§Œ ì‚¬ì‹¤ EKSë¥¼ ë¹„ë¡¯í•œ ì—¬ëŸ¬ ì„œë¹„ìŠ¤ì—ì„œëŠ” annotationì„ ì´ìš©í•´ ì¤‘ìš”í•œ ì„¤ì • ë“±ì„ ê¸°ì…í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì˜ ì„¤ì •í•´ì£¼ì–´ì•¼í•©ë‹ˆë‹¤. ELBë˜í•œ ëª¨ë“  ì„¤ì •ì´ annotationìœ¼ë¡œ ë™ì‘í•œë‹¤.\n\u0026quot; Labelì„ ì‚¬ìš©í•˜ì—¬ ì˜¤ë¸Œì íŠ¸ë¥¼ ì„ íƒí•˜ê³ , íŠ¹ì • ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ì˜¤ë¸Œì íŠ¸ ì»¬ë ‰ì…˜ì„ ì°¾ì„ ìˆ˜ ìˆë‹¤. ë°˜ë©´ì—, annotationì€ ì˜¤ë¸Œì íŠ¸ë¥¼ ì‹ë³„í•˜ê³  ì„ íƒí•˜ëŠ”ë° ì‚¬ìš©ë˜ì§€ ì•ŠëŠ”ë‹¤. ì–´ë…¸í…Œì´ì…˜ì˜ ë©”íƒ€ë°ì´í„°ëŠ” ì‘ê±°ë‚˜ í¬ê³ , êµ¬ì¡°ì ì´ê±°ë‚˜ êµ¬ì¡°ì ì´ì§€ ì•Šì„ ìˆ˜ ìˆìœ¼ë©°, ë ˆì´ë¸”ì—ì„œ í—ˆìš©ë˜ì§€ ì•ŠëŠ” ë¬¸ìë¥¼ í¬í•¨í•  ìˆ˜ ìˆë‹¤.\u0026quot;\nâš ï¸ ALBë¥¼ ì‚¬ìš©í•  ë•Œ ìœ ì˜í•  ì  ì–´ë–¤ ì˜µì…˜ë“¤ì´ ìˆê³ , ê¸°ë³¸ì ìœ¼ë¡œëŠ” ì–´ë–»ê²Œ ì„¤ì •ë˜ëŠ” ì§€ì— ëŒ€í•œ ì´í•´ê°€ ìˆì–´ì•¼ ì˜¤ë¥˜ ê³¼ì •ì„ ì¶”ì í•˜ê¸° ì‰¬ìš°ë¯€ë¡œ ê¸°ë³¸ì ìœ¼ë¡œ ALBë¥¼ AWS Consoleì—ì„œ ì‚¬ìš©í•´ë³¸ ë’¤ì— ì„¤ì •í•  ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤.\nalb ingress controllerê°€ ìƒì„±í•  ALBê°€ ì‚¬ìš©í•  ì„œë¸Œë„·ì„ discoverí•˜ê¸° ìœ„í•´ì„œëŠ” ì˜¬ë°”ë¥¸ íƒœê·¸ê°€ ë‹¬ë¦° subnetì´ ì¡´ì¬í•´ì•¼í•œë‹¤. node í˜¹ì€ alb ingress controllerì— ì—°ê²°ëœ service accountê°€ albë¥¼ ì œì–´í•˜ê¸° ìœ„í•œ iam permissionì´ ë¶€ì—¬ë˜ì–´ì•¼í•œë‹¤. internet facingí•œ albë¥¼ ë§Œë“¤ì§€ internalí•œ albë¥¼ ë§Œë“¤ì§€ ê³ ë¯¼í•´ë´ì•¼í•œë‹¤. alb ingress controllerì˜ logë¥¼ í†µí•´ ì‘ì—…ì— ëŒ€í•œ logë¥¼ ë³¼ ìˆ˜ ìˆë‹¤. âš ï¸ NLB, CLBë¥¼ ì‚¬ìš©í•  ë•Œ ìœ ì˜í•  ì  https://kubernetes.io/ko/docs/concepts/services-networking/service/#aws-nlb-support\nhttps://docs.aws.amazon.com/ko_kr/eks/latest/userguide/load-balancing.html\nNLB, CLBê°€ ì‚¬ìš©í•  ì„œë¸Œë„·ì„ ì„¤ì •í•˜ê¸° ìœ„í•´ì„œëŠ” ì˜¬ë°”ë¥¸ íƒœê·¸ê°€ ë‹¬ë¦° subnetì´ ì¡´ì¬í•´ì•¼í•œë‹¤. ì–´ëŠ ë¶€ë¶„ì—ì„ ê°€ NLB, CLBë¥¼ ì œì–´í•˜ê¸° ìœ„í•œ iam permissionì´ ë¶€ì—¬ë˜ì–´ì•¼í•œë‹¤. (ì–´ëŠ ë¶€ë¶„ì¸ì§€ í™•ì‹¤íˆëŠ” ëª¨ë¥´ê² ìŒ. ë”°ë¡œ ì„¤ì •ì•ˆí•´ë„ ë™ì‘í•˜ëŠ” ê²ƒì„ ë³´ì•„ worker nodeê°€ ê°–ëŠ” iam roleì— permissionì´ ë¶™ì–´ìˆì„ ê²ƒìœ¼ë¡œ ì˜ˆìƒë¨) ğŸŒ ALBë¥¼ ì‚¬ìš©í•´ ì„œë¹„ìŠ¤ë¥¼ ë…¸ì¶œì‹œí‚¤ëŠ” ë°©ë²• ğŸ˜Š ALBëŠ” K8sì— ì¹œìˆ™í•˜ì§€ ì•Šìœ¼ì‹  ë¶„ë“¤ê»˜ëŠ” ë‹¤ì†Œ ì§„ì…ì¥ë²½ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëƒ¥ ì„œë¹„ìŠ¤ë¥¼ ë…¸ì¶œì‹œí‚¬ ë•ŒëŠ” êµ³ì´ ì‚¬ìš©í•  í•„ìš” ì—†ëŠ” Ingress ë¼ëŠ” ì˜¤ë¸Œì íŠ¸ë„ ê´€ë¦¬í•´ì•¼í•˜ê³ , alb-ingress-contollerë¼ëŠ” ë…€ì„ë„ ë°°í¬í•´ì•¼í•˜ë©° ì„¤ì •ì´ ë‹¤ì–‘í•˜ê¸° ë•Œë¬¸ì´ì£ ! ğŸ’¦\nK8sì—ì„œ EKSë¥¼ ì‚¬ìš©í•´ ALBë¥¼ ì´ìš©í•˜ê³ ì‹¶ì€ ê²½ìš° alb-ingress-controllerì„ ë°°í¬í•œ ë’¤, Ingressë¥¼ í†µí•´ ì‚¬ìš©í•  albì— ëŒ€í•œ ruleì„ ì„¤ì •ì„ í•´ì£¼ì–´ì•¼í•©ë‹ˆë‹¤.\nhttps://kubernetes-sigs.github.io/aws-alb-ingress-controller/guide/controller/setup/ ì˜ ë‚´ìš©ì„ ë²„ë¦´ ë¶€ë¶„ì´ í•˜ë‚˜ë„ ì—†ìŠµë‹ˆë‹¤. ìœ„ ë§í¬ë¥¼ í†µí•´ alb-ingress-controllerì— ëŒ€í•œ ê°œë…ì„ ì¡ê³  ë°°í¬í•´ë´…ë‹ˆë‹¤. alb-ingress-controller.yamlì˜ ì¸ìë¥¼ ì ì ˆíˆ ìˆ˜ì •í•´ì£¼ì–´ì•¼í•©ë‹ˆë‹¤.\nALBê°€ ì•„ë‹Œ k8s cluster ìƒì—ì„œ L7 LoadBalancerë¥¼ ì´ìš©í•˜ëŠ” ê²½ìš°ì—ëŠ” nginx ingress controllerë“±ì„ ì´ìš©í•˜ë©° nginx ì— ì ìš©í•  ruleì„ Ingressë¼ëŠ” K8s Objectë¥¼ í†µí•´ ì„¤ì •í•©ë‹ˆë‹¤. ingress controllerì˜ ì„¤ì •ì—ì„œ ìì‹ ì˜ class nameì„ ì ì–´ì£¼ê³ , Ingressì—ì„œëŠ” ì–´ë–¤ class nameì˜ ingress controllerì—ì„œ ìì‹ (Ingressì´ì Rule)ì„ ì ìš©í•˜ë„ë¡ í•  ì§€ë¥¼ annotationì„ í†µí•´ ì„¤ì •í•˜ê±°ë‚˜ ingressClassNameì´ë¼ëŠ” í•„ë“œë¥¼ í†µí•´ ì„¤ì •í•©ë‹ˆë‹¤.(ingress ì„¤ì •ì— ëŒ€í•œ ì°¸ê³  - https://kubernetes.io/ko/docs/concepts/services-networking/ingress/#ì¸ê·¸ë ˆìŠ¤-í´ë˜ìŠ¤)\nì´ì™€ ê°™ì€ ê²½ìš°ì—ëŠ” ingress controllerê°€ ì§ì ‘ ingressì— ëª…ì‹œëœ ruleì„ ì´ìš©í–ˆì§€ë§Œ, alb-ingress-controllerì˜ ê²½ìš°ëŠ” alb-ingress-controllerê°€ nginx-ingress-controllerì²˜ëŸ¼ ì§ì ‘ ì›¹ì„œë²„ì˜ ì—­í• ì„ í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ, ingressì— ëª…ì‹œëœ ruleì„ ì´ìš©í•˜ëŠ” ALBë¥¼ ìƒì„±í•˜ê³  ê´€ë¦¬í•˜ëŠ” ì—­í• ì„ í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ ë¶€ë¶„ì´ ì²˜ìŒì—ëŠ” ë‹¤ì†Œ í—·ê°ˆë¦¬ê²Œ ëŠê»´ì§ˆ ìˆ˜ ìˆê¸°ì— ê¸¸ê²Œ ì„œìˆ í•´ë³´ì•˜ìŠµë‹ˆë‹¤.\nì‹¤ì œë¡œ ingressë¥¼ ìƒì„±í•œ ë’¤ ì•ì—ì„œ ë°°í¬í•œ alb-ingress-controllerì˜ logë¥¼ ë³´ë©´ albë¥¼ ê´€ë¦¬í•˜ê¸°ìœ„í•œ ì—¬ëŸ¬ ì‘ì—…ì„ ìˆ˜í–‰ì¤‘ì¸ ëª¨ìŠµì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nê·¸ëŸ¼ ì´ì œ ì‹¤ì œë¡œ alb ingress controllerì„ í†µí•´ albë¥¼ ì´ìš©í•´ë³´ê² ìŠµë‹ˆë‹¤.\nALBë¥¼ ì›í™œíˆ ì œì–´í•˜ê¸° ìœ„í•œ permission ë¶€ì—¬ ALB iam ì •ì±… ì°¸ê³  https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/alb-ingress.html https://raw.githubusercontent.com/kubernetes-sigs/aws-alb-ingress-controller/v1.1.2/docs/examples/iam-policy.json ALBë¥¼ ì œì–´í•˜ê¸° ìœ„í•´ì„œëŠ” awsì˜ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì–´ë– í•œ permissionì´ í•„ìš”í•©ë‹ˆë‹¤. nodeì— ë¶€ì—¬í•  ìˆ˜ë„ ìˆê³ , IAM Userì— ë¶€ì—¬í•œ ë’¤ alb ingress controllerì˜ ì„¤ì •ì—ì„œ í•´ë‹¹ IAM Userì˜ Keyë¥¼ ë¶€ì—¬í•  ìˆ˜ë„ ìˆê³ , Service accountì™€ IAM Roleì„ OIDC(OpenID Connectë¥¼ ì´ìš©í•´ Service accountì™€ IAM Roleì„ ì—°ê²°ì‹œí‚¤ëŠ” ì‘ì—…)ë¥¼ ì´ìš©í•´ ì—®ì€ ë’¤, alb ingress controller podì— í•´ë‹¹ Service Accountë¥¼ ë¶€ì—¬í•  ìˆ˜ë„ ìˆì§€ë§Œ ë’¤ì˜ ë°©ë²•ë“¤ì€ ì¢€ íŠœí† ë¦¬ì–¼ì¹˜ê³  íˆ¬ë¨¸ì¹˜í•œ ê°ì´ ìˆê¸°ë•Œë¬¸ì—, ê°„ë‹¨íˆ nodeì— Permissionì„ ë¶€ì—¬í•˜ë„ë¡í•˜ê² ìŠµë‹ˆë‹¤.\niam.png worker nodeë“¤ì´ ì´ìš©í•˜ëŠ” IAM Roleì— Policyë¥¼ ì¶”ê°€í•œ ëª¨ìŠµ.\nalbê°€ ì‚¬ìš©í•  subnetì— ì ì ˆí•œ íƒœê·¸ ë‹¬ê¸° https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/alb-ingress.html ì— ë‚˜ì™€ìˆë“¯ì´ ELBê°€ ì´ìš©í•˜ëŠ” ì„œë¸Œë„·ì„ ìë™ìœ¼ë¡œ ì„¤ì •ë˜ë„ë¡ í•˜ê¸° ìœ„í•´ì„œëŠ” ì‚¬ìš©í•˜ê³ ì í•˜ëŠ” ì„œë¸Œë„·ì— ì•„ë˜ì™€ ê°™ì€ íƒœê·¸ë“¤ì„ ë‹¬ì•„ì£¼ì–´ì•¼í•œë‹¤.\nkubernetes.io/cluster/\u0026lt;cluster-name\u0026gt; = shared | owned # Required kubernetes.io/role/internal-elb = 1 | \u0026#34;\u0026#34; # Optional, for internal alb kubernetes.io/role/elb = 1 | \u0026#34;\u0026#34; # Optional, for internet-facing alb a | bì™€ ê°™ì€ í‘œí˜„ì€ a ë‚˜ bì¤‘ í•œ ê°’ì„ ê°€ì ¸ì•¼í•œë‹¤ëŠ” ì˜ë¯¸ë¡œ í‘œí˜„í•œ ê²ƒì…ë‹ˆë‹¤.\ntag.png internet facing ALBë§Œ ì´ìš©í•  ê²ƒì´ê¸° ë•Œë¬¸ì— kubernetes.io/role/internal-elb tagëŠ” ìƒëµí•˜ê³  íƒœê·¸ë¥¼ ë‹¬ì•„ì¤€ ëª¨ìŠµ.\nsubnetì— ALBë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ íƒœê·¸ë¥¼ ì œëŒ€ë¡œ ë‹¬ì•„ì£¼ì§€ ì•Šì„ ê²½ìš° alb-ingress-controller ì—ì„œ ì•„ë˜ì™€ ê°™ì€ ë¡œê·¸ë¥¼ ë³´ê²Œ ë©ë‹ˆë‹¤. ALBê°€ ìƒì„±ë˜ì§€ë„ ì•ŠìŠµë‹ˆë‹¤.\ncontroller.go:217] kubebuilder/controller \u0026#34;msg\u0026#34;=\u0026#34;Reconciler error\u0026#34; \u0026#34;error\u0026#34;=\u0026#34;failed to build LoadBalancer configuration due to failed to resolve 2 qualified subnet for ALB. Subnets must contains these tags: \u0026#39;kubernetes.io/cluster/umi-dev\u0026#39;: [\u0026#39;shared\u0026#39; or \u0026#39;owned\u0026#39;] and \u0026#39;kubernetes.io/role/internal-elb\u0026#39;: [\u0026#39;\u0026#39; or \u0026#39;1\u0026#39;] alb ingress controller ë°°í¬í•˜ê¸°. ìŠ¬ìŠ¬ ì½ê¸° ê·€ì°®ì•„ì§ˆ íƒ€ì´ë°ì…ë‹ˆë‹¤. \u0026lsquo;ìš”ë†ˆì´ IAM policyë„ ë§Œë“¤ê³ , ì„œë¸Œë„·ì— ì—„í•œ íƒœê·¸ë¥¼ ë‹¬ë”ë‹ˆ ì´ì œëŠ” í•˜,,, ë­˜ ë˜ ë°°í¬í•˜ë¼ê³  í•˜ëŠ”êµ¬ë‚˜ ì•„ì´ê³  ë‚´ ëˆˆì•„,,,\u0026rsquo; ì‹¶ê² ì§€ë§Œ, ì¢€ ë” í˜ì„ ë‚´ì–´ë´…ì‹œë‹¤ ğŸ»\nhttps://kubernetes-sigs.github.io/aws-alb-ingress-controller/guide/controller/setup/ ë¥¼ ì°¸ê³ í•˜ì—¬ Deployment ë‚´ì˜ containerì˜ argsë¥¼ ìì‹ ì˜ ìƒí™©ì— ë§ê²Œ ìˆ˜ì •í•œ ë’¤ ë°°í¬í•´ì¤ë‹ˆë‹¤.\n... args: - --ingress-class=alb # ingressì˜ annotationì— ëª…ì‹œí•  class name - --cluster-name=umi-dev # eks cluster name - --aws-region=ap-northeast-2 - --aws-api-debug=true ì €ëŠ” ìœ„ì™€ ê°™ì€ ì‹ìœ¼ë¡œ ì„¤ì •í•´ì£¼ì—ˆê³ , ì˜ ë°°í¬ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ë´…ë‹ˆë‹¤.\n$ kubectl get po -A | grep alb kube-system alb-ingress-controller-594f84b465-q4qjb 1/1 Running 0 106m ë…¸ì¶œì‹œí‚¬ ì„œë¹„ìŠ¤ ë°°í¬í•˜ê¸° ê°„ë‹¨í•˜ê²Œ Nginxë¥¼ ë°°í¬í•´ë³´ë¡í•˜ê² ìŠµë‹ˆë‹¤.\napiVersion: v1 kind: Service metadata: name: ingress-test spec: selector: app: nginx ports: - protocol: TCP port: 80 targetPort: 80 nodePort: 30010 type: NodePort --- apiVersion: apps/v1 kind: Deployment metadata: name: ingress-test labels: app: nginx spec: replicas: 3 selector: matchLabels: app: nginx template: metadata: labels: app: nginx spec: containers: - name: nginx image: nginx ports: - containerPort: 80 ALBëŠ” ê¸°ë³¸ì ìœ¼ë¡œ nodeì˜ Portë¥¼ AWS ìƒì˜ target groupìœ¼ë¡œì„œ ì´ìš©í•˜ê¸° ë•Œë¬¸ì—, ingressë¥¼ í†µí•´ ë…¸ì¶œì‹œì¼œì¤„ ì„œë¹„ìŠ¤ëŠ” ì ì–´ë„ NodePort íƒ€ì…ìœ¼ë¡œ ë…¸ì¶œë˜ì–´ìˆì–´ì•¼ ALB ingress controllerê°€ í•´ë‹¹ ì„œë¹„ìŠ¤ë¥¼ ë…¸ì¶œì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.(target typeì„ ê¸°ë³¸ê°’ì¸ instanceê°€ ì•„ë‹ˆë¼ IPë¡œ ì„¤ì •í•˜ë©´, Podì˜ IPë¡œ íŠ¸ë˜í”½ì´ í˜ëŸ¬ê°€ê²Œ í•  ìˆ˜ëŠ” ìˆìŠµë‹ˆë‹¤.)\nì‘ë™ë°©ì‹ì„ ì„¤ëª…í•´ë³´ìë©´ ingress ëŠ” service nameê³¼ service portë¥¼ ì„¤ì •ìœ¼ë¡œ ë°›ìŠµë‹ˆë‹¤. alb-ingress-controllerëŠ” ê·¸ëŸ¬ë©´ í•´ë‹¹ service name, service portì™€ ì—°ê²°ëœ NodePortë¥¼ ì°¾ì•„ì„œ ALBì˜ target groupìœ¼ë¡œ ë“±ë¡ì‹œí‚µë‹ˆë‹¤.\nIngress ë°°í¬í•˜ê¸° apiVersion: extensions/v1beta1 kind: Ingress metadata: name: \u0026#34;ingress\u0026#34; annotations: kubernetes.io/ingress.class: alb # the value we set in alb-ingress-controller alb.ingress.kubernetes.io/scheme: internet-facing spec: rules: - http: paths: - path: /* backend: serviceName: \u0026#34;ingress-test\u0026#34; servicePort: 80 https://kubernetes-sigs.github.io/aws-alb-ingress-controller/guide/ingress/annotation/ ì„ ì°¸ê³ í•˜ì—¬ Ingressë¥¼ ì‘ì„±í•´ì¤ë‹ˆë‹¤. [kubernetes.io/ingress.classëŠ”](http://kubernetes.io/ingress.classëŠ”) alb-ingress-controllerì—ì„œ ì„¤ì •í•œ ingress.classë¥¼ ì ì–´ì£¼ê³ , alb.ingress.kubernetes.io/schemeëŠ” ìš©ë„ì— ë”°ë¼ internet-facing í˜¹ì€ internalì„ ì ì–´ì¤ë‹ˆë‹¤. ingress ë¥¼ ìƒì„±í•˜ê¸° ì „ì— kubectl logs -f {alb-ingress-controller pod name}ì„ í•œ ì°½ì— ë„ì›Œë†“ìœ¼ë©´ ALB ìƒì„± ê´€ë ¨ ë¡œê·¸ë¥¼ ì­ˆë£¨ë£© ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nelb.png ì˜ ì„¤ì •ë˜ì—ˆë‹¤ë©´ ìœ„ì™€ ê°™ì´ ALBê°€ ìƒì„±ë  ê²ƒ ì…ë‹ˆë‹¤.\n$ kubectl get ingress NAME HOSTS ADDRESS PORTS AGE ingress * bf1e76be-default-ingress-e8c7-1351183883.ap-northeast-2.elb.amazonaws.com 80 30s ì¸ì¦ì„œ ì„¤ì •ì„ í†µí•´ HTTPS ê¹Œì§€?! â¤ï¸ AWS Certificate Managerì™€ Ingressì— ëŒ€í•œ annotationì„ ì´ìš©í•´ ê°„ë‹¨í•˜ê²Œ HTTPSë¥¼ ì´ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤! ì§ì ‘í•˜ë ¤ë©´ ë„ë©”ì¸ ì†Œìœ  ì¸ì¦ê³¼ ì¸ì¦ì„œ, ë¹„ë°€í‚¤ ë“±ì„ ëª¨ë‘ ê´€ë¦¬í•´ì•¼í–ˆëŠ”ë° ë§ì´ì§€ìš”! ğŸ¥\ncert.png ì´ëŸ°ì‹ìœ¼ë¡œ AWSì˜ Certificate Managerì„ í†µí•´ ë°œê¸‰ë°›ì€ ì¸ì¦ì„œê°€ ìˆë‹¤ë©´ ì´ë¥¼ alb ì—ì„œ ingressì— annotationì„ ì„¤ì •í•¨ìœ¼ë¡œì¨ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nIngressì˜ annotationì— HTTPSë° ì¸ì¦ì„œ ê´€ë ¨ ì„¤ì • ì¶”ê°€í•´ì£¼ê¸°\napiVersion: extensions/v1beta1 kind: Ingress metadata: name: \u0026#34;ingress\u0026#34; annotations: kubernetes.io/ingress.class: alb alb.ingress.kubernetes.io/scheme: internet-facing alb.ingress.kubernetes.io/listen-ports: \u0026#39;[{\u0026#34;HTTP\u0026#34;: 80}, {\u0026#34;HTTPS\u0026#34;: 443}]\u0026#39; alb.ingress.kubernetes.io/actions.redirect-to-https: \u0026gt; {\u0026#34;Type\u0026#34;:\u0026#34;redirect\u0026#34;,\u0026#34;RedirectConfig\u0026#34;:{\u0026#34;Port\u0026#34;:\u0026#34;443\u0026#34;,\u0026#34;Protocol\u0026#34;:\u0026#34;HTTPS\u0026#34;,\u0026#34;StatusCode\u0026#34;:\u0026#34;HTTP_302\u0026#34;}} alb.ingress.kubernetes.io/certificate-arn: {Certificate Mangerì˜ ì¸ì¦ì„œ arn} ... http redirect ë° actionsì— ëŒ€í•œ ë‚´ìš©ì€ ì €ì˜ ì• êµì…ë‹ˆë‹¤. ê¶ê¸ˆí•˜ì‹  ë¶„ë“¤ì€ í•œ ë²ˆ ì ìš©í•´ë³´ì‹œê±°ë‚˜ ì•Œì•„ë³´ì‹œë©´ ì–´ë µì§€ ì•Šê²Œ ì•Œì•„ë‚´ì‹¤ ìˆ˜ ìˆì„ ê²ë‹ˆë‹¤! ğŸ˜†\nRoute53ì— ALB ì¶”ê°€í•´ì£¼ê¸°\nEKSì—ì„œ ALBë¥¼ ì‚¬ìš©í•˜ëŠ” ë“±ì˜ ì‘ì—…ì„ í•˜ì‹œëŠ” ë¶„ì€ ì–´ëŠ ì •ë„ awsì— ëŒ€í•œ ì´í•´ê°€ ìˆìœ¼ë¦¬ë¼ ìƒê°í•˜ê³ , ALBë¥¼ Route53ì„ í†µí•´ ë ˆì½”ë“œë¡œ ì¶”ê°€í•˜ëŠ” ì‘ì—…ì— ëŒ€í•œ ì„¤ëª…ì€ ìƒëµí•˜ê² ìŠµë‹ˆë‹¤.\ncert2.png alb-ingress-controllerë¡œ AWS Certificate Managerì˜ ì¸ì¦ì„œê¹Œì§€ ì‚¬ìš©í•œ ëª¨ìŠµ.\nğŸŒ NLBë¥¼ ì‚¬ìš©í•´ ì„œë¹„ìŠ¤ë¥¼ ë…¸ì¶œì‹œí‚¤ëŠ” ë°©ë²• CLBëŠ” Deprecate ëŒ€ìƒì´ë¼ê³  ë“¤ì—ˆê¸°ë„ í•˜ê³ , êµ³ì´ ì¨ë³¸ ì ì´ ì—†ì–´ NLBë¡œë§Œ ì„¤ëª…í•©ë‹ˆë‹¤. NLBëŠ” ALBì— ë¹„í•´ ì‚¬ìš©ì´ ê°„ë‹¨í•©ë‹ˆë‹¤.\nIngressì™€ alb-ingress-controllerë¥¼ ì‚¬ìš©í–ˆë˜ ALBì™€ ë‹¬ë¦¬ NLBëŠ” ì„œë¹„ìŠ¤ë¥¼ ì§ì ‘ ë…¸ì¶œì‹œí‚µë‹ˆë‹¤. ì£¼ë¡œ Nginx Ingress Controllerì„ NLBì— ì—°ê²°í•´ì„œ ì‚¬ìš©í–ˆë˜ ê¸°ì–µì´ ë‚©ë‹ˆë‹¤. NLBëŠ” L4 LBë¡œ, Nginxë¥¼ ì£¼ë¡œ L7 LBë¡œ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ì´ë ‡ê²Œ NLBë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ALBì™€ Nginx ëª¨ë‘ L7 LBë¡œì„œ ì—­í• ì„ í•˜ê¸°ë•Œë¬¸ì— êµ³ì´ ALBë¥¼ ì‚¬ìš©í•  í•„ìš”ê°€ ì—†ëŠ” ê²½ìš°ê°€ ë§ì•˜ìŠµë‹ˆë‹¤.\nNLBë¥¼ í†µí•´ ì„œë¹„ìŠ¤ë¥¼ ë…¸ì¶œì‹œí‚¤ê¸° ìœ„í•´ì„  annotaionì¤‘ì—ì„œë„ [service.beta.kubernetes.io](http://service.beta.kubernetes.io/)...í˜•íƒœì˜ annotationì„ ì´ìš©í•©ë‹ˆë‹¤. ì‚¬ì‹¤ ì‹¤ì œë¡œ ì‹¤ë¬´í•´ì„œ ì‚¬ìš©í•´ë³¸ annotationì€ ê±°ì˜ [service.beta.kubernetes.io/aws-load-balancer-type:](http://service.beta.kubernetes.io/aws-load-balancer-type:) \u0026quot;nlb\u0026quot; ë¿ì…ë‹ˆë‹¤. (ì´ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì„ ê²½ìš° ë””í´íŠ¸ê°€ CLBì´ê¸° ë•Œë¬¸ì—\u0026hellip;)\nNLBê°€ ì‚¬ìš©í•  subnetì— ì ì ˆí•œ íƒœê·¸ ë‹¬ê¸° ALBë¥¼ ì‚¬ìš©í–ˆì„ ë•Œì™€ ë§ˆì°¬ê°€ì§€ë¡œ NLBê°€ ì‚¬ìš©í•  ì„œë¸Œë„·ì— í•„ìˆ˜ íƒœê·¸ë¥¼ ë‹¬ì•„ì¤ë‹ˆë‹¤. ê¸°ì–µì´ ì•ˆë‚œ ë‹¤ë©´ ê¸€ì˜ ìƒë‹¨ ALB íŒŒíŠ¸ë¥¼ ì°¸ê³ !\nNLBë¡œ ë…¸ì¶œí•  ì„œë¹„ìŠ¤ ìƒì„±í•˜ê¸° apiVersion: v1 kind: Service metadata: name: nginx-nlb annotations: service.beta.kubernetes.io/aws-load-balancer-type: \u0026#34;nlb\u0026#34; spec: selector: app: nginx ports: - protocol: TCP port: 80 targetPort: 80 nodePort: 30011 type: LoadBalancer terminal.png zzal.png ê°„ë‹¨íˆ typeì„ LoadBalancerë¡œ ë°”ê¾¸ì–´ì£¼ê³ , annotationì— ì–´ë–¤ ELBë¥¼ ì‚¬ìš©í• ì§€( NLB/CLB )ë§Œ ì ì–´ì£¼ë©´ ì•„ë˜ ê·¸ë¦¼ì²˜ëŸ¼ ì†ì‰½ê²Œ NLBë¡œ ì„œë¹„ìŠ¤ë¥¼ ë…¸ì¶œ ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nì¸ì¦ì„œ ì„¤ì •ì„ í†µí•´ HTTPSê¹Œì§€?! ğŸŒ‹: \u0026ldquo;ê·¸ë§Œ\u0026hellip;. ì•„ë¬´ë„ ì•ˆ ê¶ê¸ˆí•´\u0026hellip;\u0026rdquo; - í•˜ì§€ë§Œ ë§ˆì§€ë§‰ê¹Œì§€ í˜ì„ ë‚´ì„œ EKSì—ì„œì˜ ELBë¥¼ ì •ë³µí•´ë´…ì‹œë‹¤!\napiVersion: v1 kind: Service metadata: name: nginx-nlb annotations: service.beta.kubernetes.io/aws-load-balancer-type: \u0026#34;nlb\u0026#34; service.beta.kubernetes.io/aws-load-balancer-backend-protocol: tcp service.beta.kubernetes.io/aws-load-balancer-ssl-ports: \u0026#34;443\u0026#34; service.beta.kubernetes.io/aws-load-balancer-ssl-cert: arn:aws:acm:ap-northeast-2:{{root}}:certificate/{{arn}} spec: selector: app: nginx ports: - protocol: TCP port: 80 targetPort: 80 nodePort: 30011 - protocol: TCP port: 443 targetPort: 80 nodePort: 30012 type: LoadBalancer backend-protocolì€ tcp|tls í˜¹ì€ https|httpë¡œ ì„¤ì •ì´ ë ëŠ” ë“¯í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ backend-protocol ë¡œ tcpë¥¼ ì„¤ì •í•œ ë’¤ ssl-portë¡œ 443ì„ ì„¤ì •, ì„œë¹„ìŠ¤ì˜ specì—ì„œì˜ í¬íŠ¸ë¡œëŠ” 80ê³¼ 443ì„ ì„¤ì •í•˜ë©´, ìë™ì ìœ¼ë¡œ 80ì€ tcp, 443ì€ tlsë¥¼ ì´ìš©í•˜ëŠ” NLB listenerë¡œ ì„¤ì •ë˜ê²Œ ë˜ëŠ”ë° http,httpsë„ ë§ˆì°¬ê°€ì§€ë¡œ tcp,tlsë¡œ ì ì ˆíˆ ì„¤ì •ì´ ë©ë‹ˆë‹¤. ë‹¤ë§Œ http,httpsë¥¼ ì„¤ì •í•  ê²½ìš° X-Forwarded-For í—¤ë”ê°€ ì‚½ì…ëœë‹¤ê³  í•©ë‹ˆë‹¤. (ì •í™•í•˜ì§€ëŠ” ì•Šì•„ìš”\u0026hellip; ë”±íˆ NLBì˜ backend protocolì„ L7ìœ¼ë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì´ NLBì˜ ì›ë˜ ìŠ¤í™ì´ ì•„ë‹ˆì—ˆë˜ ì ë„ ìˆê³ , L7ì„ ì´ìš©í•˜ê³  ì‹¶ìœ¼ë©´, ALBë¥¼ ì´ìš©í•˜ëŠ” ê²ƒì´ ë” í¸í•˜ë‹¤ê³  ìƒê°ì´ ë“¤ì–´ì„œ ë”°ë¡œ ê²€ì¦í•´ë³¸ ì ì´ ì—†ê¸° ë•Œë¬¸ì—\u0026hellip; )\nâš ï¸ë‹¨ì ì´ í•˜ë‚˜ ìˆë‹¤ë©´ ì•„ì§ httpâ‡’https redirectê°€ ë¶ˆê°€ëŠ¥í•˜ë‹¤ëŠ” ê²ƒì¸ë°, ì´ëŠ” ì• ì´ˆì— L4 LBë¥¼ ì´ìš©í•˜ëŠ” ê²ƒê³¼ L7 LBë¥¼ ì´ìš©í•˜ëŠ” ì“°ì„ì— ëŒ€í•œ ì°¨ì´ë¼ê³  ìƒê°ì„ í•˜ê¸° ë•Œë¬¸ì— ê°ìˆ˜ë¥¼ í•´ì•¼í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ L4 NLBì— L7 nginx-ingress-controllerì„ ì—°ê²°í•˜ì—¬ redirectëŠ” nginxê°€ ë‹´ë‹¹í•˜ë„ë¡í•˜ëŠ” ë°©ì‹ì„ ë§ì´ ì´ìš©í•˜ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤. NLBì—ì„œëŠ” L4 ì˜ ë­”ê°€ SSL/TLSí•œ ì‘ì—…ì„ í•˜ê¸° ìœ„í•¨ì´ê³ , L7ì˜ https ì‘ì—…ì´ ì£¼ê°€ ë˜ëŠ” ê²ƒì€ ì•„ë‹ˆë¯€ë¡œ\u0026hellip;? ì‚¬ì‹¤ ì´ ë¶€ë¶„ì€ ì˜ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤\u0026hellip;ğŸ’¦ğŸ’¦ ì˜ ì•„ì‹œëŠ” ë¶„ì´ ê³„ì‹œë‹¤ë©´ ì•Œë ¤ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤. ã…œã…œã…œ( NLBì—ì„œ HTTP, HTTPS redirectê°€ ì•ˆë˜ëŠ” ì´ìœ  ì°¸ê³  - https://aws.amazon.com/premiumsupport/knowledge-center/redirect-http-https-elb/ )\nâ­•ï¸ NLBë¥¼ í†µí•œ HTTPS ì„œë²„ êµ¬ì¶• ê²°ê³¼ ì–´ì¨Œë“  ìœ„ì˜ annotationì„ í†µí•´ ì˜¬ë°”ë¥´ê²Œ svcë¥¼ ì„¤ì •í•œë‹¤ë©´\n$ kubectl get svc nginx-nlb LoadBalancer 10.100.180.174 ae27784521c4f4bcd96b22f2cca2358b-4bffb166fafa47f2.elb.ap-northeast-2.amazonaws.com 443:30014/TCP 37m Route53 ì„¤ì •ì€ ì¶”ê°€ë¡œ í•´ì£¼ì–´ì•¼í•¨. - ì˜ˆì‹œ nlb.umidev.net - ALIAS ae2778452xxxxxxxxxxxxxx.elb.ap-northeast-2.amazonaws.com ì´ë ‡ê²Œ serviceê°€ ìƒì„±ë  ê²ƒì´ê³ , (serviceì˜ portë¡œì„œ ì‚¬ìš©í•  80,443 ë“±ì€ service.specì—ì„œ ëª…ì‹œ) ìƒì„± í›„ A Record Aliasë¡œì„œ NLBì˜ DNS nameì„ ë„£ì–´ì£¼ë©´ ì‚¬ì§„ê³¼ ê°™ì´ HTTPS ì ‘ì†ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤!\ncert3.png ğŸ³ ë§ˆì¹˜ë©° ì–´ì°¨í”¼ í•œ ë²ˆì˜ ê²€ìƒ‰ì´ë©´ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆëŠ” ëª¨ë“  annotationì´ë‚˜ ê¸°íƒ€ ì„¤ì •ì— ëŒ€í•œ ë‚´ìš©ì„ ë‹¤ë£¨ê¸° ë³´ë‹¨ ë‚˜ë¦„ ì œê°€ ì‹¤ì œë¡œ ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ ê´€ë¦¬í•˜ëŠ” ë°ë¸Œì˜µìŠ¤ ì¸í„´ë¡œì„œ ì¼ì„ í•˜ë©´ì„œ í—·ê°ˆë ¸ë˜ ë‚´ìš©ê³¼ EKSì—ì„œì˜ ELB ê´€ë¦¬ì— ëŒ€í•œ íë¦„ì„ ìœ„ì£¼ë¡œ ì„¤ëª…í•˜ë ¤ ë…¸ë ¥í–ˆê³ , ì €ì˜ ì‚½ì§ˆì´ ê¹ƒë“  ë‚´ìš©ë“¤ì…ë‹ˆë‹¤ ã…ã…ã…\nì•„ëŠ” ë²”ìœ„ + ì¢€ ë” ì¡°ì‚¬í•˜ì—¬ ì—´ì‹¬íˆ ì •ë¦¬í•´ë³´ì•˜ì§€ë§Œ, ë¶€ì¡±í•œ ë¶€ë¶„ì´ ìˆì„ ìˆ˜ë„ ìˆê³  í‹€ë¦° ë¶€ë¶„ì´ ìˆì„ ìˆ˜ë„ ìˆì„í…ë°, ë³´ì™„í•´ì£¼ì‹¤ ë‚´ìš©ì´ ìˆë‹¤ë©´ ë§ì”€í•´ì£¼ì‹œë©´ ì—´ì‹¬íˆ ê²€í† í•´ë³´ê² ìŠµë‹ˆë‹¤~! ê°ì‚¬í•©ë‹ˆë‹¤.\nğŸ§™â€â™‚ï¸ê¸€ì“´ì´ ë°•ì§„ìˆ˜ - ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘§AUSG (AWS University Student Group) 3ê¸°ë¡œ í™œë™ ì¤‘ ê´€ì‹¬ì‚¬ Docker, Kubernetes ë“±ì˜ ì»¨í…Œì´ë„ˆ ê¸°ìˆ  Argo, Spinnaker, Github action ë“±ì˜ CI/CD íˆ´ Terraform, AWSë¥¼ í†µí•œ í´ë¼ìš°ë“œ ì¸í”„ë¼ êµ¬ì¶• Blog - https://senticoding.tistory.com Email - bo314@naver.com ğŸ“š ì°¸ê³  (References) EKSì˜ Required subnet tags https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/load-balancing.html https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/alb-ingress.html Kubernetes Cloud provider aws - https://kubernetes.io/docs/concepts/cluster-administration/cloud-providers/#aws ALB ingress controller install - https://kubernetes-sigs.github.io/aws-alb-ingress-controller/guide/controller/setup/ ALB ingress Annotation https://kubernetes-sigs.github.io/aws-alb-ingress-controller/guide/ingress/annotation/ NLBì˜ HTTPS redirectê°€ ë¶ˆê°€ëŠ¥í•œ ì´ìœ  -https://aws.amazon.com/premiumsupport/knowledge-center/redirect-http-https-elb/ NLB service Annotations - https://kubernetes.io/ko/docs/concepts/services-networking/service/#aws-nlb-support Ingressì˜ classì— ëŒ€í•´ - https://kubernetes.io/ko/docs/concepts/services-networking/ingress/#ì¸ê·¸ë ˆìŠ¤-í´ë˜ìŠ¤ ","date":"2020-09-06T19:11:07+09:00","image":"https://umi0410.github.io/blog/aws/aws_eks_elb/preview_huc38b74e19f60c2848e88837c4c6920fa_1709468_120x120_fill_box_smart1_3.png","permalink":"https://umi0410.github.io/blog/aws/aws_eks_elb/","title":"EKS K8sì—ì„œ ELB(ALB, NLB) ì œëŒ€ë¡œ ì„¤ì •í•˜ë©° ì‚¬ìš©í•˜ê¸°"}]